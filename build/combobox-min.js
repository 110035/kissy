/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: May 29 00:21
*/
KISSY.add("combobox/combobox-tpl",function(){return'<div id="ks-combobox-invalid-el{{id}}" class="{{getBaseCssClasses "invalid-el"}}"> <div class="{{getBaseCssClasses "invalid-inner"}}"></div> </div> {{#if hasTrigger}} <div id="ks-combobox-trigger{{id}}" class="{{getBaseCssClasses "trigger"}}"> <div class="{{getBaseCssClasses "trigger-inner"}}">&#x25BC;</div> </div> {{/if}} <div class="{{getBaseCssClasses "input-wrap"}}"> <input id="ks-combobox-input{{id}}" aria-haspopup="true" aria-autocomplete="list" aria-haspopup="true" role="autocomplete" aria-expanded="false" {{#if disabled}} disabled {{/if}} autocomplete="off" class="{{getBaseCssClasses "input"}}" value="{{inputValue}}" /> <label id="ks-combobox-placeholder{{id}}" for="ks-combobox-input{{id}}" style=\'display:{{#if inputValue}}none{{else}}block{{/if}};\' class="{{getBaseCssClasses "placeholder"}}"> {{placeholder}} </label> </div>'});
KISSY.add("combobox/render",function(i,d,g){var j=d.Render.extend({initializer:function(){var c=this.get("childrenElSelectors");i.mix(c,{input:"#ks-combobox-input{id}",trigger:"#ks-combobox-trigger{id}",invalidEl:"#ks-combobox-invalid-el{id}",placeholderEl:"#ks-combobox-placeholder{id}"})},getKeyEventTarget:function(){return this.get("input")},_onSetCollapsed:function(c){this.get("input").attr("aria-expanded",!c)},_onSetInputValue:function(c,d){d.causeByTimer||this.get("input").val(c)},_onSetDisabled:function(c){j.superclass._onSetDisabled.apply(this,
arguments);this.get("input").attr("disabled",c)}},{ATTRS:{collapsed:{value:!0,sync:0},hasTrigger:{value:!0,sync:0},inputValue:{sync:0},input:{},disabled:{sync:0},trigger:{},placeholder:{},placeholderEl:{},invalidEl:{},contentTpl:{value:g}},HTML_PARSER:{input:function(c){return c.one("."+this.getBaseCssClass("input"))},trigger:function(c){return c.one("."+this.getBaseCssClass("trigger"))},invalidEl:function(c){return c.one("."+this.getBaseCssClass("invalid-el"))},placeholderEl:function(c){return c.one("."+
this.getBaseCssClass("placeholder"))}}});return j},{requires:["component/base","./combobox-tpl"]});
KISSY.add("combobox/base",function(i,d,g,j,c,l){function b(e){var a=this,b;b=a.get("menu");e.target==b&&(e=b.get("el"),b=b.get("contentEl"),e.on("focusout",t,a),e.on("focusin",q,a),b.on("mouseover",k,a),b.on("mousedown",function(){a.setValueInternal(a.getValueInternal())}))}function a(e){e=e.target;e.isMenuItem&&(e=e.get("textContent"),this.setValueInternal(e),this._savedInputValue=e,this.set("collapsed",!0))}function k(){this.focus();q.call(this)}function h(e,a){var b=e.get("el"),k=e.get("view").getBaseCssClasses("invalid"),
c=e.get("invalidEl");a?(b.addClass(k),c.attr("title",a),c.show()):(b.removeClass(k),c.hide())}function f(e,a){var b=e.get("menu");if(b&&!b.isController)if(a)b=e.createChild(b),e.setInternal("menu",b);else return null;return b}function p(){var e=f(this);e&&e.get("visible")&&this.alignInternal()}function t(){var e=this;e._focusoutDismissTimer=setTimeout(function(){e.set("collapsed",!0)},30)}function q(){var e;if(e=this._focusoutDismissTimer)clearTimeout(e),this._focusoutDismissTimer=null}function n(){this.set("inputValue",
this.get("input").val(),{data:{causeByTimer:1}})}function s(e){var a,b=[],k,c,h=f(this,1),e=this.normalizeData(e);h.removeChildren(!0);(c=h.get("highlightedItem"))&&c.set("highlighted",!1);if(e&&e.length){for(c=0;c<e.length;c++)a=e[c],b.push(h.addChild(a));e=this.getValueInternal();if(this.get("highlightMatchItem"))for(c=0;c<b.length;c++)if(b[c].get("textContent")==e){b[c].set("highlighted",!0);k=!0;break}if(!k&&this.get("autoHighlightFirst"))for(c=0;c<b.length;c++)if(!b[c].get("disabled")){b[c].set("highlighted",
!0);break}this.set("collapsed",!1);p.call(this)}else this.set("collapsed",!0)}var o,c=d.all,m=d.KeyCodes,r={points:["bl","tl"],overflow:{adjustX:1,adjustY:1}},u=c(i.Env.host);return o=g.Controller.extend({_savedInputValue:null,normalizeData:function(e){var a,b,c;if(e&&e.length){e=e.slice(0,this.get("maxItemCount"));a=this.get("format")?this.get("format").call(this,this.getValueInternal(),e):[];for(c=0;c<e.length;c++)b=e[c],a[c]=i.mix({content:b,textContent:b,value:b},a[c])}return a},bindUI:function(){this.get("input").on("valuechange",
n,this);this.on("click",a,this);u.on("resize",this.__repositionBuffer=i.buffer(p,50),this);this.on("afterRenderUI",b,this)},getValueInternal:function(){return this.get("input").val()},setValueInternal:function(e){this.set("inputValue",e)},_onSetInputValue:function(e,a){if(a.causeByTimer){var b;b=this.getValueInternal();b===l?this.set("collapsed",!0):(this._savedInputValue=b,this.sendRequest(b))}},alignInternal:function(){var e=this.get("menu"),a=e.get("align");delete a.node;a=i.clone(a);a.node=this.get("el");
i.mix(a,r,!1);e.set("align",a)},handleFocus:function(){var a;this.get("invalidEl")&&h(this,!1);(a=this.get("placeholderEl"))&&a.hide()},handleBlur:function(){var a=this,b=a.get("placeholderEl"),c=a.get("input");o.superclass.handleBlur.apply(a,arguments);t.call(a);a.get("invalidEl")&&a.validate(function(b,k){b?!a.get("focused")&&k==c.val()&&h(a,b):h(a,!1)});b&&!c.val()&&b.show()},handleMouseDown:function(a){var b,c;o.superclass.handleMouseDown.apply(this,arguments);b=a.target;c=this.get("trigger");
if(this.get("hasTrigger")&&(c[0]==b||c.contains(b)))this.get("input"),this.get("collapsed")?(this.focus(),this.sendRequest("")):this.set("collapsed",!0),a.preventDefault()},handleKeyEventInternal:function(a){var b,c,k;c=f(this);this.get("input");b=this.get("updateInputOnDownUp");if(c&&c.get("visible")){k=c.handleKeydown(a);if(a.keyCode==m.ESC)return this.set("collapsed",!0),b&&this.setValueInternal(this._savedInputValue),!0;c=c.get("highlightedItem");b&&i.inArray(a.keyCode,[m.DOWN,m.UP])&&this.setValueInternal(c.get("textContent"));
return a.keyCode==m.TAB&&c&&(c.performActionInternal(),this.get("multiple"))?!0:k}if(a.keyCode==m.DOWN||a.keyCode==m.UP)if(a=this.getValueInternal(),a!==l)return this.sendRequest(a),!0;return l},validate:function(a){var b=this.get("validator"),c=this.getValueInternal();b?b(c,function(b){a(b,c)}):a(!1,c)},sendRequest:function(a){this.get("dataSource").fetchData(a,s,this)},_onSetCollapsed:function(a){if(a)(a=f(this))&&a.hide();else{var a=this.get("el"),b=f(this,1);q.call(this);b&&!b.get("visible")&&
(this.get("matchElWidth")&&b.set("width",a.innerWidth()),b.show(),this.get("input").attr("aria-owns",b.get("el").attr("id")))}},destructor:function(){var a=this.__repositionBuffer;a&&(u.detach("resize",a,this),a.stop())}},{ATTRS:{input:{view:1},inputValue:{value:"",sync:0,view:1},trigger:{view:1},placeholder:{view:1},placeholderEl:{view:1},validator:{},invalidEl:{view:1},allowTextSelection:{value:!0},hasTrigger:{view:1},menu:{value:{},setter:function(a){a&&a.isController&&a.setInternal("parent",this)}},
defaultChildCfg:{value:{xclass:"popupmenu"}},collapsed:{view:1,sync:0},dataSource:{},maxItemCount:{value:99999},matchElWidth:{value:!0},format:{},updateInputOnDownUp:{value:!0},autoHighlightFirst:{},highlightMatchItem:{value:!0},xrender:{value:j}}},{xclass:"combobox"})},{requires:["node","component/base","./render","menu"]});
KISSY.add("combobox/cursor",function(i,d){function g(b){var a=c,k;a||(a=d.create(j));"textarea"==""+b.type?d.css(a,"width",d.css(b,"width")):d.css(a,"width",9999);i.each(l,function(c){d.css(a,c,d.css(b,c))});c||(k=b.ownerDocument.body,k.insertBefore(a,k.firstChild));return c=a}var j="<div style='z-index:-9999;overflow:hidden;position: fixed;left:-9999px;top:-9999px;opacity:0;white-space:pre-wrap;word-wrap:break-word;'></div>",c,l="paddingLeft,paddingTop,paddingBottom,paddingRight,marginLeft,marginTop,marginBottom,marginRight,borderLeftStyle,borderTopStyle,borderBottomStyle,borderRightStyle,borderLeftWidth,borderTopWidth,borderBottomWidth,borderRightWidth,line-height,outline,height,fontFamily,fontSize,fontWeight,fontVariant,fontStyle".split(",");
return function(b){var b=d.get(b),a=b.ownerDocument,c,h,f=b.scrollTop,p=b.scrollLeft;if(a.selection)return a=a.selection.createRange(),{left:a.boundingLeft+p+d.scrollLeft(),top:a.boundingTop+f+a.boundingHeight+d.scrollTop()};c=d.offset(b);if("textarea"!=b.type)return c.top+=b.offsetHeight,c;h=g(b);a=b.selectionStart;h.innerHTML=i.escapeHTML(b.value.substring(0,a-1))+"<span>x</span>";d.offset(h,c);c=h.lastChild;b=d.offset(c);b.top+=d.height(c);0<a&&(b.left+=d.width(c));b.top-=f;b.left-=p;return b}},
{requires:["dom"]});
KISSY.add("combobox/multi-value-combobox",function(i,d,g){function j(a,b){return b&&-1!=a.indexOf(b)}function c(a){var c=a.get("input"),h=c.val(),f=[],d=[],g=a.get("literal"),i=a.get("separator"),a=a.get("separatorType"),n=!1,s=a!=l,c=c.prop("selectionStart"),o,m,r=-1;for(o=0;o<h.length;o++)(m=h.charAt(o),g&&m==g&&(n=!n),n)?d.push(m):(o==c&&(r=f.length),s&&b.test(m))?(d.length&&f.push(d.join("")),d=[],d.push(m)):j(i,m)?a==l?(d.push(m),d.length&&f.push(d.join("")),d=[]):(d.length&&f.push(d.join("")),
d=[],d.push(m)):d.push(m);d.length&&f.push(d.join(""));f.length||f.push("");-1==r&&(a==l&&j(i,m)&&f.push(""),r=f.length-1);return{tokens:f,cursorPosition:c,tokenIndex:r}}var l="suffix",b=/\s|\xa0/;return g.extend({getValueInternal:function(){this.get("input");var a=c(this),b=a.tokens,d=a.tokenIndex,a=this.get("separator"),f=this.get("separatorType"),b=b[d],d=b.length-1;if(f!=l)if(j(a,b.charAt(0)))b=b.slice(1);else return;else f==l&&j(a,b.charAt(d))&&(b=b.slice(0,d));return b},setValueInternal:function(a){var d=
this.get("input"),h=c(this),f=h.tokens,h=Math.max(0,h.tokenIndex),g=this.get("separator"),i=this.get("separatorType"),q=f[h+1]||"",n=f[h];if(i!=l){if(f[h]=n.charAt(0)+a,!q||!b.test(q.charAt(0)))f[h]+=" "}else f[h]=a,a=n.length-1,j(g,n.charAt(a))?f[h]+=n.charAt(a):1==g.length&&(f[h]+=g);a=f.slice(0,h+1).join("").length;d.val(f.join(""));d.prop("selectionStart",a);d.prop("selectionEnd",a)},alignInternal:function(){if(this.get("alignWithCursor")){var a=c(this),b=a.tokens,h=this.get("menu"),f=a.cursorPosition,
j=a.tokenIndex,a=this.get("input"),b=b.slice(0,j).join("").length;0<b&&++b;a.prop("selectionStart",b);a.prop("selectionEnd",b);b=d(a);a.prop("selectionStart",f);a.prop("selectionEnd",f);h.set("xy",[b.left,b.top])}else g.prototype.alignInternal.apply(this,arguments)}},{ATTRS:{separator:{value:",;"},separatorType:{value:l},literal:{value:'"'},alignWithCursor:{}}},{xclass:"multi-value-combobox"})},{requires:["./cursor","./base"]});
KISSY.add("combobox/filter-select",function(i,d){var g=d.extend({validate:function(d){var c=this;g.superclass.validate.call(c,function(g,b){g?d(g,b):c.get("dataSource").fetchData(b,function(a){a:{if(a=c.normalizeData(a))for(var g=0;g<a.length;g++)if(a[g].textContent==b){a=a[g];break a}a=!1}d(a?"":c.get("invalidMessage"),b,a)})})}},{ATTRS:{invalidMessage:{value:"invalid input"}}});return g},{requires:["./base"]});
KISSY.add("combobox/local-data-source",function(i){function d(){d.superclass.constructor.apply(this,arguments)}d.ATTRS={data:{value:[]},parse:{value:function(d,j){var c=[],l=0;if(!d)return j;i.each(j,function(b){-1!=b.indexOf(d)&&c.push(b);l++});return c}}};i.extend(d,i.Base,{fetchData:function(d,j,c){var i=this.get("parse"),b=this.get("data"),b=i(d,b);j.call(c,b)}});return d},{requires:["component/base"]});
KISSY.add("combobox/remote-data-source",function(i,d){function g(){g.superclass.constructor.apply(this,arguments);this.io=null;this.caches={}}g.ATTRS={paramName:{value:"q"},allowEmpty:{},cache:{},parse:{},xhrCfg:{value:{}}};i.extend(g,i.Base,{fetchData:function(g,c,i){var b=this,a,k=b.get("paramName"),h=b.get("parse"),f=b.get("cache"),p=b.get("allowEmpty");b.io&&(b.io.abort(),b.io=null);if(!g&&!0!==p)return c.call(i,[]);if(f&&(a=b.caches[g]))return c.call(i,a);a=b.get("xhrCfg");a.data=a.data||{};
a.data[k]=g;a.success=function(a){h&&(a=h(g,a));b.setInternal("data",a);f&&(b.caches[g]=a);c.call(i,a)};b.io=d(a)}});return g},{requires:["io"]});KISSY.add("combobox",function(i,d,g,j,c,l){d.LocalDataSource=c;d.RemoteDataSource=l;d.FilterSelect=j;d.MultiValueComboBox=g;return d},{requires:["combobox/base","combobox/multi-value-combobox","combobox/filter-select","combobox/local-data-source","combobox/remote-data-source"]});
