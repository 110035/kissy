/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Jun 24 21:41
*/
KISSY.add("combobox/cursor",function(j,f){function c(a){var d=k;d||(d=l(i));"textarea"==""+a.type?d.css("width",a.css("width")):d.css("width",9999);j.each(b,function(h){d.css(h,a.css(h))});k||d.insertBefore(a[0].ownerDocument.body.firstChild);return k=d}var l=f.all,i="<div style='z-index:-9999;overflow:hidden;position: fixed;left:-9999px;top:-9999px;opacity:0;white-space:pre-wrap;word-wrap:break-word;'></div>",k,b="paddingLeft,paddingTop,paddingBottom,paddingRight,marginLeft,marginTop,marginBottom,marginRight,borderLeftStyle,borderTopStyle,borderBottomStyle,borderRightStyle,borderLeftWidth,borderTopWidth,borderBottomWidth,borderRightWidth,line-height,outline,height,fontFamily,fontSize,fontWeight,fontVariant,fontStyle".split(",");
return function(a){var d=l(a),a=d[0],h=a.ownerDocument,b=l(h),e=a.scrollTop,g=a.scrollLeft;if(h.selection)return a=h.selection.createRange(),{left:a.boundingLeft+g+b.scrollLeft(),top:a.boundingTop+e+a.boundingHeight+b.scrollTop()};b=d.offset();if("textarea"!=a.type)return b.top+=a.offsetHeight,b;h=c(d);d=a.selectionStart;h.html(j.escapeHtml(a.value.substring(0,d-1))+"<span>x</span>");h.offset(b);b=h.last();a=b.offset();a.top+=b.height();0<d&&(a.left+=b.width());a.top-=e;a.left-=g;return a}},{requires:["node"]});
KISSY.add("combobox/multi-value-combobox",function(j,f,c){function l(d,a){return a&&-1!=d.indexOf(a)}function i(a){a.newVal&&a.target==this.get("menu")&&this.alignWithCursor()}function k(d){var h=d.get("input"),k=d.get("value"),e=[],g=[],i=d.get("literal"),f=d.get("separator"),d=d.get("separatorType"),c=!1,j=d!=b,h=h.prop("selectionStart"),n,m,p=-1;for(n=0;n<k.length;n++)(m=k.charAt(n),i&&m==i&&(c=!c),c)?g.push(m):(n==h&&(p=e.length),j&&a.test(m))?(g.length&&e.push(g.join("")),g=[],g.push(m)):l(f,
m)?d==b?(g.push(m),g.length&&e.push(g.join("")),g=[]):(g.length&&e.push(g.join("")),g=[],g.push(m)):g.push(m);g.length&&e.push(g.join(""));e.length||e.push("");-1==p&&(d==b&&l(f,m)&&e.push(""),p=e.length-1);return{tokens:e,cursorPosition:h,tokenIndex:p}}var b="suffix",a=/\s|\xa0/;return c.extend({syncUI:function(){var a;this.get("alignWithCursor")&&(a=this.get("menu"),a.setInternal("align",null),a.on("beforeVisibleChange",i,this))},getValueForAutocomplete:function(){var a=k(this),h=a.tokens,c=a.tokenIndex,
a=this.get("separator"),e=this.get("separatorType"),h=h[c],c=h.length-1;if(e!=b)if(l(a,h.charAt(0)))h=h.slice(1);else return;else e==b&&l(a,h.charAt(c))&&(h=h.slice(0,c));return h},setValueFromAutocomplete:function(d,h){var c=this.get("input"),e=k(this),g=e.tokens,e=Math.max(0,e.tokenIndex),i=this.get("separator"),f;f=this.get("separatorType");var j=g[e+1]||"",o=g[e];if(f!=b){if(g[e]=o.charAt(0)+d,!j||!a.test(j.charAt(0)))d&&(g[e]+=" ")}else g[e]=d,f=o.length-1,l(i,o.charAt(f))?g[e]+=o.charAt(f):
1==i.length&&(g[e]+=i);e=g.slice(0,e+1).join("").length;this.set("value",g.join(""),h);c.prop("selectionStart",e);c.prop("selectionEnd",e)},alignWithCursor:function(){var a=this.get("menu"),b;b=this.get("input");b=f(b);a.move(b.left,b.top)}},{ATTRS:{separator:{value:",;"},separatorType:{value:b},literal:{value:'"'},alignWithCursor:{}},xclass:"multi-value-combobox"})},{requires:["./cursor","./base"]});
KISSY.add("combobox/filter-select",function(j,f){var c=f.extend({validate:function(f){var i=this;c.superclass.validate.call(i,function(c,b){c?f(c,b):i.get("dataSource").fetchData(b,function(a){a:{if(a=i.normalizeData(a))for(var d=0;d<a.length;d++)if(a[d].textContent==b){a=a[d];break a}a=!1}f(a?"":i.get("invalidMessage"),b,a)})})}},{ATTRS:{invalidMessage:{value:"invalid input"}}});return c},{requires:["./base"]});
KISSY.add("combobox/local-data-source",function(j){function f(){f.superclass.constructor.apply(this,arguments)}f.ATTRS={data:{value:[]},parse:{value:function(c,f){var i=[],k=0;if(!c)return f;j.each(f,function(b){-1!=b.indexOf(c)&&i.push(b);k++});return i}}};j.extend(f,j.Base,{fetchData:function(f,l,i){var k=this.get("parse"),b=this.get("data"),b=k(f,b);l.call(i,b)}});return f});
KISSY.add("combobox/remote-data-source",function(j,f){function c(){c.superclass.constructor.apply(this,arguments);this.io=null;this.caches={}}c.ATTRS={paramName:{value:"q"},allowEmpty:{},cache:{},parse:{},xhrCfg:{value:{}}};j.extend(c,j.Base,{fetchData:function(c,i,k){var b=this,a,d=b.get("paramName"),h=b.get("parse"),j=b.get("cache"),e=b.get("allowEmpty");b.io&&(b.io.abort(),b.io=null);if(!c&&!0!==e)return i.call(k,[]);if(j&&(a=b.caches[c]))return i.call(k,a);a=b.get("xhrCfg");a.data=a.data||{};
a.data[d]=c;a.success=function(a){h&&(a=h(c,a));b.setInternal("data",a);j&&(b.caches[c]=a);i.call(k,a)};b.io=f(a)}});return c},{requires:["io"]});KISSY.add("combobox",function(j,f,c,l,i,k){f.LocalDataSource=i;f.RemoteDataSource=k;f.FilterSelect=l;f.MultiValueComboBox=c;return f},{requires:["combobox/base","combobox/multi-value-combobox","combobox/filter-select","combobox/local-data-source","combobox/remote-data-source"]});
