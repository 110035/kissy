/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Jul 17 22:23
*/
KISSY.add("component/control/process",function(e,o,q){function p(b){b.fire("beforeSyncUI");b.callMethodByHierarchy("syncUI","__syncUI");b.callPluginsMethod("syncUI");b.fire("afterSyncUI")}var r=q.Defer,e=e.noop,l=o.extend({bindInternal:e,syncInternal:e,initializer:function(){this._createdDefer=new r;this._renderedDefer=new r},onCreated:function(b){return this._createdDefer.promise.then(b)},onRendered:function(b){return this._renderedDefer.promise.then(b)},create:function(){this.get("created")||(this.fire("beforeCreateDom"),
this.createInternal(),this.callPluginsMethod("createDom"),this.fire("afterCreateDom"),this.setInternal("created",!0));return this},createInternal:function(){this.callMethodByHierarchy("createDom","__createDom")},render:function(){this.get("rendered")||(this.create(),this.fire("beforeRenderUI"),this.callMethodByHierarchy("renderUI","__renderUI"),this.callPluginsMethod("renderUI"),this.fire("afterRenderUI"),this.fire("beforeBindUI"),l.superclass.bindInternal.call(this),this.callMethodByHierarchy("bindUI",
"__bindUI"),this.callPluginsMethod("bindUI"),this.fire("afterBindUI"),l.superclass.syncInternal.call(this),p(this),this.setInternal("rendered",!0));return this},sync:function(){p(this)},plug:function(){var b;b=this.get("plugins");l.superclass.plug.apply(this,arguments);b=b[b.length-1];this.get("rendered")?(b.pluginCreateDom&&b.pluginCreateDom(this),b.pluginRenderUI&&b.pluginRenderUI(this),b.pluginBindUI&&b.pluginBindUI(this),b.pluginSyncUI&&b.pluginSyncUI(this)):this.get("created")&&b.pluginCreateDom&&
b.pluginCreateDom(this);return this}},{name:"ComponentProcess",ATTRS:{rendered:{value:!1,setter:function(b){b&&this._renderedDefer.resolve(this)}},created:{value:!1,setter:function(b){b&&this._createdDefer.resolve(this)}}}});return l},{requires:["rich-base","promise"]});KISSY.add("component/control/render-tpl",'<div id="{{id}}" class="{{getBaseCssClasses ""}} {{#each elCls}} {{.}} {{/each}} " {{#each elAttrs}} {{xkey}}="{{.}}" {{/each}} style=" {{#each elStyle}} {{xkey}}:{{.}}; {{/each}} ">');
KISSY.add("component/control/render",function(e,o,q,p,r){function l(c){"number"==typeof c&&(c+="px");return c}function b(c){c||(c=[""]);"string"==typeof c&&(c=c.split(/\s+/));return c}function t(c,d,a){for(var f="",b=0,e=a.length,d=c+d;b<e;b++)c=(c=a[b])?"-"+c:c,f+=" "+d+c;return f}function j(c){var d;c.target==this.control&&(d=this[s+c.type.slice(5).slice(0,-6)],d.call(this,c.newVal,c))}var s="_onSet",n=e.trim,a=e.all,f=e.UA,v=e.Env.host.document,u;return u=o.extend({isRender:!0,createInternal:function(){var c=
this.control.get("srcNode");c?this.callMethodByHierarchy("decorateDom","__decorateDom",[c]):u.superclass.createInternal.apply(this,arguments)},beforeCreateDom:function(c){var d=this.control,a,b,e,h=d.get("elAttrs"),m=d.get("elCls"),k;a=d.getAttrs();k=d.get("elStyle");var i=d.get("elCls");for(b in a)e=a[b],e.view&&(c[b]=d.get(b));a=c.width;b=c.height;e=c.visible;c=c.zIndex;a&&(k.width=l(a));b&&(k.height=l(b));c&&(k["z-index"]=c);e||i.push(this.getBaseCssClasses("hidden"));if(k=d.get("disabled"))m.push(this.getBaseCssClasses("disabled")),
h["aria-disabled"]="true";d.get("highlighted")&&m.push(this.getBaseCssClasses("hover"));d.get("focusable")&&(f.ie&&(h.hideFocus="true"),h.tabindex=k?"-1":"0")},createDom:function(){this.callMethodByHierarchy("beforeCreateDom","__beforeCreateDom",[this.renderData={},this.childrenElSelectors={}]);var c=this.control,d;d=this.renderTpl(p+this.get("contentTpl")+"</div>");c.setInternal("el",this.$el=a(d));this.el=this.$el[0];this.fillChildrenElsBySelectors()},decorateDom:function(c){var a=this.constructor,
b=this.control,f,g,h;c.attr("id")||c.attr("id",b.get("id"));h=this.collectConstructorChains();for(f=h.length-1;0<=f;f--)if(a=h[f],g=a.HTML_PARSER){var a=c,m=b,k=void 0,i=void 0,i=void 0;for(k in g)i=g[k],"function"===typeof i?(i=i.call(this,a),void 0!==i&&m.setInternal(k,i)):"string"==typeof i?m.setInternal(k,a.one(i)):e.isArray(i)&&i[0]&&m.setInternal(k,a.all(i[0]))}b.setInternal("el",this.$el=c);this.el=c[0]},renderUI:function(){var c=this.control,a=this.$el;if(!c.get("srcNode")){var b=c.get("render");
(c=c.get("elBefore"))?a.insertBefore(c,void 0):b?a.appendTo(b,void 0):a.appendTo(v.body,void 0)}},bindUI:function(){var a=this.control,d=a.getAttrs(),b,f;for(b in d){f=d[b];var g=e.ucfirst(b),h=this[s+g];if(f.view&&h)a.on("after"+g+"Change",j,this)}},destructor:function(){this.$el&&this.$el.remove()},fillChildrenElsBySelectors:function(a){var d=this.$el,b=this.control,f,g,a=a||this.childrenElSelectors;for(f in a)g=a[f],"function"===typeof g?b.setInternal(f,g(d)):b.setInternal(f,d.all(e.substitute(g,
this.renderData))),delete a[f]},renderTpl:function(a,d){var b=this,d=d||b.renderData;return(new q(a,{commands:{getBaseCssClasses:function(a,c){return b.getBaseCssClasses(c.params[0])},getBaseCssClass:function(a,c){return b.getBaseCssClass(c.params[0])}}})).render(d)},getComponentConstructorByNode:function(a,d){var b=d[0].className;return b?(b=b.replace(RegExp("\\b"+a,"ig"),""),r.getConstructorByXClass(b)):null},getComponentCssClasses:function(){if(this.componentCssClasses)return this.componentCssClasses;
for(var a=this.control.constructor,d,b=[];a&&!a.prototype.hasOwnProperty("isControl");)(d=a.xclass)&&b.push(d),a=a.superclass&&a.superclass.constructor;return this.componentCssClasses=b},getBaseCssClasses:function(a){for(var a=b(a),d=this.getComponentCssClasses(),f=0,e=this.get("control"),g="",h=d.length,e=e.get("prefixCls");f<h;f++)g+=t(e,d[f],a);return n(g)},getBaseCssClass:function(a){return n(t(this.control.get("prefixCls"),this.getComponentCssClasses()[0],b(a)))},getKeyEventTarget:function(){return this.$el},
_onSetWidth:function(a){this.$el.width(a)},_onSetHeight:function(a){this.$el.height(a)},_onSetContent:function(a){var d=this.$el;d.html(a);9>f.ie&&!this.get("allowTextSelection")&&d.unselectable()},_onSetVisible:function(a){var d=this.$el,b=this.getBaseCssClasses("hidden");a?d.removeClass(b):d.addClass(b)},_onSetHighlighted:function(a){var b=this.getBaseCssClasses("hover");this.$el[a?"addClass":"removeClass"](b)},_onSetDisabled:function(a){var b=this.control,f=this.getBaseCssClasses("disabled");this.$el[a?
"addClass":"removeClass"](f).attr("aria-disabled",a);b.get("focusable")&&this.getKeyEventTarget().attr("tabindex",a?-1:0)},_onSetActive:function(a){var b=this.getBaseCssClasses("active");this.$el[a?"addClass":"removeClass"](b).attr("aria-pressed",!!a)},_onSetFocused:function(a){var b=this.$el,f=this.getBaseCssClasses("focused");b[a?"addClass":"removeClass"](f)},_onSetZIndex:function(a){this.$el.css("z-index",a)}},{extend:function d(a,b,f){var h={},m=o.extend.apply(this,arguments);e.isArray(a)&&(e.each(a.concat(m),
function(a){a&&e.each(a.HTML_PARSER,function(a,b){h[b]=a})}),m.HTML_PARSER=h);m.extend=d;return m},ATTRS:{control:{setter:function(a){this.control=a}},contentTpl:{value:"{{{content}}}"}},HTML_PARSER:{id:function(a){return(a=a[0].id)?a:void 0},content:function(a){return a.html()},disabled:function(a){return a.hasClass(this.getBaseCssClass("disabled"))}},name:"render"})},{requires:["./process","xtemplate","./render-tpl","component/manager"]});
KISSY.add("component/control",function(e,o,q,p,r,l){function b(){var a,b=this;do a=b.ATTRS,b=b.superclass;while(!a||!a.xrender);return a.xrender.value}var t=e.Env.host.document.documentMode||e.UA.ie,j=o.Gesture,s=e.Features.isTouchEventSupported(),n=q.extend({isControl:!0,createDom:function(){var a=this.get("xrender"),b=this.get("view"),e=this.get("id");b?b.set("control",this):this.set("view",this.view=b=new a({control:this}));b.create();a=b.getKeyEventTarget();this.get("allowTextSelection")||a.unselectable();
p.addComponent(e,this)},renderUI:function(){this.view.render()},bindUI:function(){var a=this.view.getKeyEventTarget();if(this.get("focusable"))a.on("focus",this.handleFocus,this).on("blur",this.handleBlur,this).on("keydown",this.handleKeydown,this);if(this.get("handleMouseEvents")){a=this.$el;if(!s)a.on("mouseenter",this.handleMouseEnter,this).on("mouseleave",this.handleMouseLeave,this).on("contextmenu",this.handleContextMenu,this);a.on(j.start,this.handleMouseDown,this).on(j.end,this.handleMouseUp,
this).on(j.tap,this.handleClick,this);if(j.cancel)a.on(j.cancel,this.handleMouseUp,this);if(t&&9>t)a.on("dblclick",this.handleDblClick,this)}},sync:function(){n.superclass.sync.apply(this,arguments);this.view.sync()},createComponent:function(a,b){return p.createComponent(a,b||this)},_onSetFocused:function(a){var b=this.view.getKeyEventTarget()[0];a?b.focus():b.ownerDocument.activeElement==b&&b.ownerDocument.body.focus()},_onSetX:function(a){this.$el.offset({left:a})},_onSetY:function(a){this.$el.offset({top:a})},
_onSetVisible:function(a){this.fire(a?"show":"hide")},show:function(){this.render();this.set("visible",!0);return this},hide:function(){this.set("visible",!1);return this},focus:function(){this.get("focusable")&&this.set("focused",!0)},blur:function(){this.get("focusable")&&this.set("focused",!1)},move:function(a,b){this.set({x:a,y:b})},handleDblClick:function(a){this.get("disabled")||this.handleDblClickInternal(a)},handleDblClickInternal:function(a){this.handleClickInternal(a)},handleMouseEnter:function(a){this.get("disabled")||
this.handleMouseEnterInternal(a)},handleMouseEnterInternal:function(a){this.set("highlighted",!!a)},handleMouseLeave:function(a){this.get("disabled")||this.handleMouseLeaveInternal(a)},handleMouseLeaveInternal:function(a){this.set("active",!1);this.set("highlighted",!a)},handleMouseDown:function(a){this.get("disabled")||this.handleMouseDownInternal(a)},handleMouseDownInternal:function(a){var b;if(1==a.which||s)this.get("activeable")&&this.set("active",!0),this.get("focusable")&&this.focus(),this.get("allowTextSelection")||
(b=(b=a.target.nodeName)&&b.toLowerCase(),"input"!=b&&"textarea"!=b&&a.preventDefault())},handleMouseUp:function(a){this.get("disabled")||this.handleMouseUpInternal(a)},handleMouseUpInternal:function(a){this.get("active")&&(1==a.which||s)&&this.set("active",!1)},handleContextMenu:function(a){this.get("disabled")||this.handleContextMenuInternal(a)},handleContextMenuInternal:function(){},handleFocus:function(){this.get("disabled")||this.handleFocusInternal()},handleFocusInternal:function(){this.focus();
this.fire("focus")},handleBlur:function(){this.get("disabled")||this.handleBlurInternal()},handleBlurInternal:function(){this.blur();this.fire("blur")},handleKeydown:function(a){return!this.get("disabled")&&this.handleKeyDownInternal(a)?(a.halt(),!0):l},handleKeyDownInternal:function(a){return a.keyCode==o.KeyCode.ENTER?this.handleClickInternal(a):l},handleClick:function(a){this.get("disabled")||this.handleClickInternal(a)},handleClickInternal:function(){},destructor:function(){p.removeComponent(this.get("id"));
this.view&&this.view.destroy()}},{name:"control",ATTRS:{id:{view:1,valueFn:function(){return e.guid("ks-component")}},content:{view:1,value:""},width:{view:1},height:{view:1},elCls:{view:1,value:[],setter:function(a){"string"==typeof a&&(a=a.split(/\s+/));return a||[]}},elStyle:{view:1,value:{}},elAttrs:{view:1,value:{}},elBefore:{},el:{setter:function(a){this.$el=a;this.el=a[0]}},x:{},y:{},xy:{setter:function(a){var b=e.makeArray(a);b.length&&(b[0]&&this.set("x",b[0]),b[1]&&this.set("y",b[1]));return a},
getter:function(){return[this.get("x"),this.get("y")]}},zIndex:{view:1},render:{},visible:{sync:0,value:!0,view:1},srcNode:{setter:function(a){return o.all(a)}},handleMouseEvents:{value:!0},focusable:{value:!0,view:1},allowTextSelection:{value:!1},activeable:{value:!0},focused:{view:1},active:{view:1,value:!1},highlighted:{view:1,value:!1},prefixCls:{view:1,value:e.config("component/prefixCls")||"ks-"},prefixXClass:{},parent:{setter:function(a,b){(b=this.get("parent"))&&this.removeTarget(b);a&&this.addTarget(a)}},
disabled:{view:1,value:!1},xrender:{value:r},view:{setter:function(a){this.view=a}}}});n.getDefaultRender=b;n.extend=function f(l,o,c){var d=e.makeArray(arguments),j,n=d[d.length-1];if(j=n.xclass)n.name=j;d=q.extend.apply(this,d);j&&p.setConstructorByXClass(j,d);d.extend=f;d.getDefaultRender=b;return d};return n},{requires:["node","./control/process","component/manager","./control/render"]});
