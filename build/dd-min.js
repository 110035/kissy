/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Jun 21 01:18
*/
KISSY.add("dd/ddm",function(i,k,j){function d(){d.superclass.constructor.apply(this,arguments)}function m(c){var a;if(c=o._normalEvent(c))if(c.preventDefault(),a=this.__activeToDrag)a._move(c);else if(a=this.get("activeDrag"))a._move(c),this.__needDropCheck&&g(this,c,a)}function b(c){c.preventDefault();D.call(this,c)}function g(c,a,b){var f=c.get("validDrops"),e=b.get("mode"),l=0,d=0,g=n(b.get("node")),h=q(g);i.each(f,function(c){var f;if(f=c.getNodeFromTarget(a,b.get("dragNode")[0],b.get("node")[0]))if("point"==
e)s(n(f),b.mousePos)&&(f=q(n(f)),l?f<d&&(l=c,d=f):(l=c,d=f));else if("intersect"==e)f=q(t(g,n(f))),f>d&&(d=f,l=c);else if("strict"==e&&(f=q(t(g,n(f))),f==h))return l=c,!1});if((f=c.get("activeDrop"))&&f!=l)f._handleOut(a),b._handleOut(a);c.setInternal("activeDrop",l);l&&(f!=l?l._handleEnter(a):l._handleOver(a))}function h(c){c._shim=(new k('<div style="background-color:red;position:'+(y?"absolute":"fixed")+";left:0;width:100%;height:100%;top:0;cursor:"+o.get("dragCursor")+";z-index:"+E+';"></div>')).prependTo(u.body||
u.documentElement).css("opacity",0);h=e;if(y)F.on("resize scroll",z,c);e(c)}function e(c){var a=c.get("activeDrag").get("activeHandler"),f="auto";a&&(f=a.css("cursor"));"auto"==f&&(f=c.get("dragCursor"));c._shim.css({cursor:f,display:"block"});y&&z.call(c)}function v(c){var a=c.get("drops");c.setInternal("validDrops",[]);a.length&&i.each(a,function(c){c._active()})}function w(c){var a=c.get("drops");c.setInternal("validDrops",[]);a.length&&i.each(a,function(c){c._deActive()})}function n(c){var a=
c.offset();return{left:a.left,right:a.left+(c.__dd_cached_width||c.outerWidth()),top:a.top,bottom:a.top+(c.__dd_cached_height||c.outerHeight())}}function s(c,a){return c.left<=a.left&&c.right>=a.left&&c.top<=a.top&&c.bottom>=a.top}function q(c){return c.top>=c.bottom||c.left>=c.right?0:(c.right-c.left)*(c.bottom-c.top)}function t(c,a){var f=Math.max(c.top,a.top),b=Math.min(c.right,a.right),l=Math.min(c.bottom,a.bottom);return{left:Math.max(c.left,a.left),right:b,top:f,bottom:l}}function a(c){c&&(c.__dd_cached_width=
c.outerWidth(),c.__dd_cached_height=c.outerHeight())}var f=i.UA,l=k.all,A=i.Features,B=i.Env.host,u=B.document,r=l(u),F=l(B),y=6===f.ie,E=999999,p=k.Gesture,C=p.move,x=p.end;p.cancel&&(x+=" "+p.cancel);d.ATTRS={dragCursor:{value:"move"},clickPixelThresh:{value:3},bufferTime:{value:1},activeDrag:{},activeDrop:{},drops:{value:[]},validDrops:{value:[]}};var D=f.ie&&8>f.ie?i.throttle(m,30):m,z=i.throttle(function(){var c;(c=this.get("activeDrag"))&&c.get("shim")&&this._shim.css({width:r.width(),height:r.height()})},
30);i.extend(d,j,{__activeToDrag:0,_regDrop:function(c){this.get("drops").push(c)},_unRegDrop:function(c){var a=this.get("drops"),c=i.indexOf(c,a);-1!=c&&a.splice(c,1)},_regToDrag:function(c){this.__activeToDrag=c;r.on(x,this._end,this);if(p.cancel)r.on(p.cancel,this._end,this);r.on(C,b,this);6===f.ie&&u.body.setCapture()},_start:function(){this.get("drops");var c=this.__activeToDrag;this.setInternal("activeDrag",c);this.__activeToDrag=0;c.get("shim")&&h(this);this.__needDropCheck=0;c.get("groups")&&
(v(this),this.get("validDrops").length&&(a(c.get("node")),this.__needDropCheck=1))},_addValidDrop:function(c){this.get("validDrops").push(c)},_end:function(c){var a=this.__activeToDrag,l=this.get("activeDrag"),e=this.get("activeDrop"),c=o._normalEvent(c);a&&a._move(c);l&&l._move(c);r.detach(C,b,this);r.detach(x,this._end,this);p.cancel&&r.detach(p.cancel,this._end,this);6===f.ie&&u.body.releaseCapture();a&&(a._end(c),this.__activeToDrag=0);this._shim&&this._shim.hide();l&&(l._end(c),w(this),e&&e._end(c),
this.setInternal("activeDrag",null),this.setInternal("activeDrop",null))}});var o=new d;o.inRegion=s;o.region=n;o.area=q;o.cacheWH=a;o.PREFIX_CLS="ks-dd-";o._normalEvent=function(c){var a=""+c.type,a=(a=a==p.end||a==p.cancel?c.changedTouches:c.touches)||[];if((A.isTouchEventSupported()||A.isMsPointerSupported())&&a.length){if(1!=a.length)return;a=a[0];c.target=c.target||a.target;c.currentTarget=c.currentTarget||a.currentTarget;c.pageX=a.pageX;c.pageY=a.pageY}c.which=1;return c};return o},{requires:["node",
"base"]});
KISSY.add("dd/draggable",function(i,k,j,d){function m(){return!1}var b=i.UA,g=k.all,h=i.Features,h=h.isTouchEventSupported()||h.isMsPointerSupported(),e=i.each,v=h?"singleTouchStart":k.Gesture.start,w=b.ie,n=d.PREFIX_CLS,s=i.Env.host.document,j=j.extend({initializer:function(){this.addTarget(d);this._allowMove=this.get("move")},_onSetNode:function(a){this.setInternal("dragNode",a);this.bindDragEvent()},bindDragEvent:function(){this.get("node").on(v,t,this).on("dragstart",this._fixDragStart)},detachDragEvent:function(){this.get("node").detach(v,
t,this).detach("dragstart",this._fixDragStart)},_bufferTimer:null,_onSetDisabledChange:function(a){this.get("dragNode")[a?"addClass":"removeClass"](n+"-disabled")},_fixDragStart:function(a){a.preventDefault()},_checkHandler:function(a){var f=this,b=f.get("handlers"),d=0;e(b,function(b){if(b[0]==a||b.contains(a))return d=1,f.setInternal("activeHandler",b),!1});return d},_checkDragStartValid:function(a){return this.get("primaryButtonOnly")&&1!=a.which||this.get("disabled")?0:1},_prepare:function(a){if(a){var f=
this;w&&(q=s.body.onselectstart,s.body.onselectstart=m);f.get("halt")&&a.stopPropagation();a.preventDefault();var b=a.pageX,e=a.pageY;f.setInternal("startMousePos",f.mousePos={left:b,top:e});if(f._allowMove){var g=f.get("node").offset();f.setInternal("startNodePos",g);f.setInternal("deltaPos",{left:b-g.left,top:e-g.top})}d._regToDrag(f);if(b=f.get("bufferTime"))f._bufferTimer=setTimeout(function(){f._start(a)},1E3*b)}},_clearBufferTimer:function(){this._bufferTimer&&(clearTimeout(this._bufferTimer),
this._bufferTimer=0)},_move:function(a){var b=a.pageX,e=a.pageY;if(!this.get("dragging")){var d=this.get("startMousePos"),g=0,h=this.get("clickPixelThresh");if(Math.abs(b-d.left)>=h||Math.abs(e-d.top)>=h)this._start(a),g=1;if(!g)return}this.mousePos={left:b,top:e};a={pageX:b,pageY:e,drag:this};if(d=this._allowMove)g=this.get("deltaPos"),b-=g.left,e-=g.top,a.left=b,a.top=e,this.setInternal("actualPos",{left:b,top:e}),this.fire("dragalign",a);e=1;!1===this.fire("drag",a)&&(e=0);e&&d&&this.get("node").offset(this.get("actualPos"))},
stopDrag:function(){d._end()},_end:function(a){var a=a||{},b;this._clearBufferTimer();w&&(s.body.onselectstart=q);this.get("dragging")&&(this.get("node").removeClass(n+"drag-over"),(b=d.get("activeDrop"))?this.fire("dragdrophit",{drag:this,drop:b}):this.fire("dragdropmiss",{drag:this}),this.setInternal("dragging",0),this.fire("dragend",{drag:this,pageX:a.pageX,pageY:a.pageY}))},_handleOut:function(){this.get("node").removeClass(n+"drag-over");this.fire("dragexit",{drag:this,drop:d.get("activeDrop")})},
_handleEnter:function(a){this.get("node").addClass(n+"drag-over");this.fire("dragenter",a)},_handleOver:function(a){this.fire("dragover",a)},_start:function(a){this._clearBufferTimer();this.setInternal("dragging",1);this.setInternal("dragStartMousePos",{left:a.pageX,top:a.pageY});d._start();this.fire("dragstart",{drag:this,pageX:a.pageX,pageY:a.pageY})},destructor:function(){this.detachDragEvent();this.detach()}},{name:"Draggable",DRAG_START_EVENT:v,ATTRS:{node:{setter:function(a){if(!(a instanceof
k))return g(a)}},clickPixelThresh:{valueFn:function(){return d.get("clickPixelThresh")}},bufferTime:{valueFn:function(){return d.get("bufferTime")}},dragNode:{},shim:{value:!h},handlers:{value:[],getter:function(a){var b=this;a.length||(a[0]=b.get("node"));e(a,function(e,d){i.isFunction(e)&&(e=e.call(b));"string"==typeof e&&(e=b.get("node").one(e));e.nodeType&&(e=g(e));a[d]=e});b.setInternal("handlers",a);return a}},activeHandler:{},dragging:{value:!1,setter:function(a){this.get("dragNode")[a?"addClass":
"removeClass"](n+"dragging")}},mode:{value:"point"},disabled:{value:!1},move:{value:!1},primaryButtonOnly:{value:!0},halt:{value:!0},groups:{value:!0},startMousePos:{},dragStartMousePos:{},startNodePos:{},deltaPos:{},actualPos:{}}});j.DropMode={POINT:"point",INTERSECT:"intersect",STRICT:"strict"};i.mix(j,j.DropMode);var q,t=function(a){if(a=d._normalEvent(a)){var b=a.target;this._checkDragStartValid(a)&&this._checkHandler(b)&&this._prepare(a)}};return j},{requires:["node","rich-base","./ddm"]});
KISSY.add("dd/draggable-delegate",function(i,k,j,d){var m=k.PREFIX_CLS,b=d.all,g=j.DRAG_START_EVENT,h=function(e){if(e=k._normalEvent(e)){var d,g;if(this._checkDragStartValid(e)){d=this.get("handlers");var h=b(e.target);(d=d.length?this._getHandler(h):h)&&(g=this._getNode(d));g&&(this.setInternal("activeHandler",d),this.setInternal("node",g),this.setInternal("dragNode",g),this._prepare(e))}}};return j.extend({_onSetNode:function(){},_onSetContainer:function(){this.bindDragEvent()},_onSetDisabledChange:function(b){this.get("container")[b?
"addClass":"removeClass"](m+"-disabled")},bindDragEvent:function(){this.get("container").on(g,h,this).on("dragstart",this._fixDragStart)},detachDragEvent:function(){this.get("container").detach(g,h,this).detach("dragstart",this._fixDragStart)},_getHandler:function(b){for(var d=void 0,g=this.get("container"),h=this.get("handlers");b&&b[0]!==g[0];){i.each(h,function(g){if(b.test(g))return d=b,!1});if(d)break;b=b.parent()}return d},_getNode:function(b){return b.closest(this.get("selector"),this.get("container"))}},
{ATTRS:{container:{setter:function(d){return b(d)}},selector:{},handlers:{value:[],getter:0}}})},{requires:["./ddm","./draggable","node"]});
KISSY.add("dd/droppable",function(i,k,j,d){var m=d.PREFIX_CLS;return j.extend({initializer:function(){this.addTarget(d);d._regDrop(this)},getNodeFromTarget:function(b,d,h){var b=this.get("node"),e=b[0];return e==d||e==h?null:b},_active:function(){var b=d.get("activeDrag"),g=this.get("node"),h=this.get("groups"),b=b.get("groups");a:if(!0===b)h=1;else{for(var e in h)if(b[e]){h=1;break a}h=0}h?(d._addValidDrop(this),g&&(g.addClass(m+"drop-active-valid"),d.cacheWH(g))):g&&g.addClass(m+"drop-active-invalid")},
_deActive:function(){var b=this.get("node");b&&b.removeClass(m+"drop-active-valid").removeClass(m+"drop-active-invalid")},__getCustomEvt:function(b){return i.mix({drag:d.get("activeDrag"),drop:this},b)},_handleOut:function(){var b=this.__getCustomEvt();this.get("node").removeClass(m+"drop-over");this.fire("dropexit",b)},_handleEnter:function(b){b=this.__getCustomEvt(b);b.drag._handleEnter(b);this.get("node").addClass(m+"drop-over");this.fire("dropenter",b)},_handleOver:function(b){b=this.__getCustomEvt(b);
b.drag._handleOver(b);this.fire("dropover",b)},_end:function(){var b=this.__getCustomEvt();this.get("node").removeClass(m+"drop-over");this.fire("drophit",b)},destructor:function(){d._unRegDrop(this)}},{name:"Droppable",ATTRS:{node:{setter:function(b){if(b)return k.one(b)}},groups:{value:{}}}})},{requires:["node","rich-base","./ddm"]});
KISSY.add("dd/droppable-delegate",function(i,k,j,d){function m(){var b=this.get("container"),d=[],e=this.get("selector");b.all(e).each(function(b){k.cacheWH(b);d.push(b)});this.__allNodes=d}var b=j.extend({initializer:function(){k.on("dragstart",m,this)},getNodeFromTarget:function(b,d,e){var m={left:b.pageX,top:b.pageY},b=this.__allNodes,j=0,n=Number.MAX_VALUE;b&&i.each(b,function(b){var g=b[0];g===e||g===d||(g=k.region(b),k.inRegion(g,m)&&(g=k.area(g),g<n&&(n=g,j=b)))});j&&(this.setInternal("lastNode",
this.get("node")),this.setInternal("node",j));return j},_handleOut:function(){b.superclass._handleOut.apply(this,arguments);this.setInternal("node",0);this.setInternal("lastNode",0)},_handleOver:function(d){var h=this.get("node"),e=b.superclass._handleOut,i=b.superclass._handleOver,j=b.superclass._handleEnter,k=this.get("lastNode");k[0]!==h[0]?(this.setInternal("node",k),e.apply(this,arguments),this.setInternal("node",h),j.call(this,d)):i.call(this,d)},_end:function(){b.superclass._end.apply(this,
arguments);this.setInternal("node",0)}},{ATTRS:{lastNode:{},selector:{},container:{setter:function(b){return d.one(b)}}}});return b},{requires:["./ddm","./droppable","node"]});KISSY.add("dd",function(i,k,j,d,m,b){i={Draggable:j,DDM:k,Droppable:m,DroppableDelegate:b,DraggableDelegate:d};return KISSY.DD=i},{requires:["dd/ddm","dd/draggable","dd/draggable-delegate","dd/droppable","dd/droppable-delegate"]});
