/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: May 27 14:51
*/
/*
 thanks to CKSource's intelligent work on CKEditor
 @author yiminghe@gmail.com
*/
KISSY.add("editor/core/base",function(a,i,t){i=t.Controller.extend({initializer:function(){this.__commands={};this.__controls={}}},{Config:{},XHTML_DTD:i.DTD,ATTRS:{textarea:{},iframe:{},window:{},document:{},toolBarEl:{},statusBarEl:{},handleMouseEvents:{value:!1},focusable:{value:!1},mode:{value:1},data:{getter:function(a){var i=this._getData();return void 0===i?a:i}},formatData:{getter:function(){return this._getData(1)}},customStyle:{value:""},customLink:{value:[]}}},{xclass:"editor"});i.HTML_PARSER=
{textarea:function(a){return a.one("."+this.get("prefixCls")+"editor-textarea")},data:function(a){return a.one("."+this.get("prefixCls")+"editor-textarea").val()}};a.mix(i,a.EventTarget);return KISSY.Editor=i},{requires:["htmlparser","component/base","core"]});
KISSY.add("editor/core/clipboard",function(a,i,t,q){function s(a){this.editor=a;this._init()}function f(a){var c=a.get("document")[0],b=a.getSelection(),u;if(b.getType()==q.SELECTION_ELEMENT&&(u=b.getSelectedElement())){var a=b.getRanges()[0],d=e(c.createTextNode(""));d.insertBefore(u);a.setStartBefore(d);a.setEndAfter(u);b.selectRanges([a]);setTimeout(function(){u.parent()&&(d.remove(),b.selectElement(u))},0)}}var e=a.all,l=a.UA,o=l.ie?"beforepaste":"paste",m=i.RANGE;a.augment(s,{_init:function(){var a=
this,c=a.editor,b=c.get("document"),u=b.one("body"),d=function(d){this.type=d};d.prototype={exec:function(d){var b=this.type;d.focus();setTimeout(function(){l.ie&&("cut"==b?f(d):"paste"==b&&(a._preventPasteEvent(),a._getClipboardDataFromPasteBin()));n(d,b)||alert(v[b])},0)}};u.on(o,a._getClipboardDataFromPasteBin,a);l.ie&&(u.on("paste",a._iePaste,a),b.on("keydown",a._onKeyDown,a),b.on("contextmenu",function(){a._isPreventBeforePaste=1;setTimeout(function(){a._isPreventBeforePaste=0},0)}));c.addCommand("copy",
new d("copy"));c.addCommand("cut",new d("cut"));c.addCommand("paste",new d("paste"))},_onKeyDown:function(a){this.editor.get("mode")==i.Mode.WYSIWYG_MODE&&(a.ctrlKey&&86==a.keyCode||a.shiftKey&&45==a.keyCode)&&this._preventPasteEvent()},_stateFromNamedCommand:function(a){var c,b=this.editor;if("paste"==a){this._isPreventBeforePaste=1;try{c=b.get("document")[0].queryCommandEnabled(a)}catch(u){}this._isPreventBeforePaste=0}else c=(a=(a=b.getSelection())&&a.getRanges())&&!(1==a.length&&a[0].collapsed);
return c},_preventPasteEvent:function(){var a=this;a._preventPasteTimer&&clearTimeout(a._preventPasteTimer);a._isPreventPaste=1;a._preventPasteTimer=setTimeout(function(){a._isPreventPaste=0},70)},_iePaste:function(a){var c=this.editor;this._isPreventPaste||(a.preventDefault(),c.execCommand("paste"))},_getClipboardDataFromPasteBin:function(){if(!this._isPreventBeforePaste){var j=this.editor,c=j.get("document")[0];if(!c.getElementById("ke_pastebin")){var b=j.getSelection(),u=new t(c),d=e(l.webkit?
"<body></body>":c.createElement("div"),null,c);d.attr("id","ke_pastebin");l.webkit&&d[0].appendChild(c.createTextNode("\u00a0"));c.body.appendChild(d[0]);d.css({position:"absolute",top:b.getStartElement().offset().top+"px",width:"1px",height:"1px",overflow:"hidden"});d.css("left","-1000px");var h=b.createBookmarks();u.setStartAt(d,m.POSITION_AFTER_START);u.setEndAt(d,m.POSITION_BEFORE_END);u.select(!0);setTimeout(function(){var c,k=d;d=l.webkit&&(c=d.first())&&c.hasClass("Apple-style-span")?c:d;b.selectBookmarks(h);
var p=d.html();k.remove();if(p=a.trim(p.replace(/<span[^>]+_ke_bookmark[^<]*?<\/span>(&nbsp;)*/ig,"")))c=j.fire("paste",{html:p}),!1!==c&&(void 0!==c&&(p=c),/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument)/.test(p)?a.use("editor/plugin/word-filter",function(d,b){j.insertHTML(b.toDataFormat(p,j))}):j.insertHTML(p))},0)}}}});var w=function(a,c){var b=a.get("document")[0],u=e(b.body),d=!1,h=function(){d=!0};u.on(c,h);(7<l.ie?b:b.selection.createRange()).execCommand(c);u.detach(c,h);return d},n=l.ie?
function(a,c){return w(a,c)}:function(a,c){try{return a.get("document")[0].execCommand(c)}catch(b){return!1}},v={cut:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u526a\u5207\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+X)\u6765\u5b8c\u6210",copy:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u590d\u5236\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+C)\u6765\u5b8c\u6210",paste:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u7c98\u8d34\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+V)\u6765\u5b8c\u6210"},y={copy:"\u590d\u5236",paste:"\u7c98\u8d34",cut:"\u526a\u5207"};return{init:function(a){var c;a.docReady(function(){c=new s(a)});var b={copy:1,cut:1,paste:1},u=["copy","cut","paste"];a.on("contextmenu",function(d){var h=d.contextmenu;if(!h.__copy_fix){h.__copy_fix=
1;for(d=0;d<u.length;d++)h.addChild({content:y[u[d]],value:u[d]});h.on("click",function(d){var c=d.target.get("value");b[c]&&(h.hide(),setTimeout(function(){a.execCommand("save");a.execCommand(c);setTimeout(function(){a.execCommand("save")},10)},30))})}for(var g=h.get("children"),d=g.length-1;d--;0<=d){var k=g[d],p;p=k.get?k.get("value"):k.value;b[p]&&(p=!c._stateFromNamedCommand(p),k.set?k.set("disabled",p):k.disabled=p)}})}}},{requires:["./base","./range","./selection"]});
KISSY.add("editor/core",function(a,i,t,q,s,f,e,l,o,m){function w(b,a){var r=b.body;E(function(){b.designMode="on";setTimeout(function(){b.designMode="off";r.focus();arguments.callee.retry||(arguments.callee.retry=c)},50)},function(){b.designMode="off";p.attr(r,"contentEditable",d);p.attr(r,"contentEditable",c);!a&&w(b,1)})}function n(b){b.get("iframe");var c=b.get("textarea")[0],r=b.get("window")[0],h=b.get("document")[0];g.webkit&&(z.on(h,"click",function(b){var d=new C(b.target);a.inArray(d.nodeName(),
["input","select"])&&b.preventDefault()}),z.on(h,"mouseup",function(b){var d=new C(b.target);a.inArray(d.nodeName(),["input","textarea"])&&b.preventDefault()}));if(g.gecko||k||g.opera){var p;p=(new C('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>')).insertAfter(c);p.on("focus",function(){b.focus()});b.activateGecko=function(){g.gecko&&b.__iframeFocus&&p[0].focus()};b.on("destroy",function(){p.detach();p.remove()})}z.on(r,"focus",function(){g.gecko?w(h,d):g.opera&&
h.body.focus();b.notifySelectionChange()});if(g.gecko)z.on(h,"mousedown",function(){b.__iframeFocus||w(h,d)});if(k&&(z.on(h,"keydown",function(d){if(d.keyCode in{8:1,46:1}){var c=b.getSelection(),a=c.getSelectedElement();if(a){b.execCommand("save");var r=c.getRanges()[0].createBookmark();a.remove();c.selectBookmarks([r]);b.execCommand("save");d.preventDefault()}}}),"CSS1Compat"==h.compatMode)){var x={33:1,34:1};z.on(h,"keydown",function(d){d.keyCode in x&&setTimeout(function(){b.getSelection().scrollIntoView()},
0)})}if(g.webkit)z.on(h,"mousedown",function(d){d=new C(d.target);a.inArray(d.nodeName(),["img","hr","input","textarea","select"])&&b.getSelection().selectElement(d)});if(g.gecko)z.on(h,"dragstart",function(b){var d=new C(b.target);d.nodeName()==="img"&&/ke_/.test(d[0].className)&&b.preventDefault()});q.add(b)}function v(b,d,c,g){var k="",x;x=t.debugUrl("theme/editor-iframe.css");c=c.concat([]);c.unshift(x);for(x=0;x<c.length;x++)k+=a.substitute('<link href="{href}" rel="stylesheet" />',{href:c[x]});
return a.substitute(r,{doctype:8===h.documentMode?'<meta http-equiv="X-UA-Compatible" content="IE=7" />':"",title:"${title}",links:k,style:d,data:g||"&nbsp;",script:b?'<script id="ke_active_script">'+(p.isCustomDomain()?'document.domain="'+h.domain+'";':"")+'parent.KISSY.Editor._initIFrame("'+b+'");<\/script>':""})}function y(b,d){function c(){x=h.document;b.setInternal("document",new C(x));b.setInternal("window",new C(h));a.detach();x.open("text/html","replace");x.write(r);x.close()}var a=b.get("iframe"),
r=v(b._UUID,b.get("customStyle"),b.get("customLink"),d),g=a[0],h=g.contentWindow,x;a.__loaded=1;try{x=h.document}catch(p){if(g.src=g.src,7>k){setTimeout(c,10);return}}c()}function j(b,d){var c=p.getEmptyIframeSrc()||"";c&&(c=' src="'+c+'" ');var c=new C(a.substitute(D,{iframeSrc:c})),r=b.get("textarea");r.hasAttr("tabindex")&&c.attr("tabindex",g.webkit?-1:r.attr("tabindex"));r.parent().prepend(c);b.set("iframe",c);b.__docReady=0;if(g.gecko&&!c.__loaded)c.on("load",function(){y(b,d)},b);else y(b,d)}
var c=!0,b=b,u=a.all,d=!1,h=document,g=a.UA,k=g.ie,p=a.DOM,B=p.NodeType,C=a.Node,z=a.Event,E=t.tryThese,r='<!doctype html><html><head>{doctype}<title>{title}</title><style>{style}</style>{links}</head><body class="ks-editor" >{data}{script}</body></html>',D='<iframe style="width:100%;height:100%;border:none;"  frameborder="0"  title="kissy-editor"  allowTransparency="true"  {iframeSrc} ></iframe>',x=/^(?:<(p)>)?(?:(?:&nbsp;)|\s)*(?:<\/\1>)?$/i,O='<div class="{prefixCls}editor-tools"></div><div class="{prefixCls}editor-textarea-wrap" '+
(g.mobile?'style="overflow:scroll;-webkit-overflow-scrolling:touch;"':"")+'></div><div class="{prefixCls}editor-status"></div>';i.Mode={SOURCE_MODE:0,WYSIWYG_MODE:1};a.augment(i,{createDom:function(){var b,d=this.prefixCls,c=this.get("textarea"),r;c?(this.set("textarea",c=u(c)),c[0].parentNode&&c.remove()):(b=this.get("data"),this.set("textarea",c=u('<textarea class="'+d+'-editor-textarea"></textarea>')),c.val(b));r=this.get("el");r.html(a.substitute(O,{prefixCls:d}));b=r.one(a.substitute(".{prefixCls}editor-textarea-wrap",
{prefixCls:d}));this._UUID=a.guid();this.set({toolBarEl:r.one(a.substitute(".{prefixCls}editor-tools",{prefixCls:d})),statusBarEl:r.one(a.substitute(".{prefixCls}editor-status",{prefixCls:d}))},{silent:1});c.css("width","100%");c.css("display","none");b.append(c);q.register(this)},renderUI:function(){e.init(this);l.init(this);o.init(this);m.init(this)},bindUI:function(){function b(){d.detach("docReady",b);if(d.get("focused"))d.focus();else{var c=d.getSelection();c&&c.removeAllRanges()}}var d=this,
c,a=d.prefixCls,r=d.get("textarea");if(d.get("attachForm")&&(c=r[0].form))z.on(c,"submit",d.sync,d);d.on("docReady",b);d.on("blur",function(){d.get("el").removeClass(a+"editor-focused")});d.on("focus",function(){d.get("el").addClass(a+"editor-focused")})},syncUI:function(){this.get("rendered")&&this.get("textarea").val(this.get("data"))},_onSetHeight:function(b){var d=this.get("textarea"),c=this.get("toolBarEl"),a=this.get("statusBarEl"),b=parseInt(b,10),b=b-((c&&c.outerHeight()||0)+(a&&a.outerHeight()||
0));d.parent().css("height",b);d.css("height",b)},_onSetMode:function(b){this.get("rendered");var d=this.get("iframe"),c=this.get("textarea");1==b?(this._setData(c.val()),c.hide(),this.fire("wysiwygMode")):(d&&(c.val(this._getData(1,1)),d.hide()),c.show(),this.fire("sourceMode"))},_onSetFocused:function(b){b&&this.__docReady&&this.focus()},_onSetData:function(b){this.get("rendered")&&this._setData(b)},destructor:function(){var b,d=this.get("textarea"),c=this.get("document")[0],r=this.get("window");
this.get("attachForm")&&(b=d[0].form)&&z.detach(b,"submit",this.sync,this);q.remove(this);z.remove([c,c.documentElement,c.body,r[0]]);a.each(this.__controls,function(b){b.destroy&&b.destroy()});this.__commands={};this.__controls={}},getControl:function(b){return this.__controls[b]},getControls:function(){return this.__controls},addControl:function(b,d){this.__controls[b]=d},showDialog:function(b,d){var b=b+"/dialog",c=this.__controls[b];c.show(d);this.fire("dialogShow",{dialog:c.dialog,pluginDialog:c,
dialogName:b})},addCommand:function(b,d){this.__commands[b]=d},hasCommand:function(b){return this.__commands[b]},execCommand:function(d){var c=this.__commands[d],r=a.makeArray(arguments);r.shift();r.unshift(this);return c?c.exec.apply(c,r):b},queryCommandValue:function(b){return this.execCommand(t.getQueryCmd(b))},_getData:function(d,c){var r=this.htmlDataProcessor,g;if(!this.get("rendered"))return b;c==b&&(c=this.get("mode"));g=1==c&&this.isDocReady()?this.get("document")[0].body.innerHTML:r.toDataFormat(this.get("textarea").val());
g=d?r.toHTML(g):r.toServer(g);g=a.trim(g);x.test(g)&&(g="");return g},_setData:function(b){var d,c=b;if(1!=this.get("mode"))this.get("textarea").val(b);else{if(d=this.htmlDataProcessor)c=d.toDataFormat(b);if(this.get("iframe")){b=this.get("iframe");d=this.get("window")[0];var a=this.get("document")[0];z.remove([a,a.documentElement,a.body,d]);b.remove()}j(this,c)}},getDocHTML:function(){return v(0,this.get("customStyle"),this.get("customLink"),this.get("formatData"))},getDocHtml:function(){return this.getDocHTML()},
getSelection:function(){return i.Selection.getSelection(this.get("document")[0])},getSelectedHTML:function(){var b=this.getSelection().getRanges()[0],d;b&&(b=b.cloneContents(),d=this.get("document")[0].createElement("div"),d.appendChild(b),d=d.innerHTML);return d},focus:function(){var b=this.get("window");if(b){var d=this.get("document")[0],b=b[0];g.ie||b&&b.parent&&b.parent.focus();b&&b.focus();try{d.body.focus()}catch(c){}this.notifySelectionChange()}},blur:function(){this.get("window")[0].blur();
this.get("document")[0].body.blur()},addCustomStyle:function(b,d){var c=this.get("window"),a=this.get("customStyle")||"";this.set("customStyle",a+("\n"+b));c&&p.addStyleSheet(c,b,d)},removeCustomStyle:function(b){p.remove(p.get("#"+b,this.get("window")[0]))},addCustomLink:function(b){var d=this.get("customLink"),c=this.get("document")[0];d.push(b);this.set("customLink",d);d=c.createElement("link");d.rel="stylesheet";c.getElementsByTagName("head")[0].appendChild(d);d.href=b},removeCustomLink:function(b){for(var d=
this.get("document")[0],d=p.query("link",d),c=0;c<d.length;c++)p.attr(d[c],"href")==b&&p.remove(d[c]);d=this.get("customLink");b=a.indexOf(b,d);-1!=b&&d.splice(b,1)},docReady:function(b){this.on("docReady",b);this.__docReady&&b.call(this)},isDocReady:function(){return this.__docReady},checkSelectionChange:function(){var b=this;b.__checkSelectionChangeId&&clearTimeout(b.__checkSelectionChangeId);b.__checkSelectionChangeId=setTimeout(function(){var d=b.getSelection();if(d&&!d.isInvalid){var c=d.getStartElement(),
a=new i.ElementPath(c);if(!b.__previousPath||!b.__previousPath.compare(a))b.__previousPath=a,b.fire("selectionChange",{selection:d,path:a,element:c})}},100)},notifySelectionChange:function(){this.__previousPath=null;this.checkSelectionChange()},insertElement:function(d){if(1!==this.get("mode"))return b;this.focus();var a,r=d.nodeName(),g=i.XHTML_DTD,h=g.$block[r],k=i.RANGE,x=(r=this.getSelection())&&r.getRanges(),p,u,D;if(!x||0==x.length)return b;this.execCommand("save");for(u=x.length-1;0<=u;u--)p=
x[u],a=!u&&d||d.clone(c),p.insertNodeByDtd(a),D||(D=a);if(!D)return b;p.moveToPosition(D,k.POSITION_AFTER_END);h&&(d=i.Walker.whitespaces(!0),(d=(D=D.next(d,1))&&D[0].nodeType==B.ELEMENT_NODE&&D.nodeName())&&g.$block[d]&&g[d]["#text"]&&p.moveToElementEditablePosition(D));r.selectRanges([p]);this.focus();a&&1==a[0].nodeType&&a.scrollIntoView(b,{alignWithTop:!1,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0});G.call(this);return a},insertHTML:function(c,a){var r=this,g,h=r.get("document")[0];if(1===
r.get("mode")){if(g=r.htmlDataProcessor)c=g.toDataFormat(c,a);r.focus();r.execCommand("save");if(k){g=h.selection;"Control"==g.type&&g.clear();try{g.createRange().pasteHTML(c)}catch(x){}}else try{h.execCommand("inserthtml",d,c)}catch(D){setTimeout(function(){if(0==r.getSelection().getRanges().length){var a=new i.Range(h),g=p.first(h.body,function(b){return 1==b.nodeType&&"br"!=p.nodeName(b)});g||(g=new C(h.createElement("p")),g._4e_appendBogus(b),h.body.appendChild(g[0]));a.setStartAt(g,i.RANGE.POSITION_AFTER_START);
a.select()}h.execCommand("inserthtml",d,c)},50)}setTimeout(function(){r.getSelection().scrollIntoView()},50);G.call(r)}},insertHtml:function(b,d){this.insertHTML(b,d)}});i._initIFrame=function(b){var a=q.getInstance(b),r=a.get("document")[0],b=r.getElementById("ke_active_script");p.remove(b);n(a);var h=r.body;k?(h.hideFocus=c,h.disabled=c,h.contentEditable=c,h.removeAttribute("disabled")):setTimeout(function(){g.gecko||g.opera?h.contentEditable=c:g.webkit?h.parentNode.contentEditable=c:r.designMode=
"on"},0);if(g.gecko||g.opera){var x=r.documentElement;z.on(x,"mousedown",function(b){if(b.target==x){g.gecko&&w(r,d);a.activateGecko()}})}setTimeout(function(){k&&setTimeout(function(){if(r){h.runtimeStyle.marginBottom="0px";h.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){a.__docReady=1;a.fire("docReady");var b=a.get("disableObjectResizing"),c=a.get("disableInlineTableEditing");if(b||c)try{r.execCommand("enableObjectResizing",d,!b);r.execCommand("enableInlineTableEditing",d,!c)}catch(g){z.on(h,
k?"resizestart":"resize",function(d){var a=new C(d.target);(b||a.nodeName()==="table"&&c)&&d.preventDefault()})}},10)};var G=a.buffer(function(){this.execCommand("save")},50);return i},{requires:"editor/core/base,editor/core/utils,editor/core/focusManager,editor/core/styles,editor/core/zIndexManager,editor/core/clipboard,editor/core/enterKey,editor/core/htmlDataProcessor,editor/core/selectionFix".split(",")});
KISSY.add("editor/core/dom",function(a,i,t){function q(c,b){var a=c[b?"next":"prev"](s,1);if(a&&a[0].nodeType==l.ELEMENT_NODE){for(var d=[];a.attr("_ke_bookmark")||a._4e_isEmptyInlineRemovable(s);)if(d.push(a),a=b?a.next(s,1):a.prev(s,1),!a)return;if(c._4e_isIdentical(a,s)){for(var h=new m(b?c[0].lastChild:c[0].firstChild);d.length;)d.shift()._4e_move(c,!b,s);a._4e_moveChildren(c,!b,s);a.remove();h[0]&&h[0].nodeType==l.ELEMENT_NODE&&h._4e_mergeSiblings()}}}var s=s,f=i.XHTML_DTD,e=a.DOM,l=e.NodeType,
o=a.UA,m=a.Node,w={a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};i.POSITION={POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16};var n=i.POSITION,v={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,
"table-column":1,"table-cell":1,"table-caption":1},y={hr:1},j=function(c){return c&&(c[0]||c)};t.injectDom({_4e_sameLevel:function(c,b){var b=j(b),a=c.parentNode;return a&&a==b.parentNode},_4e_isBlockBoundary:function(c,b){var u=a.merge(y,b);return!(!v[e.css(c,"display")]&&!u[e.nodeName(c)])},_4e_index:function(c,b){for(var a=c.parentNode.childNodes,d,h=-1,g=0;g<a.length;g++)if(d=a[g],!b||!(3==d.nodeType&&d.previousSibling&&3==d.previousSibling.nodeType))if(h++,d===c)return h;return-1},_4e_move:function(c,
b,a){b=j(b);a?b.insertBefore(c,b.firstChild):b.appendChild(c)},_4e_isIdentical:function(c,b){if(!b)return!1;b=j(b);if(e.nodeName(c)!=e.nodeName(b))return!1;var a=c.attributes,d=b.attributes,h=a.length,g=d.length;if(h!=g)return!1;for(var k=0;k<h;k++){var p=a[k],f=p.name;if(p.specified&&e.attr(c,f)!=e.attr(b,f))return!1}if(8>t.ieEngine)for(k=0;k<g;k++)if(p=d[k],f=p.name,p.specified&&e.attr(c,f)!=e.attr(b,f))return!1;return!0},_4e_isEmptyInlineRemovable:function(c){if(!f.$removeEmpty[e.nodeName(c)])return!1;
for(var c=c.childNodes,b=0,u=c.length;b<u;b++){var d=c[b],h=d.nodeType;if(!(h==l.ELEMENT_NODE&&d.getAttribute("_ke_bookmark"))&&(h==l.ELEMENT_NODE&&!e._4e_isEmptyInlineRemovable(d)||h==e.NodeType.TEXT_NODE&&a.trim(d.nodeValue)))return!1}return!0},_4e_moveChildren:function(c,b,a){b=j(b);if(c!=b)if(a)for(;a=c.lastChild;)b.insertBefore(c.removeChild(a),b.firstChild);else for(;a=c.firstChild;)b.appendChild(c.removeChild(a))},_4e_mergeSiblings:function(c){c=new m(c);w[c.nodeName()]&&(q(c,!0),q(c))},_4e_splitText:function(c,
b){var a=c.ownerDocument;if(c.nodeType==e.NodeType.TEXT_NODE){if(o.ie&&b==c.nodeValue.length){var d=a.createTextNode("");e.insertAfter(d,c);return d}d=c.splitText(b);a.documentMode&&(a=a.createTextNode(""),e.insertAfter(a,d),e.remove(a));return d}},_4e_parents:function(c,b){var a=[];a.__IS_NODELIST=1;do a[b?"push":"unshift"](c);while(c=c.parentNode);return a},_4e_nextSourceNode:function(c,b,a,d){if(d&&!d.call)var h=j(d),d=function(b){return b!==h};var b=!b&&c.firstChild,g=c;if(!b){if(c.nodeType==
l.ELEMENT_NODE&&d&&!1===d(c,!0))return null;b=c.nextSibling}for(;!b&&(g=g.parentNode);){if(d&&!1===d(g,!0))return null;b=g.nextSibling}return!b||d&&!1===d(b)?null:a&&a!=b.nodeType?e._4e_nextSourceNode(b,!1,a,d):b},_4e_previousSourceNode:function(c,b,a,d){if(d&&!d.call)var h=j(d),d=function(b){return b!==h};var b=!b&&c.lastChild,g=c;if(!b){if(c.nodeType==l.ELEMENT_NODE&&d&&!1===d(c,!0))return null;b=c.previousSibling}for(;!b&&(g=g.parentNode);){if(d&&!1===d(g,!0))return null;b=g.previousSibling}return!b||
d&&!1===d(b)?null:a&&b.nodeType!=a?e._4e_previousSourceNode(b,!1,a,d):b},_4e_commonAncestor:function(c,b){b=j(b);if(c===b)return c;if(e.contains(b,c))return b;var a=c;do if(e.contains(a,b))return a;while(a=a.parentNode);return null},_4e_hasAttributes:9>t.ieEngine?function(a){for(var b=a.attributes,e=0;e<b.length;e++){var d=b[e];switch(d.name){case "class":if(a.getAttribute("class"))return!0;break;default:if(d.specified)return!0}}return!1}:function(a){o.gecko&&a.removeAttribute("_moz_dirty");return a.hasAttributes()},
_4e_position:function(a,b){var f=j(b);if(a.compareDocumentPosition)return a.compareDocumentPosition(f);if(a==f)return n.POSITION_IDENTICAL;if(a.nodeType==l.ELEMENT_NODE&&f.nodeType==l.ELEMENT_NODE){if(e.contains(a,f))return n.POSITION_CONTAINS+n.POSITION_PRECEDING;if(e.contains(f,a))return n.POSITION_IS_CONTAINED+n.POSITION_FOLLOWING;if("sourceIndex"in a)return 0>a.sourceIndex||0>f.sourceIndex?n.POSITION_DISCONNECTED:a.sourceIndex<f.sourceIndex?n.POSITION_PRECEDING:n.POSITION_FOLLOWING}for(var d=
e._4e_address(a),f=e._4e_address(f),h=Math.min(d.length,f.length),g=0;g<=h-1;g++)if(d[g]!=f[g])return d[g]<f[g]?n.POSITION_PRECEDING:n.POSITION_FOLLOWING;return d.length<f.length?n.POSITION_CONTAINS+n.POSITION_PRECEDING:n.POSITION_IS_CONTAINED+n.POSITION_FOLLOWING},_4e_address:function(a,b){for(var f=[],d=a.ownerDocument.documentElement,h=a;h&&h!=d;)f.unshift(e._4e_index(h,b)),h=h.parentNode;return f},_4e_remove:function(a,b){var e=a.parentNode;if(e){if(b)for(var d;d=a.firstChild;)e.insertBefore(a.removeChild(d),
a);e.removeChild(a)}return a},_4e_trim:function(a){e._4e_ltrim(a);e._4e_rtrim(a)},_4e_ltrim:function(a){for(var b;b=a.firstChild;){if(b.nodeType==e.NodeType.TEXT_NODE){var f=t.ltrim(b.nodeValue),d=b.nodeValue.length;if(f)f.length<d&&(e._4e_splitText(b,d-f.length),a.removeChild(a.firstChild));else{a.removeChild(b);continue}}break}},_4e_rtrim:function(a){for(var b;b=a.lastChild;){if(b.type==e.NodeType.TEXT_NODE){var f=t.rtrim(b.nodeValue),d=b.nodeValue.length;if(f)f.length<d&&(e._4e_splitText(b,f.length),
a.removeChild(a.lastChild));else{a.removeChild(b);continue}}break}!o.ie&&!o.opera&&(b=a.lastChild)&&1==b.nodeType&&"br"==e.nodeName(b)&&a.removeChild(b)},_4e_appendBogus:function(c){for(var b=c.lastChild;b&&b.nodeType==e.NodeType.TEXT_NODE&&!a.trim(b.nodeValue);)b=b.previousSibling;if(!b||b.nodeType==e.NodeType.TEXT_NODE||"br"!==e.nodeName(b))b=o.opera?c.ownerDocument.createTextNode(""):c.ownerDocument.createElement("br"),o.gecko&&b.setAttribute("type","_moz"),c.appendChild(b)},_4e_setMarker:function(c,
b,e,d){var c=new m(c),h=c.data("list_marker_id")||c.data("list_marker_id",a.guid()).data("list_marker_id"),g=c.data("list_marker_names")||c.data("list_marker_names",{}).data("list_marker_names");b[h]=c;g[e]=1;return c.data(e,d)},_4e_clearMarkers:function(a,b,e){var a=new m(a),d=a.data("list_marker_names"),h=a.data("list_marker_id"),g;for(g in d)a.removeData(g);a.removeData("list_marker_names");e&&(a.removeData("list_marker_id"),delete b[h])},_4e_copyAttributes:function(a,b,f){for(var b=new m(b),d=
a.attributes,f=f||{},h=0;h<d.length;h++){var g=d[h],k=g.name.toLowerCase(),p;if(!(k in f))if("checked"==k&&(p=e.attr(a,k)))b.attr(k,p);else if(g.specified||o.ie&&g.value&&"value"==k)p=e.attr(a,k),null===p&&(p=g.nodeValue),b.attr(k,p)}""!==a.style.cssText&&(b[0].style.cssText=a.style.cssText)},_4e_isEditable:function(a){a=e.nodeName(a);return(a=!f.$nonEditable[a]&&(f[a]||f.span))&&a["#text"]},_4e_getByAddress:function(a,b,e){for(var a=a.documentElement,d=0;a&&d<b.length;d++){var h=b[d];if(e)for(var g=
-1,k=0;k<a.childNodes.length;k++){var p=a.childNodes[k];if(!(!0===e&&3==p.nodeType&&p.previousSibling&&3==p.previousSibling.nodeType)&&(g++,g==h)){a=p;break}}else a=a.childNodes[h]}return a}})},{requires:["./base","./utils"]});
KISSY.add("editor/core/domIterator",function(a){function i(a){1>arguments.length||(this.range=a,this.forceBrBreak=q,this.enlargeBr=t,this.enforceRealBlocks=q,this._||(this._={}))}var t=!0,q=!1,s=a.Editor,f=a.UA,e=s.Walker,l=s.Range,o=s.RANGE,m=s.ElementPath,w=a.Node,n=a.DOM,v=/^[\r\n\t ]*$/;a.augment(i,{getNextParagraph:function(i){var j,c,b,u,d;if(!this._.lastNode){c=this.range.clone();c.shrink(o.SHRINK_ELEMENT,t);c.enlarge(this.forceBrBreak||!this.enlargeBr?o.ENLARGE_LIST_ITEM_CONTENTS:o.ENLARGE_BLOCK_CONTENTS);
var h=new e(c),g=e.bookmark(t,t);h.evaluator=g;this._.nextNode=h.next();h=new e(c);h.evaluator=g;h=h.previous();this._.lastNode=h._4e_nextSourceNode(t);this._.lastNode&&this._.lastNode[0].nodeType==n.NodeType.TEXT_NODE&&!a.trim(this._.lastNode[0].nodeValue)&&this._.lastNode.parent()._4e_isBlockBoundary()&&(g=new l(c.document),g.moveToPosition(this._.lastNode,o.POSITION_AFTER_END),g.checkEndOfBlock()&&(g=new m(g.endContainer),this._.lastNode=(g.block||g.blockLimit)._4e_nextSourceNode(t)));this._.lastNode||
(this._.lastNode=this._.docEndMarker=new w(c.document.createTextNode("")),n.insertAfter(this._.lastNode[0],h[0]));c=null}g=this._.nextNode;h=this._.lastNode;for(this._.nextNode=null;g;){var k=q,p=g[0].nodeType!=n.NodeType.ELEMENT_NODE,B=q;if(p)g[0].nodeType==n.NodeType.TEXT_NODE&&v.test(g[0].nodeValue)&&(p=q);else{var C=g.nodeName();if(g._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){if("br"==C)p=t;else if(!c&&!g[0].childNodes.length&&"hr"!=C){j=g;b=g.equals(h);break}c&&(c.setEndAt(g,o.POSITION_BEFORE_START),
"br"!=C&&(this._.nextNode=g));k=t}else{if(g[0].firstChild){c||(c=new l(this.range.document),c.setStartAt(g,o.POSITION_BEFORE_START));g=new w(g[0].firstChild);continue}p=t}}p&&!c&&(c=new l(this.range.document),c.setStartAt(g,o.POSITION_BEFORE_START));b=(!k||p)&&g.equals(h);if(c&&!k)for(;!g[0].nextSibling&&!b;){C=g.parent();if(C._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){k=t;b||C.equals(h);break}g=C;p=t;b=g.equals(h);B=t}p&&c.setEndAt(g,o.POSITION_AFTER_END);g=g._4e_nextSourceNode(B,null,h);if((b=
!g)||k&&c)break}if(!j){if(!c)return this._.docEndMarker&&this._.docEndMarker._4e_remove(),this._.nextNode=null;j=new m(c.startContainer);g=j.blockLimit;k={div:1,th:1,td:1};j=j.block;if((!j||!j[0])&&!this.enforceRealBlocks&&k[g.nodeName()]&&c.checkStartOfBlock()&&c.checkEndOfBlock())j=g;else if(!j||this.enforceRealBlocks&&"li"==j.nodeName())j=new w(this.range.document.createElement(i||"p")),j[0].appendChild(c.extractContents()),j._4e_trim(),c.insertNode(j),u=d=t;else if("li"!=j.nodeName()){if(!c.checkStartOfBlock()||
!c.checkEndOfBlock())j=j.clone(q),j[0].appendChild(c.extractContents()),j._4e_trim(),d=c.splitBlock(),u=!d.wasStartOfBlock,d=!d.wasEndOfBlock,c.insertNode(j)}else b||(this._.nextNode=j.equals(h)?null:c.getBoundaryNodes().endNode._4e_nextSourceNode(t,null,h))}u&&(c=new w(j[0].previousSibling),c[0]&&c[0].nodeType==n.NodeType.ELEMENT_NODE&&("br"==c.nodeName()?c._4e_remove():c[0].lastChild&&"br"==n.nodeName(c[0].lastChild)&&n._4e_remove(c[0].lastChild)));d&&(c=e.bookmark(q,t),u=new w(j[0].lastChild),
u[0]&&u[0].nodeType==n.NodeType.ELEMENT_NODE&&"br"==u.nodeName()&&(f.ie||u.prev(c,1)||u.next(c,1))&&u.remove());this._.nextNode||(this._.nextNode=b||j.equals(h)?null:j._4e_nextSourceNode(t,null,h));return j}});l.prototype.createIterator=function(){return new i(this)};return i},{requires:["./base","./range","./elementPath","./walker"]});
KISSY.add("editor/core/elementPath",function(a){function i(a){for(var m=f,i=f,n=[];a;){if(a[0].nodeType==q.NodeType.ELEMENT_NODE){this.lastElement||(this.lastElement=a);var v=a.nodeName();if(!i&&(!m&&e[v]&&(m=a),l[v])){var t;if(t=!m)if(t="div"==v){a:{t=a[0].childNodes;for(var j=0,c=t.length;j<c;j++){var b=t[j];if(b.nodeType==q.NodeType.ELEMENT_NODE&&s.$block[b.nodeName.toLowerCase()]){t=!0;break a}}t=!1}t=!t}t?m=a:i=a}n.push(a);if("body"==v)break}a=a.parent()}this.block=m;this.blockLimit=i;this.elements=
n}var t=a.Editor,q=a.DOM,s=t.XHTML_DTD,f=null,e={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},l={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};i.prototype={constructor:i,compare:function(a){var e=this.elements,a=a&&a.elements;if(!a||e.length!=a.length)return!1;for(var f=0;f<e.length;f++)if(!q.equals(e[f],a[f]))return!1;return!0},contains:function(a){for(var e=this.elements,l=0;l<e.length;l++)if(e[l].nodeName()in a)return e[l];return f},toString:function(){var a=
this.elements,e,f=[];for(e=0;e<a.length;e++)f.push(a[e].nodeName());return f.toString()}};return t.ElementPath=i},{requires:["./base","./dom"]});
KISSY.add("editor/core/enterKey",function(a,i,t,q){function s(f){var i;i=f.getSelection().getRanges();for(var s=i.length-1;0<s;s--)i[s].deleteContents();i=i[0];s=i.document;if(i.checkStartOfBlock()&&i.checkEndOfBlock()){var j=(new q(i.startContainer)).block;if(j&&("li"==j.nodeName()||"li"==j.parent().nodeName()))return f.hasCommand("outdent")?(f.execCommand("save"),f.execCommand("outdent"),f.execCommand("save"),!0):!1}var c=i.splitBlock("p");if(!c)return!0;var f=c.previousBlock,j=c.nextBlock,b=c.wasStartOfBlock,
u=c.wasEndOfBlock,d;if(j)d=j.parent(),"li"==d.nodeName()&&(j._4e_breakParent(d),j._4e_move(j.next(),!0));else if(f&&(d=f.parent())&&"li"==d.nodeName())f._4e_breakParent(d),i.moveToElementEditablePosition(f.next()),f._4e_move(f.prev());if(!b&&!u){if("li"==j.nodeName()&&(d=j.first(t.invisible(!0)))&&a.inArray(d.nodeName(),["ul","ol"]))(e.ie?new m(s.createTextNode("\u00a0")):new m(s.createElement("br"))).insertBefore(d);j&&i.moveToElementEditablePosition(j)}else{var h;if(f){if("li"==f.nodeName()||!l.test(f.nodeName()))h=
f.clone()}else j&&(h=j.clone());h||(h=new m("<p>",null,s));if(d=c.elementPath)for(var c=0,g=d.elements.length;c<g;c++){var k=d.elements[c];if(k.equals(d.block)||k.equals(d.blockLimit))break;o.$removeEmpty[k.nodeName()]&&(k=k.clone(),h._4e_moveChildren(k),h.append(k))}e.ie||h._4e_appendBogus();i.insertNode(h);if(e.ie&&b&&(!u||!f[0].childNodes.length))i.moveToElementEditablePosition(u?f:h),i.select();i.moveToElementEditablePosition(b&&!u?j:h)}e.ie||(j?(h=new m(s.createElement("span")),h.html("&nbsp;"),
i.insertNode(h),h.scrollIntoView(void 0,{alignWithTop:!1,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0}),i.deleteContents()):h.scrollIntoView(void 0,{alignWithTop:!1,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0}));i.select();return!0}function f(a){var f=a.get("document")[0];w.on(f,"keydown",function(f){if(13===f.keyCode&&!f.shiftKey&&!f.ctrlKey&&!f.metaKey){a.execCommand("save");var e=a.execCommand("enterBlock");a.execCommand("save");!1!==e&&f.preventDefault()}})}var e=a.UA,l=/^h[1-6]$/,o=i.XHTML_DTD,
m=a.Node,w=a.Event;return{init:function(a){a.addCommand("enterBlock",{exec:s});a.docReady(function(){f(a)})}}},{requires:["./base","./walker","./elementPath"]});
KISSY.add("editor/core/focusManager",function(a){function i(){var a=this;a.__iframeFocus=o;l=a;e&&clearTimeout(e);e=setTimeout(function(){a.fire("focus")},30)}function t(){var a=this;a.__iframeFocus=m;l=w;e&&clearTimeout(e);e=setTimeout(function(){a.fire("blur")},30)}var q=a.Editor,s=a.Event,f={},e,l,a={refreshAll:function(){for(var a in f){var e=f[a].get("document")[0];e.designMode="off";e.designMode="on"}},currentInstance:function(){return l},getInstance:function(a){return f[a]},add:function(a){var f=
a.get("window")[0];s.on(f,"focus",i,a);s.on(f,"blur",t,a)},register:function(a){f[a._UUID]=a},remove:function(a){delete f[a._UUID];var e=a.get("window")[0];s.remove(e,"focus",i,a);s.remove(e,"blur",t,a)}},o=!0,m=!1,w=null;a.refreshAll=a.refreshAll;q.focusManager=a;q.getInstances=function(){return f};return a},{requires:["./base","./dom"]});
KISSY.add("editor/core/htmlDataProcessor",function(a,i){return{init:function(t){function q(b){var b=b.childNodes,d,c,h,f=b.length;if(f){h=1;for(d=0;d<f;d++)if(c=b[d],c.nodeType!=a.DOM.NodeType.TEXT_NODE||c.nodeValue){h=0;break}return h?!1:void 0}return!1}function s(a){return a.replace(v,function(a,b,d){return"<"+b+d.replace(y,function(a,b){return-1==d.indexOf("_ke_saved_"+b)?" _ke_saved_"+a+" "+a:a})+">"})}function f(a){return a.replace(c,function(a){return"<ke:encoded>"+encodeURIComponent(a)+"</ke:encoded>"})}
function e(d){return d.replace(b,function(b,d){return a.urlDecode(d)})}var l=a.Node,o=a.UA,m=a.require("htmlparser"),w=new m.Filter,n=new m.Filter;(function(){function b(a){a=m.serialize(a);return new m.Comment(j+encodeURIComponent(a).replace(/--/g,"%2D%2D"))}var d={tagNames:[[/^\?xml.*$/i,""],[/^.*namespace.*$/i,""]],attributeNames:[[/^on/,"ke_on"],[/^lang$/,""]],tags:{script:b,noscript:b,span:q}},c={tagNames:[[/^ke:/,""],[/^\?xml:namespace$/,""]],tags:{$:function(a){if(a.attributes.length)for(var b=
["name","href","src"],d,c=0;c<b.length;c++)d="_ke_saved_"+b[c],a.getAttribute(d)&&a.removeAttribute(b[c]);return a},embed:function(a){var b=a.parentNode;if(b&&"object"==b.nodeName){var d=b.getAttribute("width"),b=b.getAttribute("height");d&&a.setAttribute("width",d);b&&a.setAttribute("width",b)}},a:function(a){if(!a.childNodes.length&&!a.attributes.length)return!1},span:q,strong:q,em:q,del:q,u:q},attributes:{style:function(b){if(!a.trim(b))return!1}},attributeNames:[[/^_ke_saved_/,""],[/^ke_on/,"on"],
[/^_ke.*/,""],[/^ke:.*$/,""],[/^_ks.*/,""]],text:function(a){if(o.webkit)return a.replace(/\u200b/g,"")},comment:function(b){if(b.substr(0,j.length)==j)return b=a.trim(a.urlDecode(b.substr(j.length))),m.parse(b).childNodes[0]}};o.ie&&(c.attributes.style=function(a){return a.replace(/(^|;)([^:]+)/g,function(a){return a.toLowerCase()})});w.addRules(c);n.addRules(d)})();(function(){function b(d){for(var d=d.childNodes,c=d.length,r=d[c-1];r&&3==r.nodeType&&!a.trim(r.nodeValue);)r=d[--c];return r}function d(a,
c){var r=b(a);r&&((c||!o.ie)&&1==r.nodeType&&"br"==r.nodeName?a.removeChild(r):3==r.nodeType&&e.test(r.nodeValue)&&a.removeChild(r))}function c(a){var d=b(a);return!d||1==d.nodeType&&"br"==d.nodeName||"form"==a.nodeName&&"input"==d.nodeName}function h(a){d(a,!0);c(a)&&(o.ie?a.appendChild(new m.Text("\u00a0")):(a.appendChild(new m.Text("&nbsp;")),a.appendChild(new m.Tag("br"))))}function f(a){d(a,!1);c(a)&&a.appendChild(new m.Text("\u00a0"))}var e=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,j=i.XHTML_DTD,r=a.merge(j.$block,
j.$listItem,j.$tableContent),D;for(D in r)"br"in j[D]||delete r[D];delete r.td;delete r.pre;var j={tags:{}},x={tags:{}};for(D in r)j.tags[D]=h,x.tags[D]=f;n.addRules(j);w.addRules(x)})();w.addRules({text:function(a){return a.replace(/\xa0/g,"&nbsp;")}});var v=/<(a|area|img|input)\b([^>]*)>/gi,y=/\b(href|src|name)\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|(?:[^ "'>]+))/gi,j="{ke_protected}",c=/(?:<textarea[^>]*>[\s\S]*<\/textarea>)|(?:<style[^>]*>[\s\S]*<\/style>)|(?:<(:?link|meta|base)[^>]*>)/gi,b=/<ke:encoded>([^<]*)<\/ke:encoded>/gi,
u=/(<\/?)((?:object|embed|param|html|body|head|title|script|noscript)[^>]*>)/gi,d=/(<\/?)ke:((?:object|embed|param|html|body|head|title|script|noscript)[^>]*>)/gi,h=/<ke:(param|embed)([^>]*?)\/?>(?!\s*<\/ke:\1)/gi;t.htmlDataProcessor={dataFilter:n,htmlFilter:w,toHTML:function(a){var b=new m.BeautifyWriter;(new m.Parser(a)).parse().writeHTML(b,w);return a=b.getHTML()},toDataFormat:function(a,b){var b=b||n,a=f(a),a=s(a),a=a.replace(u,"$1ke:$2"),a=a.replace(h,"<ke:$1$2></ke:$1>"),c=new l("<div>");c.html("a"+
a);a=c.html().substr(1);a=a.replace(d,"$1$2");a=e(a);c=new m.BasicWriter;(new m.Parser(a)).parse().writeHTML(c,b);return a=c.getHTML()},toServer:function(a){var b=new m.MinifyWriter;(new m.Parser(a)).parse().writeHTML(b,w);return b.getHTML()}}}}},{requires:["./base"]});
(function(a){a({"editor/plugin/back-color":{requires:["editor","editor/plugin/color/btn"]}});a({"editor/plugin/back-color/cmd":{requires:["editor/plugin/color/cmd"]}});a({"editor/plugin/bold":{requires:["editor","editor/plugin/font/ui"]}});a({"editor/plugin/bold/cmd":{requires:["editor","editor/plugin/font/cmd"]}});a({"editor/plugin/bubble":{requires:["overlay","editor"]}});a({"editor/plugin/button":{requires:["editor","button"]}});a({"editor/plugin/checkbox-source-area":{requires:["editor"]}});a({"editor/plugin/code":{requires:["editor",
"editor/plugin/dialog-loader"]}});a({"editor/plugin/code/dialog":{requires:["editor","editor/plugin/dialog","menubutton"]}});a({"editor/plugin/color/btn":{requires:["editor","editor/plugin/button","editor/plugin/overlay","editor/plugin/dialog-loader"]}});a({"editor/plugin/color/cmd":{requires:["editor"]}});a({"editor/plugin/color/dialog":{requires:["editor","editor/plugin/dialog"]}});a({"editor/plugin/contextmenu":{requires:["editor","menu","editor/plugin/focus-fix"]}});a({"editor/plugin/dent-cmd":{requires:["editor",
"editor/plugin/list-utils"]}});a({"editor/plugin/dialog-loader":{requires:["overlay","editor"]}});a({"editor/plugin/dialog":{requires:["editor","overlay","editor/plugin/focus-fix","dd/plugin/constrain","component/plugin/drag"]}});a({"editor/plugin/draft":{requires:["editor","editor/plugin/local-storage","overlay","editor/plugin/menubutton"]}});a({"editor/plugin/drag-upload":{requires:["editor"]}});a({"editor/plugin/element-path":{requires:["editor"]}});a({"editor/plugin/fake-objects":{requires:["editor"]}});
a({"editor/plugin/flash-bridge":{requires:["swf","editor"]}});a({"editor/plugin/flash-common/base-class":{requires:["editor","editor/plugin/contextmenu","editor/plugin/bubble","editor/plugin/dialog-loader","editor/plugin/flash-common/utils"]}});a({"editor/plugin/flash-common/utils":{requires:["swf"]}});a({"editor/plugin/flash":{requires:["editor","editor/plugin/flash-common/base-class","editor/plugin/flash-common/utils","editor/plugin/fake-objects"]}});a({"editor/plugin/flash/dialog":{requires:["editor",
"editor/plugin/flash-common/utils","editor/plugin/dialog","editor/plugin/menubutton"]}});a({"editor/plugin/focus-fix":{requires:["editor"]}});a({"editor/plugin/font-family":{requires:["editor","editor/plugin/font/ui"]}});a({"editor/plugin/font-family/cmd":{requires:["editor","editor/plugin/font/cmd"]}});a({"editor/plugin/font-size":{requires:["editor","editor/plugin/font/ui"]}});a({"editor/plugin/font-size/cmd":{requires:["editor","editor/plugin/font/cmd"]}});a({"editor/plugin/font/cmd":{requires:["editor"]}});
a({"editor/plugin/font/ui":{requires:["editor","editor/plugin/button","editor/plugin/menubutton"]}});a({"editor/plugin/fore-color":{requires:["editor","editor/plugin/color/btn"]}});a({"editor/plugin/fore-color/cmd":{requires:["editor/plugin/color/cmd"]}});a({"editor/plugin/heading":{requires:["editor"]}});a({"editor/plugin/heading/cmd":{requires:["editor"]}});a({"editor/plugin/image":{requires:["editor","editor/plugin/button","editor/plugin/bubble","editor/plugin/contextmenu","editor/plugin/dialog-loader"]}});
a({"editor/plugin/image/dialog":{requires:["io","editor","editor/plugin/dialog","tabs","editor/plugin/menubutton"]}});a({"editor/plugin/indent":{requires:["editor"]}});a({"editor/plugin/indent/cmd":{requires:["editor","editor/plugin/dent-cmd"]}});a({"editor/plugin/italic":{requires:["editor","editor/plugin/font/ui"]}});a({"editor/plugin/italic/cmd":{requires:["editor","editor/plugin/font/cmd"]}});a({"editor/plugin/justify-center":{requires:["editor"]}});a({"editor/plugin/justify-center/cmd":{requires:["editor/plugin/justify-cmd"]}});
a({"editor/plugin/justify-cmd":{requires:["editor"]}});a({"editor/plugin/justify-left":{requires:["editor"]}});a({"editor/plugin/justify-left/cmd":{requires:["editor/plugin/justify-cmd"]}});a({"editor/plugin/justify-right":{requires:["editor"]}});a({"editor/plugin/justify-right/cmd":{requires:["editor/plugin/justify-cmd"]}});a({"editor/plugin/link":{requires:["editor","editor/plugin/bubble","editor/plugin/dialog-loader","editor/plugin/button"]}});a({"editor/plugin/link/dialog":{requires:["editor",
"editor/plugin/dialog","editor/plugin/link/utils"]}});a({"editor/plugin/link/utils":{requires:["editor"]}});a({"editor/plugin/list-utils":{requires:["editor"]}});a({"editor/plugin/list-utils/btn":{requires:["editor","editor/plugin/button","editor/plugin/menubutton"]}});a({"editor/plugin/list-utils/cmd":{requires:["editor","editor/plugin/list-utils"]}});a({"editor/plugin/local-storage":{requires:["editor","overlay","editor/plugin/flash-bridge"]}});a({"editor/plugin/maximize":{requires:["editor"]}});
a({"editor/plugin/maximize/cmd":{requires:["editor"]}});a({"editor/plugin/menubutton":{requires:["editor","menubutton"]}});a({"editor/plugin/multiple-upload":{requires:["editor","editor/plugin/dialog-loader"]}});a({"editor/plugin/multiple-upload/dialog":{requires:"editor,component/plugin/drag,editor/plugin/progressbar,editor/plugin/dialog,editor/plugin/flash-bridge,editor/plugin/local-storage,swf".split(",")}});a({"editor/plugin/ordered-list":{requires:["editor","editor/plugin/list-utils/btn"]}});
a({"editor/plugin/ordered-list/cmd":{requires:["editor","editor/plugin/list-utils/cmd"]}});a({"editor/plugin/outdent":{requires:["editor"]}});a({"editor/plugin/outdent/cmd":{requires:["editor","editor/plugin/dent-cmd"]}});a({"editor/plugin/overlay":{requires:["editor","overlay","editor/plugin/focus-fix"]}});a({"editor/plugin/page-break":{requires:["editor","editor/plugin/fake-objects"]}});a({"editor/plugin/remove-format":{requires:["editor","editor/plugin/button"]}});a({"editor/plugin/remove-format/cmd":{requires:["editor"]}});
a({"editor/plugin/resize":{requires:["editor","dd/base"]}});a({"editor/plugin/separator":{requires:["editor"]}});a({"editor/plugin/smiley":{requires:["editor","editor/plugin/overlay"]}});a({"editor/plugin/source-area":{requires:["editor","editor/plugin/button"]}});a({"editor/plugin/strike-through":{requires:["editor","editor/plugin/font/ui"]}});a({"editor/plugin/strike-through/cmd":{requires:["editor","editor/plugin/font/cmd"]}});a({"editor/plugin/table":{requires:["editor","editor/plugin/dialog-loader",
"editor/plugin/contextmenu"]}});a({"editor/plugin/table/dialog":{requires:["editor","editor/plugin/dialog","editor/plugin/menubutton"]}});a({"editor/plugin/underline":{requires:["editor","editor/plugin/font/ui"]}});a({"editor/plugin/underline/cmd":{requires:["editor","editor/plugin/font/cmd"]}});a({"editor/plugin/undo":{requires:["editor"]}});a({"editor/plugin/undo/btn":{requires:["editor","editor/plugin/button"]}});a({"editor/plugin/undo/cmd":{requires:["editor"]}});a({"editor/plugin/unordered-list":{requires:["editor",
"editor/plugin/list-utils/btn"]}});a({"editor/plugin/unordered-list/cmd":{requires:["editor","editor/plugin/list-utils/cmd"]}});a({"editor/plugin/video":{requires:["editor","editor/plugin/flash-common/utils","editor/plugin/flash-common/base-class","editor/plugin/fake-objects"]}});a({"editor/plugin/video/dialog":{requires:["editor","editor/plugin/flash/dialog","editor/plugin/menubutton"]}});a({"editor/plugin/word-filter":{requires:["htmlparser"]}});a({"editor/plugin/xiami-music":{requires:["editor",
"editor/plugin/flash-common/base-class","editor/plugin/flash-common/utils","editor/plugin/fake-objects"]}});a({"editor/plugin/xiami-music/dialog":{requires:["editor","editor/plugin/flash/dialog","editor/plugin/menubutton"]}})})(function(a){KISSY.config("modules",a)},KISSY.Features,KISSY.UA);
KISSY.add("editor/core/range",function(a,i,t,q,s){function f(c){var h=c.nodeType!=b.NodeType.TEXT_NODE&&b.nodeName(c)in d.$removeEmpty,g=c.nodeType==b.NodeType.TEXT_NODE&&!a.trim(c.nodeValue),c=!!c.parentNode.getAttribute("_ke_bookmark");return h||g||c}function e(a){return!p(a)&&!B(a)}function l(d){var c=v;return function(h){if(B(h))return n;if(h.nodeType==b.NodeType.TEXT_NODE){if(a.trim(h.nodeValue).length)return v}else if(h.nodeType==b.NodeType.ELEMENT_NODE&&(h=b.nodeName(h),!E[h]))if(!d&&!u.ie&&
"br"==h&&!c)c=n;else return v;return n}}function o(a,d){var c=a.startContainer,g=a.endContainer,f=a.startOffset,k=a.endOffset,e,p=v,j=v,l=void 0,i=a.document,u;0<d&&(l=i.createDocumentFragment());if(a.collapsed)return l;a.optimizeBookmark();g[0].nodeType==b.NodeType.TEXT_NODE?(j=n,g=g._4e_splitText(k)):0<g[0].childNodes.length&&(k>=g[0].childNodes.length?(g=new h(g[0].appendChild(i.createTextNode(""))),u=n):g=new h(g[0].childNodes[k]));c[0].nodeType==b.NodeType.TEXT_NODE?(p=n,c._4e_splitText(f)):
f?f>=c[0].childNodes.length?(c=new h(c[0].appendChild(i.createTextNode(""))),e=n):c=new h(c[0].childNodes[f].previousSibling):(e=new h(i.createTextNode("")),c.prepend(e),c=e,e=n);var H=c._4e_parents(),J=g._4e_parents();H.each(function(a,b){H[b]=a});J.each(function(a,b){J[b]=a});for(var F,M,i=0;i<H.length&&!(F=H[i],M=J[i],!F.equals(M));i++);for(var f=l,A,I,m=i;m<H.length;m++){A=H[m];k=0<d&&!A.equals(c)?f.appendChild(A.clone()[0]):null;A=A[0].nextSibling;I=J[m];for(var B=g[0],o=I&&I[0];A&&!(o==A||B==
A);)I=A.nextSibling,2==d?f.appendChild(A.cloneNode(n)):(b._4e_remove(A),1==d&&f.appendChild(A)),A=I;k&&(f=k)}for(f=l;i<J.length;i++){A=J[i];k=0<d&&!A.equals(g)?f.appendChild(A.clone()[0]):null;if(!H[i]||!A._4e_sameLevel(H[i]))for(A=A[0].previousSibling;A;)I=A.previousSibling,2==d?f.insertBefore(A.cloneNode(n),f.firstChild):(b._4e_remove(A),1==d&&f.insertBefore(A,f.firstChild)),A=I;k&&(f=k)}if(2==d){if(p&&(F=c[0],F.nodeType==b.NodeType.TEXT_NODE&&F.nextSibling&&F.nextSibling.nodeType==b.NodeType.TEXT_NODE&&
(F.data+=F.nextSibling.data,F.parentNode.removeChild(F.nextSibling))),j)j=g[0],j.nodeType==b.NodeType.TEXT_NODE&&j.previousSibling&&j.previousSibling.nodeType==b.NodeType.TEXT_NODE&&(j.previousSibling.data+=j.data,j.parentNode.removeChild(j))}else{if(F&&M&&(!c._4e_sameLevel(F)||!g._4e_sameLevel(M)))j=F._4e_index(),e&&F._4e_sameLevel(c)&&j--,a.setStart(F.parent(),j+1);a.collapse(n)}e&&c.remove();u&&g.remove();return l}function m(a){a.collapsed=a.startContainer&&a.endContainer&&a.startContainer[0]==
a.endContainer[0]&&a.startOffset==a.endOffset}function w(a){this.endOffset=this.endContainer=this.startOffset=this.startContainer=y;this.collapsed=n;this.document=a}i.RANGE={POSITION_AFTER_START:1,POSITION_BEFORE_END:2,POSITION_BEFORE_START:3,POSITION_AFTER_END:4,ENLARGE_ELEMENT:1,ENLARGE_BLOCK_CONTENTS:2,ENLARGE_LIST_ITEM_CONTENTS:3,START:1,END:2,SHRINK_ELEMENT:1,SHRINK_TEXT:2};var n=!0,v=!1,y=null,j=i.RANGE,c=i.POSITION,b=a.DOM,u=a.UA,d=i.XHTML_DTD,h=a.Node,g=h.all,k={area:1,base:1,br:1,col:1,hr:1,
img:1,input:1,link:1,meta:1,param:1},p=new q.whitespaces,B=new q.bookmark,C=q.whitespaces(n),z=q.bookmark(!1,!0),E={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};a.augment(w,{toString:function(){var a=[],b=this.startContainer[0],d=this.endContainer[0];a.push((b.id||b.nodeName)+":"+this.startOffset);a.push((d.id||d.nodeName)+":"+this.endOffset);return a.join("<br/>")},optimize:function(){var a=
this.startContainer,d=this.startOffset;a[0].nodeType!=b.NodeType.ELEMENT_NODE&&(d?d>=a[0].nodeValue.length&&this.setStartAfter(a):this.setStartBefore(a));a=this.endContainer;d=this.endOffset;a[0].nodeType!=b.NodeType.ELEMENT_NODE&&(d?d>=a[0].nodeValue.length&&this.setEndAfter(a):this.setEndBefore(a))},setStartAfter:function(a){this.setStart(a.parent(),a._4e_index()+1)},setStartBefore:function(a){this.setStart(a.parent(),a._4e_index())},setEndAfter:function(a){this.setEnd(a.parent(),a._4e_index()+
1)},setEndBefore:function(a){this.setEnd(a.parent(),a._4e_index())},optimizeBookmark:function(){var a=this.startContainer,b=this.endContainer;a&&"span"==a.nodeName()&&a.attr("_ke_bookmark")&&this.setStartBefore(a);b&&"span"==b.nodeName()&&b.attr("_ke_bookmark")&&this.setEndAfter(b)},setStart:function(a,d){a[0].nodeType==b.NodeType.ELEMENT_NODE&&k[a.nodeName()]&&(a=a.parent(),d=a._4e_index());this.startContainer=a;this.startOffset=d;this.endContainer||(this.endContainer=a,this.endOffset=d);m(this)},
setEnd:function(a,d){a[0].nodeType==b.NodeType.ELEMENT_NODE&&k[a.nodeName()]&&(a=a.parent(),d=a._4e_index()+1);this.endContainer=a;this.endOffset=d;this.startContainer||(this.startContainer=a,this.startOffset=d);m(this)},setStartAt:function(a,d){switch(d){case j.POSITION_AFTER_START:this.setStart(a,0);break;case j.POSITION_BEFORE_END:a[0].nodeType==b.NodeType.TEXT_NODE?this.setStart(a,a[0].nodeValue.length):this.setStart(a,a[0].childNodes.length);break;case j.POSITION_BEFORE_START:this.setStartBefore(a);
break;case j.POSITION_AFTER_END:this.setStartAfter(a)}m(this)},setEndAt:function(a,d){switch(d){case j.POSITION_AFTER_START:this.setEnd(a,0);break;case j.POSITION_BEFORE_END:a[0].nodeType==b.NodeType.TEXT_NODE?this.setEnd(a,a[0].nodeValue.length):this.setEnd(a,a[0].childNodes.length);break;case j.POSITION_BEFORE_START:this.setEndBefore(a);break;case j.POSITION_AFTER_END:this.setEndAfter(a)}m(this)},cloneContents:function(){return o(this,2)},deleteContents:function(){return o(this,0)},extractContents:function(){return o(this,
1)},collapse:function(a){a?(this.endContainer=this.startContainer,this.endOffset=this.startOffset):(this.startContainer=this.endContainer,this.startOffset=this.endOffset);this.collapsed=n},clone:function(){var a=new w(this.document);a.startContainer=this.startContainer;a.startOffset=this.startOffset;a.endContainer=this.endContainer;a.endOffset=this.endOffset;a.collapsed=this.collapsed;return a},getEnclosedNode:function(){var a=this.clone();a.optimize();if(a.startContainer[0].nodeType!=b.NodeType.ELEMENT_NODE||
a.endContainer[0].nodeType!=b.NodeType.ELEMENT_NODE)return y;var d=new q(a);d.evaluator=function(a){return C(a)&&z(a)};a=d.next();d.reset();d=d.previous();return a&&a.equals(d)?a:y},shrink:function(a,d){if(!this.collapsed){var a=a||j.SHRINK_TEXT,c=this.clone(),h=this.startContainer,g=this.endContainer,f=this.startOffset,k=this.endOffset,e=n,p,l,i=n;h&&h[0].nodeType==b.NodeType.TEXT_NODE&&(f?f>=h[0].nodeValue.length?c.setStartAfter(h):(c.setStartBefore(h),e=v):c.setStartBefore(h));g&&g[0].nodeType==
b.NodeType.TEXT_NODE&&(k?k>=g[0].nodeValue.length?c.setEndAfter(g):(c.setEndAfter(g),i=v):c.setEndBefore(g));if(e||i)l=new q(c),l.evaluator=function(d){return d.nodeType==(a==j.SHRINK_ELEMENT?b.NodeType.ELEMENT_NODE:b.NodeType.TEXT_NODE)},l.guard=function(d,c){if(a==j.SHRINK_ELEMENT&&d.nodeType==b.NodeType.TEXT_NODE||c&&d==p)return v;!c&&d.nodeType==b.NodeType.ELEMENT_NODE&&(p=d);return n};e&&(c=l[a==j.SHRINK_ELEMENT?"lastForward":"next"]())&&this.setStartAt(c,d?j.POSITION_AFTER_START:j.POSITION_BEFORE_START);
i&&(l.reset(),(l=l[a==j.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(l,d?j.POSITION_BEFORE_END:j.POSITION_AFTER_END));return e||i}},createBookmark2:function(a){var d=this.startContainer,c=this.endContainer,g=this.startOffset,f=this.endOffset,k,e;if(!d||!c)return{start:0,end:0};if(a){if(d[0].nodeType==b.NodeType.ELEMENT_NODE&&(k=new h(d[0].childNodes[g]))&&k[0]&&k[0].nodeType==b.NodeType.TEXT_NODE&&0<g&&k[0].previousSibling.nodeType==b.NodeType.TEXT_NODE)d=k,g=0;for(;d[0].nodeType==
b.NodeType.TEXT_NODE&&(e=d.prev(void 0,1))&&e[0].nodeType==b.NodeType.TEXT_NODE;)d=e,g+=e[0].nodeValue.length;if(!this.collapsed){if(c[0].nodeType==b.NodeType.ELEMENT_NODE&&(k=new h(c[0].childNodes[f]))&&k[0]&&k[0].nodeType==b.NodeType.TEXT_NODE&&0<f&&k[0].previousSibling.nodeType==b.NodeType.TEXT_NODE)c=k,f=0;for(;c[0].nodeType==b.NodeType.TEXT_NODE&&(e=c.prev(void 0,1))&&e[0].nodeType==b.NodeType.TEXT_NODE;)c=e,f+=e[0].nodeValue.length}}return{start:d._4e_address(a),end:this.collapsed?y:c._4e_address(a),
startOffset:g,endOffset:f,normalized:a,is2:n}},createBookmark:function(d){var b,c,g,f,k=this.collapsed;b=new h("<span>",y,this.document);b.attr("_ke_bookmark",1);b.css("display","none");b.html("&nbsp;");d&&(g=a.guid("ke_bm_"),b.attr("id",g+"S"));k||(c=b.clone(),c.html("&nbsp;"),d&&c.attr("id",g+"E"),f=this.clone(),f.collapse(),f.insertNode(c));f=this.clone();f.collapse(n);f.insertNode(b);c?(this.setStartAfter(b),this.setEndBefore(c)):this.moveToPosition(b,j.POSITION_AFTER_END);return{startNode:d?
g+"S":b,endNode:d?g+"E":c,serializable:d,collapsed:k}},moveToPosition:function(a,b){this.setStartAt(a,b);this.collapse(n)},trim:function(a,d){var c=this.startContainer,h=this.startOffset,g=this.collapsed;if((!a||g)&&c[0]&&c[0].nodeType==b.NodeType.TEXT_NODE){if(h)if(h>=c[0].nodeValue.length)h=c._4e_index()+1,c=c.parent();else{var f=c._4e_splitText(h),h=c._4e_index()+1,c=c.parent();b.equals(this.startContainer,this.endContainer)?this.setEnd(f,this.endOffset-this.startOffset):b.equals(c,this.endContainer)&&
(this.endOffset+=1)}else h=c._4e_index(),c=c.parent();this.setStart(c,h);if(g){this.collapse(n);return}}c=this.endContainer;h=this.endOffset;!d&&!g&&c[0]&&c[0].nodeType==b.NodeType.TEXT_NODE&&(h?(h>=c[0].nodeValue.length||c._4e_splitText(h),h=c._4e_index()+1):h=c._4e_index(),c=c.parent(),this.setEnd(c,h))},insertNode:function(a){this.optimizeBookmark();this.trim(v,n);var b=this.startContainer;b[0].insertBefore(a[0],b[0].childNodes[this.startOffset]||null);b[0]==this.endContainer[0]&&this.endOffset++;
this.setStartBefore(a)},moveToBookmark:function(b){var d=g(this.document);if(b.is2){var c=d._4e_getByAddress(b.start,b.normalized),h=b.startOffset,d=b.end&&d._4e_getByAddress(b.end,b.normalized),b=b.endOffset;this.setStart(c,h);d?this.setEnd(d,b):this.collapse(n)}else c=(h=b.serializable)?a.one("#"+b.startNode,d):b.startNode,b=h?a.one("#"+b.endNode,d):b.endNode,this.setStartBefore(c),c._4e_remove(),b&&b[0]?(this.setEndBefore(b),b._4e_remove()):this.collapse(n)},getCommonAncestor:function(a,d){var c=
this.startContainer,g=this.endContainer,c=c[0]==g[0]?a&&c[0].nodeType==b.NodeType.ELEMENT_NODE&&this.startOffset==this.endOffset-1?new h(c[0].childNodes[this.startOffset]):c:c._4e_commonAncestor(g);return d&&c[0].nodeType==b.NodeType.TEXT_NODE?c.parent():c},enlarge:function(){function a(d,c,h,f){var k=d[c?"startContainer":"endContainer"],e,j=c?0:1,r=0,l=c?"previousSibling":"nextSibling";e=d[c?"startOffset":"endOffset"];if(k[0].nodeType==b.NodeType.TEXT_NODE){if(c){if(e)return}else if(e<k[0].nodeValue.length)return;
e=k[0][l];k=k[0].parentNode}else e=k[0].childNodes[e+(c?-1:1)]||null,k=k[0];for(;k;){for(;e;)if(p(e)||B(e))e=e[l];else break;if(e){if(!r)d[c?"setStartAfter":"setEndBefore"](g(e));break}k=g(k);if("body"==k.nodeName())break;if(r||k.equals(f))h[j]=k,r=1;else d[c?"setStartBefore":"setEndAfter"](k);e=k[0][l];k=k[0].parentNode}}return function(d){switch(d){case j.ENLARGE_ELEMENT:if(this.collapsed)break;var d=this.getCommonAncestor(),c=[];a(this,1,c,d);a(this,0,c,d);c[0]&&c[1]&&(d=c[0].contains(c[1])?c[1]:
c[0],this.setStartBefore(d),this.setEndAfter(d));break;case j.ENLARGE_BLOCK_CONTENTS:case j.ENLARGE_LIST_ITEM_CONTENTS:var f=new w(this.document),c=new h(this.document.body);f.setStartAt(c,j.POSITION_AFTER_START);f.setEnd(this.startContainer,this.startOffset);var f=new q(f),k,e,p=q.blockBoundary(d==j.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:y),l=function(a){var b=p(a);b||(k=g(a));return b},i=function(a){var d=l(a);!d&&"br"==b.nodeName(a)&&(e=g(a));return d};f.guard=l;f=f.lastBackward();k=k||c;this.setStartAt(k,
"br"!=k.nodeName()&&(!f&&this.checkStartOfBlock()||f&&k.contains(f))?j.POSITION_AFTER_START:j.POSITION_AFTER_END);f=this.clone();f.collapse();f.setEndAt(c,j.POSITION_BEFORE_END);f=new q(f);f.guard=d==j.ENLARGE_LIST_ITEM_CONTENTS?i:l;k=y;f=f.lastForward();k=k||c;this.setEndAt(k,!f&&this.checkEndOfBlock()||f&&k.contains(f)?j.POSITION_BEFORE_END:j.POSITION_BEFORE_START);e&&this.setEndAfter(e)}}}(),checkStartOfBlock:function(){var d=this.startContainer,c=this.startOffset;if(c&&d[0].nodeType==b.NodeType.TEXT_NODE&&
a.trim(d[0].nodeValue.substring(0,c)).length)return v;this.trim();d=new s(this.startContainer);c=this.clone();c.collapse(n);c.setStartAt(d.block||d.blockLimit,j.POSITION_AFTER_START);d=new q(c);d.evaluator=l(n);return d.checkBackward()},checkEndOfBlock:function(){var d=this.endContainer,c=this.endOffset;if(d[0].nodeType==b.NodeType.TEXT_NODE&&a.trim(d[0].nodeValue.substring(c)).length)return v;this.trim();d=new s(this.endContainer);c=this.clone();c.collapse(v);c.setEndAt(d.block||d.blockLimit,j.POSITION_BEFORE_END);
d=new q(c);d.evaluator=l(v);return d.checkForward()},checkBoundaryOfElement:function(a,d){var b=this.clone();b[d==j.START?"setStartAt":"setEndAt"](a,d==j.START?j.POSITION_AFTER_START:j.POSITION_BEFORE_END);b=new q(b);b.evaluator=f;return b[d==j.START?"checkBackward":"checkForward"]()},getBoundaryNodes:function(){var a=this.startContainer,d=this.endContainer,h=this.startOffset,f=this.endOffset,k;if(a[0].nodeType==b.NodeType.ELEMENT_NODE)if(k=a[0].childNodes.length,k>h)a=g(a[0].childNodes[h]);else if(0==
k)a=a._4e_previousSourceNode();else{for(a=a[0];a.lastChild;)a=a.lastChild;a=g(a);a=a._4e_nextSourceNode()||a}if(d[0].nodeType==b.NodeType.ELEMENT_NODE)if(k=d[0].childNodes.length,k>f)d=g(d[0].childNodes[f])._4e_previousSourceNode(n);else if(0==k)d=d._4e_previousSourceNode();else{for(d=d[0];d.lastChild;)d=d.lastChild;d=g(d)}a._4e_position(d)&c.POSITION_FOLLOWING&&(a=d);return{startNode:a,endNode:d}},fixBlock:function(a,d){var b=this.createBookmark(),c=g(this.document.createElement(d));this.collapse(a);
this.enlarge(j.ENLARGE_BLOCK_CONTENTS);c[0].appendChild(this.extractContents());c._4e_trim();u.ie||c._4e_appendBogus();this.insertNode(c);this.moveToBookmark(b);return c},splitBlock:function(d){var b=new s(this.startContainer),c=new s(this.endContainer),h=b.block,g=c.block,f=y;if(!b.blockLimit.equals(c.blockLimit))return y;"br"!=d&&(h||(h=this.fixBlock(n,d),g=(new s(this.endContainer)).block),g||(g=this.fixBlock(v,d)));d=h&&this.checkStartOfBlock();b=g&&this.checkEndOfBlock();this.deleteContents();
h&&h[0]==g[0]&&(b?(f=new s(this.startContainer),this.moveToPosition(g,j.POSITION_AFTER_END),g=y):d?(f=new s(this.startContainer),this.moveToPosition(h,j.POSITION_BEFORE_START),h=y):(g=this.splitElement(h),!u.ie&&!a.inArray(h.nodeName(),["ul","ol"])&&h._4e_appendBogus()));return{previousBlock:h,nextBlock:g,wasStartOfBlock:d,wasEndOfBlock:b,elementPath:f}},splitElement:function(a){if(!this.collapsed)return y;this.setEndAt(a,j.POSITION_BEFORE_END);var d=this.extractContents(),b=a.clone(v);b[0].appendChild(d);
b.insertAfter(a);this.moveToPosition(a,j.POSITION_AFTER_END);return b},moveToElementEditablePosition:function(a,d){for(var c=0;a;){if(a[0].nodeType==b.NodeType.TEXT_NODE){this.moveToPosition(a,d?j.POSITION_AFTER_END:j.POSITION_BEFORE_START);c=1;break}a[0].nodeType==b.NodeType.ELEMENT_NODE&&a._4e_isEditable()&&(this.moveToPosition(a,d?j.POSITION_BEFORE_END:j.POSITION_AFTER_START),c=1);var h=a,g=c,f=void 0;h[0].nodeType==b.NodeType.ELEMENT_NODE&&h._4e_isEditable()&&(f=h[d?"last":"first"](e,1));!g&&
!f&&(f=h[d?"prev":"next"](e,1));a=f}return!!c},selectNodeContents:function(a){var d=a[0];this.setStart(a,0);this.setEnd(a,d.nodeType==b.NodeType.TEXT_NODE?d.nodeValue.length:d.childNodes.length)},insertNodeByDtd:function(a){var b,c,h,g=a.nodeName();b=d.$block[g];this.deleteContents();if(b){for(b=this.getCommonAncestor(v,n);(c=d[b.nodeName()])&&(!c||!c[g]);){var f=b.parent();this.checkStartOfBlock()&&this.checkEndOfBlock()?(this.setStartBefore(b),this.collapse(n),b.remove()):h=b;b=f}h&&this.splitElement(h)}this.insertNode(a)}});
t.injectDom({_4e_breakParent:function(a,d){var d=g(d),a=g(a),b,c=new i.Range(a[0].ownerDocument);c.setStartAfter(a);c.setEndAfter(d);b=c.extractContents();c.insertNode(a.remove());a.after(b)}});return i.Range=w},{requires:["./base","./utils","./walker","./elementPath","./dom"]});
KISSY.add("editor/core/selection",function(a){function i(a){this.document=a;this._={cache:{}};if(n)try{var b=this.getNative().createRange();if(!b||b.item&&b.item(0).ownerDocument!=a||b.parentElement&&b.parentElement().ownerDocument!=a)this.isInvalid=s}catch(c){this.isInvalid=s}}function t(a){a=new i(a);return!a||a.isInvalid?f:a}var q=a.Editor;q.SELECTION={SELECTION_NONE:1,SELECTION_TEXT:2,SELECTION_ELEMENT:3};var s=!0,f=null,e=a.UA,l=a.DOM,o=a.Node,m=q.SELECTION,w=q.RANGE,n=e.ie,v=q.Walker,y=q.Range,
j={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};a.augment(i,{getNative:!n?function(){var a=this._.cache;return a.nativeSel||(a.nativeSel=l.getWindow(this.document).getSelection())}:function(){var a=this._.cache;return a.nativeSel||(a.nativeSel=this.document.selection)},getType:!n?function(){var a=this._.cache;if(a.type)return a.type;var b=m.SELECTION_TEXT,c=this.getNative();if(c){if(1==c.rangeCount){var c=
c.getRangeAt(0),f=c.startContainer;f==c.endContainer&&f.nodeType==l.NodeType.ELEMENT_NODE&&1==Number(c.endOffset-c.startOffset)&&j[f.childNodes[c.startOffset].nodeName.toLowerCase()]&&(b=m.SELECTION_ELEMENT)}}else b=m.SELECTION_NONE;return a.type=b}:function(){var a=this._.cache;if(a.type)return a.type;var b=m.SELECTION_NONE;try{var c=this.getNative(),f=c.type;"Text"==f&&(b=m.SELECTION_TEXT);"Control"==f&&(b=m.SELECTION_ELEMENT);c.createRange().parentElement&&(b=m.SELECTION_TEXT)}catch(e){}return a.type=
b},getRanges:n?function(){var a=function(a,b){a=a.duplicate();a.collapse(b);for(var d=a.parentElement(),c=d.childNodes,e,j=0;j<c.length;j++){var i=c[j];if(i.nodeType==l.NodeType.ELEMENT_NODE){e=a.duplicate();e.moveToElementText(i);var i=e.compareEndPoints("StartToStart",a),u=e.compareEndPoints("EndToStart",a);e.collapse();if(0<i)break;else{if(!i||1==u&&-1==i)return{container:d,offset:j};if(!u)return{container:d,offset:j+1}}e=f}}e||(e=a.duplicate(),e.moveToElementText(d),e.collapse(!1));e.setEndPoint("StartToStart",
a);e=(""+e.text).replace(/\r\n|\r/g,"\n").length;try{for(;0<e;)e-=c[--j].nodeValue.length}catch(r){e=0}return 0===e?{container:d,offset:j}:{container:c[j],offset:-e}};return function(b){var c=this._.cache;if(c.ranges&&!b)return c.ranges;var f=this.getNative(),b=f&&f.createRange(),e=this.getType();if(!f)return[];if(e==m.SELECTION_TEXT)return f=new y(this.document),e=a(b,s),f.setStart(new o(e.container),e.offset),e=a(b),f.setEnd(new o(e.container),e.offset),c.ranges=[f];if(e==m.SELECTION_ELEMENT){c=
c.ranges=[];for(e=0;e<b.length;e++){for(var j=b.item(e),l=j.parentNode,i=0,f=new y(this.document);i<l.childNodes.length&&l.childNodes[i]!=j;i++);f.setStart(new o(l),i);f.setEnd(new o(l),i+1);c.push(f)}return c}return c.ranges=[]}}():function(a){var b=this._.cache;if(b.ranges&&!a)return b.ranges;var a=[],c=this.getNative();if(!c)return[];for(var f=0;f<c.rangeCount;f++){var e=c.getRangeAt(f),j=new y(this.document);j.setStart(new o(e.startContainer),e.startOffset);j.setEnd(new o(e.endContainer),e.endOffset);
a.push(j)}return b.ranges=a},getStartElement:function(){var a=this._.cache;if(void 0!==a.startElement)return a.startElement;var b,c=this.getNative();switch(this.getType()){case m.SELECTION_ELEMENT:return this.getSelectedElement();case m.SELECTION_TEXT:var f=this.getRanges()[0];if(f&&!f.collapsed){for(f.optimize();s;)if(b=f.startContainer,f.startOffset==(b[0].nodeType===l.NodeType.ELEMENT_NODE?b[0].childNodes.length:b[0].nodeValue.length)&&!b._4e_isBlockBoundary())f.setStartAfter(b);else break;b=f.startContainer;
if(b[0].nodeType!=l.NodeType.ELEMENT_NODE)return b.parent();b=new o(b[0].childNodes[f.startOffset]);if(!b[0]||b[0].nodeType!=l.NodeType.ELEMENT_NODE)return f.startContainer;for(f=b[0].firstChild;f&&f.nodeType==l.NodeType.ELEMENT_NODE;)b=new o(f),f=f.firstChild;return b}if(n)f=c.createRange(),f.collapse(s),b=new o(f.parentElement());else{if((b=c.anchorNode)&&b.nodeType!=l.NodeType.ELEMENT_NODE)b=b.parentNode;b&&(b=new o(b))}}return a.startElement=b},getSelectedElement:function(){var a,b=this._.cache;
if(void 0!==b.selectedElement)return b.selectedElement;n&&(a=this.getNative().createRange(),a=a.item&&a.item(0));var c;if(a)c=new o(a);else{a=this.getRanges()[0];for(var f,e=2;e&&(!(c=a.getEnclosedNode())||!(c[0].nodeType==l.NodeType.ELEMENT_NODE&&j[c.nodeName()]&&(f=c)));e--)a.shrink(w.SHRINK_ELEMENT);c=f}return b.selectedElement=c},reset:function(){this._.cache={}},selectElement:function(a){var b,c=this.document;if(n)try{b=c.body.createControlRange(),b.addElement(a[0]),b.select()}catch(f){b=c.body.createTextRange(),
b.moveToElementText(a[0]),b.select()}finally{}else b=c.createRange(),b.selectNode(a[0]),a=this.getNative(),a.removeAllRanges(),a.addRange(b);this.reset()},selectRanges:function(a){if(n){if(1<a.length){var b=a[a.length-1];a[0].setEnd(b.endContainer,b.endOffset);a.length=1}a[0]&&a[0].select()}else{b=this.getNative();if(!b)return;b.removeAllRanges();for(var c=0;c<a.length;c++){var f=a[c],j=this.document.createRange(),i=f.startContainer;if(f.collapsed&&(e.gecko&&1.09>e.gecko||e.opera||e.webkit)&&i[0].nodeType==
l.NodeType.ELEMENT_NODE&&!i[0].childNodes.length)i[0].appendChild(this.document.createTextNode(e.webkit?"\u200b":"")),f.startOffset++,f.endOffset++;j.setStart(i[0],f.startOffset);j.setEnd(f.endContainer[0],f.endOffset);b.addRange(j)}}this.reset()},createBookmarks2:function(a){for(var b=[],c=this.getRanges(),f=0;f<c.length;f++)b.push(c[f].createBookmark2(a));return b},createBookmarks:function(b,c){for(var f=[],e=this.document,j,c=c||this.getRanges(),i=c.length,u=0;u<i;u++){f.push(j=c[u].createBookmark(b,
s));var m=(b=j.serializable)?a.one("#"+j.startNode,e):j.startNode;j=b?a.one("#"+j.endNode,e):j.endNode;for(var o=u+1;o<i;o++){var r=c[o],n=r.startContainer,t=r.endContainer;l.equals(n,m.parent())&&r.startOffset++;l.equals(n,j.parent())&&r.startOffset++;l.equals(t,m.parent())&&r.endOffset++;l.equals(t,j.parent())&&r.endOffset++}}return f},selectBookmarks:function(a){for(var b=[],c=0;c<a.length;c++){var f=new y(this.document);f.moveToBookmark(a[c]);b.push(f)}this.selectRanges(b);return this},getCommonAncestor:function(){var a=
this.getRanges();return a[0].startContainer._4e_commonAncestor(a[a.length-1].endContainer)},scrollIntoView:function(){var a=this.getStartElement();a&&a.scrollIntoView(void 0,{alignWithTop:!1,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0})},removeAllRanges:function(){var a=this.getNative();n?a&&a.clear():a&&a.removeAllRanges()}});var c={table:1,tbody:1,tr:1},b=v.whitespaces(s),u=/\ufeff|\u00a0/;y.prototype.select=y.prototype.select=!n?function(){var a=this.startContainer;this.collapsed&&a[0].nodeType==
l.NodeType.ELEMENT_NODE&&!a[0].childNodes.length&&(a[0].appendChild(this.document.createTextNode(e.webkit?"\u200b":"")),this.startOffset++,this.endOffset++);var b=this.document.createRange();b.setStart(a[0],this.startOffset);try{b.setEnd(this.endContainer[0],this.endOffset)}catch(c){if(0<=c.toString().indexOf("NS_ERROR_ILLEGAL_VALUE"))this.collapse(s),b.setEnd(this.endContainer[0],this.endOffset);else throw c;}a=t(this.document).getNative();a.removeAllRanges();a.addRange(b)}:function(a){var f=this.collapsed,
e,j;if(this.startContainer[0]===this.endContainer[0]&&1==this.endOffset-this.startOffset){var p=this.startContainer[0].childNodes[this.startOffset];if(p.nodeType==l.NodeType.ELEMENT_NODE){(new i(this.document)).selectElement(new o(p));return}}(this.startContainer[0].nodeType==l.NodeType.ELEMENT_NODE&&this.startContainer.nodeName()in c||this.endContainer[0].nodeType==l.NodeType.ELEMENT_NODE&&this.endContainer.nodeName()in c)&&this.shrink(w.SHRINK_ELEMENT,s);var m=this.createBookmark(),p=m.startNode,
n;f||(n=m.endNode);m=this.document.body.createTextRange();m.moveToElementText(p[0]);m.moveStart("character",1);if(n)a=this.document.body.createTextRange(),a.moveToElementText(n[0]),m.setEndPoint("EndToEnd",a),m.moveEnd("character",-1);else{for(e=p[0].nextSibling;e&&!b(e);)e=e.nextSibling;e=!(e&&e.nodeValue&&e.nodeValue.match(u))&&(a||!p[0].previousSibling||p[0].previousSibling&&"br"==l.nodeName(p[0].previousSibling));j=new o(this.document.createElement("span"));j.html("&#65279;");j.insertBefore(p);
e&&l.insertBefore(this.document.createTextNode("\ufeff"),p[0]||p)}this.setStartBefore(p);p._4e_remove();if(f){if(e?(m.moveStart("character",-1),m.select(),this.document.selection.clear()):m.select(),j)this.moveToPosition(j,w.POSITION_BEFORE_START),j._4e_remove()}else this.setEndBefore(n),n._4e_remove(),m.select()};i.getSelection=t;return q.Selection=i},{requires:["./base","./walker","./range","./dom"]});
KISSY.add("editor/core/selectionFix",function(a,i){function t(a){function c(a,b){var c=g.body.createTextRange();try{c.moveToPoint(a,b)}catch(d){c=o}return c}function b(){var a=g.selection.createRange();k&&!a.item&&0===a.compareEndPoints("StartToEnd",a)&&k.select();w.remove(g,"mouseup",b);w.remove(g,"mousemove",f);k=d=0}function f(a){if(a.button){if(a=c(a.pageX,a.pageY))0<a.compareEndPoints("StartToStart",k)?a.setEndPoint("StartToStart",k):a.setEndPoint("EndToEnd",k),a.select()}else b()}var d,e=a.get("window")[0],
g=a.get("document")[0],k;w.on(g,"mousedown contextmenu",function(a){var j=g.documentElement;if(a.target===j&&(d&&b(),!(j.scrollHeight>j.clientHeight)&&(d=1,k=c(a.pageX,a.pageY))))w.on(g,"mouseup",b),w.on(g,"mousemove",f),e.focus(),k.select()})}function q(a){function c(d){if(g){var f=a.getSelection(),k=f&&f.getType(),i=f&&b.selection;if(d&&i&&k==y.SELECTION_NONE&&!b.queryCommandEnabled("InsertImage"))setTimeout(function(){c(e)},50);else{var l;if(!i||!i.type||!("Control"!=i.type&&(l=i.createRange())&&
(l=l.parentElement())&&(l=l.nodeName)&&l.toLowerCase()in{input:1,textarea:1}))h=i&&f.getRanges()[0],a.checkSelectionChange()}}}var b=a.get("document")[0],f=new v(b.body),d=new v(b.documentElement);if(8>i.Utils.ieEngine)d.on("click",function(b){"html"===(new v(b.target)).nodeName()&&a.getSelection().getNative().createRange().select()});var h,g,k=e;d.on("mousedown",function(){k=l});d.on("mouseup",function(){k=e});f.on("focusin",function(a){if("body"==(new v(a.target)).nodeName()&&h){try{k&&h.select()}catch(b){}h=
o}});f.on("focus",function(){g=e;c()});f.on("beforedeactivate",function(a){a.relatedTarget||(g=l,k=e)});f.on("mousedown",function(){g=l});f.on("mouseup",function(){g=e;setTimeout(function(){c(e)},0)});f.on("keydown",function(){g=l});f.on("keyup",function(){g=e;setTimeout(function(){c()},0)})}function s(a){var c=a.get("document")[0];w.on(c,"mouseup keyup selectionchange",function(){a.checkSelectionChange()})}function f(a){function c(a){var b=i.XHTML_DTD;return a._4e_isBlockBoundary()&&b.$empty[a.nodeName()]}
function b(a){return d(a)&&h(a)}var f=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;|(<\!--[\s\S]*?--\>))?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,d=i.Walker.whitespaces(e),h=i.Walker.bookmark(l,e),g=function(a){return d(a)&&8!=a.nodeType};a.on("selectionChange",function(d){var h=d.path,o=new v(a.get("document")[0].body),d=(d=d.selection)&&d.getRanges()[0],t=h.blockLimit;if(m.gecko){var s=h.block||h.blockLimit,q=s&&s.last(b);s&&s._4e_isBlockBoundary()&&(!q||!(1==q[0].nodeType&&
q._4e_isBlockBoundary()))&&"pre"!=s.nodeName()&&!s._4e_getBogus()&&s._4e_appendBogus()}if(d&&d.collapsed&&!h.block){if("body"==t.nodeName()){if((h=d.fixBlock(e,"p"))&&h[0]!=o[0].lastChild&&h.outerHTML().match(f))if((t=h.next(g,1))&&t[0].nodeType==n.NodeType.ELEMENT_NODE&&!c[t])d.moveToElementEditablePosition(t),h._4e_remove();else if((t=h.prev(g,1))&&t[0].nodeType==n.NodeType.ELEMENT_NODE&&!c[t])d.moveToElementEditablePosition(t,t.outerHTML().match(f)?l:e),h._4e_remove();d.select();a.notifySelectionChange()}h=
a.get("document")[0];d=new i.Range(h);d.moveToElementEditablePosition(o,e);"body"!==(new i.ElementPath(d.startContainer)).blockLimit.nodeName()&&(o=(new v(h.createElement("p"))).appendTo(o),m.ie||o._4e_appendBogus())}})}var e=!0,l=!1,o=null,m=a.UA,w=a.Event,n=a.DOM,v=a.Node,y=i.SELECTION;return{init:function(a){a.docReady(function(){m.ie?(t(a),q(a)):s(a)});f(a)}}},{requires:["./base","./selection"]});
KISSY.add("editor/core/styles",function(a,i){function t(a){return!z.attr(a,"_ke_bookmark")}function q(a,b){for(var c in a)"string"==typeof a[c]?a[c]=a[c].replace(S,function(a,c){return b[c]}):q(a[c],b)}function s(b,c){c&&(b=a.clone(b),q(b,c));var d=this.element=this.element=(b.element||"*").toLowerCase();this.type=this.type="#text"==d||R[d]?E.STYLE_BLOCK:P[d]?E.STYLE_OBJECT:E.STYLE_INLINE;this._={definition:b}}function f(a,b){var c=b?this.removeFromRange:this.applyToRange;a.body.focus();for(var d=
new D(a),f=d.getRanges(),e=0;e<f.length;e++)c.call(this,f[e]);d.selectRanges(f)}function e(a,b,c){var d=a.element;"*"==d&&(d="span");b=new G(b.createElement(d));c&&c._4e_copyAttributes(b);c=a._.definition;a=c.attributes;c=s.getStyleText(c);if(a)for(var f in a)b.attr(f,a[f]);c&&(b[0].style.cssText=c);return b}function l(a){var b=a.createBookmark(k),c=a.createIterator();c.enforceRealBlocks=k;c.enlargeBr=k;for(var d,f=a.document;d=c.getNextParagraph();){var h=e(this,f,d),g=h,h="pre"==g.nodeName,j="pre"==
d.nodeName,i=!h&&j;h&&!j?(j=d,i=j.html(),i=o(i,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,""),i=i.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1"),i=i.replace(/([ \t\n\r]+|&nbsp;)/g," "),i=i.replace(/<br\b[^>]*>/gi,"\n"),L.ie?(j=j[0].ownerDocument.createElement("div"),j.appendChild(g[0]),g[0].outerHTML="<pre>"+i+"</pre>",g=new G(j.firstChild),g._4e_remove()):g.html(i)):i?g=w(m(d),g):d._4e_moveChildren(g);d[0].parentNode.replaceChild(g[0],d[0]);if(h&&(d=g,h=void 0,(h=d._4e_previousSourceNode(k,z.NodeType.ELEMENT_NODE))&&
"pre"==h.nodeName()))g=o(h.html(),/\n$/,"")+"\n\n"+o(d.html(),/^\n/,""),L.ie?d[0].outerHTML="<pre>"+g+"</pre>":d.html(g),h._4e_remove()}a.moveToBookmark(b)}function o(a,b,c){var d="",f="",a=a.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,function(a,b,c){b&&(d=b);c&&(f=c);return""});return d+a.replace(b,c)+f}function m(a){var b=[];o(a.outerHTML(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(a,b,c){return b+"</pre>"+c+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,
function(a,c){b.push(c)});return b}function w(a,b){for(var c=b[0].ownerDocument.createDocumentFragment(),d=0;d<a.length;d++){var f=a[d],f=f.replace(/(\r\n|\r)/g,"\n"),f=o(f,/^[ \t]*\n/,""),f=o(f,/\n$/,""),f=o(f,/^[ \t]+|[ \t]+$/g,function(a,b){return 1==a.length?"&nbsp;":b?" "+Array(a.length).join("&nbsp;"):Array(a.length).join("&nbsp;")+" "}),f=f.replace(/\n/g,"<br>"),f=f.replace(/[ \t]{2,}/g,function(a){return Array(a.length).join("&nbsp;")+" "}),e=b.clone();e.html(f);c.appendChild(e[0])}return c}
function n(a){var b=a.document;if(a.collapsed)b=e(this,b,void 0),a.insertNode(b),a.moveToPosition(b,r.POSITION_BEFORE_END);else{var c=this.element,f=this._.definition,h,g=K[c];g||(h=k,g=K.span);var j=a.createBookmark();a.enlarge(r.ENLARGE_ELEMENT);a.trim();for(var i=a.createBookmark(),l=i.startNode,i=i.endNode,m=l,o;m&&m[0];){var n=p;if(z.equals(m,i))m=B,n=k;else{var u=m[0].nodeType,s=u==z.NodeType.ELEMENT_NODE?m.nodeName():B;if(s&&m.attr("_ke_bookmark")){m=m._4e_nextSourceNode(k);continue}if(!s||
g[s]&&(m._4e_position(i)|x.POSITION_PRECEDING|x.POSITION_IDENTICAL|x.POSITION_IS_CONTAINED)==x.POSITION_PRECEDING+x.POSITION_IDENTICAL+x.POSITION_IS_CONTAINED&&(!f.childRule||f.childRule(m))){var q=m.parent();if(q&&"a"==c&&q.nodeName()==c)u=e(this,b,void 0),q._4e_moveChildren(u),q[0].parentNode.replaceChild(u[0],q[0]),u._4e_mergeSiblings();else if(q&&q[0]&&((K[q.nodeName()]||K.span)[c]||h)&&(!f.parentRule||f.parentRule(q))){if(!o&&(!s||!K.$removeEmpty[s]||(m._4e_position(i)|x.POSITION_PRECEDING|x.POSITION_IDENTICAL|
x.POSITION_IS_CONTAINED)==x.POSITION_PRECEDING+x.POSITION_IDENTICAL+x.POSITION_IS_CONTAINED))o=new O(b),o.setStartBefore(m);if(u==z.NodeType.TEXT_NODE||u==z.NodeType.ELEMENT_NODE&&!m[0].childNodes.length){q=m;for(u=null;(n=!q.next(t,1))&&(u=q.parent())&&g[u.nodeName()]&&(u._4e_position(l)|x.POSITION_FOLLOWING|x.POSITION_IDENTICAL|x.POSITION_IS_CONTAINED)==x.POSITION_FOLLOWING+x.POSITION_IDENTICAL+x.POSITION_IS_CONTAINED&&(!f.childRule||f.childRule(u));)q=u;o.setEndAfter(q)}}else n=k}else n=k;m=m._4e_nextSourceNode()}if(n&&
o&&!o.collapsed){for(var n=e(this,b,void 0),q=o.getCommonAncestor(),u={},s={},w,v=null,y;n&&q&&n[0]&&q[0];){if(q.nodeName()==c){for(w in f.attributes)if(!s[w]&&(y=q.attr(v)))n.attr(w)==y?n.removeAttr(w):s[w]=1;for(v in f.styles)if(!u[v]&&(y=q.style(v)))n.style(v)==y?n.style(v,""):u[v]=1;if(!n._4e_hasAttributes()){n=B;break}}q=q.parent()}n?(n[0].appendChild(o.extractContents()),d(this,n),o.insertNode(n),n._4e_mergeSiblings(),L.ie||n[0].normalize()):(n=new G(b.createElement("span")),n[0].appendChild(o.extractContents()),
o.insertNode(n),d(this,n),n._4e_remove(!0));o=B}}l._4e_remove();i._4e_remove();a.moveToBookmark(j);a.shrink(r.SHRINK_TEXT)}}function v(a){a.enlarge(r.ENLARGE_ELEMENT);var d=a.createBookmark(),f=d.startNode;if(a.collapsed){for(var e=new N(f.parent()),g,j=0,i;j<e.elements.length&&(i=e.elements[j])&&!(i==e.block||i==e.blockLimit);j++)if(this.checkElementRemovable(i)){var k=a.checkBoundaryOfElement(i,r.END),l=!k&&a.checkBoundaryOfElement(i,r.START);l||k?(g=i,g.match=l?"start":"end"):(i._4e_mergeSiblings(),
i.nodeName()!=this.element?(k=c(this),h(i,k[i.nodeName()]||k["*"])):b(this,i))}if(g){i=f;for(j=0;;j++){k=e.elements[j];if(k.equals(g))break;else if(k.match)continue;else k=k.clone();k[0].appendChild(i[0]);i=k}i["start"==g.match?"insertBefore":"insertAfter"](g);e=g.html();!e||"\u200b"==e?g.remove():L.webkit&&C(a.document.createTextNode("\u200b")).insertBefore(i)}}else{var m=d.endNode,n=this;g=function(){for(var a=new N(f.parent()),b=new N(m.parent()),c=B,d=B,e=0;e<a.elements.length;e++){var g=a.elements[e];
if(g==a.block||g==a.blockLimit)break;n.checkElementRemovable(g)&&(c=g)}for(e=0;e<b.elements.length;e++){g=b.elements[e];if(g==b.block||g==b.blockLimit)break;n.checkElementRemovable(g)&&(d=g)}d&&m._4e_breakParent(d);c&&f._4e_breakParent(c)};g();for(e=new G(f[0].nextSibling);e[0]!==m[0];){j=e._4e_nextSourceNode();if(e[0]&&e[0].nodeType==z.NodeType.ELEMENT_NODE&&this.checkElementRemovable(e)&&(e.nodeName()==this.element?b(this,e):(i=c(this),h(e,i[e.nodeName()]||i["*"])),j[0].nodeType==z.NodeType.ELEMENT_NODE&&
j.contains(f)))g(),j=new G(f[0].nextSibling);e=j}}a.moveToBookmark(d)}function y(a){var b={};(""+a).replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(a,c,d){b[c]=d});return b}function j(a,b){var c="";b!==p?(c=document.createElement("span"),c.style.cssText=a,c=c.style.cssText||""):c=a;return c.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function c(b){if(b._.overrides)return b._.overrides;var c=b._.overrides={},d=b._.definition.overrides;
if(d){a.isArray(d)||(d=[d]);for(var f=0;f<d.length;f++){var e=d[f],g,h,j;"string"==typeof e?g=e.toLowerCase():(g=e.element?e.element.toLowerCase():b.element,h=e.attributes,j=e.styles);e=c[g]||(c[g]={});if(h){g=e.attributes=e.attributes||[];for(var i in h)g.push([i.toLowerCase(),h[i]])}if(j){var e=e.styles=e.styles||[],k;for(k in j)e.push([k.toLowerCase(),j[k]])}}}return c}function b(b,d){var f=b._.definition,e=c(b),h=a.merge(f.attributes,(e[d.nodeName()]||e["*"]||{}).attributes),f=a.merge(f.styles,
(e[d.nodeName()]||e["*"]||{}).styles),e=a.isEmptyObject(h)&&a.isEmptyObject(f),j;for(j in h)("class"==j||b._.definition.fullMatch)&&d.attr(j)!=u(j,h[j])||(e=e||!!d.hasAttr(j),d.removeAttr(j));for(var i in f)b._.definition.fullMatch&&d.style(i)!=u(i,f[i],k)||(e=e||!!d.style(i),d.style(i,""));g(d)}function u(a,b,c){var d=new G("<span>");d[c?"style":"attr"](a,b);return d[c?"style":"attr"](a)}function d(a,d){for(var f=c(a),e=d.all(a.element),g=e.length;0<=--g;)b(a,new G(e[g]));for(var j in f)if(j!=a.element){e=
d.all(j);for(g=e.length-1;0<=g;g--){var i=new G(e[g]);h(i,f[j])}}}function h(a,b){var c,d=b&&b.attributes;if(d)for(c=0;c<d.length;c++){var f=d[c][0],e;if(e=a.attr(f)){var h=d[c][1];(h===B||h.test&&h.test(e)||"string"==typeof h&&e==h)&&a[0].removeAttribute(f)}}if(d=b&&b.styles)for(c=0;c<d.length;c++)if(f=d[c][0],h=a.css(f)){var j=d[c][1];(j===B||j.test&&j.test(e)||"string"==typeof j&&h==j)&&a.css(f,"")}g(a)}function g(a){if(!a._4e_hasAttributes()){var b=a[0].firstChild,c=a[0].lastChild;a._4e_remove(k);
b&&(b.nodeType==z.NodeType.ELEMENT_NODE&&z._4e_mergeSiblings(b),c&&b!=c&&c.nodeType==z.NodeType.ELEMENT_NODE&&z._4e_mergeSiblings(c))}}var k=!0,p=!1,B=null,C=a.all,z=a.DOM,E={STYLE_BLOCK:1,STYLE_INLINE:2,STYLE_OBJECT:3},r=i.RANGE,D=i.Selection,x=i.POSITION,O=i.Range,G=a.Node,L=a.UA,N=i.ElementPath,R={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},K=i.XHTML_DTD,P={embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1},Q=/\s*(?:;\s*|$)/g,S=/#\((.+?)\)/g;i.STYLE=
E;s.prototype={constructor:s,apply:function(a){f.call(this,a,p)},remove:function(a){f.call(this,a,k)},applyToRange:function(a){return(this.applyToRange=this.type==E.STYLE_INLINE?n:this.type==E.STYLE_BLOCK?l:B).call(this,a)},removeFromRange:function(a){return(this.removeFromRange=this.type==E.STYLE_INLINE?v:B).call(this,a)},checkElementRemovable:function(a,b){if(!a)return p;var d=this._.definition,f;if(a.nodeName()==this.element){if(!b&&!a._4e_hasAttributes())return k;var e=d._AC;if(e)d=e;else{var e=
{},g=0,h=d.attributes;if(h)for(var i in h)g++,e[i]=h[i];if(h=s.getStyleText(d))e.style||g++,e.style=h;e._length=g;d=d._AC=e}if(d._length){for(var l in d)if("_length"!=l){g=a.attr(l)||"";if("style"==l)a:{e=d[l];g=j(g,p);"string"==typeof e&&(e=y(e));"string"==typeof g&&(g=y(g));h=void 0;for(h in e)if(!(h in g&&(g[h]==e[h]||"inherit"==e[h]||"inherit"==g[h]))){e=p;break a}e=k}else e=d[l]==g;if(e){if(!b)return k}else if(b)return p}if(b)return k}else return k}l=c(this);if(l=l[a.nodeName()]||l["*"]){if(!(d=
l.attributes)&&!(f=l.styles))return k;if(d)for(e=0;e<d.length;e++)if(l=d[e][0],l=a.attr(l))if(g=d[e][1],g===B||"string"==typeof g&&l==g||g.test&&g.test(l))return k;if(f)for(e=0;e<f.length;e++)if(l=a.css(f[e][0]))if(d=f[e][1],d===B||"string"==typeof d&&l==d||d.test&&d.test(l))return k}return p},checkActive:function(a){switch(this.type){case E.STYLE_BLOCK:return this.checkElementRemovable(a.block||a.blockLimit,k);case E.STYLE_OBJECT:case E.STYLE_INLINE:for(var b=a.elements,c=0,d;c<b.length;c++)if(d=
b[c],!(this.type==E.STYLE_INLINE&&(z.equals(d,a.block)||z.equals(d,a.blockLimit))))if((this.type!=E.STYLE_OBJECT||d.nodeName()in P)&&this.checkElementRemovable(d,k))return k}return p}};s.getStyleText=function(a){var b=a._ST;if(b)return b;var b=a.styles,c=a.attributes&&a.attributes.style||"",d="";c.length&&(c=c.replace(Q,";"));for(var f in b){var e=b[f],g=(f+":"+e).replace(Q,";");"inherit"==e?d+=g:c+=g}c.length&&(c=j(c));return a._ST=c+d};return i.Style=s},{requires:["./base","./range","./selection",
"./domIterator","./elementPath"]});
KISSY.add("editor/core/utils",function(a){var i=a.Node,t=a.DOM,q=a.UA,s={debugUrl:function(f){var e=a.Config;e.debug||(f=f.replace(/\.(js|css)/i,"-min.$1"));-1==f.indexOf("?t")&&(f=-1!=f.indexOf("?")?f+"&":f+"?",f+="t="+encodeURIComponent(e.tag));return e.base+"editor/"+f},lazyRun:function(a,e,i){var o=a[e],m=a[i];a[e]=function(){o.apply(this,arguments);a[e]=a[i];return m.apply(this,arguments)}},getXY:function(a,e){var i=a.left,o=a.top,m=e.get("window")[0],i=i-t.scrollLeft(m),o=o-t.scrollTop(m),m=
e.get("iframe").offset(),i=i+m.left,o=o+m.top;return{left:i,top:o}},tryThese:function(a){for(var e,i=0,o=arguments.length;i<o;i++){var m=arguments[i];try{e=m();break}catch(q){}}return e},arrayCompare:function(a,e){if(!a&&!e)return!0;if(!a||!e||a.length!=e.length)return!1;for(var i=0;i<a.length;i++)if(a[i]!==e[i])return!1;return!0},clearAllMarkers:function(a){for(var e in a)a[e]._4e_clearMarkers(a,!0,void 0)},ltrim:function(a){return a.replace(/^\s+/,"")},rtrim:function(a){return a.replace(/\s+$/,
"")},isNumber:function(f){return/^\d+(.\d+)?$/.test(a.trim(f))},verifyInputs:function(f){for(var e=0;e<f.length;e++){var l=new i(f[e]),o=a.trim(s.valInput(l)),m=l.attr("data-verify"),l=l.attr("data-warning");if(m&&!RegExp(m).test(o))return alert(l),!1}return!0},sourceDisable:function(a,e){a.on("sourceMode",e.disable,e);a.on("wysiwygMode",e.enable,e)},resetInput:function(a){var e=a.attr("placeholder");e&&q.ie?(a.addClass("ks-editor-input-tip"),a.val(e)):q.ie||a.val("")},valInput:function(a,e){if(void 0===
e)return a.hasClass("ks-editor-input-tip")?"":a.val();a.removeClass("ks-editor-input-tip");a.val(e)},placeholder:function(f,e){f.attr("placeholder",e);q.ie&&(f.on("blur",function(){a.trim(f.val())||(f.addClass("ks-editor-input-tip"),f.val(e))}),f.on("focus",function(){f.removeClass("ks-editor-input-tip");a.trim(f.val())==e&&f.val("")}))},htmlEncode:function(a){return!a?a:(""+a).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},normParams:function(f){var f=a.clone(f),
e;for(e in f){var i=f[e];a.isFunction(i)&&(f[e]=i())}return f},map:function(a,e){for(var i=0;i<a.length;i++)a[i]=e(a[i]);return a},ieEngine:document.documentMode||q.ie,preventFocus:function(a){q.ie?a.unselectable():a.attr("onmousedown","return false;")},injectDom:function(f){a.mix(t,f);for(var e in f)(function(e){i.prototype[e]=function(){var o=[].slice.call(arguments,0);o.unshift(this[0]);return(o=f[e].apply(null,o))&&(o.nodeType||a.isWindow(o))?new i(o):a.isArray(o)&&(o.__IS_NODELIST||o[0]&&o[0].nodeType)?
new i(o):o}})(e)},addRes:function(){var f=this.__res=this.__res||[];f.push.apply(f,a.makeArray(arguments))},destroyRes:function(){for(var f=this.__res||[],e=0;e<f.length;e++){var i=f[e];a.isFunction(i)?i():i.destroy?i.destroy():i.remove&&i.remove()}this.__res=[]},getQueryCmd:function(a){return"query"+("-"+a).replace(/-(\w)/g,function(a,f){return f.toUpperCase()})+"Value"}};return a.Editor.Utils=s},{requires:["./base"]});
KISSY.add("editor/core/walker",function(a,i){function t(a,c){if(this._.end)return l;var d,h=this.range,g,i=this.guard,j=this.type,o=a?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this._.start&&(this._.start=1,h.trim(),h.collapsed))return this.end(),l;if(!a&&!this._.guardLTR){var q=h.endContainer[0],s=q.childNodes[h.endOffset];this._.guardLTR=function(a,b){return b&&(q==a||"body"==m.nodeName(a))?!1:a!=s}}if(a&&!this._.guardRTL){var t=h.startContainer[0],r=0<h.startOffset&&t.childNodes[h.startOffset-
1]||null;this._.guardRTL=function(a,b){return b&&(t==a||"body"==m.nodeName(a))?!1:a!=r}}var v=a?this._.guardRTL:this._.guardLTR;g=i?function(a,b){return v(a,b)===e?e:i(a,b)}:v;this.current?d=this.current[o](e,j,g):a?(d=h.endContainer,0<h.endOffset?(d=new n(d[0].childNodes[h.endOffset-1]),g(d[0])===e&&(d=l)):d=g(d,f)===e?l:d._4e_previousSourceNode(f,j,g,void 0)):(d=h.startContainer,d=new n(d[0].childNodes[h.startOffset]),d.length?g(d[0])===e&&(d=l):d=g(h.startContainer,f)===e?l:h.startContainer._4e_nextSourceNode(f,
j,g,void 0));for(;d&&!this._.end;){this.current=d;if(!this.evaluator||this.evaluator(d[0])!==e){if(!c)return d}else if(c&&this.evaluator)return e;d=d[o](e,j,g)}this.end();return this.current=l}function q(a){for(var c,d=l;c=t.call(this,a);)d=c;return d}function s(a){this.range=a;this.guard=this.evaluator=l;this._={}}var f=!0,e=!1,l=null,o=a.UA,m=a.DOM,w=i.XHTML_DTD,n=a.Node;a.augment(s,{end:function(){this._.end=1},next:function(){return t.call(this)},previous:function(){return t.call(this,f)},checkForward:function(){return t.call(this,
e,f)!==e},checkBackward:function(){return t.call(this,f,f)!==e},lastForward:function(){return q.call(this)},lastBackward:function(){return q.call(this,f)},reset:function(){delete this.current;this._={}},_iterator:t});a.mix(s,{blockBoundary:function(a){return function(c){return!(c.nodeType==m.NodeType.ELEMENT_NODE&&m._4e_isBlockBoundary(c,a))}},bookmark:function(a,c){function d(a){return"span"==m.nodeName(a)&&m.attr(a,"_ke_bookmark")}return function(e){var f,i;f=e.nodeType==m.NodeType.TEXT_NODE&&(i=
e.parentNode)&&d(i);f=a?f:f||d(e);return!!(c^f)}},whitespaces:function(b){return function(c){c=c.nodeType==m.NodeType.TEXT_NODE&&!a.trim(c.nodeValue);return!!(b^c)}},invisible:function(a){var c=s.whitespaces();return function(d){d=c(d)||d.nodeType==m.NodeType.ELEMENT_NODE&&!d.offsetHeight;return!!(a^d)}}});var v=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,y=s.whitespaces(),j=s.bookmark(),c=function(a){var c=m.nodeName(a);return j(a)||y(a)||1==a.nodeType&&c in w.$inline&&!(c in w.$empty)};i.Utils.injectDom({_4e_getBogus:function(a){a=
new n(a);do a=a._4e_previousSourceNode();while(a&&c(a[0]));return a&&(!o.ie?"br"==a.nodeName():3==a[0].nodeType&&v.test(a.text()))?a[0]:!1}});return i.Walker=s},{requires:["./base","./utils","./dom"]});KISSY.add("editor/core/zIndexManager",function(a){var i=a.Editor,a=i.zIndexManager={BUBBLE_VIEW:1100,POPUP_MENU:1200,STORE_FLASH_SHOW:99999,MAXIMIZE:900,OVERLAY:9999,LOADING:11E3,LOADING_CANCEL:12E3,SELECT:1200};i.baseZIndex=function(a){return(i.Config.baseZIndex||1E4)+a};return a},{requires:["./base"]});
