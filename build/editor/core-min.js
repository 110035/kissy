/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: May 27 18:22
*/
/*
 thanks to CKSource's intelligent work on CKEditor
 @author yiminghe@gmail.com
*/
KISSY.add("editor/core/base",function(a,m,t){m=t.Controller.extend({initializer:function(){this.__commands={};this.__controls={}}},{Config:{},XHTML_DTD:m.DTD,ATTRS:{textarea:{},iframe:{},window:{},document:{},toolBarEl:{},statusBarEl:{},handleMouseEvents:{value:!1},focusable:{value:!1},mode:{value:1},data:{getter:function(a){var m=this._getData();return void 0===m?a:m}},formatData:{getter:function(){return this._getData(1)}},customStyle:{value:""},customLink:{value:[]}}},{xclass:"editor"});m.HTML_PARSER=
{textarea:function(a){return a.one("."+this.get("prefixCls")+"editor-textarea")},data:function(a){return a.one("."+this.get("prefixCls")+"editor-textarea").val()}};a.mix(m,a.EventTarget);return KISSY.Editor=m},{requires:["htmlparser","component/base","core"]});
KISSY.add("editor/core/clipboard",function(a,m,t,r){function s(a){this.editor=a;this._init()}function g(a){var b=a.get("document")[0],d=a.getSelection(),j;if(d.getType()==r.SELECTION_ELEMENT&&(j=d.getSelectedElement())){var a=d.getRanges()[0],c=e(b.createTextNode(""));c.insertBefore(j);a.setStartBefore(c);a.setEndAfter(j);d.selectRanges([a]);setTimeout(function(){j.parent()&&(c.remove(),d.selectElement(j))},0)}}var e=a.all,l=a.UA,n=l.ie?"beforepaste":"paste",o=m.RANGE;a.augment(s,{_init:function(){var a=
this,b=a.editor,d=b.get("document"),j=d.one("body"),c=function(c){this.type=c};c.prototype={exec:function(c){var d=this.type;c.focus();setTimeout(function(){l.ie&&("cut"==d?g(c):"paste"==d&&(a._preventPasteEvent(),a._getClipboardDataFromPasteBin()));p(c,d)||alert(v[d])},0)}};j.on(n,a._getClipboardDataFromPasteBin,a);l.ie&&(j.on("paste",a._iePaste,a),d.on("keydown",a._onKeyDown,a),d.on("contextmenu",function(){a._isPreventBeforePaste=1;setTimeout(function(){a._isPreventBeforePaste=0},0)}));b.addCommand("copy",
new c("copy"));b.addCommand("cut",new c("cut"));b.addCommand("paste",new c("paste"))},_onKeyDown:function(a){this.editor.get("mode")==m.Mode.WYSIWYG_MODE&&(a.ctrlKey&&86==a.keyCode||a.shiftKey&&45==a.keyCode)&&this._preventPasteEvent()},_stateFromNamedCommand:function(a){var b,d=this.editor;if("paste"==a){this._isPreventBeforePaste=1;try{b=d.get("document")[0].queryCommandEnabled(a)}catch(j){}this._isPreventBeforePaste=0}else b=(a=(a=d.getSelection())&&a.getRanges())&&!(1==a.length&&a[0].collapsed);
return b},_preventPasteEvent:function(){var a=this;a._preventPasteTimer&&clearTimeout(a._preventPasteTimer);a._isPreventPaste=1;a._preventPasteTimer=setTimeout(function(){a._isPreventPaste=0},70)},_iePaste:function(a){var b=this.editor;this._isPreventPaste||(a.preventDefault(),b.execCommand("paste"))},_getClipboardDataFromPasteBin:function(){if(!this._isPreventBeforePaste){var h=this.editor,b=h.get("document")[0];if(!b.getElementById("ke_pastebin")){var d=h.getSelection(),j=new t(b),c=e(l.webkit?
"<body></body>":b.createElement("div"),null,b);c.attr("id","ke_pastebin");l.webkit&&c[0].appendChild(b.createTextNode("\u200b"));b.body.appendChild(c[0]);c.css({position:"absolute",top:d.getStartElement().offset().top+"px",width:"1px",height:"1px",overflow:"hidden"});c.css("left","-1000px");var i=d.createBookmarks();j.setStartAt(c,o.POSITION_AFTER_START);j.setEndAt(c,o.POSITION_BEFORE_END);j.select(!0);setTimeout(function(){var b,k=c;c=l.webkit&&(b=c.first())&&b.hasClass("Apple-style-span")?b:c;d.selectBookmarks(i);
var q=c.html();k.remove();if(q=a.trim(q.replace(/<span[^>]+_ke_bookmark[^<]*?<\/span>(&nbsp;)*/ig,"")))b=h.fire("paste",{html:q}),!1!==b&&(void 0!==b&&(q=b),/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument)/.test(q)?a.use("editor/plugin/word-filter",function(c,b){h.insertHTML(b.toDataFormat(q,h))}):h.insertHTML(q))},0)}}}});var w=function(a,b){var d=a.get("document")[0],j=e(d.body),c=!1,i=function(){c=!0};j.on(b,i);(7<l.ie?d:d.selection.createRange()).execCommand(b);j.detach(b,i);return c},p=l.ie?
function(a,b){return w(a,b)}:function(a,b){try{return a.get("document")[0].execCommand(b)}catch(d){return!1}},v={cut:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u526a\u5207\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+X)\u6765\u5b8c\u6210",copy:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u590d\u5236\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+C)\u6765\u5b8c\u6210",paste:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u7c98\u8d34\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+V)\u6765\u5b8c\u6210"},y={copy:"\u590d\u5236",paste:"\u7c98\u8d34",cut:"\u526a\u5207"};return{init:function(a){var b;a.docReady(function(){b=new s(a)});var d={copy:1,cut:1,paste:1},j=["copy","cut","paste"];a.on("contextmenu",function(c){var i=c.contextmenu;if(!i.__copy_fix){i.__copy_fix=
1;for(c=0;c<j.length;c++)i.addChild({content:y[j[c]],value:j[c]});i.on("click",function(c){var b=c.target.get("value");d[b]&&(i.hide(),setTimeout(function(){a.execCommand("save");a.execCommand(b);setTimeout(function(){a.execCommand("save")},10)},30))})}for(var f=i.get("children"),c=f.length-1;c--;0<=c){var k=f[c],q;q=k.get?k.get("value"):k.value;d[q]&&(q=!b._stateFromNamedCommand(q),k.set?k.set("disabled",q):k.disabled=q)}})}}},{requires:["./base","./range","./selection"]});
KISSY.add("editor/core",function(a,m,t,r,s,g,e,l,n,o){function w(a,d){var f=a.body;E(function(){a.designMode="on";setTimeout(function(){a.designMode="off";f.focus();arguments.callee.retry||(arguments.callee.retry=b)},50)},function(){a.designMode="off";q.attr(f,"contentEditable",c);q.attr(f,"contentEditable",b);!d&&w(a,1)})}function p(b){b.get("iframe");var d=b.get("textarea")[0],u=b.get("window")[0],i=b.get("document")[0];f.webkit&&(z.on(i,"click",function(b){var c=new C(b.target);a.inArray(c.nodeName(),
["input","select"])&&b.preventDefault()}),z.on(i,"mouseup",function(b){var c=new C(b.target);a.inArray(c.nodeName(),["input","textarea"])&&b.preventDefault()}));if(f.gecko||k||f.opera){var q;q=(new C('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>')).insertAfter(d);q.on("focus",function(){b.focus()});b.activateGecko=function(){f.gecko&&b.__iframeFocus&&q[0].focus()};b.on("destroy",function(){q.detach();q.remove()})}z.on(u,"focus",function(){f.gecko?w(i,c):f.opera&&
i.body.focus();b.notifySelectionChange()});if(f.gecko)z.on(i,"mousedown",function(){b.__iframeFocus||w(i,c)});if(k&&(z.on(i,"keydown",function(c){if(c.keyCode in{8:1,46:1}){var a=b.getSelection(),d=a.getSelectedElement();if(d){b.execCommand("save");var f=a.getRanges()[0].createBookmark();d.remove();a.selectBookmarks([f]);b.execCommand("save");c.preventDefault()}}}),"CSS1Compat"==i.compatMode)){var x={33:1,34:1};z.on(i,"keydown",function(c){c.keyCode in x&&setTimeout(function(){b.getSelection().scrollIntoView()},
0)})}if(f.webkit)z.on(i,"mousedown",function(c){c=new C(c.target);a.inArray(c.nodeName(),["img","hr","input","textarea","select"])&&b.getSelection().selectElement(c)});if(f.gecko)z.on(i,"dragstart",function(b){var c=new C(b.target);c.nodeName()==="img"&&/ke_/.test(c[0].className)&&b.preventDefault()});r.add(b)}function v(b,c,d,f){var k="",x;x=t.debugUrl("theme/editor-iframe.css");d=d.concat([]);d.unshift(x);for(x=0;x<d.length;x++)k+=a.substitute('<link href="{href}" rel="stylesheet" />',{href:d[x]});
return a.substitute(u,{doctype:8===i.documentMode?'<meta http-equiv="X-UA-Compatible" content="IE=7" />':"",title:"${title}",links:k,style:c,data:f||"",script:b?'<script id="ke_active_script">'+(q.isCustomDomain()?'document.domain="'+i.domain+'";':"")+'parent.KISSY.Editor._initIFrame("'+b+'");<\/script>':""})}function y(b,c){function d(){x=i.document;b.setInternal("document",new C(x));b.setInternal("window",new C(i));a.detach();x.open("text/html","replace");x.write(f);x.close()}var a=b.get("iframe"),
f=v(b._UUID,b.get("customStyle"),b.get("customLink"),c),u=a[0],i=u.contentWindow,x;a.__loaded=1;try{x=i.document}catch(q){if(u.src=u.src,7>k){setTimeout(d,10);return}}d()}function h(b,c){var d=q.getEmptyIframeSrc()||"";d&&(d=' src="'+d+'" ');var d=new C(a.substitute(D,{iframeSrc:d})),u=b.get("textarea");u.hasAttr("tabindex")&&d.attr("tabindex",f.webkit?-1:u.attr("tabindex"));u.parent().prepend(d);b.set("iframe",d);b.__docReady=0;if(f.gecko&&!d.__loaded)d.on("load",function(){y(b,c)},b);else y(b,c)}
var b=!0,d=d,j=a.all,c=!1,i=document,f=a.UA,k=f.ie,q=a.DOM,A=q.NodeType,C=a.Node,z=a.Event,E=t.tryThese,u='<!doctype html><html><head>{doctype}<title>{title}</title><style>{style}</style>{links}</head><body class="ks-editor" >{data}{script}</body></html>',D='<iframe style="width:100%;height:100%;border:none;"  frameborder="0"  title="kissy-editor"  allowTransparency="true"  {iframeSrc} ></iframe>',x=/^(?:<(p)>)?(?:(?:&nbsp;)|\s|<br[^>]*>)*(?:<\/\1>)?$/i,O='<div class="{prefixCls}editor-tools"></div><div class="{prefixCls}editor-textarea-wrap" '+
(f.mobile?'style="overflow:scroll;-webkit-overflow-scrolling:touch;"':"")+'></div><div class="{prefixCls}editor-status"></div>';m.Mode={SOURCE_MODE:0,WYSIWYG_MODE:1};a.augment(m,{createDom:function(){var b,c=this.prefixCls,d=this.get("textarea"),f;d?(this.set("textarea",d=j(d)),d[0].parentNode&&d.remove()):(b=this.get("data"),this.set("textarea",d=j('<textarea class="'+c+'-editor-textarea"></textarea>')),d.val(b));f=this.get("el");f.html(a.substitute(O,{prefixCls:c}));b=f.one(a.substitute(".{prefixCls}editor-textarea-wrap",
{prefixCls:c}));this._UUID=a.guid();this.set({toolBarEl:f.one(a.substitute(".{prefixCls}editor-tools",{prefixCls:c})),statusBarEl:f.one(a.substitute(".{prefixCls}editor-status",{prefixCls:c}))},{silent:1});d.css("width","100%");d.css("display","none");b.append(d);r.register(this)},renderUI:function(){e.init(this);l.init(this);n.init(this);o.init(this)},bindUI:function(){function b(){c.detach("docReady",b);if(c.get("focused"))c.focus();else{var d=c.getSelection();d&&d.removeAllRanges()}}var c=this,
d,a=c.prefixCls,f=c.get("textarea");if(c.get("attachForm")&&(d=f[0].form))z.on(d,"submit",c.sync,c);c.on("docReady",b);c.on("blur",function(){c.get("el").removeClass(a+"editor-focused")});c.on("focus",function(){c.get("el").addClass(a+"editor-focused")})},syncUI:function(){this.get("rendered")&&this.get("textarea").val(this.get("data"))},_onSetHeight:function(c){var b=this.get("textarea"),d=this.get("toolBarEl"),a=this.get("statusBarEl"),c=parseInt(c,10),c=c-((d&&d.outerHeight()||0)+(a&&a.outerHeight()||
0));b.parent().css("height",c);b.css("height",c)},_onSetMode:function(c){this.get("rendered");var b=this.get("iframe"),d=this.get("textarea");1==c?(this._setData(d.val()),d.hide(),this.fire("wysiwygMode")):(b&&(d.val(this._getData(1,1)),b.hide()),d.show(),this.fire("sourceMode"))},_onSetFocused:function(c){c&&this.__docReady&&this.focus()},_onSetData:function(c){this.get("rendered")&&this._setData(c)},destructor:function(){var c,b=this.get("textarea"),d=this.get("document")[0],f=this.get("window");
this.get("attachForm")&&(c=b[0].form)&&z.detach(c,"submit",this.sync,this);r.remove(this);z.remove([d,d.documentElement,d.body,f[0]]);a.each(this.__controls,function(c){c.destroy&&c.destroy()});this.__commands={};this.__controls={}},getControl:function(c){return this.__controls[c]},getControls:function(){return this.__controls},addControl:function(c,b){this.__controls[c]=b},showDialog:function(c,b){var c=c+"/dialog",d=this.__controls[c];d.show(b);this.fire("dialogShow",{dialog:d.dialog,pluginDialog:d,
dialogName:c})},addCommand:function(c,b){this.__commands[c]=b},hasCommand:function(c){return this.__commands[c]},execCommand:function(c){var b=this.__commands[c],f=a.makeArray(arguments);f.shift();f.unshift(this);return b?b.exec.apply(b,f):d},queryCommandValue:function(c){return this.execCommand(t.getQueryCmd(c))},_getData:function(c,b){var f=this.htmlDataProcessor,u;if(!this.get("rendered"))return d;b==d&&(b=this.get("mode"));u=1==b&&this.isDocReady()?this.get("document")[0].body.innerHTML:f.toDataFormat(this.get("textarea").val());
u=c?f.toHTML(u):f.toServer(u);u=a.trim(u);x.test(u)&&(u="");return u},_setData:function(c){var b,d=c;if(1!=this.get("mode"))this.get("textarea").val(c);else{if(b=this.htmlDataProcessor)d=b.toDataFormat(c);if(this.get("iframe")){c=this.get("iframe");b=this.get("window")[0];var a=this.get("document")[0];z.remove([a,a.documentElement,a.body,b]);c.remove()}h(this,d)}},getDocHTML:function(){return v(0,this.get("customStyle"),this.get("customLink"),this.get("formatData"))},getDocHtml:function(){return this.getDocHTML()},
getSelection:function(){return m.Selection.getSelection(this.get("document")[0])},getSelectedHTML:function(){var c=this.getSelection().getRanges()[0],b;c&&(c=c.cloneContents(),b=this.get("document")[0].createElement("div"),b.appendChild(c),b=b.innerHTML);return b},focus:function(){var c=this.get("window");if(c){var b=this.get("document")[0],c=c[0];f.ie||c&&c.parent&&c.parent.focus();c&&c.focus();try{b.body.focus()}catch(d){}this.notifySelectionChange()}},blur:function(){this.get("window")[0].blur();
this.get("document")[0].body.blur()},addCustomStyle:function(c,b){var d=this.get("window"),a=this.get("customStyle")||"";this.set("customStyle",a+("\n"+c));d&&q.addStyleSheet(d,c,b)},removeCustomStyle:function(c){q.remove(q.get("#"+c,this.get("window")[0]))},addCustomLink:function(c){var b=this.get("customLink"),d=this.get("document")[0];b.push(c);this.set("customLink",b);b=d.createElement("link");b.rel="stylesheet";d.getElementsByTagName("head")[0].appendChild(b);b.href=c},removeCustomLink:function(c){for(var b=
this.get("document")[0],b=q.query("link",b),d=0;d<b.length;d++)q.attr(b[d],"href")==c&&q.remove(b[d]);b=this.get("customLink");c=a.indexOf(c,b);-1!=c&&b.splice(c,1)},docReady:function(c){this.on("docReady",c);this.__docReady&&c.call(this)},isDocReady:function(){return this.__docReady},checkSelectionChange:function(){var c=this;c.__checkSelectionChangeId&&clearTimeout(c.__checkSelectionChangeId);c.__checkSelectionChangeId=setTimeout(function(){var b=c.getSelection();if(b&&!b.isInvalid){var d=b.getStartElement(),
a=new m.ElementPath(d);if(!c.__previousPath||!c.__previousPath.compare(a))c.__previousPath=a,c.fire("selectionChange",{selection:b,path:a,element:d})}},100)},notifySelectionChange:function(){this.__previousPath=null;this.checkSelectionChange()},insertElement:function(c){if(1!==this.get("mode"))return d;this.focus();var a,f=c.nodeName(),u=m.XHTML_DTD,i=u.$block[f],k=m.RANGE,x=(f=this.getSelection())&&f.getRanges(),q,j,D;if(!x||0==x.length)return d;this.execCommand("save");for(j=x.length-1;0<=j;j--)q=
x[j],a=!j&&c||c.clone(b),q.insertNodeByDtd(a),D||(D=a);if(!D)return d;q.moveToPosition(D,k.POSITION_AFTER_END);i&&(c=m.Walker.whitespaces(!0),(c=(D=D.next(c,1))&&D[0].nodeType==A.ELEMENT_NODE&&D.nodeName())&&u.$block[c]&&u[c]["#text"]&&q.moveToElementEditablePosition(D));f.selectRanges([q]);this.focus();a&&1==a[0].nodeType&&a.scrollIntoView(d,{alignWithTop:!1,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0});G.call(this);return a},insertHTML:function(b,a){var f=this,u,i=f.get("document")[0];if(1===
f.get("mode")){if(u=f.htmlDataProcessor)b=u.toDataFormat(b,a);f.focus();f.execCommand("save");if(k){u=i.selection;"Control"==u.type&&u.clear();try{u.createRange().pasteHTML(b)}catch(x){}}else try{i.execCommand("inserthtml",c,b)}catch(D){setTimeout(function(){if(0==f.getSelection().getRanges().length){var a=new m.Range(i),u=q.first(i.body,function(c){return 1==c.nodeType&&"br"!=q.nodeName(c)});u||(u=new C(i.createElement("p")),u._4e_appendBogus(d),i.body.appendChild(u[0]));a.setStartAt(u,m.RANGE.POSITION_AFTER_START);
a.select()}i.execCommand("inserthtml",c,b)},50)}setTimeout(function(){f.getSelection().scrollIntoView()},50);G.call(f)}},insertHtml:function(c,b){this.insertHTML(c,b)}});m._initIFrame=function(d){var a=r.getInstance(d),u=a.get("document")[0],d=u.getElementById("ke_active_script");q.remove(d);p(a);var i=u.body;k?(i.hideFocus=b,i.disabled=b,i.contentEditable=b,i.removeAttribute("disabled")):setTimeout(function(){f.gecko||f.opera?i.contentEditable=b:f.webkit?i.parentNode.contentEditable=b:u.designMode=
"on"},0);if(f.gecko||f.opera){var x=u.documentElement;z.on(x,"mousedown",function(b){if(b.target==x){f.gecko&&w(u,c);a.activateGecko()}})}setTimeout(function(){k&&setTimeout(function(){if(u){i.runtimeStyle.marginBottom="0px";i.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){a.__docReady=1;a.fire("docReady");var b=a.get("disableObjectResizing"),d=a.get("disableInlineTableEditing");if(b||d)try{u.execCommand("enableObjectResizing",c,!b);u.execCommand("enableInlineTableEditing",c,!d)}catch(f){z.on(i,
k?"resizestart":"resize",function(c){var a=new C(c.target);(b||a.nodeName()==="table"&&d)&&c.preventDefault()})}},10)};var G=a.buffer(function(){this.execCommand("save")},50);return m},{requires:"editor/core/base,editor/core/utils,editor/core/focusManager,editor/core/styles,editor/core/zIndexManager,editor/core/clipboard,editor/core/enterKey,editor/core/htmlDataProcessor,editor/core/selectionFix".split(",")});
KISSY.add("editor/core/dom",function(a,m,t){function r(b,d){var a=b[d?"next":"prev"](s,1);if(a&&a[0].nodeType==l.ELEMENT_NODE){for(var c=[];a.attr("_ke_bookmark")||a._4e_isEmptyInlineRemovable(s);)if(c.push(a),a=d?a.next(s,1):a.prev(s,1),!a)return;if(b._4e_isIdentical(a,s)){for(var i=new o(d?b[0].lastChild:b[0].firstChild);c.length;)c.shift()._4e_move(b,!d,s);a._4e_moveChildren(b,!d,s);a.remove();i[0]&&i[0].nodeType==l.ELEMENT_NODE&&i._4e_mergeSiblings()}}}var s=s,g=m.XHTML_DTD,e=a.DOM,l=e.NodeType,
n=a.UA,o=a.Node,w={a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};m.POSITION={POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16};var p=m.POSITION,v={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,
"table-column":1,"table-cell":1,"table-caption":1},y={hr:1},h=function(b){return b&&(b[0]||b)};t.injectDom({_4e_sameLevel:function(b,d){var d=h(d),a=b.parentNode;return a&&a==d.parentNode},_4e_isBlockBoundary:function(b,d){var j=a.merge(y,d);return!(!v[e.css(b,"display")]&&!j[e.nodeName(b)])},_4e_index:function(b,d){for(var a=b.parentNode.childNodes,c,i=-1,f=0;f<a.length;f++)if(c=a[f],!d||!(3==c.nodeType&&c.previousSibling&&3==c.previousSibling.nodeType))if(i++,c===b)return i;return-1},_4e_move:function(b,
d,a){d=h(d);a?d.insertBefore(b,d.firstChild):d.appendChild(b)},_4e_isIdentical:function(b,d){if(!d)return!1;d=h(d);if(e.nodeName(b)!=e.nodeName(d))return!1;var a=b.attributes,c=d.attributes,i=a.length,f=c.length;if(i!=f)return!1;for(var k=0;k<i;k++){var q=a[k],g=q.name;if(q.specified&&e.attr(b,g)!=e.attr(d,g))return!1}if(8>t.ieEngine)for(k=0;k<f;k++)if(q=c[k],g=q.name,q.specified&&e.attr(b,g)!=e.attr(d,g))return!1;return!0},_4e_isEmptyInlineRemovable:function(b){if(!g.$removeEmpty[e.nodeName(b)])return!1;
for(var b=b.childNodes,d=0,j=b.length;d<j;d++){var c=b[d],i=c.nodeType;if(!(i==l.ELEMENT_NODE&&c.getAttribute("_ke_bookmark"))&&(i==l.ELEMENT_NODE&&!e._4e_isEmptyInlineRemovable(c)||i==e.NodeType.TEXT_NODE&&a.trim(c.nodeValue)))return!1}return!0},_4e_moveChildren:function(b,d,a){d=h(d);if(b!=d)if(a)for(;a=b.lastChild;)d.insertBefore(b.removeChild(a),d.firstChild);else for(;a=b.firstChild;)d.appendChild(b.removeChild(a))},_4e_mergeSiblings:function(b){b=new o(b);w[b.nodeName()]&&(r(b,!0),r(b))},_4e_splitText:function(b,
d){var a=b.ownerDocument;if(b.nodeType==e.NodeType.TEXT_NODE){if(n.ie&&d==b.nodeValue.length){var c=a.createTextNode("");e.insertAfter(c,b);return c}c=b.splitText(d);a.documentMode&&(a=a.createTextNode(""),e.insertAfter(a,c),e.remove(a));return c}},_4e_parents:function(b,a){var e=[];e.__IS_NODELIST=1;do e[a?"push":"unshift"](b);while(b=b.parentNode);return e},_4e_nextSourceNode:function(b,a,j,c){if(c&&!c.call)var i=h(c),c=function(c){return c!==i};var a=!a&&b.firstChild,f=b;if(!a){if(b.nodeType==
l.ELEMENT_NODE&&c&&!1===c(b,!0))return null;a=b.nextSibling}for(;!a&&(f=f.parentNode);){if(c&&!1===c(f,!0))return null;a=f.nextSibling}return!a||c&&!1===c(a)?null:j&&j!=a.nodeType?e._4e_nextSourceNode(a,!1,j,c):a},_4e_previousSourceNode:function(b,a,j,c){if(c&&!c.call)var i=h(c),c=function(c){return c!==i};var a=!a&&b.lastChild,f=b;if(!a){if(b.nodeType==l.ELEMENT_NODE&&c&&!1===c(b,!0))return null;a=b.previousSibling}for(;!a&&(f=f.parentNode);){if(c&&!1===c(f,!0))return null;a=f.previousSibling}return!a||
c&&!1===c(a)?null:j&&a.nodeType!=j?e._4e_previousSourceNode(a,!1,j,c):a},_4e_commonAncestor:function(b,a){a=h(a);if(b===a)return b;if(e.contains(a,b))return a;var j=b;do if(e.contains(j,a))return j;while(j=j.parentNode);return null},_4e_hasAttributes:9>t.ieEngine?function(b){for(var a=b.attributes,e=0;e<a.length;e++){var c=a[e];switch(c.name){case "class":if(b.getAttribute("class"))return!0;break;default:if(c.specified)return!0}}return!1}:function(b){n.gecko&&b.removeAttribute("_moz_dirty");return b.hasAttributes()},
_4e_position:function(b,a){var j=h(a);if(b.compareDocumentPosition)return b.compareDocumentPosition(j);if(b==j)return p.POSITION_IDENTICAL;if(b.nodeType==l.ELEMENT_NODE&&j.nodeType==l.ELEMENT_NODE){if(e.contains(b,j))return p.POSITION_CONTAINS+p.POSITION_PRECEDING;if(e.contains(j,b))return p.POSITION_IS_CONTAINED+p.POSITION_FOLLOWING;if("sourceIndex"in b)return 0>b.sourceIndex||0>j.sourceIndex?p.POSITION_DISCONNECTED:b.sourceIndex<j.sourceIndex?p.POSITION_PRECEDING:p.POSITION_FOLLOWING}for(var c=
e._4e_address(b),j=e._4e_address(j),i=Math.min(c.length,j.length),f=0;f<=i-1;f++)if(c[f]!=j[f])return c[f]<j[f]?p.POSITION_PRECEDING:p.POSITION_FOLLOWING;return c.length<j.length?p.POSITION_CONTAINS+p.POSITION_PRECEDING:p.POSITION_IS_CONTAINED+p.POSITION_FOLLOWING},_4e_address:function(a,d){for(var h=[],c=a.ownerDocument.documentElement,i=a;i&&i!=c;)h.unshift(e._4e_index(i,d)),i=i.parentNode;return h},_4e_remove:function(a,d){var e=a.parentNode;if(e){if(d)for(var c;c=a.firstChild;)e.insertBefore(a.removeChild(c),
a);e.removeChild(a)}return a},_4e_trim:function(a){e._4e_ltrim(a);e._4e_rtrim(a)},_4e_ltrim:function(a){for(var d;d=a.firstChild;){if(d.nodeType==e.NodeType.TEXT_NODE){var h=t.ltrim(d.nodeValue),c=d.nodeValue.length;if(h)h.length<c&&(e._4e_splitText(d,c-h.length),a.removeChild(a.firstChild));else{a.removeChild(d);continue}}break}},_4e_rtrim:function(a){for(var d;d=a.lastChild;){if(d.type==e.NodeType.TEXT_NODE){var h=t.rtrim(d.nodeValue),c=d.nodeValue.length;if(h)h.length<c&&(e._4e_splitText(d,h.length),
a.removeChild(a.lastChild));else{a.removeChild(d);continue}}break}!n.ie&&!n.opera&&(d=a.lastChild)&&1==d.nodeType&&"br"==e.nodeName(d)&&a.removeChild(d)},_4e_appendBogus:function(b){for(var d=b.lastChild;d&&d.nodeType==e.NodeType.TEXT_NODE&&!a.trim(d.nodeValue);)d=d.previousSibling;if(!d||d.nodeType==e.NodeType.TEXT_NODE||"br"!==e.nodeName(d))d=n.opera?b.ownerDocument.createTextNode(""):b.ownerDocument.createElement("br"),b.appendChild(d)},_4e_setMarker:function(b,d,e,c){var b=new o(b),i=b.data("list_marker_id")||
b.data("list_marker_id",a.guid()).data("list_marker_id"),f=b.data("list_marker_names")||b.data("list_marker_names",{}).data("list_marker_names");d[i]=b;f[e]=1;return b.data(e,c)},_4e_clearMarkers:function(a,d,e){var a=new o(a),c=a.data("list_marker_names"),i=a.data("list_marker_id"),f;for(f in c)a.removeData(f);a.removeData("list_marker_names");e&&(a.removeData("list_marker_id"),delete d[i])},_4e_copyAttributes:function(a,d,h){for(var d=new o(d),c=a.attributes,h=h||{},i=0;i<c.length;i++){var f=c[i],
k=f.name.toLowerCase(),q;if(!(k in h))if("checked"==k&&(q=e.attr(a,k)))d.attr(k,q);else if(f.specified||n.ie&&f.value&&"value"==k)q=e.attr(a,k),null===q&&(q=f.nodeValue),d.attr(k,q)}""!==a.style.cssText&&(d[0].style.cssText=a.style.cssText)},_4e_isEditable:function(a){a=e.nodeName(a);return(a=!g.$nonEditable[a]&&(g[a]||g.span))&&a["#text"]},_4e_getByAddress:function(a,d,e){for(var a=a.documentElement,c=0;a&&c<d.length;c++){var i=d[c];if(e)for(var f=-1,k=0;k<a.childNodes.length;k++){var q=a.childNodes[k];
if(!(!0===e&&3==q.nodeType&&q.previousSibling&&3==q.previousSibling.nodeType)&&(f++,f==i)){a=q;break}}else a=a.childNodes[i]}return a}})},{requires:["./base","./utils"]});
KISSY.add("editor/core/domIterator",function(a){function m(a){1>arguments.length||(this.range=a,this.forceBrBreak=r,this.enlargeBr=t,this.enforceRealBlocks=r,this._||(this._={}))}var t=!0,r=!1,s=a.Editor,g=a.UA,e=s.Walker,l=s.Range,n=s.RANGE,o=s.ElementPath,w=a.Node,p=a.DOM,v=/^[\r\n\t ]*$/;a.augment(m,{getNextParagraph:function(m){var h,b,d,j,c;if(!this._.lastNode){b=this.range.clone();b.shrink(n.SHRINK_ELEMENT,t);b.enlarge(this.forceBrBreak||!this.enlargeBr?n.ENLARGE_LIST_ITEM_CONTENTS:n.ENLARGE_BLOCK_CONTENTS);
var i=new e(b),f=e.bookmark(t,t);i.evaluator=f;this._.nextNode=i.next();i=new e(b);i.evaluator=f;i=i.previous();this._.lastNode=i._4e_nextSourceNode(t);this._.lastNode&&this._.lastNode[0].nodeType==p.NodeType.TEXT_NODE&&!a.trim(this._.lastNode[0].nodeValue)&&this._.lastNode.parent()._4e_isBlockBoundary()&&(f=new l(b.document),f.moveToPosition(this._.lastNode,n.POSITION_AFTER_END),f.checkEndOfBlock()&&(f=new o(f.endContainer),this._.lastNode=(f.block||f.blockLimit)._4e_nextSourceNode(t)));this._.lastNode||
(this._.lastNode=this._.docEndMarker=new w(b.document.createTextNode("")),p.insertAfter(this._.lastNode[0],i[0]));b=null}f=this._.nextNode;i=this._.lastNode;for(this._.nextNode=null;f;){var k=r,q=f[0].nodeType!=p.NodeType.ELEMENT_NODE,A=r;if(q)f[0].nodeType==p.NodeType.TEXT_NODE&&v.test(f[0].nodeValue)&&(q=r);else{var C=f.nodeName();if(f._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){if("br"==C)q=t;else if(!b&&!f[0].childNodes.length&&"hr"!=C){h=f;d=f.equals(i);break}b&&(b.setEndAt(f,n.POSITION_BEFORE_START),
"br"!=C&&(this._.nextNode=f));k=t}else{if(f[0].firstChild){b||(b=new l(this.range.document),b.setStartAt(f,n.POSITION_BEFORE_START));f=new w(f[0].firstChild);continue}q=t}}q&&!b&&(b=new l(this.range.document),b.setStartAt(f,n.POSITION_BEFORE_START));d=(!k||q)&&f.equals(i);if(b&&!k)for(;!f[0].nextSibling&&!d;){C=f.parent();if(C._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){k=t;d||C.equals(i);break}f=C;q=t;d=f.equals(i);A=t}q&&b.setEndAt(f,n.POSITION_AFTER_END);f=f._4e_nextSourceNode(A,null,i);if((d=
!f)||k&&b)break}if(!h){if(!b)return this._.docEndMarker&&this._.docEndMarker._4e_remove(),this._.nextNode=null;h=new o(b.startContainer);f=h.blockLimit;k={div:1,th:1,td:1};h=h.block;if((!h||!h[0])&&!this.enforceRealBlocks&&k[f.nodeName()]&&b.checkStartOfBlock()&&b.checkEndOfBlock())h=f;else if(!h||this.enforceRealBlocks&&"li"==h.nodeName())h=new w(this.range.document.createElement(m||"p")),h[0].appendChild(b.extractContents()),h._4e_trim(),b.insertNode(h),j=c=t;else if("li"!=h.nodeName()){if(!b.checkStartOfBlock()||
!b.checkEndOfBlock())h=h.clone(r),h[0].appendChild(b.extractContents()),h._4e_trim(),c=b.splitBlock(),j=!c.wasStartOfBlock,c=!c.wasEndOfBlock,b.insertNode(h)}else d||(this._.nextNode=h.equals(i)?null:b.getBoundaryNodes().endNode._4e_nextSourceNode(t,null,i))}j&&(b=new w(h[0].previousSibling),b[0]&&b[0].nodeType==p.NodeType.ELEMENT_NODE&&("br"==b.nodeName()?b._4e_remove():b[0].lastChild&&"br"==p.nodeName(b[0].lastChild)&&p._4e_remove(b[0].lastChild)));c&&(b=e.bookmark(r,t),j=new w(h[0].lastChild),
j[0]&&j[0].nodeType==p.NodeType.ELEMENT_NODE&&"br"==j.nodeName()&&(g.ie||j.prev(b,1)||j.next(b,1))&&j.remove());this._.nextNode||(this._.nextNode=d||h.equals(i)?null:h._4e_nextSourceNode(t,null,i));return h}});l.prototype.createIterator=function(){return new m(this)};return m},{requires:["./base","./range","./elementPath","./walker"]});
KISSY.add("editor/core/elementPath",function(a){function m(a){for(var o=g,m=g,p=[];a;){if(a[0].nodeType==r.NodeType.ELEMENT_NODE){this.lastElement||(this.lastElement=a);var v=a.nodeName();if(!m&&(!o&&e[v]&&(o=a),l[v])){var t;if(t=!o)if(t="div"==v){a:{t=a[0].childNodes;for(var h=0,b=t.length;h<b;h++){var d=t[h];if(d.nodeType==r.NodeType.ELEMENT_NODE&&s.$block[d.nodeName.toLowerCase()]){t=!0;break a}}t=!1}t=!t}t?o=a:m=a}p.push(a);if("body"==v)break}a=a.parent()}this.block=o;this.blockLimit=m;this.elements=
p}var t=a.Editor,r=a.DOM,s=t.XHTML_DTD,g=null,e={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},l={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};m.prototype={constructor:m,compare:function(a){var e=this.elements,a=a&&a.elements;if(!a||e.length!=a.length)return!1;for(var g=0;g<e.length;g++)if(!r.equals(e[g],a[g]))return!1;return!0},contains:function(a){for(var e=this.elements,l=0;l<e.length;l++)if(e[l].nodeName()in a)return e[l];return g},toString:function(){var a=
this.elements,e,g=[];for(e=0;e<a.length;e++)g.push(a[e].nodeName());return g.toString()}};return t.ElementPath=m},{requires:["./base","./dom"]});
KISSY.add("editor/core/enterKey",function(a,m,t,r){function s(g){var m;m=g.getSelection().getRanges();for(var s=m.length-1;0<s;s--)m[s].deleteContents();m=m[0];s=m.document;if(m.checkStartOfBlock()&&m.checkEndOfBlock()){var h=(new r(m.startContainer)).block;if(h&&("li"==h.nodeName()||"li"==h.parent().nodeName()))return g.hasCommand("outdent")?(g.execCommand("save"),g.execCommand("outdent"),g.execCommand("save"),!0):!1}var b=m.splitBlock("p");if(!b)return!0;var g=b.previousBlock,h=b.nextBlock,d=b.wasStartOfBlock,
j=b.wasEndOfBlock,c;if(h)c=h.parent(),"li"==c.nodeName()&&(h._4e_breakParent(c),h._4e_move(h.next(),!0));else if(g&&(c=g.parent())&&"li"==c.nodeName())g._4e_breakParent(c),m.moveToElementEditablePosition(g.next()),g._4e_move(g.prev());if(!d&&!j){if("li"==h.nodeName()&&(c=h.first(t.invisible(!0)))&&a.inArray(c.nodeName(),["ul","ol"]))(e.ie?new o(s.createTextNode("\u00a0")):new o(s.createElement("br"))).insertBefore(c);h&&m.moveToElementEditablePosition(h)}else{var i;if(g){if("li"==g.nodeName()||!l.test(g.nodeName()))i=
g.clone()}else h&&(i=h.clone());i||(i=new o("<p>",null,s));if(c=b.elementPath)for(var b=0,f=c.elements.length;b<f;b++){var k=c.elements[b];if(k.equals(c.block)||k.equals(c.blockLimit))break;n.$removeEmpty[k.nodeName()]&&(k=k.clone(),i._4e_moveChildren(k),i.append(k))}e.ie||i._4e_appendBogus();m.insertNode(i);if(e.ie&&d&&(!j||!g[0].childNodes.length))m.moveToElementEditablePosition(j?g:i),m.select();m.moveToElementEditablePosition(d&&!j?h:i)}e.ie||(h?(i=new o(s.createElement("span")),i.html("&nbsp;"),
m.insertNode(i),i.scrollIntoView(void 0,{alignWithTop:!1,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0}),m.deleteContents()):i.scrollIntoView(void 0,{alignWithTop:!1,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0}));m.select();return!0}function g(a){var e=a.get("document")[0];w.on(e,"keydown",function(e){if(13===e.keyCode&&!e.shiftKey&&!e.ctrlKey&&!e.metaKey){a.execCommand("save");var g=a.execCommand("enterBlock");a.execCommand("save");!1!==g&&e.preventDefault()}})}var e=a.UA,l=/^h[1-6]$/,n=m.XHTML_DTD,
o=a.Node,w=a.Event;return{init:function(a){a.addCommand("enterBlock",{exec:s});a.docReady(function(){g(a)})}}},{requires:["./base","./walker","./elementPath"]});
KISSY.add("editor/core/focusManager",function(a){function m(){var a=this;a.__iframeFocus=n;l=a;e&&clearTimeout(e);e=setTimeout(function(){a.fire("focus")},30)}function t(){var a=this;a.__iframeFocus=o;l=w;e&&clearTimeout(e);e=setTimeout(function(){a.fire("blur")},30)}var r=a.Editor,s=a.Event,g={},e,l,a={refreshAll:function(){for(var a in g){var e=g[a].get("document")[0];e.designMode="off";e.designMode="on"}},currentInstance:function(){return l},getInstance:function(a){return g[a]},add:function(a){var e=
a.get("window")[0];s.on(e,"focus",m,a);s.on(e,"blur",t,a)},register:function(a){g[a._UUID]=a},remove:function(a){delete g[a._UUID];var e=a.get("window")[0];s.remove(e,"focus",m,a);s.remove(e,"blur",t,a)}},n=!0,o=!1,w=null;a.refreshAll=a.refreshAll;r.focusManager=a;r.getInstances=function(){return g};return a},{requires:["./base","./dom"]});
KISSY.add("editor/core/htmlDataProcessor",function(a,m){return{init:function(t){function r(c){var c=c.childNodes,b,d,i,e=c.length;if(e){i=1;for(b=0;b<e;b++)if(d=c[b],d.nodeType!=a.DOM.NodeType.TEXT_NODE||d.nodeValue){i=0;break}return i?!1:void 0}return!1}function s(a){return a.replace(v,function(a,c,b){return"<"+c+b.replace(y,function(a,c){return-1==b.indexOf("_ke_saved_"+c)?" _ke_saved_"+a+" "+a:a})+">"})}function g(a){return a.replace(b,function(a){return"<ke:encoded>"+encodeURIComponent(a)+"</ke:encoded>"})}
function e(c){return c.replace(d,function(c,b){return a.urlDecode(b)})}var l=a.Node,n=a.UA,o=a.require("htmlparser"),w=new o.Filter,p=new o.Filter;(function(){function c(a){a=o.serialize(a);return new o.Comment(h+encodeURIComponent(a).replace(/--/g,"%2D%2D"))}var b={tagNames:[[/^\?xml.*$/i,""],[/^.*namespace.*$/i,""]],attributeNames:[[/^on/,"ke_on"],[/^lang$/,""]],tags:{script:c,noscript:c,span:r}},d={tagNames:[[/^ke:/,""],[/^\?xml:namespace$/,""]],tags:{$:function(a){if(a.attributes.length)for(var c=
["name","href","src"],b,d=0;d<c.length;d++)b="_ke_saved_"+c[d],a.getAttribute(b)&&a.removeAttribute(c[d]);return a},embed:function(a){var c=a.parentNode;if(c&&"object"==c.nodeName){var b=c.getAttribute("width"),c=c.getAttribute("height");b&&a.setAttribute("width",b);c&&a.setAttribute("width",c)}},a:function(a){if(!a.childNodes.length&&!a.attributes.length)return!1},span:r,strong:r,em:r,del:r,u:r},attributes:{style:function(c){if(!a.trim(c))return!1}},attributeNames:[[/^_ke_saved_/,""],[/^ke_on/,"on"],
[/^_ke.*/,""],[/^ke:.*$/,""],[/^_ks.*/,""]],comment:function(c){if(c.substr(0,h.length)==h)return c=a.trim(a.urlDecode(c.substr(h.length))),o.parse(c).childNodes[0]}};n.ie&&(d.attributes.style=function(a){return a.replace(/(^|;)([^:]+)/g,function(a){return a.toLowerCase()})});w.addRules(d);p.addRules(b)})();(function(){function c(b){for(var b=b.childNodes,d=b.length,u=b[d-1];u&&3==u.nodeType&&!a.trim(u.nodeValue);)u=b[--d];return u}function b(a){var d=c(a);d&&(1==d.nodeType&&"br"==d.nodeName?a.removeChild(d):
3==d.nodeType&&g.test(d.nodeValue)&&a.removeChild(d))}function d(a){var b=c(a);return!b||"form"==a.nodeName&&"input"==b.nodeName}function i(a){b(a);d(a)&&(n.ie||a.appendChild(new o.Tag("br")))}function e(a){b(a);d(a)&&a.appendChild(new o.Text("\u00a0"))}var g=/^[\t\r\n ]*(?:&nbsp;|\xa0)[\t\r\n ]*$/,h=m.XHTML_DTD,u=a.merge(h.$block,h.$listItem,h.$tableContent),D;for(D in u)"br"in h[D]||delete u[D];delete u.pre;var h={tags:{}},x={tags:{}};for(D in u)h.tags[D]=i,x.tags[D]=e;p.addRules(h);w.addRules(x)})();
w.addRules({text:function(a){return a.replace(/\xa0/g,"&nbsp;")}});var v=/<(a|area|img|input)\b([^>]*)>/gi,y=/\b(href|src|name)\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|(?:[^ "'>]+))/gi,h="{ke_protected}",b=/(?:<textarea[^>]*>[\s\S]*<\/textarea>)|(?:<style[^>]*>[\s\S]*<\/style>)|(?:<(:?link|meta|base)[^>]*>)/gi,d=/<ke:encoded>([^<]*)<\/ke:encoded>/gi,j=/(<\/?)((?:object|embed|param|html|body|head|title|script|noscript)[^>]*>)/gi,c=/(<\/?)ke:((?:object|embed|param|html|body|head|title|script|noscript)[^>]*>)/gi,
i=/<ke:(param|embed)([^>]*?)\/?>(?!\s*<\/ke:\1)/gi;t.htmlDataProcessor={dataFilter:p,htmlFilter:w,toHTML:function(a){n.webkit&&(a=a.replace(/\u200b/g,""));var c=new o.BeautifyWriter;(new o.Parser(a)).parse().writeHTML(c,w);return a=c.getHTML()},toDataFormat:function(a,b){var b=b||p,a=g(a),a=s(a),a=a.replace(j,"$1ke:$2"),a=a.replace(i,"<ke:$1$2></ke:$1>"),d=new l("<div>");d.html("a"+a);a=d.html().substr(1);a=a.replace(c,"$1$2");a=e(a);d=new o.BasicWriter;(new o.Parser(a)).parse().writeHTML(d,b);return a=
d.getHTML()},toServer:function(a){var c=new o.MinifyWriter;(new o.Parser(a)).parse().writeHTML(c,w);return c.getHTML()}}}}},{requires:["./base"]});
(function(a){a({"editor/plugin/back-color":{requires:["editor","editor/plugin/color/btn"]}});a({"editor/plugin/back-color/cmd":{requires:["editor/plugin/color/cmd"]}});a({"editor/plugin/bold":{requires:["editor","editor/plugin/font/ui"]}});a({"editor/plugin/bold/cmd":{requires:["editor","editor/plugin/font/cmd"]}});a({"editor/plugin/bubble":{requires:["overlay","editor"]}});a({"editor/plugin/button":{requires:["editor","button"]}});a({"editor/plugin/checkbox-source-area":{requires:["editor"]}});a({"editor/plugin/code":{requires:["editor",
"editor/plugin/dialog-loader"]}});a({"editor/plugin/code/dialog":{requires:["editor","editor/plugin/dialog","menubutton"]}});a({"editor/plugin/color/btn":{requires:["editor","editor/plugin/button","editor/plugin/overlay","editor/plugin/dialog-loader"]}});a({"editor/plugin/color/cmd":{requires:["editor"]}});a({"editor/plugin/color/dialog":{requires:["editor","editor/plugin/dialog"]}});a({"editor/plugin/contextmenu":{requires:["editor","menu","editor/plugin/focus-fix"]}});a({"editor/plugin/dent-cmd":{requires:["editor",
"editor/plugin/list-utils"]}});a({"editor/plugin/dialog-loader":{requires:["overlay","editor"]}});a({"editor/plugin/dialog":{requires:["editor","overlay","editor/plugin/focus-fix","dd/plugin/constrain","component/plugin/drag"]}});a({"editor/plugin/draft":{requires:["editor","editor/plugin/local-storage","overlay","editor/plugin/menubutton"]}});a({"editor/plugin/drag-upload":{requires:["editor"]}});a({"editor/plugin/element-path":{requires:["editor"]}});a({"editor/plugin/fake-objects":{requires:["editor"]}});
a({"editor/plugin/flash-bridge":{requires:["swf","editor"]}});a({"editor/plugin/flash-common/base-class":{requires:["editor","editor/plugin/contextmenu","editor/plugin/bubble","editor/plugin/dialog-loader","editor/plugin/flash-common/utils"]}});a({"editor/plugin/flash-common/utils":{requires:["swf"]}});a({"editor/plugin/flash":{requires:["editor","editor/plugin/flash-common/base-class","editor/plugin/flash-common/utils","editor/plugin/fake-objects"]}});a({"editor/plugin/flash/dialog":{requires:["editor",
"editor/plugin/flash-common/utils","editor/plugin/dialog","editor/plugin/menubutton"]}});a({"editor/plugin/focus-fix":{requires:["editor"]}});a({"editor/plugin/font-family":{requires:["editor","editor/plugin/font/ui"]}});a({"editor/plugin/font-family/cmd":{requires:["editor","editor/plugin/font/cmd"]}});a({"editor/plugin/font-size":{requires:["editor","editor/plugin/font/ui"]}});a({"editor/plugin/font-size/cmd":{requires:["editor","editor/plugin/font/cmd"]}});a({"editor/plugin/font/cmd":{requires:["editor"]}});
a({"editor/plugin/font/ui":{requires:["editor","editor/plugin/button","editor/plugin/menubutton"]}});a({"editor/plugin/fore-color":{requires:["editor","editor/plugin/color/btn"]}});a({"editor/plugin/fore-color/cmd":{requires:["editor/plugin/color/cmd"]}});a({"editor/plugin/heading":{requires:["editor"]}});a({"editor/plugin/heading/cmd":{requires:["editor"]}});a({"editor/plugin/image":{requires:["editor","editor/plugin/button","editor/plugin/bubble","editor/plugin/contextmenu","editor/plugin/dialog-loader"]}});
a({"editor/plugin/image/dialog":{requires:["io","editor","editor/plugin/dialog","tabs","editor/plugin/menubutton"]}});a({"editor/plugin/indent":{requires:["editor"]}});a({"editor/plugin/indent/cmd":{requires:["editor","editor/plugin/dent-cmd"]}});a({"editor/plugin/italic":{requires:["editor","editor/plugin/font/ui"]}});a({"editor/plugin/italic/cmd":{requires:["editor","editor/plugin/font/cmd"]}});a({"editor/plugin/justify-center":{requires:["editor"]}});a({"editor/plugin/justify-center/cmd":{requires:["editor/plugin/justify-cmd"]}});
a({"editor/plugin/justify-cmd":{requires:["editor"]}});a({"editor/plugin/justify-left":{requires:["editor"]}});a({"editor/plugin/justify-left/cmd":{requires:["editor/plugin/justify-cmd"]}});a({"editor/plugin/justify-right":{requires:["editor"]}});a({"editor/plugin/justify-right/cmd":{requires:["editor/plugin/justify-cmd"]}});a({"editor/plugin/link":{requires:["editor","editor/plugin/bubble","editor/plugin/dialog-loader","editor/plugin/button"]}});a({"editor/plugin/link/dialog":{requires:["editor",
"editor/plugin/dialog","editor/plugin/link/utils"]}});a({"editor/plugin/link/utils":{requires:["editor"]}});a({"editor/plugin/list-utils":{requires:["editor"]}});a({"editor/plugin/list-utils/btn":{requires:["editor","editor/plugin/button","editor/plugin/menubutton"]}});a({"editor/plugin/list-utils/cmd":{requires:["editor","editor/plugin/list-utils"]}});a({"editor/plugin/local-storage":{requires:["editor","overlay","editor/plugin/flash-bridge"]}});a({"editor/plugin/maximize":{requires:["editor"]}});
a({"editor/plugin/maximize/cmd":{requires:["editor"]}});a({"editor/plugin/menubutton":{requires:["editor","menubutton"]}});a({"editor/plugin/multiple-upload":{requires:["editor","editor/plugin/dialog-loader"]}});a({"editor/plugin/multiple-upload/dialog":{requires:"editor,component/plugin/drag,editor/plugin/progressbar,editor/plugin/dialog,editor/plugin/flash-bridge,editor/plugin/local-storage,swf".split(",")}});a({"editor/plugin/ordered-list":{requires:["editor","editor/plugin/list-utils/btn"]}});
a({"editor/plugin/ordered-list/cmd":{requires:["editor","editor/plugin/list-utils/cmd"]}});a({"editor/plugin/outdent":{requires:["editor"]}});a({"editor/plugin/outdent/cmd":{requires:["editor","editor/plugin/dent-cmd"]}});a({"editor/plugin/overlay":{requires:["editor","overlay","editor/plugin/focus-fix"]}});a({"editor/plugin/page-break":{requires:["editor","editor/plugin/fake-objects"]}});a({"editor/plugin/remove-format":{requires:["editor","editor/plugin/button"]}});a({"editor/plugin/remove-format/cmd":{requires:["editor"]}});
a({"editor/plugin/resize":{requires:["editor","dd/base"]}});a({"editor/plugin/separator":{requires:["editor"]}});a({"editor/plugin/smiley":{requires:["editor","editor/plugin/overlay"]}});a({"editor/plugin/source-area":{requires:["editor","editor/plugin/button"]}});a({"editor/plugin/strike-through":{requires:["editor","editor/plugin/font/ui"]}});a({"editor/plugin/strike-through/cmd":{requires:["editor","editor/plugin/font/cmd"]}});a({"editor/plugin/table":{requires:["editor","editor/plugin/dialog-loader",
"editor/plugin/contextmenu"]}});a({"editor/plugin/table/dialog":{requires:["editor","editor/plugin/dialog","editor/plugin/menubutton"]}});a({"editor/plugin/underline":{requires:["editor","editor/plugin/font/ui"]}});a({"editor/plugin/underline/cmd":{requires:["editor","editor/plugin/font/cmd"]}});a({"editor/plugin/undo":{requires:["editor"]}});a({"editor/plugin/undo/btn":{requires:["editor","editor/plugin/button"]}});a({"editor/plugin/undo/cmd":{requires:["editor"]}});a({"editor/plugin/unordered-list":{requires:["editor",
"editor/plugin/list-utils/btn"]}});a({"editor/plugin/unordered-list/cmd":{requires:["editor","editor/plugin/list-utils/cmd"]}});a({"editor/plugin/video":{requires:["editor","editor/plugin/flash-common/utils","editor/plugin/flash-common/base-class","editor/plugin/fake-objects"]}});a({"editor/plugin/video/dialog":{requires:["editor","editor/plugin/flash/dialog","editor/plugin/menubutton"]}});a({"editor/plugin/word-filter":{requires:["htmlparser"]}});a({"editor/plugin/xiami-music":{requires:["editor",
"editor/plugin/flash-common/base-class","editor/plugin/flash-common/utils","editor/plugin/fake-objects"]}});a({"editor/plugin/xiami-music/dialog":{requires:["editor","editor/plugin/flash/dialog","editor/plugin/menubutton"]}})})(function(a){KISSY.config("modules",a)},KISSY.Features,KISSY.UA);
KISSY.add("editor/core/range",function(a,m,t,r,s){function g(b){var i=b.nodeType!=d.NodeType.TEXT_NODE&&d.nodeName(b)in c.$removeEmpty,f=b.nodeType==d.NodeType.TEXT_NODE&&!a.trim(b.nodeValue),b=!!b.parentNode.getAttribute("_ke_bookmark");return i||f||b}function e(a){return!q(a)&&!A(a)}function l(c){var b=v;return function(i){if(A(i))return p;if(i.nodeType==d.NodeType.TEXT_NODE){if(a.trim(i.nodeValue).length)return v}else if(i.nodeType==d.NodeType.ELEMENT_NODE&&(i=d.nodeName(i),!E[i]))if(!c&&!j.ie&&
"br"==i&&!b)b=p;else return v;return p}}function n(a,c){var b=a.startContainer,f=a.endContainer,e=a.startOffset,k=a.endOffset,q,g=v,h=v,l=void 0,j=a.document,m;0<c&&(l=j.createDocumentFragment());if(a.collapsed)return l;a.optimizeBookmark();f[0].nodeType==d.NodeType.TEXT_NODE?(h=p,f=f._4e_splitText(k)):0<f[0].childNodes.length&&(k>=f[0].childNodes.length?(f=new i(f[0].appendChild(j.createTextNode(""))),m=p):f=new i(f[0].childNodes[k]));b[0].nodeType==d.NodeType.TEXT_NODE?(g=p,b._4e_splitText(e)):
e?e>=b[0].childNodes.length?(b=new i(b[0].appendChild(j.createTextNode(""))),q=p):b=new i(b[0].childNodes[e].previousSibling):(q=new i(j.createTextNode("")),b.prepend(q),b=q,q=p);var H=b._4e_parents(),J=f._4e_parents();H.each(function(a,c){H[c]=a});J.each(function(a,c){J[c]=a});for(var F,M,j=0;j<H.length&&!(F=H[j],M=J[j],!F.equals(M));j++);for(var e=l,B,I,A=j;A<H.length;A++){B=H[A];k=0<c&&!B.equals(b)?e.appendChild(B.clone()[0]):null;B=B[0].nextSibling;I=J[A];for(var o=f[0],n=I&&I[0];B&&!(n==B||o==
B);)I=B.nextSibling,2==c?e.appendChild(B.cloneNode(p)):(d._4e_remove(B),1==c&&e.appendChild(B)),B=I;k&&(e=k)}for(e=l;j<J.length;j++){B=J[j];k=0<c&&!B.equals(f)?e.appendChild(B.clone()[0]):null;if(!H[j]||!B._4e_sameLevel(H[j]))for(B=B[0].previousSibling;B;)I=B.previousSibling,2==c?e.insertBefore(B.cloneNode(p),e.firstChild):(d._4e_remove(B),1==c&&e.insertBefore(B,e.firstChild)),B=I;k&&(e=k)}if(2==c){if(g&&(F=b[0],F.nodeType==d.NodeType.TEXT_NODE&&F.nextSibling&&F.nextSibling.nodeType==d.NodeType.TEXT_NODE&&
(F.data+=F.nextSibling.data,F.parentNode.removeChild(F.nextSibling))),h)h=f[0],h.nodeType==d.NodeType.TEXT_NODE&&h.previousSibling&&h.previousSibling.nodeType==d.NodeType.TEXT_NODE&&(h.previousSibling.data+=h.data,h.parentNode.removeChild(h))}else{if(F&&M&&(!b._4e_sameLevel(F)||!f._4e_sameLevel(M)))h=F._4e_index(),q&&F._4e_sameLevel(b)&&h--,a.setStart(F.parent(),h+1);a.collapse(p)}q&&b.remove();m&&f.remove();return l}function o(a){a.collapsed=a.startContainer&&a.endContainer&&a.startContainer[0]==
a.endContainer[0]&&a.startOffset==a.endOffset}function w(a){this.endOffset=this.endContainer=this.startOffset=this.startContainer=y;this.collapsed=p;this.document=a}m.RANGE={POSITION_AFTER_START:1,POSITION_BEFORE_END:2,POSITION_BEFORE_START:3,POSITION_AFTER_END:4,ENLARGE_ELEMENT:1,ENLARGE_BLOCK_CONTENTS:2,ENLARGE_LIST_ITEM_CONTENTS:3,START:1,END:2,SHRINK_ELEMENT:1,SHRINK_TEXT:2};var p=!0,v=!1,y=null,h=m.RANGE,b=m.POSITION,d=a.DOM,j=a.UA,c=m.XHTML_DTD,i=a.Node,f=i.all,k={area:1,base:1,br:1,col:1,hr:1,
img:1,input:1,link:1,meta:1,param:1},q=new r.whitespaces,A=new r.bookmark,C=r.whitespaces(p),z=r.bookmark(!1,!0),E={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};a.augment(w,{toString:function(){var a=[],c=this.startContainer[0],b=this.endContainer[0];a.push((c.id||c.nodeName)+":"+this.startOffset);a.push((b.id||b.nodeName)+":"+this.endOffset);return a.join("<br/>")},optimize:function(){var a=
this.startContainer,c=this.startOffset;a[0].nodeType!=d.NodeType.ELEMENT_NODE&&(c?c>=a[0].nodeValue.length&&this.setStartAfter(a):this.setStartBefore(a));a=this.endContainer;c=this.endOffset;a[0].nodeType!=d.NodeType.ELEMENT_NODE&&(c?c>=a[0].nodeValue.length&&this.setEndAfter(a):this.setEndBefore(a))},setStartAfter:function(a){this.setStart(a.parent(),a._4e_index()+1)},setStartBefore:function(a){this.setStart(a.parent(),a._4e_index())},setEndAfter:function(a){this.setEnd(a.parent(),a._4e_index()+
1)},setEndBefore:function(a){this.setEnd(a.parent(),a._4e_index())},optimizeBookmark:function(){var a=this.startContainer,c=this.endContainer;a&&"span"==a.nodeName()&&a.attr("_ke_bookmark")&&this.setStartBefore(a);c&&"span"==c.nodeName()&&c.attr("_ke_bookmark")&&this.setEndAfter(c)},setStart:function(a,c){a[0].nodeType==d.NodeType.ELEMENT_NODE&&k[a.nodeName()]&&(a=a.parent(),c=a._4e_index());this.startContainer=a;this.startOffset=c;this.endContainer||(this.endContainer=a,this.endOffset=c);o(this)},
setEnd:function(a,c){a[0].nodeType==d.NodeType.ELEMENT_NODE&&k[a.nodeName()]&&(a=a.parent(),c=a._4e_index()+1);this.endContainer=a;this.endOffset=c;this.startContainer||(this.startContainer=a,this.startOffset=c);o(this)},setStartAt:function(a,c){switch(c){case h.POSITION_AFTER_START:this.setStart(a,0);break;case h.POSITION_BEFORE_END:a[0].nodeType==d.NodeType.TEXT_NODE?this.setStart(a,a[0].nodeValue.length):this.setStart(a,a[0].childNodes.length);break;case h.POSITION_BEFORE_START:this.setStartBefore(a);
break;case h.POSITION_AFTER_END:this.setStartAfter(a)}o(this)},setEndAt:function(a,c){switch(c){case h.POSITION_AFTER_START:this.setEnd(a,0);break;case h.POSITION_BEFORE_END:a[0].nodeType==d.NodeType.TEXT_NODE?this.setEnd(a,a[0].nodeValue.length):this.setEnd(a,a[0].childNodes.length);break;case h.POSITION_BEFORE_START:this.setEndBefore(a);break;case h.POSITION_AFTER_END:this.setEndAfter(a)}o(this)},cloneContents:function(){return n(this,2)},deleteContents:function(){return n(this,0)},extractContents:function(){return n(this,
1)},collapse:function(a){a?(this.endContainer=this.startContainer,this.endOffset=this.startOffset):(this.startContainer=this.endContainer,this.startOffset=this.endOffset);this.collapsed=p},clone:function(){var a=new w(this.document);a.startContainer=this.startContainer;a.startOffset=this.startOffset;a.endContainer=this.endContainer;a.endOffset=this.endOffset;a.collapsed=this.collapsed;return a},getEnclosedNode:function(){var a=this.clone();a.optimize();if(a.startContainer[0].nodeType!=d.NodeType.ELEMENT_NODE||
a.endContainer[0].nodeType!=d.NodeType.ELEMENT_NODE)return y;var c=new r(a);c.evaluator=function(a){return C(a)&&z(a)};a=c.next();c.reset();c=c.previous();return a&&a.equals(c)?a:y},shrink:function(a,c){if(!this.collapsed){var a=a||h.SHRINK_TEXT,b=this.clone(),i=this.startContainer,f=this.endContainer,e=this.startOffset,k=this.endOffset,q=p,g,j,l=p;i&&i[0].nodeType==d.NodeType.TEXT_NODE&&(e?e>=i[0].nodeValue.length?b.setStartAfter(i):(b.setStartBefore(i),q=v):b.setStartBefore(i));f&&f[0].nodeType==
d.NodeType.TEXT_NODE&&(k?k>=f[0].nodeValue.length?b.setEndAfter(f):(b.setEndAfter(f),l=v):b.setEndBefore(f));if(q||l)j=new r(b),j.evaluator=function(c){return c.nodeType==(a==h.SHRINK_ELEMENT?d.NodeType.ELEMENT_NODE:d.NodeType.TEXT_NODE)},j.guard=function(c,b){if(a==h.SHRINK_ELEMENT&&c.nodeType==d.NodeType.TEXT_NODE||b&&c==g)return v;!b&&c.nodeType==d.NodeType.ELEMENT_NODE&&(g=c);return p};q&&(b=j[a==h.SHRINK_ELEMENT?"lastForward":"next"]())&&this.setStartAt(b,c?h.POSITION_AFTER_START:h.POSITION_BEFORE_START);
l&&(j.reset(),(j=j[a==h.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(j,c?h.POSITION_BEFORE_END:h.POSITION_AFTER_END));return q||l}},createBookmark2:function(a){var c=this.startContainer,b=this.endContainer,f=this.startOffset,e=this.endOffset,k,q;if(!c||!b)return{start:0,end:0};if(a){if(c[0].nodeType==d.NodeType.ELEMENT_NODE&&(k=new i(c[0].childNodes[f]))&&k[0]&&k[0].nodeType==d.NodeType.TEXT_NODE&&0<f&&k[0].previousSibling.nodeType==d.NodeType.TEXT_NODE)c=k,f=0;for(;c[0].nodeType==
d.NodeType.TEXT_NODE&&(q=c.prev(void 0,1))&&q[0].nodeType==d.NodeType.TEXT_NODE;)c=q,f+=q[0].nodeValue.length;if(!this.collapsed){if(b[0].nodeType==d.NodeType.ELEMENT_NODE&&(k=new i(b[0].childNodes[e]))&&k[0]&&k[0].nodeType==d.NodeType.TEXT_NODE&&0<e&&k[0].previousSibling.nodeType==d.NodeType.TEXT_NODE)b=k,e=0;for(;b[0].nodeType==d.NodeType.TEXT_NODE&&(q=b.prev(void 0,1))&&q[0].nodeType==d.NodeType.TEXT_NODE;)b=q,e+=q[0].nodeValue.length}}return{start:c._4e_address(a),end:this.collapsed?y:b._4e_address(a),
startOffset:f,endOffset:e,normalized:a,is2:p}},createBookmark:function(c){var b,d,f,e,k=this.collapsed;b=new i("<span>",y,this.document);b.attr("_ke_bookmark",1);b.css("display","none");b.html("&nbsp;");c&&(f=a.guid("ke_bm_"),b.attr("id",f+"S"));k||(d=b.clone(),d.html("&nbsp;"),c&&d.attr("id",f+"E"),e=this.clone(),e.collapse(),e.insertNode(d));e=this.clone();e.collapse(p);e.insertNode(b);d?(this.setStartAfter(b),this.setEndBefore(d)):this.moveToPosition(b,h.POSITION_AFTER_END);return{startNode:c?
f+"S":b,endNode:c?f+"E":d,serializable:c,collapsed:k}},moveToPosition:function(a,c){this.setStartAt(a,c);this.collapse(p)},trim:function(a,c){var b=this.startContainer,f=this.startOffset,i=this.collapsed;if((!a||i)&&b[0]&&b[0].nodeType==d.NodeType.TEXT_NODE){if(f)if(f>=b[0].nodeValue.length)f=b._4e_index()+1,b=b.parent();else{var e=b._4e_splitText(f),f=b._4e_index()+1,b=b.parent();d.equals(this.startContainer,this.endContainer)?this.setEnd(e,this.endOffset-this.startOffset):d.equals(b,this.endContainer)&&
(this.endOffset+=1)}else f=b._4e_index(),b=b.parent();this.setStart(b,f);if(i){this.collapse(p);return}}b=this.endContainer;f=this.endOffset;!c&&!i&&b[0]&&b[0].nodeType==d.NodeType.TEXT_NODE&&(f?(f>=b[0].nodeValue.length||b._4e_splitText(f),f=b._4e_index()+1):f=b._4e_index(),b=b.parent(),this.setEnd(b,f))},insertNode:function(a){this.optimizeBookmark();this.trim(v,p);var c=this.startContainer;c[0].insertBefore(a[0],c[0].childNodes[this.startOffset]||null);c[0]==this.endContainer[0]&&this.endOffset++;
this.setStartBefore(a)},moveToBookmark:function(c){var b=f(this.document);if(c.is2){var d=b._4e_getByAddress(c.start,c.normalized),i=c.startOffset,b=c.end&&b._4e_getByAddress(c.end,c.normalized),c=c.endOffset;this.setStart(d,i);b?this.setEnd(b,c):this.collapse(p)}else d=(i=c.serializable)?a.one("#"+c.startNode,b):c.startNode,c=i?a.one("#"+c.endNode,b):c.endNode,this.setStartBefore(d),d._4e_remove(),c&&c[0]?(this.setEndBefore(c),c._4e_remove()):this.collapse(p)},getCommonAncestor:function(a,c){var b=
this.startContainer,f=this.endContainer,b=b[0]==f[0]?a&&b[0].nodeType==d.NodeType.ELEMENT_NODE&&this.startOffset==this.endOffset-1?new i(b[0].childNodes[this.startOffset]):b:b._4e_commonAncestor(f);return c&&b[0].nodeType==d.NodeType.TEXT_NODE?b.parent():b},enlarge:function(){function a(c,b,i,e){var k=c[b?"startContainer":"endContainer"],h,g=b?0:1,u=0,j=b?"previousSibling":"nextSibling";h=c[b?"startOffset":"endOffset"];if(k[0].nodeType==d.NodeType.TEXT_NODE){if(b){if(h)return}else if(h<k[0].nodeValue.length)return;
h=k[0][j];k=k[0].parentNode}else h=k[0].childNodes[h+(b?-1:1)]||null,k=k[0];for(;k;){for(;h;)if(q(h)||A(h))h=h[j];else break;if(h){if(!u)c[b?"setStartAfter":"setEndBefore"](f(h));break}k=f(k);if("body"==k.nodeName())break;if(u||k.equals(e))i[g]=k,u=1;else c[b?"setStartBefore":"setEndAfter"](k);h=k[0][j];k=k[0].parentNode}}return function(c){switch(c){case h.ENLARGE_ELEMENT:if(this.collapsed)break;var c=this.getCommonAncestor(),b=[];a(this,1,b,c);a(this,0,b,c);b[0]&&b[1]&&(c=b[0].contains(b[1])?b[1]:
b[0],this.setStartBefore(c),this.setEndAfter(c));break;case h.ENLARGE_BLOCK_CONTENTS:case h.ENLARGE_LIST_ITEM_CONTENTS:var e=new w(this.document),b=new i(this.document.body);e.setStartAt(b,h.POSITION_AFTER_START);e.setEnd(this.startContainer,this.startOffset);var e=new r(e),k,q,g=r.blockBoundary(c==h.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:y),j=function(a){var c=g(a);c||(k=f(a));return c},l=function(a){var c=j(a);!c&&"br"==d.nodeName(a)&&(q=f(a));return c};e.guard=j;e=e.lastBackward();k=k||b;this.setStartAt(k,
"br"!=k.nodeName()&&(!e&&this.checkStartOfBlock()||e&&k.contains(e))?h.POSITION_AFTER_START:h.POSITION_AFTER_END);e=this.clone();e.collapse();e.setEndAt(b,h.POSITION_BEFORE_END);e=new r(e);e.guard=c==h.ENLARGE_LIST_ITEM_CONTENTS?l:j;k=y;e=e.lastForward();k=k||b;this.setEndAt(k,!e&&this.checkEndOfBlock()||e&&k.contains(e)?h.POSITION_BEFORE_END:h.POSITION_BEFORE_START);q&&this.setEndAfter(q)}}}(),checkStartOfBlock:function(){var c=this.startContainer,b=this.startOffset;if(b&&c[0].nodeType==d.NodeType.TEXT_NODE&&
a.trim(c[0].nodeValue.substring(0,b)).length)return v;this.trim();c=new s(this.startContainer);b=this.clone();b.collapse(p);b.setStartAt(c.block||c.blockLimit,h.POSITION_AFTER_START);c=new r(b);c.evaluator=l(p);return c.checkBackward()},checkEndOfBlock:function(){var c=this.endContainer,b=this.endOffset;if(c[0].nodeType==d.NodeType.TEXT_NODE&&a.trim(c[0].nodeValue.substring(b)).length)return v;this.trim();c=new s(this.endContainer);b=this.clone();b.collapse(v);b.setEndAt(c.block||c.blockLimit,h.POSITION_BEFORE_END);
c=new r(b);c.evaluator=l(v);return c.checkForward()},checkBoundaryOfElement:function(a,c){var b=this.clone();b[c==h.START?"setStartAt":"setEndAt"](a,c==h.START?h.POSITION_AFTER_START:h.POSITION_BEFORE_END);b=new r(b);b.evaluator=g;return b[c==h.START?"checkBackward":"checkForward"]()},getBoundaryNodes:function(){var a=this.startContainer,c=this.endContainer,i=this.startOffset,e=this.endOffset,k;if(a[0].nodeType==d.NodeType.ELEMENT_NODE)if(k=a[0].childNodes.length,k>i)a=f(a[0].childNodes[i]);else if(0==
k)a=a._4e_previousSourceNode();else{for(a=a[0];a.lastChild;)a=a.lastChild;a=f(a);a=a._4e_nextSourceNode()||a}if(c[0].nodeType==d.NodeType.ELEMENT_NODE)if(k=c[0].childNodes.length,k>e)c=f(c[0].childNodes[e])._4e_previousSourceNode(p);else if(0==k)c=c._4e_previousSourceNode();else{for(c=c[0];c.lastChild;)c=c.lastChild;c=f(c)}a._4e_position(c)&b.POSITION_FOLLOWING&&(a=c);return{startNode:a,endNode:c}},fixBlock:function(a,c){var b=this.createBookmark(),d=f(this.document.createElement(c));this.collapse(a);
this.enlarge(h.ENLARGE_BLOCK_CONTENTS);d[0].appendChild(this.extractContents());d._4e_trim();j.ie||d._4e_appendBogus();this.insertNode(d);this.moveToBookmark(b);return d},splitBlock:function(c){var b=new s(this.startContainer),d=new s(this.endContainer),f=b.block,i=d.block,e=y;if(!b.blockLimit.equals(d.blockLimit))return y;"br"!=c&&(f||(f=this.fixBlock(p,c),i=(new s(this.endContainer)).block),i||(i=this.fixBlock(v,c)));c=f&&this.checkStartOfBlock();b=i&&this.checkEndOfBlock();this.deleteContents();
f&&f[0]==i[0]&&(b?(e=new s(this.startContainer),this.moveToPosition(i,h.POSITION_AFTER_END),i=y):c?(e=new s(this.startContainer),this.moveToPosition(f,h.POSITION_BEFORE_START),f=y):(i=this.splitElement(f),!j.ie&&!a.inArray(f.nodeName(),["ul","ol"])&&f._4e_appendBogus()));return{previousBlock:f,nextBlock:i,wasStartOfBlock:c,wasEndOfBlock:b,elementPath:e}},splitElement:function(a){if(!this.collapsed)return y;this.setEndAt(a,h.POSITION_BEFORE_END);var c=this.extractContents(),b=a.clone(v);b[0].appendChild(c);
b.insertAfter(a);this.moveToPosition(a,h.POSITION_AFTER_END);return b},moveToElementEditablePosition:function(a,c){for(var b=0;a;){if(a[0].nodeType==d.NodeType.TEXT_NODE){this.moveToPosition(a,c?h.POSITION_AFTER_END:h.POSITION_BEFORE_START);b=1;break}a[0].nodeType==d.NodeType.ELEMENT_NODE&&a._4e_isEditable()&&(this.moveToPosition(a,c?h.POSITION_BEFORE_END:h.POSITION_AFTER_START),b=1);var f=a,i=b,k=void 0;f[0].nodeType==d.NodeType.ELEMENT_NODE&&f._4e_isEditable()&&(k=f[c?"last":"first"](e,1));!i&&
!k&&(k=f[c?"prev":"next"](e,1));a=k}return!!b},selectNodeContents:function(a){var c=a[0];this.setStart(a,0);this.setEnd(a,c.nodeType==d.NodeType.TEXT_NODE?c.nodeValue.length:c.childNodes.length)},insertNodeByDtd:function(a){var b,d,f,i=a.nodeName();b=c.$block[i];this.deleteContents();if(b){for(b=this.getCommonAncestor(v,p);(d=c[b.nodeName()])&&(!d||!d[i]);){var e=b.parent();this.checkStartOfBlock()&&this.checkEndOfBlock()?(this.setStartBefore(b),this.collapse(p),b.remove()):f=b;b=e}f&&this.splitElement(f)}this.insertNode(a)}});
t.injectDom({_4e_breakParent:function(a,c){var c=f(c),a=f(a),b,d=new m.Range(a[0].ownerDocument);d.setStartAfter(a);d.setEndAfter(c);b=d.extractContents();d.insertNode(a.remove());a.after(b)}});return m.Range=w},{requires:["./base","./utils","./walker","./elementPath","./dom"]});
KISSY.add("editor/core/selection",function(a){function m(a){this.document=a;this._={cache:{}};if(p)try{var b=this.getNative().createRange();if(!b||b.item&&b.item(0).ownerDocument!=a||b.parentElement&&b.parentElement().ownerDocument!=a)this.isInvalid=s}catch(d){this.isInvalid=s}}function t(a){a=new m(a);return!a||a.isInvalid?g:a}var r=a.Editor;r.SELECTION={SELECTION_NONE:1,SELECTION_TEXT:2,SELECTION_ELEMENT:3};var s=!0,g=null,e=a.UA,l=a.DOM,n=a.Node,o=r.SELECTION,w=r.RANGE,p=e.ie,v=r.Walker,y=r.Range,
h={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};a.augment(m,{getNative:!p?function(){var a=this._.cache;return a.nativeSel||(a.nativeSel=l.getWindow(this.document).getSelection())}:function(){var a=this._.cache;return a.nativeSel||(a.nativeSel=this.document.selection)},getType:!p?function(){var a=this._.cache;if(a.type)return a.type;var b=o.SELECTION_TEXT,d=this.getNative();if(d){if(1==d.rangeCount){var d=
d.getRangeAt(0),e=d.startContainer;e==d.endContainer&&e.nodeType==l.NodeType.ELEMENT_NODE&&1==Number(d.endOffset-d.startOffset)&&h[e.childNodes[d.startOffset].nodeName.toLowerCase()]&&(b=o.SELECTION_ELEMENT)}}else b=o.SELECTION_NONE;return a.type=b}:function(){var a=this._.cache;if(a.type)return a.type;var b=o.SELECTION_NONE;try{var d=this.getNative(),e=d.type;"Text"==e&&(b=o.SELECTION_TEXT);"Control"==e&&(b=o.SELECTION_ELEMENT);d.createRange().parentElement&&(b=o.SELECTION_TEXT)}catch(q){}return a.type=
b},getRanges:p?function(){var a=function(a,c){a=a.duplicate();a.collapse(c);for(var b=a.parentElement(),d=b.childNodes,e,h=0;h<d.length;h++){var j=d[h];if(j.nodeType==l.NodeType.ELEMENT_NODE){e=a.duplicate();e.moveToElementText(j);var j=e.compareEndPoints("StartToStart",a),m=e.compareEndPoints("EndToStart",a);e.collapse();if(0<j)break;else{if(!j||1==m&&-1==j)return{container:b,offset:h};if(!m)return{container:b,offset:h+1}}e=g}}e||(e=a.duplicate(),e.moveToElementText(b),e.collapse(!1));e.setEndPoint("StartToStart",
a);e=(""+e.text).replace(/\r\n|\r/g,"\n").length;try{for(;0<e;)e-=d[--h].nodeValue.length}catch(o){e=0}return 0===e?{container:b,offset:h}:{container:d[h],offset:-e}};return function(b){var d=this._.cache;if(d.ranges&&!b)return d.ranges;var e=this.getNative(),b=e&&e.createRange(),h=this.getType();if(!e)return[];if(h==o.SELECTION_TEXT)return e=new y(this.document),h=a(b,s),e.setStart(new n(h.container),h.offset),h=a(b),e.setEnd(new n(h.container),h.offset),d.ranges=[e];if(h==o.SELECTION_ELEMENT){d=
d.ranges=[];for(h=0;h<b.length;h++){for(var g=b.item(h),j=g.parentNode,l=0,e=new y(this.document);l<j.childNodes.length&&j.childNodes[l]!=g;l++);e.setStart(new n(j),l);e.setEnd(new n(j),l+1);d.push(e)}return d}return d.ranges=[]}}():function(a){var b=this._.cache;if(b.ranges&&!a)return b.ranges;var a=[],d=this.getNative();if(!d)return[];for(var e=0;e<d.rangeCount;e++){var h=d.getRangeAt(e),g=new y(this.document);g.setStart(new n(h.startContainer),h.startOffset);g.setEnd(new n(h.endContainer),h.endOffset);
a.push(g)}return b.ranges=a},getStartElement:function(){var a=this._.cache;if(void 0!==a.startElement)return a.startElement;var b,d=this.getNative();switch(this.getType()){case o.SELECTION_ELEMENT:return this.getSelectedElement();case o.SELECTION_TEXT:var e=this.getRanges()[0];if(e&&!e.collapsed){for(e.optimize();s;)if(b=e.startContainer,e.startOffset==(b[0].nodeType===l.NodeType.ELEMENT_NODE?b[0].childNodes.length:b[0].nodeValue.length)&&!b._4e_isBlockBoundary())e.setStartAfter(b);else break;b=e.startContainer;
if(b[0].nodeType!=l.NodeType.ELEMENT_NODE)return b.parent();b=new n(b[0].childNodes[e.startOffset]);if(!b[0]||b[0].nodeType!=l.NodeType.ELEMENT_NODE)return e.startContainer;for(e=b[0].firstChild;e&&e.nodeType==l.NodeType.ELEMENT_NODE;)b=new n(e),e=e.firstChild;return b}if(p)e=d.createRange(),e.collapse(s),b=new n(e.parentElement());else{if((b=d.anchorNode)&&b.nodeType!=l.NodeType.ELEMENT_NODE)b=b.parentNode;b&&(b=new n(b))}}return a.startElement=b},getSelectedElement:function(){var a,b=this._.cache;
if(void 0!==b.selectedElement)return b.selectedElement;p&&(a=this.getNative().createRange(),a=a.item&&a.item(0));var d;if(a)d=new n(a);else{a=this.getRanges()[0];for(var e,g=2;g&&(!(d=a.getEnclosedNode())||!(d[0].nodeType==l.NodeType.ELEMENT_NODE&&h[d.nodeName()]&&(e=d)));g--)a.shrink(w.SHRINK_ELEMENT);d=e}return b.selectedElement=d},reset:function(){this._.cache={}},selectElement:function(a){var b,d=this.document;if(p)try{b=d.body.createControlRange(),b.addElement(a[0]),b.select()}catch(e){b=d.body.createTextRange(),
b.moveToElementText(a[0]),b.select()}finally{}else b=d.createRange(),b.selectNode(a[0]),a=this.getNative(),a.removeAllRanges(),a.addRange(b);this.reset()},selectRanges:function(a){if(p){if(1<a.length){var b=a[a.length-1];a[0].setEnd(b.endContainer,b.endOffset);a.length=1}a[0]&&a[0].select()}else{b=this.getNative();if(!b)return;b.removeAllRanges();for(var d=0;d<a.length;d++){var h=a[d],g=this.document.createRange(),j=h.startContainer;if(h.collapsed&&(e.gecko&&1.09>e.gecko||e.opera||e.webkit)&&j[0].nodeType==
l.NodeType.ELEMENT_NODE&&!j[0].childNodes.length)j[0].appendChild(this.document.createTextNode(e.webkit?"\u200b":"")),h.startOffset++,h.endOffset++;g.setStart(j[0],h.startOffset);g.setEnd(h.endContainer[0],h.endOffset);b.addRange(g)}}this.reset()},createBookmarks2:function(a){for(var b=[],d=this.getRanges(),e=0;e<d.length;e++)b.push(d[e].createBookmark2(a));return b},createBookmarks:function(b,d){for(var e=[],h=this.document,g,d=d||this.getRanges(),j=d.length,m=0;m<j;m++){e.push(g=d[m].createBookmark(b,
s));var o=(b=g.serializable)?a.one("#"+g.startNode,h):g.startNode;g=b?a.one("#"+g.endNode,h):g.endNode;for(var p=m+1;p<j;p++){var n=d[p],t=n.startContainer,r=n.endContainer;l.equals(t,o.parent())&&n.startOffset++;l.equals(t,g.parent())&&n.startOffset++;l.equals(r,o.parent())&&n.endOffset++;l.equals(r,g.parent())&&n.endOffset++}}return e},selectBookmarks:function(a){for(var b=[],d=0;d<a.length;d++){var e=new y(this.document);e.moveToBookmark(a[d]);b.push(e)}this.selectRanges(b);return this},getCommonAncestor:function(){var a=
this.getRanges();return a[0].startContainer._4e_commonAncestor(a[a.length-1].endContainer)},scrollIntoView:function(){var a=this.getStartElement();a&&a.scrollIntoView(void 0,{alignWithTop:!1,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0})},removeAllRanges:function(){var a=this.getNative();p?a&&a.clear():a&&a.removeAllRanges()}});var b={table:1,tbody:1,tr:1},d=v.whitespaces(s),j=/\ufeff|\u00a0/;y.prototype.select=y.prototype.select=!p?function(){var a=this.startContainer;this.collapsed&&a[0].nodeType==
l.NodeType.ELEMENT_NODE&&!a[0].childNodes.length&&(a[0].appendChild(this.document.createTextNode(e.webkit?"\u200b":"")),this.startOffset++,this.endOffset++);var b=this.document.createRange();b.setStart(a[0],this.startOffset);try{b.setEnd(this.endContainer[0],this.endOffset)}catch(d){if(0<=d.toString().indexOf("NS_ERROR_ILLEGAL_VALUE"))this.collapse(s),b.setEnd(this.endContainer[0],this.endOffset);else throw d;}a=t(this.document).getNative();a.removeAllRanges();a.addRange(b)}:function(a){var e=this.collapsed,
f,h;if(this.startContainer[0]===this.endContainer[0]&&1==this.endOffset-this.startOffset){var g=this.startContainer[0].childNodes[this.startOffset];if(g.nodeType==l.NodeType.ELEMENT_NODE){(new m(this.document)).selectElement(new n(g));return}}(this.startContainer[0].nodeType==l.NodeType.ELEMENT_NODE&&this.startContainer.nodeName()in b||this.endContainer[0].nodeType==l.NodeType.ELEMENT_NODE&&this.endContainer.nodeName()in b)&&this.shrink(w.SHRINK_ELEMENT,s);var o=this.createBookmark(),g=o.startNode,
p;e||(p=o.endNode);o=this.document.body.createTextRange();o.moveToElementText(g[0]);o.moveStart("character",1);if(p)a=this.document.body.createTextRange(),a.moveToElementText(p[0]),o.setEndPoint("EndToEnd",a),o.moveEnd("character",-1);else{for(f=g[0].nextSibling;f&&!d(f);)f=f.nextSibling;f=!(f&&f.nodeValue&&f.nodeValue.match(j))&&(a||!g[0].previousSibling||g[0].previousSibling&&"br"==l.nodeName(g[0].previousSibling));h=new n(this.document.createElement("span"));h.html("&#65279;");h.insertBefore(g);
f&&l.insertBefore(this.document.createTextNode("\ufeff"),g[0]||g)}this.setStartBefore(g);g._4e_remove();if(e){if(f?(o.moveStart("character",-1),o.select(),this.document.selection.clear()):o.select(),h)this.moveToPosition(h,w.POSITION_BEFORE_START),h._4e_remove()}else this.setEndBefore(p),p._4e_remove(),o.select()};m.getSelection=t;return r.Selection=m},{requires:["./base","./walker","./range","./dom"]});
KISSY.add("editor/core/selectionFix",function(a,m){function t(a){function b(a,b){var c=f.body.createTextRange();try{c.moveToPoint(a,b)}catch(d){c=n}return c}function d(){var a=f.selection.createRange();k&&!a.item&&0===a.compareEndPoints("StartToEnd",a)&&k.select();w.remove(f,"mouseup",d);w.remove(f,"mousemove",e);k=c=0}function e(a){if(a.button){if(a=b(a.pageX,a.pageY))0<a.compareEndPoints("StartToStart",k)?a.setEndPoint("StartToStart",k):a.setEndPoint("EndToEnd",k),a.select()}else d()}var c,g=a.get("window")[0],
f=a.get("document")[0],k;w.on(f,"mousedown contextmenu",function(a){var h=f.documentElement;if(a.target===h&&(c&&d(),!(h.scrollHeight>h.clientHeight)&&(c=1,k=b(a.pageX,a.pageY))))w.on(f,"mouseup",d),w.on(f,"mousemove",e),g.focus(),k.select()})}function r(a){function b(c){if(f){var g=a.getSelection(),k=g&&g.getType(),j=g&&d.selection;if(c&&j&&k==y.SELECTION_NONE&&!d.queryCommandEnabled("InsertImage"))setTimeout(function(){b(e)},50);else{var l;if(!j||!j.type||!("Control"!=j.type&&(l=j.createRange())&&
(l=l.parentElement())&&(l=l.nodeName)&&l.toLowerCase()in{input:1,textarea:1}))i=j&&g.getRanges()[0],a.checkSelectionChange()}}}var d=a.get("document")[0],g=new v(d.body),c=new v(d.documentElement);if(8>m.Utils.ieEngine)c.on("click",function(b){"html"===(new v(b.target)).nodeName()&&a.getSelection().getNative().createRange().select()});var i,f,k=e;c.on("mousedown",function(){k=l});c.on("mouseup",function(){k=e});g.on("focusin",function(a){if("body"==(new v(a.target)).nodeName()&&i){try{k&&i.select()}catch(b){}i=
n}});g.on("focus",function(){f=e;b()});g.on("beforedeactivate",function(a){a.relatedTarget||(f=l,k=e)});g.on("mousedown",function(){f=l});g.on("mouseup",function(){f=e;setTimeout(function(){b(e)},0)});g.on("keydown",function(){f=l});g.on("keyup",function(){f=e;setTimeout(function(){b()},0)})}function s(a){var b=a.get("document")[0];w.on(b,"mouseup keyup selectionchange",function(){a.checkSelectionChange()})}function g(a){function b(a){var b=m.XHTML_DTD;return a._4e_isBlockBoundary()&&b.$empty[a.nodeName()]}
function d(a){return c(a)&&i(a)}var g=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;|(<\!--[\s\S]*?--\>))?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,c=m.Walker.whitespaces(e),i=m.Walker.bookmark(l,e),f=function(a){return c(a)&&8!=a.nodeType};a.on("selectionChange",function(c){var i=c.path,n=new v(a.get("document")[0].body),c=(c=c.selection)&&c.getRanges()[0],t=i.blockLimit;if(o.gecko){var s=i.block||i.blockLimit,r=s&&s.last(d);s&&s._4e_isBlockBoundary()&&(!r||!(1==r[0].nodeType&&
r._4e_isBlockBoundary()))&&"pre"!=s.nodeName()&&!s._4e_getBogus()&&s._4e_appendBogus()}if(c&&c.collapsed&&!i.block){if("body"==t.nodeName()){if((i=c.fixBlock(e,"p"))&&i[0]!=n[0].lastChild&&i.outerHTML().match(g))if((t=i.next(f,1))&&t[0].nodeType==p.NodeType.ELEMENT_NODE&&!b[t])c.moveToElementEditablePosition(t),i._4e_remove();else if((t=i.prev(f,1))&&t[0].nodeType==p.NodeType.ELEMENT_NODE&&!b[t])c.moveToElementEditablePosition(t,t.outerHTML().match(g)?l:e),i._4e_remove();c.select();a.notifySelectionChange()}i=
a.get("document")[0];c=new m.Range(i);c.moveToElementEditablePosition(n,e);"body"!==(new m.ElementPath(c.startContainer)).blockLimit.nodeName()&&(n=(new v(i.createElement("p"))).appendTo(n),o.ie||n._4e_appendBogus())}})}var e=!0,l=!1,n=null,o=a.UA,w=a.Event,p=a.DOM,v=a.Node,y=m.SELECTION;return{init:function(a){a.docReady(function(){o.ie?(t(a),r(a)):s(a)});g(a)}}},{requires:["./base","./selection"]});
KISSY.add("editor/core/styles",function(a,m){function t(a){return!z.attr(a,"_ke_bookmark")}function r(a,b){for(var c in a)"string"==typeof a[c]?a[c]=a[c].replace(S,function(a,c){return b[c]}):r(a[c],b)}function s(b,c){c&&(b=a.clone(b),r(b,c));var d=this.element=this.element=(b.element||"*").toLowerCase();this.type=this.type="#text"==d||R[d]?E.STYLE_BLOCK:P[d]?E.STYLE_OBJECT:E.STYLE_INLINE;this._={definition:b}}function g(a,b){var c=b?this.removeFromRange:this.applyToRange;a.body.focus();for(var d=
new D(a),e=d.getRanges(),f=0;f<e.length;f++)c.call(this,e[f]);d.selectRanges(e)}function e(a,b,c){var d=a.element;"*"==d&&(d="span");b=new G(b.createElement(d));c&&c._4e_copyAttributes(b);c=a._.definition;a=c.attributes;c=s.getStyleText(c);if(a)for(var e in a)b.attr(e,a[e]);c&&(b[0].style.cssText=c);return b}function l(a){var b=a.createBookmark(k),c=a.createIterator();c.enforceRealBlocks=k;c.enlargeBr=k;for(var d,f=a.document;d=c.getNextParagraph();){var g=e(this,f,d),i=g,g="pre"==i.nodeName,h="pre"==
d.nodeName,j=!g&&h;g&&!h?(h=d,j=h.html(),j=n(j,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,""),j=j.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1"),j=j.replace(/([ \t\n\r]+|&nbsp;)/g," "),j=j.replace(/<br\b[^>]*>/gi,"\n"),L.ie?(h=h[0].ownerDocument.createElement("div"),h.appendChild(i[0]),i[0].outerHTML="<pre>"+j+"</pre>",i=new G(h.firstChild),i._4e_remove()):i.html(j)):j?i=w(o(d),i):d._4e_moveChildren(i);d[0].parentNode.replaceChild(i[0],d[0]);if(g&&(d=i,g=void 0,(g=d._4e_previousSourceNode(k,z.NodeType.ELEMENT_NODE))&&
"pre"==g.nodeName()))i=n(g.html(),/\n$/,"")+"\n\n"+n(d.html(),/^\n/,""),L.ie?d[0].outerHTML="<pre>"+i+"</pre>":d.html(i),g._4e_remove()}a.moveToBookmark(b)}function n(a,b,c){var d="",e="",a=a.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,function(a,b,c){b&&(d=b);c&&(e=c);return""});return d+a.replace(b,c)+e}function o(a){var b=[];n(a.outerHTML(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(a,b,c){return b+"</pre>"+c+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,
function(a,c){b.push(c)});return b}function w(a,b){for(var c=b[0].ownerDocument.createDocumentFragment(),d=0;d<a.length;d++){var e=a[d],e=e.replace(/(\r\n|\r)/g,"\n"),e=n(e,/^[ \t]*\n/,""),e=n(e,/\n$/,""),e=n(e,/^[ \t]+|[ \t]+$/g,function(a,b){return 1==a.length?"&nbsp;":b?" "+Array(a.length).join("&nbsp;"):Array(a.length).join("&nbsp;")+" "}),e=e.replace(/\n/g,"<br>"),e=e.replace(/[ \t]{2,}/g,function(a){return Array(a.length).join("&nbsp;")+" "}),f=b.clone();f.html(e);c.appendChild(f[0])}return c}
function p(a){var b=a.document;if(a.collapsed)b=e(this,b,void 0),a.insertNode(b),a.moveToPosition(b,u.POSITION_BEFORE_END);else{var d=this.element,f=this._.definition,g,i=K[d];i||(g=k,i=K.span);var h=a.createBookmark();a.enlarge(u.ENLARGE_ELEMENT);a.trim();for(var j=a.createBookmark(),l=j.startNode,j=j.endNode,m=l,o;m&&m[0];){var n=q;if(z.equals(m,j))m=A,n=k;else{var p=m[0].nodeType,s=p==z.NodeType.ELEMENT_NODE?m.nodeName():A;if(s&&m.attr("_ke_bookmark")){m=m._4e_nextSourceNode(k);continue}if(!s||
i[s]&&(m._4e_position(j)|x.POSITION_PRECEDING|x.POSITION_IDENTICAL|x.POSITION_IS_CONTAINED)==x.POSITION_PRECEDING+x.POSITION_IDENTICAL+x.POSITION_IS_CONTAINED&&(!f.childRule||f.childRule(m))){var r=m.parent();if(r&&"a"==d&&r.nodeName()==d)p=e(this,b,void 0),r._4e_moveChildren(p),r[0].parentNode.replaceChild(p[0],r[0]),p._4e_mergeSiblings();else if(r&&r[0]&&((K[r.nodeName()]||K.span)[d]||g)&&(!f.parentRule||f.parentRule(r))){if(!o&&(!s||!K.$removeEmpty[s]||(m._4e_position(j)|x.POSITION_PRECEDING|x.POSITION_IDENTICAL|
x.POSITION_IS_CONTAINED)==x.POSITION_PRECEDING+x.POSITION_IDENTICAL+x.POSITION_IS_CONTAINED))o=new O(b),o.setStartBefore(m);if(p==z.NodeType.TEXT_NODE||p==z.NodeType.ELEMENT_NODE&&!m[0].childNodes.length){r=m;for(p=null;(n=!r.next(t,1))&&(p=r.parent())&&i[p.nodeName()]&&(p._4e_position(l)|x.POSITION_FOLLOWING|x.POSITION_IDENTICAL|x.POSITION_IS_CONTAINED)==x.POSITION_FOLLOWING+x.POSITION_IDENTICAL+x.POSITION_IS_CONTAINED&&(!f.childRule||f.childRule(p));)r=p;o.setEndAfter(r)}}else n=k}else n=k;m=m._4e_nextSourceNode()}if(n&&
o&&!o.collapsed){for(var n=e(this,b,void 0),r=o.getCommonAncestor(),p={},s={},w,v=null,y;n&&r&&n[0]&&r[0];){if(r.nodeName()==d){for(w in f.attributes)if(!s[w]&&(y=r.attr(v)))n.attr(w)==y?n.removeAttr(w):s[w]=1;for(v in f.styles)if(!p[v]&&(y=r.style(v)))n.style(v)==y?n.style(v,""):p[v]=1;if(!n._4e_hasAttributes()){n=A;break}}r=r.parent()}n?(n[0].appendChild(o.extractContents()),c(this,n),o.insertNode(n),n._4e_mergeSiblings(),L.ie||n[0].normalize()):(n=new G(b.createElement("span")),n[0].appendChild(o.extractContents()),
o.insertNode(n),c(this,n),n._4e_remove(!0));o=A}}l._4e_remove();j._4e_remove();a.moveToBookmark(h);a.shrink(u.SHRINK_TEXT)}}function v(a){a.enlarge(u.ENLARGE_ELEMENT);var c=a.createBookmark(),e=c.startNode;if(a.collapsed){for(var f=new N(e.parent()),g,h=0,j;h<f.elements.length&&(j=f.elements[h])&&!(j==f.block||j==f.blockLimit);h++)if(this.checkElementRemovable(j)){var k=a.checkBoundaryOfElement(j,u.END),l=!k&&a.checkBoundaryOfElement(j,u.START);l||k?(g=j,g.match=l?"start":"end"):(j._4e_mergeSiblings(),
j.nodeName()!=this.element?(k=b(this),i(j,k[j.nodeName()]||k["*"])):d(this,j))}if(g){j=e;for(h=0;;h++){k=f.elements[h];if(k.equals(g))break;else if(k.match)continue;else k=k.clone();k[0].appendChild(j[0]);j=k}j["start"==g.match?"insertBefore":"insertAfter"](g);f=g.html();!f||"\u200b"==f?g.remove():L.webkit&&C(a.document.createTextNode("\u200b")).insertBefore(j)}}else{var m=c.endNode,n=this;g=function(){for(var a=new N(e.parent()),b=new N(m.parent()),c=A,d=A,f=0;f<a.elements.length;f++){var g=a.elements[f];
if(g==a.block||g==a.blockLimit)break;n.checkElementRemovable(g)&&(c=g)}for(f=0;f<b.elements.length;f++){g=b.elements[f];if(g==b.block||g==b.blockLimit)break;n.checkElementRemovable(g)&&(d=g)}d&&m._4e_breakParent(d);c&&e._4e_breakParent(c)};g();for(f=new G(e[0].nextSibling);f[0]!==m[0];){h=f._4e_nextSourceNode();if(f[0]&&f[0].nodeType==z.NodeType.ELEMENT_NODE&&this.checkElementRemovable(f)&&(f.nodeName()==this.element?d(this,f):(j=b(this),i(f,j[f.nodeName()]||j["*"])),h[0].nodeType==z.NodeType.ELEMENT_NODE&&
h.contains(e)))g(),h=new G(e[0].nextSibling);f=h}}a.moveToBookmark(c)}function y(a){var b={};(""+a).replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(a,c,d){b[c]=d});return b}function h(a,b){var c="";b!==q?(c=document.createElement("span"),c.style.cssText=a,c=c.style.cssText||""):c=a;return c.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function b(b){if(b._.overrides)return b._.overrides;var c=b._.overrides={},d=b._.definition.overrides;
if(d){a.isArray(d)||(d=[d]);for(var e=0;e<d.length;e++){var f=d[e],g,i,h;"string"==typeof f?g=f.toLowerCase():(g=f.element?f.element.toLowerCase():b.element,i=f.attributes,h=f.styles);f=c[g]||(c[g]={});if(i){g=f.attributes=f.attributes||[];for(var j in i)g.push([j.toLowerCase(),i[j]])}if(h){var f=f.styles=f.styles||[],k;for(k in h)f.push([k.toLowerCase(),h[k]])}}}return c}function d(c,d){var e=c._.definition,g=b(c),i=a.merge(e.attributes,(g[d.nodeName()]||g["*"]||{}).attributes),e=a.merge(e.styles,
(g[d.nodeName()]||g["*"]||{}).styles),g=a.isEmptyObject(i)&&a.isEmptyObject(e),h;for(h in i)("class"==h||c._.definition.fullMatch)&&d.attr(h)!=j(h,i[h])||(g=g||!!d.hasAttr(h),d.removeAttr(h));for(var l in e)c._.definition.fullMatch&&d.style(l)!=j(l,e[l],k)||(g=g||!!d.style(l),d.style(l,""));f(d)}function j(a,b,c){var d=new G("<span>");d[c?"style":"attr"](a,b);return d[c?"style":"attr"](a)}function c(a,c){for(var e=b(a),f=c.all(a.element),g=f.length;0<=--g;)d(a,new G(f[g]));for(var h in e)if(h!=a.element){f=
c.all(h);for(g=f.length-1;0<=g;g--){var j=new G(f[g]);i(j,e[h])}}}function i(a,b){var c,d=b&&b.attributes;if(d)for(c=0;c<d.length;c++){var e=d[c][0],g;if(g=a.attr(e)){var h=d[c][1];(h===A||h.test&&h.test(g)||"string"==typeof h&&g==h)&&a[0].removeAttribute(e)}}if(d=b&&b.styles)for(c=0;c<d.length;c++)if(e=d[c][0],h=a.css(e)){var i=d[c][1];(i===A||i.test&&i.test(g)||"string"==typeof i&&h==i)&&a.css(e,"")}f(a)}function f(a){if(!a._4e_hasAttributes()){var b=a[0].firstChild,c=a[0].lastChild;a._4e_remove(k);
b&&(b.nodeType==z.NodeType.ELEMENT_NODE&&z._4e_mergeSiblings(b),c&&b!=c&&c.nodeType==z.NodeType.ELEMENT_NODE&&z._4e_mergeSiblings(c))}}var k=!0,q=!1,A=null,C=a.all,z=a.DOM,E={STYLE_BLOCK:1,STYLE_INLINE:2,STYLE_OBJECT:3},u=m.RANGE,D=m.Selection,x=m.POSITION,O=m.Range,G=a.Node,L=a.UA,N=m.ElementPath,R={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},K=m.XHTML_DTD,P={embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1},Q=/\s*(?:;\s*|$)/g,S=/#\((.+?)\)/g;m.STYLE=
E;s.prototype={constructor:s,apply:function(a){g.call(this,a,q)},remove:function(a){g.call(this,a,k)},applyToRange:function(a){return(this.applyToRange=this.type==E.STYLE_INLINE?p:this.type==E.STYLE_BLOCK?l:A).call(this,a)},removeFromRange:function(a){return(this.removeFromRange=this.type==E.STYLE_INLINE?v:A).call(this,a)},checkElementRemovable:function(a,c){if(!a)return q;var d=this._.definition,e;if(a.nodeName()==this.element){if(!c&&!a._4e_hasAttributes())return k;var f=d._AC;if(f)d=f;else{var f=
{},g=0,i=d.attributes;if(i)for(var j in i)g++,f[j]=i[j];if(i=s.getStyleText(d))f.style||g++,f.style=i;f._length=g;d=d._AC=f}if(d._length){for(var l in d)if("_length"!=l){g=a.attr(l)||"";if("style"==l)a:{f=d[l];g=h(g,q);"string"==typeof f&&(f=y(f));"string"==typeof g&&(g=y(g));i=void 0;for(i in f)if(!(i in g&&(g[i]==f[i]||"inherit"==f[i]||"inherit"==g[i]))){f=q;break a}f=k}else f=d[l]==g;if(f){if(!c)return k}else if(c)return q}if(c)return k}else return k}l=b(this);if(l=l[a.nodeName()]||l["*"]){if(!(d=
l.attributes)&&!(e=l.styles))return k;if(d)for(f=0;f<d.length;f++)if(l=d[f][0],l=a.attr(l))if(g=d[f][1],g===A||"string"==typeof g&&l==g||g.test&&g.test(l))return k;if(e)for(f=0;f<e.length;f++)if(l=a.css(e[f][0]))if(d=e[f][1],d===A||"string"==typeof d&&l==d||d.test&&d.test(l))return k}return q},checkActive:function(a){switch(this.type){case E.STYLE_BLOCK:return this.checkElementRemovable(a.block||a.blockLimit,k);case E.STYLE_OBJECT:case E.STYLE_INLINE:for(var b=a.elements,c=0,d;c<b.length;c++)if(d=
b[c],!(this.type==E.STYLE_INLINE&&(z.equals(d,a.block)||z.equals(d,a.blockLimit))))if((this.type!=E.STYLE_OBJECT||d.nodeName()in P)&&this.checkElementRemovable(d,k))return k}return q}};s.getStyleText=function(a){var b=a._ST;if(b)return b;var b=a.styles,c=a.attributes&&a.attributes.style||"",d="";c.length&&(c=c.replace(Q,";"));for(var e in b){var f=b[e],g=(e+":"+f).replace(Q,";");"inherit"==f?d+=g:c+=g}c.length&&(c=h(c));return a._ST=c+d};return m.Style=s},{requires:["./base","./range","./selection",
"./domIterator","./elementPath"]});
KISSY.add("editor/core/utils",function(a){var m=a.Node,t=a.DOM,r=a.UA,s={debugUrl:function(g){var e=a.Config;e.debug||(g=g.replace(/\.(js|css)/i,"-min.$1"));-1==g.indexOf("?t")&&(g=-1!=g.indexOf("?")?g+"&":g+"?",g+="t="+encodeURIComponent(e.tag));return e.base+"editor/"+g},lazyRun:function(a,e,l){var m=a[e],o=a[l];a[e]=function(){m.apply(this,arguments);a[e]=a[l];return o.apply(this,arguments)}},getXY:function(a,e){var l=a.left,m=a.top,o=e.get("window")[0],l=l-t.scrollLeft(o),m=m-t.scrollTop(o),o=
e.get("iframe").offset(),l=l+o.left,m=m+o.top;return{left:l,top:m}},tryThese:function(a){for(var e,l=0,m=arguments.length;l<m;l++){var o=arguments[l];try{e=o();break}catch(r){}}return e},arrayCompare:function(a,e){if(!a&&!e)return!0;if(!a||!e||a.length!=e.length)return!1;for(var l=0;l<a.length;l++)if(a[l]!==e[l])return!1;return!0},clearAllMarkers:function(a){for(var e in a)a[e]._4e_clearMarkers(a,!0,void 0)},ltrim:function(a){return a.replace(/^\s+/,"")},rtrim:function(a){return a.replace(/\s+$/,
"")},isNumber:function(g){return/^\d+(.\d+)?$/.test(a.trim(g))},verifyInputs:function(g){for(var e=0;e<g.length;e++){var l=new m(g[e]),n=a.trim(s.valInput(l)),o=l.attr("data-verify"),l=l.attr("data-warning");if(o&&!RegExp(o).test(n))return alert(l),!1}return!0},sourceDisable:function(a,e){a.on("sourceMode",e.disable,e);a.on("wysiwygMode",e.enable,e)},resetInput:function(a){var e=a.attr("placeholder");e&&r.ie?(a.addClass("ks-editor-input-tip"),a.val(e)):r.ie||a.val("")},valInput:function(a,e){if(void 0===
e)return a.hasClass("ks-editor-input-tip")?"":a.val();a.removeClass("ks-editor-input-tip");a.val(e)},placeholder:function(g,e){g.attr("placeholder",e);r.ie&&(g.on("blur",function(){a.trim(g.val())||(g.addClass("ks-editor-input-tip"),g.val(e))}),g.on("focus",function(){g.removeClass("ks-editor-input-tip");a.trim(g.val())==e&&g.val("")}))},htmlEncode:function(a){return!a?a:(""+a).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},normParams:function(g){var g=a.clone(g),
e;for(e in g){var l=g[e];a.isFunction(l)&&(g[e]=l())}return g},map:function(a,e){for(var l=0;l<a.length;l++)a[l]=e(a[l]);return a},ieEngine:document.documentMode||r.ie,preventFocus:function(a){r.ie?a.unselectable():a.attr("onmousedown","return false;")},injectDom:function(g){a.mix(t,g);for(var e in g)(function(e){m.prototype[e]=function(){var n=[].slice.call(arguments,0);n.unshift(this[0]);return(n=g[e].apply(null,n))&&(n.nodeType||a.isWindow(n))?new m(n):a.isArray(n)&&(n.__IS_NODELIST||n[0]&&n[0].nodeType)?
new m(n):n}})(e)},addRes:function(){var g=this.__res=this.__res||[];g.push.apply(g,a.makeArray(arguments))},destroyRes:function(){for(var g=this.__res||[],e=0;e<g.length;e++){var l=g[e];a.isFunction(l)?l():l.destroy?l.destroy():l.remove&&l.remove()}this.__res=[]},getQueryCmd:function(a){return"query"+("-"+a).replace(/-(\w)/g,function(a,g){return g.toUpperCase()})+"Value"}};return a.Editor.Utils=s},{requires:["./base"]});
KISSY.add("editor/core/walker",function(a,m){function t(a,b){if(this._.end)return l;var c,i=this.range,f,h=this.guard,m=this.type,n=a?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this._.start&&(this._.start=1,i.trim(),i.collapsed))return this.end(),l;if(!a&&!this._.guardLTR){var r=i.endContainer[0],s=r.childNodes[i.endOffset];this._.guardLTR=function(a,b){return b&&(r==a||"body"==o.nodeName(a))?!1:a!=s}}if(a&&!this._.guardRTL){var t=i.startContainer[0],u=0<i.startOffset&&t.childNodes[i.startOffset-
1]||null;this._.guardRTL=function(a,b){return b&&(t==a||"body"==o.nodeName(a))?!1:a!=u}}var v=a?this._.guardRTL:this._.guardLTR;f=h?function(a,b){return v(a,b)===e?e:h(a,b)}:v;this.current?c=this.current[n](e,m,f):a?(c=i.endContainer,0<i.endOffset?(c=new p(c[0].childNodes[i.endOffset-1]),f(c[0])===e&&(c=l)):c=f(c,g)===e?l:c._4e_previousSourceNode(g,m,f,void 0)):(c=i.startContainer,c=new p(c[0].childNodes[i.startOffset]),c.length?f(c[0])===e&&(c=l):c=f(i.startContainer,g)===e?l:i.startContainer._4e_nextSourceNode(g,
m,f,void 0));for(;c&&!this._.end;){this.current=c;if(!this.evaluator||this.evaluator(c[0])!==e){if(!b)return c}else if(b&&this.evaluator)return e;c=c[n](e,m,f)}this.end();return this.current=l}function r(a){for(var b,c=l;b=t.call(this,a);)c=b;return c}function s(a){this.range=a;this.guard=this.evaluator=l;this._={}}var g=!0,e=!1,l=null,n=a.UA,o=a.DOM,w=m.XHTML_DTD,p=a.Node;a.augment(s,{end:function(){this._.end=1},next:function(){return t.call(this)},previous:function(){return t.call(this,g)},checkForward:function(){return t.call(this,
e,g)!==e},checkBackward:function(){return t.call(this,g,g)!==e},lastForward:function(){return r.call(this)},lastBackward:function(){return r.call(this,g)},reset:function(){delete this.current;this._={}},_iterator:t});a.mix(s,{blockBoundary:function(a){return function(b){return!(b.nodeType==o.NodeType.ELEMENT_NODE&&o._4e_isBlockBoundary(b,a))}},bookmark:function(a,b){function c(a){return"span"==o.nodeName(a)&&o.attr(a,"_ke_bookmark")}return function(e){var f,g;f=e.nodeType==o.NodeType.TEXT_NODE&&(g=
e.parentNode)&&c(g);f=a?f:f||c(e);return!!(b^f)}},whitespaces:function(b){return function(e){e=e.nodeType==o.NodeType.TEXT_NODE&&!a.trim(e.nodeValue);return!!(b^e)}},invisible:function(a){var b=s.whitespaces();return function(c){c=b(c)||c.nodeType==o.NodeType.ELEMENT_NODE&&!c.offsetHeight;return!!(a^c)}}});var v=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,y=s.whitespaces(),h=s.bookmark(),b=function(a){var b=o.nodeName(a);return h(a)||y(a)||1==a.nodeType&&b in w.$inline&&!(b in w.$empty)};m.Utils.injectDom({_4e_getBogus:function(a){a=
new p(a);do a=a._4e_previousSourceNode();while(a&&b(a[0]));return a&&(!n.ie?"br"==a.nodeName():3==a[0].nodeType&&v.test(a.text()))?a[0]:!1}});return m.Walker=s},{requires:["./base","./utils","./dom"]});KISSY.add("editor/core/zIndexManager",function(a){var m=a.Editor,a=m.zIndexManager={BUBBLE_VIEW:1100,POPUP_MENU:1200,STORE_FLASH_SHOW:99999,MAXIMIZE:900,OVERLAY:9999,LOADING:11E3,LOADING_CANCEL:12E3,SELECT:1200};m.baseZIndex=function(a){return(m.Config.baseZIndex||1E4)+a};return a},{requires:["./base"]});
