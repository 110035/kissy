/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Jul 18 22:09
*/
KISSY.add("event/dom/touch/handle-map",function(){return{}});KISSY.add("event/dom/touch/gesture",function(g,c){var e=c.Gesture,a=g.Features,b,h,j,i;a.isTouchEventSupported()?(b="touchstart",h="touchmove",i="touchend",j="touchcancel"):a.isMsPointerSupported()&&(b="MSPointerDown",h="MSPointerMove",i="MSPointerUp",j="MSPointerCancel");b&&(e.start=b,e.move=h,e.end=i,e.cancel=j,e.tap="tap",e.doubleTap="doubleTap",e.singleTouchStart="singleTouchStart");return e},{requires:["event/dom/base"]});
KISSY.add("event/dom/touch/single-touch",function(g){function c(){}c.prototype={constructor:c,requiredTouchCount:1,onTouchStart:function(e){if(e.touches.length!=this.requiredTouchCount)return!1;this.lastTouches=e.touches},onTouchMove:g.noop,onTouchEnd:g.noop};return c});
KISSY.add("event/dom/touch/tap",function(g,c,e,a){function b(i){i.preventDefault()}function h(){h.superclass.constructor.apply(this,arguments)}var j=e.Object;g.extend(h,a,{onTouchMove:function(){return!1},onTouchEnd:function(i){var a=i.changedTouches[0],i=i.target,d=new j({type:"tap",target:i,currentTarget:i});g.mix(d,{pageX:a.pageX,pageY:a.pageY,which:1,touch:a});e.fire(i,"tap",d);if(d.isDefaultPrevented())e.on(i,"click",{fn:b,once:1})}});c.tap={handle:new h};return h},{requires:["./handle-map",
"event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/swipe",function(g,c,e,a){function b(d,f,k){var m=f.changedTouches[0],a=m.pageX-d.startX,b=m.pageY-d.startY,h=Math.abs(a),c=Math.abs(b);if(k)d.isVertical&&d.isHorizontal&&(c>h?d.isHorizontal=0:d.isVertical=0);else if(d.isVertical&&c<l&&(d.isVertical=0),d.isHorizontal&&h<l)d.isHorizontal=0;if(d.isHorizontal)a=0>a?"left":"right";else if(d.isVertical)a=0>b?"up":"down",h=c;else return!1;e.fire(f.target,k?i:j,{originalEvent:f.originalEvent,pageX:m.pageX,pageY:m.pageY,which:1,
touch:m,direction:a,distance:h,duration:(f.timeStamp-d.startTime)/1E3})}function h(){}var j="swipe",i="swiping",l=50;g.extend(h,a,{onTouchStart:function(d){if(!1===h.superclass.onTouchStart.apply(this,arguments))return!1;var f=d.touches[0];this.startTime=d.timeStamp;this.isVertical=this.isHorizontal=1;this.startX=f.pageX;this.startY=f.pageY;-1!=d.type.indexOf("mouse")&&d.preventDefault()},onTouchMove:function(d){var f=d.changedTouches[0],k=f.pageY-this.startY,f=Math.abs(f.pageX-this.startX),k=Math.abs(k);
if(1E3<d.timeStamp-this.startTime)return!1;this.isVertical&&35<f&&(this.isVertical=0);this.isHorizontal&&35<k&&(this.isHorizontal=0);return b(this,d,1)},onTouchEnd:function(d){return!1===this.onTouchMove(d)?!1:b(this,d,0)}});c[j]=c[i]={handle:new h};return h},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/double-tap",function(g,c,e,a){function b(){}g.extend(b,a,{onTouchStart:function(a){if(!1===b.superclass.onTouchStart.apply(this,arguments))return!1;this.startTime=a.timeStamp;this.singleTapTimer&&(clearTimeout(this.singleTapTimer),this.singleTapTimer=0)},onTouchMove:function(){return!1},onTouchEnd:function(a){var b=this.lastEndTime,i=a.timeStamp,c=a.target,d=a.changedTouches[0],f=i-this.startTime;this.lastEndTime=i;if(b&&(f=i-b,300>f)){this.lastEndTime=0;e.fire(c,"doubleTap",
{touch:d,duration:f/1E3});return}f=i-this.startTime;300<f?e.fire(c,"singleTap",{touch:d,pageX:d.pageX,which:1,pageY:d.pageY,duration:f/1E3}):this.singleTapTimer=setTimeout(function(){e.fire(c,"singleTap",{touch:d,pageX:d.pageX,which:1,pageY:d.pageY,duration:f/1E3})},300)}});c.singleTap=c.doubleTap={handle:new b};return b},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/multi-touch",function(g,c){function e(){}e.prototype={constructor:e,requiredTouchCount:2,onTouchStart:function(a){var b=this.requiredTouchCount,c=a.touches.length;c===b?this.start():c>b&&this.end(a)},onTouchEnd:function(a){this.end(a)},start:function(){this.isTracking||(this.isTracking=!0,this.isStarted=!1)},fireEnd:g.noop,getCommonTarget:function(a){var b=a.touches,a=b[0].target,b=b[1].target;if(a==b||c.contains(a,b))return a;for(;;){if(c.contains(b,a))return b;b=b.parentNode}},
end:function(a){this.isTracking&&(this.isTracking=!1,this.isStarted&&(this.isStarted=!1,this.fireEnd(a)))}};return e},{requires:["dom"]});
KISSY.add("event/dom/touch/pinch",function(g,c,e,a,b){function h(){}function j(a){(!a.touches||2==a.touches.length)&&a.preventDefault()}g.extend(h,a,{onTouchMove:function(a){if(this.isTracking){var b=a.touches,d,f=b[0],k=b[1];d=f.pageX-k.pageX;f=f.pageY-k.pageY;d=Math.sqrt(d*d+f*f);this.lastTouches=b;this.isStarted?e.fire(this.target,"pinch",g.mix(a,{distance:d,scale:d/this.startDistance})):(this.isStarted=!0,this.startDistance=d,b=this.target=this.getCommonTarget(a),e.fire(b,"pinchStart",g.mix(a,
{distance:d,scale:1})))}},fireEnd:function(a){e.fire(this.target,"pinchEnd",g.mix(a,{touches:this.lastTouches}))}});a=new h;c.pinchStart=c.pinchEnd={handle:a};c.pinch={handle:a,add:function(){e.on(this,b.move,j)},remove:function(){e.detach(this,b.move,j)}};return h},{requires:["./handle-map","event/dom/base","./multi-touch","./gesture"]});
KISSY.add("event/dom/touch/tap-hold",function(g,c,e,a,b){function h(){}function j(a){(!a.touches||1==a.touches.length)&&a.preventDefault()}g.extend(h,e,{onTouchStart:function(b){if(!1===h.superclass.onTouchStart.call(this,b))return!1;this.timer=setTimeout(function(){var c=b.touches[0];a.fire(b.target,"tapHold",{touch:c,pageX:c.pageX,pageY:c.pageY,which:1,duration:(g.now()-b.timeStamp)/1E3})},1E3)},onTouchMove:function(){clearTimeout(this.timer);return!1},onTouchEnd:function(){clearTimeout(this.timer)}});
c.tapHold={setup:function(){a.on(this,b.start,j)},tearDown:function(){a.detach(this,b.start,j)},handle:new h};return h},{requires:["./handle-map","./single-touch","event/dom/base","./gesture"]});
KISSY.add("event/dom/touch/rotate",function(g,c,e,a,b,h){function j(){}function i(a){(!a.touches||2==a.touches.length)&&a.preventDefault()}var l=180/Math.PI;g.extend(j,e,{onTouchMove:function(b){if(this.isTracking){var f=b.touches,k=f[0],c=f[1],e=this.lastAngle,k=Math.atan2(c.pageY-k.pageY,c.pageX-k.pageX)*l;if(e!==h){var c=Math.abs(k-e),j=(k+360)%360,i=(k-360)%360;Math.abs(j-e)<c?k=j:Math.abs(i-e)<c&&(k=i)}this.lastTouches=f;this.lastAngle=k;this.isStarted?a.fire(this.target,"rotate",g.mix(b,{angle:k,
rotation:k-this.startAngle})):(this.isStarted=!0,this.startAngle=k,this.target=this.getCommonTarget(b),a.fire(this.target,"rotateStart",g.mix(b,{angle:k,rotation:0})))}},end:function(){this.lastAngle=h;j.superclass.end.apply(this,arguments)},fireEnd:function(b){a.fire(this.target,"rotateEnd",g.mix(b,{touches:this.lastTouches}))}});e=new j;c.rotateEnd=c.rotateStart={handle:e};c.rotate={handle:e,add:function(){a.on(this,b.move,i)},remove:function(){a.detach(this,b.move,i)}};return j},{requires:["./handle-map",
"./multi-touch","event/dom/base","./gesture"]});KISSY.add("event/dom/touch/single-touch-start",function(g,c,e,a){function b(){}g.extend(b,a,{onTouchStart:function(a){if(!1!==b.superclass.onTouchStart.apply(this,arguments)){var c=a.touches[0];e.fire(a.target,"singleTouchStart",{touch:c[0],pageX:c.pageX,pageY:c.pageY,which:1,touches:a.touches})}else return!1}});c.singleTouchStart={handle:new b};return b},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/handle",function(g,c,e,a,b){function h(f){this.doc=f;this.eventHandle={};this.init();this.touches=[]}var j=g.guid("touch-handle"),i=g.Features,l=i.isMsPointerSupported(),d={};d[b.start]="onTouchStart";d[b.move]="onTouchMove";d[b.end]="onTouchEnd";b.cancel&&(d[b.cancel]="onTouchEnd");h.prototype={constructor:h,addTouch:function(f){this.touches.push(f)},removeTouch:function(f){var a=this.touches;g.each(a,function(b,c){if(b.pointerId==f.pointerId)return a.splice(c,1),!1})},
updateTouch:function(f){var a=this.touches;g.each(a,function(b,c){if(b.pointerId==f.pointerId)return a[c]=f,!1})},init:function(){var f=this.doc,b,c;for(b in d)c=d[b],a.on(f,b,this[c],this)},normalize:function(a){var b=a.type,c;if(i.isTouchEventSupported())return c="touchend"==b||"touchcancel"==b?a.changedTouches:a.touches,1==c.length&&(a.which=1,a.pageX=c.pageX,a.pageY=c.pageY),a;if(l)c=this.touches;else{if(-1!=b.indexOf("mouse")&&1!=a.which)return;c=[a]}b=!b.match(/(up|cancel)$/i);a.touches=b?c:
[];a.targetTouches=b?c:[];a.changedTouches=c;return a},onTouchMove:function(a){l&&this.updateTouch(a.originalEvent);this.callEventHandle("onTouchMove",a)},onTouchStart:function(a){var b,c,d=this.eventHandle;for(b in d)c=d[b].handle,c.isActive=1;l&&this.addTouch(a.originalEvent);this.callEventHandle("onTouchStart",a)},onTouchEnd:function(a){this.callEventHandle("onTouchEnd",a);l&&this.removeTouch(a.originalEvent)},callEventHandle:function(a,b){var c=this.eventHandle,d,e;if(b=this.normalize(b)){for(d in c)e=
c[d].handle,e.processed||(e.processed=1,e.isActive&&!1===e[a](b)&&(e.isActive=0));for(d in c)e=c[d].handle,e.processed=0}},addEventHandle:function(a){var b=this.eventHandle,c=e[a].handle;b[a]?b[a].count++:b[a]={count:1,handle:c}},removeEventHandle:function(a){var b=this.eventHandle;b[a]&&(b[a].count--,b[a].count||delete b[a])},destroy:function(){var b=this.doc,c,e;for(c in d)e=d[c],a.detach(b,c,this[e],this)}};return{addDocumentHandle:function(a,b){var d=c.getDocument(a),e=c.data(d,j);e||c.data(d,
j,e=new h(d));e.addEventHandle(b)},removeDocumentHandle:function(a,b){var d=c.getDocument(a),e=c.data(d,j);e&&(e.removeEventHandle(b),g.isEmptyObject(e.eventHandle)&&(e.destroy(),c.removeData(d,j)))}}},{requires:"dom,./handle-map,event/dom/base,./gesture,./tap,./swipe,./double-tap,./pinch,./tap-hold,./rotate,./single-touch-start".split(",")});
KISSY.add("event/dom/touch",function(g,c,e,a){function b(a){h.call(this,a);e[a].setup.apply(this,arguments)}function h(b){var c=this.style;l.isMsPointerSupported()&&c&&(this.__ks_touch_action||(this.__ks_touch_action=c.msTouchAction,this.__ks_user_select=c.msUserSelect,c.msTouchAction=c.msUserSelect="none"),this.__ks_touch_action_count?this.__ks_touch_action_count++:this.__ks_touch_action_count=1);a.addDocumentHandle(this,b)}function j(a){i.call(this,a);e[a].tearDown.apply(this,arguments)}function i(b){var c=
this.style;l.isMsPointerSupported()&&c&&(this.__ks_touch_action_count--,this.__ks_touch_action_count||(c.msUserSelect=this.__ks_user_select,c.msTouchAction=this.__ks_touch_action,this.__ks_touch_action=""));a.removeDocumentHandle(this,b)}var l=g.Features,g=c.Special,d,f;for(d in e)c={},f=e[d],c.setup=f.setup?b:h,c.tearDown=f.tearDown?j:i,f.add&&(c.add=f.add),f.remove&&(c.remove=f.remove),g[d]=c},{requires:["event/dom/base","./touch/handle-map","./touch/handle"]});
