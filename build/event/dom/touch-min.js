/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Jul 15 14:21
*/
KISSY.add("event/dom/touch/handle-map",function(){return{}});KISSY.add("event/dom/touch/gesture",function(g,c){var d=c.Gesture,a=g.Features,b,h,j,i;a.isTouchEventSupported()?(b="touchstart",h="touchmove",i="touchend",j="touchcancel"):a.isMsPointerSupported()&&(b="MSPointerDown",h="MSPointerMove",i="MSPointerUp",j="MSPointerCancel");b&&(d.start=b,d.move=h,d.end=i,d.cancel=j,d.tap="tap",d.doubleTap="doubleTap",d.singleTouchStart="singleTouchStart");return d},{requires:["event/dom/base"]});
KISSY.add("event/dom/touch/single-touch",function(g){function c(){}c.prototype={constructor:c,requiredTouchCount:1,onTouchStart:function(d){if(d.touches.length!=this.requiredTouchCount)return!1;this.lastTouches=d.touches},onTouchMove:g.noop,onTouchEnd:g.noop};return c});
KISSY.add("event/dom/touch/tap",function(g,c,d,a){function b(i){i.preventDefault()}function h(){h.superclass.constructor.apply(this,arguments)}var j=d.Object;g.extend(h,a,{onTouchMove:function(){return!1},onTouchEnd:function(i){var a=i.changedTouches[0],i=i.target,a=new j({type:"tap",pageX:a.pageX,pageY:a.pageY,which:1,touch:a,target:i,currentTarget:i});d.fire(i,"tap",a);if(a.isDefaultPrevented())d.on(i,"click",{fn:b,once:1})}});c.tap={handle:new h};return h},{requires:["./handle-map","event/dom/base",
"./single-touch"]});
KISSY.add("event/dom/touch/swipe",function(g,c,d,a){function b(e,f,k){var m=f.changedTouches[0],a=m.pageX-e.startX,b=m.pageY-e.startY,h=Math.abs(a),c=Math.abs(b);if(k)e.isVertical&&e.isHorizontal&&(c>h?e.isHorizontal=0:e.isVertical=0);else if(e.isVertical&&c<l&&(e.isVertical=0),e.isHorizontal&&h<l)e.isHorizontal=0;if(e.isHorizontal)a=0>a?"left":"right";else if(e.isVertical)a=0>b?"up":"down",h=c;else return!1;d.fire(f.target,k?i:j,{originalEvent:f.originalEvent,pageX:m.pageX,pageY:m.pageY,which:1,
touch:m,direction:a,distance:h,duration:(f.timeStamp-e.startTime)/1E3})}function h(){}var j="swipe",i="swiping",l=50;g.extend(h,a,{onTouchStart:function(e){if(!1===h.superclass.onTouchStart.apply(this,arguments))return!1;var f=e.touches[0];this.startTime=e.timeStamp;this.isVertical=this.isHorizontal=1;this.startX=f.pageX;this.startY=f.pageY;-1!=e.type.indexOf("mouse")&&e.preventDefault()},onTouchMove:function(e){var f=e.changedTouches[0],k=f.pageY-this.startY,f=Math.abs(f.pageX-this.startX),k=Math.abs(k);
if(1E3<e.timeStamp-this.startTime)return!1;this.isVertical&&35<f&&(this.isVertical=0);this.isHorizontal&&35<k&&(this.isHorizontal=0);return b(this,e,1)},onTouchEnd:function(e){return!1===this.onTouchMove(e)?!1:b(this,e,0)}});c[j]=c[i]={handle:new h};return h},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/double-tap",function(g,c,d,a){function b(){}g.extend(b,a,{onTouchStart:function(a){if(!1===b.superclass.onTouchStart.apply(this,arguments))return!1;this.startTime=a.timeStamp;this.singleTapTimer&&(clearTimeout(this.singleTapTimer),this.singleTapTimer=0)},onTouchMove:function(){return!1},onTouchEnd:function(a){var b=this.lastEndTime,i=a.timeStamp,c=a.target,e=a.changedTouches[0],f=i-this.startTime;this.lastEndTime=i;if(b&&(f=i-b,300>f)){this.lastEndTime=0;d.fire(c,"doubleTap",
{touch:e,duration:f/1E3});return}f=i-this.startTime;300<f?d.fire(c,"singleTap",{touch:e,pageX:e.pageX,which:1,pageY:e.pageY,duration:f/1E3}):this.singleTapTimer=setTimeout(function(){d.fire(c,"singleTap",{touch:e,pageX:e.pageX,which:1,pageY:e.pageY,duration:f/1E3})},300)}});c.singleTap=c.doubleTap={handle:new b};return b},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/multi-touch",function(g,c){function d(){}d.prototype={constructor:d,requiredTouchCount:2,onTouchStart:function(a){var b=this.requiredTouchCount,c=a.touches.length;c===b?this.start():c>b&&this.end(a)},onTouchEnd:function(a){this.end(a)},start:function(){this.isTracking||(this.isTracking=!0,this.isStarted=!1)},fireEnd:g.noop,getCommonTarget:function(a){var b=a.touches,a=b[0].target,b=b[1].target;if(a==b||c.contains(a,b))return a;for(;;){if(c.contains(b,a))return b;b=b.parentNode}},
end:function(a){this.isTracking&&(this.isTracking=!1,this.isStarted&&(this.isStarted=!1,this.fireEnd(a)))}};return d},{requires:["dom"]});
KISSY.add("event/dom/touch/pinch",function(g,c,d,a,b){function h(){}function j(a){(!a.touches||2==a.touches.length)&&a.preventDefault()}g.extend(h,a,{onTouchMove:function(a){if(this.isTracking){var b=a.touches,e,f=b[0],k=b[1];e=f.pageX-k.pageX;f=f.pageY-k.pageY;e=Math.sqrt(e*e+f*f);this.lastTouches=b;this.isStarted?d.fire(this.target,"pinch",g.mix(a,{distance:e,scale:e/this.startDistance})):(this.isStarted=!0,this.startDistance=e,b=this.target=this.getCommonTarget(a),d.fire(b,"pinchStart",g.mix(a,
{distance:e,scale:1})))}},fireEnd:function(a){d.fire(this.target,"pinchEnd",g.mix(a,{touches:this.lastTouches}))}});a=new h;c.pinchStart=c.pinchEnd={handle:a};c.pinch={handle:a,add:function(){d.on(this,b.move,j)},remove:function(){d.detach(this,b.move,j)}};return h},{requires:["./handle-map","event/dom/base","./multi-touch","./gesture"]});
KISSY.add("event/dom/touch/tap-hold",function(g,c,d,a,b){function h(){}function j(a){(!a.touches||1==a.touches.length)&&a.preventDefault()}g.extend(h,d,{onTouchStart:function(b){if(!1===h.superclass.onTouchStart.call(this,b))return!1;this.timer=setTimeout(function(){var c=b.touches[0];a.fire(b.target,"tapHold",{touch:c,pageX:c.pageX,pageY:c.pageY,which:1,duration:(g.now()-b.timeStamp)/1E3})},1E3)},onTouchMove:function(){clearTimeout(this.timer);return!1},onTouchEnd:function(){clearTimeout(this.timer)}});
c.tapHold={setup:function(){a.on(this,b.start,j)},tearDown:function(){a.detach(this,b.start,j)},handle:new h};return h},{requires:["./handle-map","./single-touch","event/dom/base","./gesture"]});
KISSY.add("event/dom/touch/rotate",function(g,c,d,a,b,h){function j(){}function i(a){(!a.touches||2==a.touches.length)&&a.preventDefault()}var l=180/Math.PI;g.extend(j,d,{onTouchMove:function(b){if(this.isTracking){var f=b.touches,k=f[0],c=f[1],d=this.lastAngle,k=Math.atan2(c.pageY-k.pageY,c.pageX-k.pageX)*l;if(d!==h){var c=Math.abs(k-d),j=(k+360)%360,i=(k-360)%360;Math.abs(j-d)<c?k=j:Math.abs(i-d)<c&&(k=i)}this.lastTouches=f;this.lastAngle=k;this.isStarted?a.fire(this.target,"rotate",g.mix(b,{angle:k,
rotation:k-this.startAngle})):(this.isStarted=!0,this.startAngle=k,this.target=this.getCommonTarget(b),a.fire(this.target,"rotateStart",g.mix(b,{angle:k,rotation:0})))}},end:function(){this.lastAngle=h;j.superclass.end.apply(this,arguments)},fireEnd:function(b){a.fire(this.target,"rotateEnd",g.mix(b,{touches:this.lastTouches}))}});d=new j;c.rotateEnd=c.rotateStart={handle:d};c.rotate={handle:d,add:function(){a.on(this,b.move,i)},remove:function(){a.detach(this,b.move,i)}};return j},{requires:["./handle-map",
"./multi-touch","event/dom/base","./gesture"]});KISSY.add("event/dom/touch/single-touch-start",function(g,c,d,a){function b(){}g.extend(b,a,{onTouchStart:function(a){if(!1!==b.superclass.onTouchStart.apply(this,arguments)){var c=a.touches[0];d.fire(a.target,"singleTouchStart",{touch:c[0],pageX:c.pageX,pageY:c.pageY,which:1,touches:a.touches})}else return!1}});c.singleTouchStart={handle:new b};return b},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/handle",function(g,c,d,a,b){function h(f){this.doc=f;this.eventHandle={};this.init();this.touches=[]}var j=g.guid("touch-handle"),i=g.Features,l=i.isMsPointerSupported(),e={};e[b.start]="onTouchStart";e[b.move]="onTouchMove";e[b.end]="onTouchEnd";b.cancel&&(e[b.cancel]="onTouchEnd");h.prototype={constructor:h,addTouch:function(f){this.touches.push(f)},removeTouch:function(f){var a=this.touches;g.each(a,function(b,c){if(b.pointerId==f.pointerId)return a.splice(c,1),!1})},
updateTouch:function(a){var b=this.touches;g.each(b,function(c,e){if(c.pointerId==a.pointerId)return b[e]=a,!1})},init:function(){var f=this.doc,b,c;for(b in e)c=e[b],a.on(f,b,this[c],this)},normalize:function(a){var b=a.type,c;if(i.isTouchEventSupported())return c="touchend"==b||"touchcancel"==b?a.changedTouches:a.touches,1==c.length&&(a.which=1,a.pageX=c.pageX,a.pageY=c.pageY),a;if(l)c=this.touches;else{if(-1!=b.indexOf("mouse")&&1!=a.which)return;c=[a]}b=!b.match(/(up|cancel)$/i);a.touches=b?c:
[];a.targetTouches=b?c:[];a.changedTouches=c;return a},onTouchMove:function(a){l&&this.updateTouch(a.originalEvent);this.callEventHandle("onTouchMove",a)},onTouchStart:function(a){var b,c,e=this.eventHandle;for(b in e)c=e[b].handle,c.isActive=1;l&&this.addTouch(a.originalEvent);this.callEventHandle("onTouchStart",a)},onTouchEnd:function(a){this.callEventHandle("onTouchEnd",a);l&&this.removeTouch(a.originalEvent)},callEventHandle:function(a,b){var c=this.eventHandle,e,d;if(b=this.normalize(b)){for(e in c)d=
c[e].handle,d.processed||(d.processed=1,d.isActive&&!1===d[a](b)&&(d.isActive=0));for(e in c)d=c[e].handle,d.processed=0}},addEventHandle:function(a){var b=this.eventHandle,c=d[a].handle;b[a]?b[a].count++:b[a]={count:1,handle:c}},removeEventHandle:function(a){var b=this.eventHandle;b[a]&&(b[a].count--,b[a].count||delete b[a])},destroy:function(){var b=this.doc,c,d;for(c in e)d=e[c],a.detach(b,c,this[d],this)}};return{addDocumentHandle:function(a,b){var e=c.getDocument(a),d=c.data(e,j);d||c.data(e,
j,d=new h(e));d.addEventHandle(b)},removeDocumentHandle:function(a,b){var e=c.getDocument(a),d=c.data(e,j);d&&(d.removeEventHandle(b),g.isEmptyObject(d.eventHandle)&&(d.destroy(),c.removeData(e,j)))}}},{requires:"dom,./handle-map,event/dom/base,./gesture,./tap,./swipe,./double-tap,./pinch,./tap-hold,./rotate,./single-touch-start".split(",")});
KISSY.add("event/dom/touch",function(g,c,d,a){function b(a){h.call(this,a);d[a].setup.apply(this,arguments)}function h(b){var c=this.style;l.isMsPointerSupported()&&c&&(this.__ks_touch_action||(this.__ks_touch_action=c.msTouchAction,this.__ks_user_select=c.msUserSelect,c.msTouchAction=c.msUserSelect="none"),this.__ks_touch_action_count?this.__ks_touch_action_count++:this.__ks_touch_action_count=1);a.addDocumentHandle(this,b)}function j(a){i.call(this,a);d[a].tearDown.apply(this,arguments)}function i(b){var c=
this.style;l.isMsPointerSupported()&&c&&(this.__ks_touch_action_count--,this.__ks_touch_action_count||(c.msUserSelect=this.__ks_user_select,c.msTouchAction=this.__ks_touch_action,this.__ks_touch_action=""));a.removeDocumentHandle(this,b)}var l=g.Features,g=c.Special,e,f;for(e in d)c={},f=d[e],c.setup=f.setup?b:h,c.tearDown=f.tearDown?j:i,f.add&&(c.add=f.add),f.remove&&(c.remove=f.remove),g[e]=c},{requires:["event/dom/base","./touch/handle-map","./touch/handle"]});
