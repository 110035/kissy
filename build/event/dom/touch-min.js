/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: May 30 01:42
*/
KISSY.add("event/dom/touch/handle-map",function(){return{}});KISSY.add("event/dom/touch/gesture",function(f,a){var e=a.Gesture,b,c,g;f.Features.isTouchSupported()&&(b="touchstart",c="touchmove",g="touchend");b&&(e.start=b,e.move=c,e.end=g,e.tap="tap",e.doubleTap="doubleTap");return e},{requires:["event/dom/base"]});
KISSY.add("event/dom/touch/single-touch",function(f){function a(){}a.prototype={constructor:a,requiredTouchCount:1,onTouchStart:function(a){if(a.touches.length!=this.requiredTouchCount)return!1;this.lastTouches=a.touches},onTouchMove:f.noop,onTouchEnd:f.noop};return a});
KISSY.add("event/dom/touch/tap",function(f,a,e,b){function c(){}f.extend(c,b,{onTouchMove:function(){return!1},onTouchEnd:function(b){e.fire(b.target,"tap",{touch:b.changedTouches[0]})}});a.tap={handle:new c};return c},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/swipe",function(f,a,e,b){function c(d,h,b){var c=h.changedTouches[0],a=c.pageX-d.startX,g=c.pageY-d.startY,f=Math.abs(a),l=Math.abs(g);if(b)d.isVertical&&d.isHorizontal&&(l>f?d.isHorizontal=0:d.isVertical=0);else if(d.isVertical&&l<j&&(d.isVertical=0),d.isHorizontal&&f<j)d.isHorizontal=0;if(d.isHorizontal)a=0>a?"left":"right";else if(d.isVertical)a=0>g?"up":"down",f=l;else return!1;e.fire(h.target,b?k:i,{originalEvent:h.originalEvent,touch:c,direction:a,distance:f,duration:(h.timeStamp-
d.startTime)/1E3})}function g(){}var i="swipe",k="swiping",j=50;f.extend(g,b,{onTouchStart:function(d){if(!1===g.superclass.onTouchStart.apply(this,arguments))return!1;var h=d.touches[0];this.startTime=d.timeStamp;this.isVertical=this.isHorizontal=1;this.startX=h.pageX;this.startY=h.pageY;-1!=d.type.indexOf("mouse")&&d.preventDefault()},onTouchMove:function(d){var h=d.changedTouches[0],b=h.pageY-this.startY,h=Math.abs(h.pageX-this.startX),b=Math.abs(b);if(1E3<d.timeStamp-this.startTime)return!1;this.isVertical&&
35<h&&(this.isVertical=0);this.isHorizontal&&35<b&&(this.isHorizontal=0);return c(this,d,1)},onTouchEnd:function(d){return!1===this.onTouchMove(d)?!1:c(this,d,0)}});a[i]=a[k]={handle:new g};return g},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/double-tap",function(f,a,e,b){function c(){}f.extend(c,b,{onTouchStart:function(b){if(!1===c.superclass.onTouchStart.apply(this,arguments))return!1;this.startTime=b.timeStamp;this.singleTapTimer&&(clearTimeout(this.singleTapTimer),this.singleTapTimer=0)},onTouchMove:function(){return!1},onTouchEnd:function(b){var a=this.lastEndTime,c=b.timeStamp,f=b.target,d=b.changedTouches[0],h=c-this.startTime;this.lastEndTime=c;if(a&&(h=c-a,300>h)){this.lastEndTime=0;e.fire(f,"doubleTap",
{touch:d,duration:h/1E3});return}h=c-this.startTime;300<h?e.fire(f,"singleTap",{touch:d,duration:h/1E3}):this.singleTapTimer=setTimeout(function(){e.fire(f,"singleTap",{touch:d,duration:h/1E3})},300)}});a.singleTap=a.doubleTap={handle:new c};return c},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/multi-touch",function(f,a){function e(){}e.prototype={constructor:e,requiredTouchCount:2,onTouchStart:function(b){var c=this.requiredTouchCount,a=b.touches.length;a===c?this.start():a>c&&this.end(b)},onTouchEnd:function(b){this.end(b)},start:function(){this.isTracking||(this.isTracking=!0,this.isStarted=!1)},fireEnd:f.noop,getCommonTarget:function(b){var c=b.touches,b=c[0].target,c=c[1].target;if(b==c||a.contains(b,c))return b;for(;;){if(a.contains(c,b))return c;c=c.parentNode}},
end:function(b){this.isTracking&&(this.isTracking=!1,this.isStarted&&(this.isStarted=!1,this.fireEnd(b)))}};return e},{requires:["dom"]});
KISSY.add("event/dom/touch/pinch",function(f,a,e,b,c){function g(){}function i(b){(!b.touches||2==b.touches.length)&&b.preventDefault()}f.extend(g,b,{onTouchMove:function(b){if(this.isTracking){var a=b.touches,d,h=a[0],c=a[1];d=h.pageX-c.pageX;h=h.pageY-c.pageY;d=Math.sqrt(d*d+h*h);this.lastTouches=a;this.isStarted?e.fire(this.target,"pinch",f.mix(b,{distance:d,scale:d/this.startDistance})):(this.isStarted=!0,this.startDistance=d,a=this.target=this.getCommonTarget(b),e.fire(a,"pinchStart",f.mix(b,
{distance:d,scale:1})))}},fireEnd:function(b){e.fire(this.target,"pinchEnd",f.mix(b,{touches:this.lastTouches}))}});b=new g;a.pinchStart=a.pinchEnd={handle:b};a.pinch={handle:b,add:function(){e.on(this,c.move,i)},remove:function(){e.detach(this,c.move,i)}};return g},{requires:["./handle-map","event/dom/base","./multi-touch","./gesture"]});
KISSY.add("event/dom/touch/tap-hold",function(f,a,e,b,c){function g(){}function i(b){(!b.touches||1==b.touches.length)&&b.preventDefault()}f.extend(g,e,{onTouchStart:function(a){if(!1===g.superclass.onTouchStart.call(this,a))return!1;this.timer=setTimeout(function(){b.fire(a.target,"tapHold",{touch:a.touches[0],duration:(f.now()-a.timeStamp)/1E3})},1E3)},onTouchMove:function(){clearTimeout(this.timer);return!1},onTouchEnd:function(){clearTimeout(this.timer)}});a.tapHold={setup:function(){b.on(this,
c.start,i)},tearDown:function(){b.detach(this,c.start,i)},handle:new g};return g},{requires:["./handle-map","./single-touch","event/dom/base","./gesture"]});
KISSY.add("event/dom/touch/rotate",function(f,a,e,b,c,g){function i(){}function k(d){(!d.touches||2==d.touches.length)&&d.preventDefault()}var j=180/Math.PI;f.extend(i,e,{onTouchMove:function(d){if(this.isTracking){var h=d.touches,a=h[0],c=h[1],e=this.lastAngle,a=Math.atan2(c.pageY-a.pageY,c.pageX-a.pageX)*j;if(e!==g){var c=Math.abs(a-e),i=(a+360)%360,k=(a-360)%360;Math.abs(i-e)<c?a=i:Math.abs(k-e)<c&&(a=k)}this.lastTouches=h;this.lastAngle=a;this.isStarted?b.fire(this.target,"rotate",f.mix(d,{angle:a,
rotation:a-this.startAngle})):(this.isStarted=!0,this.startAngle=a,this.target=this.getCommonTarget(d),b.fire(this.target,"rotateStart",f.mix(d,{angle:a,rotation:0})))}},end:function(){this.lastAngle=g;i.superclass.end.apply(this,arguments)},fireEnd:function(d){b.fire(this.target,"rotateEnd",f.mix(d,{touches:this.lastTouches}))}});e=new i;a.rotateEnd=a.rotateStart={handle:e};a.rotate={handle:e,add:function(){b.on(this,c.move,k)},remove:function(){b.detach(this,c.move,k)}};return i},{requires:["./handle-map",
"./multi-touch","event/dom/base","./gesture"]});KISSY.add("event/dom/touch/single-touch-start",function(f,a,e,b){function c(){}f.extend(c,b,{onTouchStart:function(a){if(!1!==c.superclass.onTouchStart.apply(this,arguments))e.fire(a.target,"singleTouchStart",{touch:a.touches[0],touches:a.touches});else return!1}});a.singleTouchStart={handle:new c};return c},{requires:["./handle-map","event/dom/base","./single-touch"]});
KISSY.add("event/dom/touch/handle",function(f,a,e,b,c){function g(d){this.doc=d;this.eventHandle={};this.init()}var i=f.guid("touch-handle"),k=f.Features,j={};j[c.start]="onTouchStart";j[c.move]="onTouchMove";j[c.end]="onTouchEnd";j.touchcancel="onTouchEnd";g.prototype={constructor:g,init:function(){var d=this.doc,a,c;for(a in j)c=j[a],b.on(d,a,this[c],this)},normalize:function(d){var a=d.type,b;if(!k.isTouchSupported()){if(-1!=a.indexOf("mouse")&&1!=d.which)return;b=[d];a=!a.match(/up$/i);d.touches=
a?b:[];d.targetTouches=a?b:[];d.changedTouches=b}return d},onTouchMove:function(a){this.callEventHandle("onTouchMove",a)},onTouchStart:function(a){var b,c,e=this.eventHandle;for(b in e)c=e[b].handle,c.isActive=1;this.callEventHandle("onTouchStart",a)},onTouchEnd:function(a){this.callEventHandle("onTouchEnd",a)},callEventHandle:function(a,b){var c=this.eventHandle,e,f;if(b=this.normalize(b)){for(e in c)f=c[e].handle,f.processed||(f.processed=1,f.isActive&&!1===f[a](b)&&(f.isActive=0));for(e in c)f=
c[e].handle,f.processed=0}},addEventHandle:function(a){var b=this.eventHandle,c=e[a].handle;b[a]?b[a].count++:b[a]={count:1,handle:c}},removeEventHandle:function(a){var b=this.eventHandle;b[a]&&(b[a].count--,b[a].count||delete b[a])},destroy:function(){var a=this.doc,c,e;for(c in j)e=j[c],b.detach(a,c,this[e],this)}};return{addDocumentHandle:function(b,c){var e=a.getWindow(b.ownerDocument||b).document,f=a.data(e,i);f||a.data(e,i,f=new g(e));f.addEventHandle(c)},removeDocumentHandle:function(b,c){var e=
a.getWindow(b.ownerDocument||b).document,g=a.data(e,i);g&&(g.removeEventHandle(c),f.isEmptyObject(g.eventHandle)&&(g.destroy(),a.removeData(e,i)))}}},{requires:"dom,./handle-map,event/dom/base,./gesture,./tap,./swipe,./double-tap,./pinch,./tap-hold,./rotate,./single-touch-start".split(",")});
KISSY.add("event/dom/touch",function(f,a,e,b){function c(a){b.addDocumentHandle(this,a);e[a].setup.apply(this,arguments)}function g(a){b.addDocumentHandle(this,a)}function i(a){b.removeDocumentHandle(this,a);e[a].tearDown.apply(this,arguments)}function k(a){b.removeDocumentHandle(this,a)}var f=a._Special,j,d;for(j in e)a={},d=e[j],a.setup=d.setup?c:g,a.tearDown=d.tearDown?i:k,d.add&&(a.add=d.add),d.remove&&(a.remove=d.remove),f[j]=a},{requires:["event/dom/base","./touch/handle-map","./touch/handle"]});
