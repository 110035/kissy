/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Jun 21 01:26
*/
KISSY.add("io/form-serializer",function(d,h){function i(a){return a.replace(j,"\r\n")}var k=/^(?:select|textarea)/i,j=/\r?\n/g,c,a=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return c={serialize:function(a,f){return d.param(c.getFormData(a),void 0,void 0,f||!1)},getFormData:function(b){var f=[],c={};d.each(h.query(b),function(a){a=a.elements?d.makeArray(a.elements):[a];f.push.apply(f,a)});f=d.filter(f,function(n){return n.name&&!n.disabled&&
(n.checked||k.test(n.nodeName)||a.test(n.type))});d.each(f,function(a){var e=h.val(a),g;null!==e&&(e=d.isArray(e)?d.map(e,i):i(e),(g=c[a.name])?(g&&!d.isArray(g)&&(g=c[a.name]=[g]),g.push.apply(g,d.makeArray(e))):c[a.name]=e)});return c}}},{requires:["dom"]});
KISSY.add("io/base",function(d,h,i,k){function j(a){var g=a.context;delete a.context;a=d.mix(d.clone(l),a,{deep:!0});a.context=g||a;var b,c=a.type,m=a.dataType,g=a.uri=e.resolve(a.url);a.uri.setQuery("");"crossDomain"in a||(a.crossDomain=!a.uri.isSameOriginAs(e));c=a.type=c.toUpperCase();a.hasContent=!n.test(c);if(a.processData&&(b=a.data)&&"string"!=typeof b)a.data=d.param(b,k,k,a.serializeArray);m=a.dataType=d.trim(m||"*").split(f);!("cache"in a)&&d.inArray(m[0],["script","jsonp"])&&(a.cache=!1);
a.hasContent||(a.data&&g.query.add(d.unparam(a.data)),!1===a.cache&&g.query.set("_ksTS",d.now()+"_"+d.guid()));return a}function c(g,e){a.fire(g,{ajaxConfig:e.config,io:e})}function a(e){function n(a){return function(g){if(h=b.timeoutTimer)clearTimeout(h),b.timeoutTimer=0;var n=e[a];n&&n.apply(r,g);c(a,b)}}var b=this;if(!(b instanceof a))return new a(e);m.call(b);e=j(e);d.mix(b,{responseData:null,config:e||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,
requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null,_defer:new d.Defer(this)});var f;c("start",b);f=new (g[e.dataType[0]]||g["*"])(b);b.transport=f;e.contentType&&b.setRequestHeader("Content-Type",e.contentType);var l=e.dataType[0],h,i,k=e.timeout,r=e.context,q=e.headers,x=e.accepts;b.setRequestHeader("Accept",l&&x[l]?x[l]+("*"===l?"":", */*; q=0.01"):x["*"]);for(i in q)b.setRequestHeader(i,q[i]);if(e.beforeSend&&!1===e.beforeSend.call(r,b,e))return b;b.done(n("success"),
n("error"));b.fin(n("complete"));b.readyState=1;c("send",b);e.async&&0<k&&(b.timeoutTimer=setTimeout(function(){b.abort("timeout")},1E3*k));try{b.state=1,f.send()}catch(z){2>b.state&&b._ioReady(-1,z.message)}return b}var b=/^(?:about|app|app\-storage|.+\-extension|file|widget)$/,f=/\s+/,h=function(a){return a},m=d.Promise,n=/^(?:GET|HEAD)$/,e=new d.Uri((d.Env.host.location||{}).href),b=e&&b.test(e.getScheme()),g={},l={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0,
serializeArray:!0,processData:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:d.parseJson,html:h,text:h,xml:d.parseXML}},contents:{xml:/xml/,html:/html/,json:/json/}};l.converters.html=l.converters.text;d.mix(a,i.Target);d.mix(a,{isLocal:b,setupConfig:function(a){d.mix(l,a,{deep:!0})},setupTransport:function(a,e){g[a]=e},getTransport:function(a){return g[a]},getConfig:function(){return l}});return a},
{requires:["json","event"]});
KISSY.add("io/xhr-transport-base",function(d,h){function i(a,e){try{return new (e||j).XMLHttpRequest}catch(b){}}function k(a){var e;a.ifModified&&(e=a.uri,!1===a.cache&&(e=e.clone(),e.query.remove("_ksTS")),e=e.toString());return e}var j=d.Env.host,c=7<d.UA.ie&&j.XDomainRequest,a={proto:{}},b={},f={};h.__lastModifiedCached=b;h.__eTagCached=f;a.nativeXhr=j.ActiveXObject?function(a,e){var b;if(!m&&a&&c)b=new c;else if(!(b=!h.isLocal&&i(a,e)))a:{try{b=new (e||j).ActiveXObject("Microsoft.XMLHTTP");break a}catch(f){}b=
void 0}return b}:i;a._XDomainRequest=c;var m=a.supportCORS="withCredentials"in a.nativeXhr();d.mix(a.proto,{sendInternal:function(){var a=this,e=a.io,g=e.config,l=a.nativeXhr,h=g.files,i=h?"post":g.type,j=g.async,o,u=e.mimeType,p=e.requestHeaders||{},e=e._getUrlForSend(),v=k(g),s,r;if(v){if(s=b[v])p["If-Modified-Since"]=s;if(s=f[v])p["If-None-Match"]=s}(o=g.username)?l.open(i,e,j,o,g.password):l.open(i,e,j);i=g.xhrFields||{};"withCredentials"in i?m||delete i.withCredentials:m&&(i.withCredentials=
!0);for(r in i)l[r]=i[r];u&&l.overrideMimeType&&l.overrideMimeType(u);p["X-Requested-With"]||(p["X-Requested-With"]="XMLHttpRequest");if("undefined"!==typeof l.setRequestHeader)for(r in p)l.setRequestHeader(r,p[r]);var q=g.hasContent&&g.data||null;h&&(u=q,p={},u&&(p=d.unparam(u)),p=d.mix(p,h),q=new FormData,d.each(p,function(a,b){d.isArray(a)?d.each(a,function(a){q.append(b+(g.serializeArray?"[]":""),a)}):q.append(b,a)}));l.send(q);!j||4==l.readyState?a._callback():c&&l instanceof c?(l.onload=function(){l.readyState=
4;l.status=200;a._callback()},l.onerror=function(){l.readyState=4;l.status=500;a._callback()}):l.onreadystatechange=function(){a._callback()}},abort:function(){this._callback(0,1)},_callback:function(a,e){var g=this.nativeXhr,m=this.io,i,j,w,o,u,p=m.config;try{if(e||4==g.readyState)if(c&&g instanceof c?(g.onerror=d.noop,g.onload=d.noop):g.onreadystatechange=d.noop,e)4!==g.readyState&&g.abort();else{i=k(p);var v=g.status;c&&g instanceof c||(m.responseHeadersString=g.getAllResponseHeaders());i&&(j=
g.getResponseHeader("Last-Modified"),w=g.getResponseHeader("ETag"),j&&(b[i]=j),w&&(f[w]=w));if((u=g.responseXML)&&u.documentElement)m.responseXML=u;var s=m.responseText=g.responseText;if(p.files&&s){var r,q;if(-1!=(r=s.indexOf("<body>")))q=s.lastIndexOf("</body>"),-1==q&&(q=s.length),s=s.slice(r+6,q);m.responseText=d.unEscapeHtml(s)}try{o=g.statusText}catch(x){o=""}!v&&h.isLocal&&!p.crossDomain?v=m.responseText?200:404:1223===v&&(v=204);m._ioReady(v,o)}}catch(z){g.onreadystatechange=d.noop,e||m._ioReady(-1,
z)}}});return a},{requires:["./base"]});
KISSY.add("io/sub-domain-transport",function(d,h,i,k){function j(a){var b=a.config;this.io=a;b.crossDomain=!1}function c(){var a=this.io.config.uri.getHostname(),a=b[a];a.ready=1;i.detach(a.iframe,"load",c,this);this.send()}var a=d.Env.host.document,b={};d.augment(j,h.proto,{send:function(){var f=this.io.config,m=f.uri,n=m.getHostname(),e;e=b[n];var g="/sub_domain_proxy.html";f.xdr&&f.xdr.subDomain&&f.xdr.subDomain.proxy&&(g=f.xdr.subDomain.proxy);e&&e.ready?(this.nativeXhr=h.nativeXhr(0,e.iframe.contentWindow))&&
this.sendInternal():(e?f=e.iframe:(e=b[n]={},f=e.iframe=a.createElement("iframe"),k.css(f,{position:"absolute",left:"-9999px",top:"-9999px"}),k.prepend(f,a.body||a.documentElement),e=new d.Uri,e.setScheme(m.getScheme()),e.setPort(m.getPort()),e.setHostname(n),e.setPath(g),f.src=e.toString()),i.on(f,"load",c,this))}});return j},{requires:["./xhr-transport-base","event","dom"]});
KISSY.add("io/xdr-flash-transport",function(d,h,i){function k(b,e,g){m||(m=!0,b='<object id="'+a+'" type="application/x-shockwave-flash" data="'+b+'" width="0" height="0"><param name="movie" value="'+b+'" /><param name="FlashVars" value="yid='+e+"&uid="+g+'&host=KISSY.Io" /><param name="allowScriptAccess" value="always" /></object>',e=f.createElement("div"),i.prepend(e,f.body||f.documentElement),e.innerHTML=b)}function j(a){this.io=a}var c={},a="io_swf",b,f=d.Env.host.document,m=!1;d.augment(j,{send:function(){var a=
this,e=a.io,g=e.config;k((g.xdr||{}).src||d.Config.base+"io/assets/io.swf",1,1);b?(a._uid=d.guid(),c[a._uid]=a,b.send(e._getUrlForSend(),{id:a._uid,uid:a._uid,method:g.type,data:g.hasContent&&g.data||{}})):setTimeout(function(){a.send()},200)},abort:function(){b.abort(this._uid)},_xdrResponse:function(a,b){var g,d=b.id,f,m=b.c,i=this.io;if(m&&(f=m.responseText))i.responseText=decodeURI(f);switch(a){case "success":g={status:200,statusText:"success"};delete c[d];break;case "abort":delete c[d];break;
case "timeout":case "transport error":case "failure":delete c[d],g={status:"status"in m?m.status:500,statusText:m.statusText||a}}g&&i._ioReady(g.status,g.statusText)}});h.applyTo=function(a,b,g){var a=b.split(".").slice(1),f=h;d.each(a,function(a){f=f[a]});f.apply(null,g)};h.xdrReady=function(){b=f.getElementById(a)};h.xdrResponse=function(a,b){var g=c[b.uid];g&&g._xdrResponse(a,b)};return j},{requires:["./base","dom"]});
KISSY.add("io/xhr-transport",function(d,h,i,k,j){function c(f){var c=f.config,n=c.crossDomain,e=c.xdr||{},g=e.subDomain=e.subDomain||{};this.io=f;if(n&&!i.supportCORS){c=c.uri.getHostname();if(a.domain&&d.endsWith(c,a.domain)&&!1!==g.proxy)return new k(f);if("flash"===""+e.use||!b)return new j(f)}this.nativeXhr=i.nativeXhr(n);return this}var a=d.Env.host.document,b=i._XDomainRequest;d.augment(c,i.proto,{send:function(){this.sendInternal()}});h.setupTransport("*",c);return h},{requires:["./base","./xhr-transport-base",
"./sub-domain-transport","./xdr-flash-transport"]});
KISSY.add("io/script-transport",function(d,h,i,k){function j(a){if(!a.config.crossDomain)return new (h.getTransport("*"))(a);this.io=a;return this}var c=d.Env.host,a=c.document;h.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(a){d.globalEval(a);return a}}}});d.augment(j,{send:function(){var b=this,d,m=b.io,i=m.config,e=a.head||a.getElementsByTagName("head")[0]||
a.documentElement;b.head=e;d=a.createElement("script");b.script=d;d.async=!0;i.scriptCharset&&(d.charset=i.scriptCharset);d.src=m._getUrlForSend();d.onerror=d.onload=d.onreadystatechange=function(a){a=a||c.event;b._callback((a.type||"error").toLowerCase())};e.insertBefore(d,e.firstChild)},_callback:function(a,d){var c=this.script,i=this.io,e=this.head;if(c&&(d||!c.readyState||/loaded|complete/.test(c.readyState)||"error"==a))c.onerror=c.onload=c.onreadystatechange=null,e&&c.parentNode&&e.removeChild(c),
this.head=this.script=k,!d&&"error"!=a?i._ioReady(200,"success"):"error"==a&&i._ioReady(500,"script error")},abort:function(){this._callback(0,1)}});h.setupTransport("script",j);return h},{requires:["./base","./xhr-transport"]});
KISSY.add("io/jsonp",function(d,h){var i=d.Env.host;h.setupConfig({jsonp:"callback",jsonpCallback:function(){return d.guid("jsonp")}});h.on("start",function(h){var j=h.io,c=j.config,h=c.dataType;if("jsonp"==h[0]){var a,b=c.jsonpCallback,f=d.isFunction(b)?b():b,m=i[f];c.uri.query.set(c.jsonp,f);i[f]=function(b){1<arguments.length&&(b=d.makeArray(arguments));a=[b]};j.fin(function(){i[f]=m;if(void 0===m)try{delete i[f]}catch(b){}else a&&m(a[0])});j=c.converters;j.script=j.script||{};j.script.json=function(){return a[0]};
h.length=2;h[0]="script";h[1]="json"}});return h},{requires:["./base"]});
KISSY.add("io/form",function(d,h,i,k){var j=Array.prototype.slice,c=d.Env.host.FormData;h.on("start",function(a){var b,f,a=a.io.config;if(f=a.form){b=i.get(f);f=a.data;for(var m=!1,h={},e=i.query("input",b),g=0,l=e.length;g<l;g++){var y=e[g];if("file"==y.type.toLowerCase()){m=!0;if(!c)break;var t=j.call(y.files,0);h[i.attr(y,"name")]=1<t.length?t:t[0]||null}}m&&c&&(a.files=a.files||{},d.mix(a.files,h),delete a.contentType);!m||c?(b=k.getFormData(b),a.hasContent?(b=d.param(b,void 0,void 0,a.serializeArray),
a.data=f?a.data+("&"+b):b):a.uri.query.add(b)):(f=a.dataType,a=f[0],"*"==a&&(a="text"),f.length=2,f[0]="iframe",f[1]=a)}});return h},{requires:["./base","dom","./form-serializer"]});
KISSY.add("io/iframe-transport",function(d,h,i,k){function j(a){var c=d.guid("io-iframe"),e=h.getEmptyIframeSrc(),a=a.iframe=h.create("<iframe "+(e?' src="'+e+'" ':"")+' id="'+c+'" name="'+c+'" style="position:absolute;left:-9999px;top:-9999px;"/>');h.prepend(a,b.body||b.documentElement);return a}function c(a,c,e){var g=[],f,i,j,k;d.each(a,function(a,m){f=d.isArray(a);i=d.makeArray(a);for(j=0;j<i.length;j++)k=b.createElement("input"),k.type="hidden",k.name=m+(f&&e?"[]":""),k.value=i[j],h.append(k,
c),g.push(k)});return g}function a(a){this.io=a}var b=d.Env.host.document,f=d.clone(k.getConfig().converters.text);f.json=function(a){return d.parseJson(d.unEscapeHtml(a))};k.setupConfig({converters:{iframe:f,text:{iframe:function(a){return a}},xml:{iframe:function(a){return a}}}});d.augment(a,{send:function(){function a(){i.on(k,"load error",b._callback,b);o.submit()}var b=this,e=b.io,g=e.config,f,k,t,w=g.data,o=h.get(g.form);b.attrs={target:h.attr(o,"target")||"",action:h.attr(o,"action")||"",encoding:h.attr(o,
"encoding"),enctype:h.attr(o,"enctype"),method:h.attr(o,"method")};b.form=o;k=j(e);h.attr(o,{target:k.id,action:e._getUrlForSend(),method:"post",enctype:"multipart/form-data",encoding:"multipart/form-data"});w&&(t=d.unparam(w));t&&(f=c(t,o,g.serializeArray));b.fields=f;6==d.UA.ie?setTimeout(a,0):a()},_callback:function(a){var b=this,e=b.form,c=b.io,a=a.type,f,j=c.iframe;if(j)if("abort"==a&&6==d.UA.ie?setTimeout(function(){h.attr(e,b.attrs)},0):h.attr(e,b.attrs),h.remove(this.fields),i.detach(j),setTimeout(function(){h.remove(j)},
30),c.iframe=null,"load"==a)try{if((f=j.contentWindow.document)&&f.body)c.responseText=h.html(f.body),d.startsWith(c.responseText,"<?xml")&&(c.responseText=void 0);c.responseXML=f&&f.XMLDocument?f.XMLDocument:f;f?c._ioReady(200,"success"):c._ioReady(500,"parser error")}catch(k){c._ioReady(500,"parser error")}else"error"==a&&c._ioReady(500,"error")},abort:function(){this._callback({type:"abort"})}});k.setupTransport("iframe",a);return k},{requires:["dom","event","./base"]});
KISSY.add("io/methods",function(d,h,i){function k(c){var a=c.responseText,b=c.responseXML,f=c.config,h=f.converters,j,e,g=f.contents,l=f.dataType;if(a||b){for(f=c.mimeType||c.getResponseHeader("Content-Type");"*"==l[0];)l.shift();if(!l.length)for(j in g)if(g[j].test(f)){l[0]!=j&&l.unshift(j);break}l[0]=l[0]||"text";for(j=0;j<l.length;j++)if("text"==l[j]&&a!==i){e=a;break}else if("xml"==l[j]&&b!==i){e=b;break}if(!e){var k={text:a,xml:b};d.each(["text","xml"],function(c){var d=l[0];return h[c]&&h[c][d]&&
k[c]?(l.unshift(c),e="text"==c?a:b,!1):i})}}g=l[0];for(f=1;f<l.length;f++){j=l[f];var t=h[g]&&h[g][j];if(!t)throw"no covert for "+g+" => "+j;e=t(e);g=j}c.responseData=e}var j=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg;d.extend(h,d.Promise,{setRequestHeader:function(c,a){this.requestHeaders[c]=a;return this},getAllResponseHeaders:function(){return 2===this.state?this.responseHeadersString:null},getResponseHeader:function(c){var a,b;if(2===this.state){if(!(b=this.responseHeaders))for(b=this.responseHeaders={};a=
j.exec(this.responseHeadersString);)b[a[1]]=a[2];a=b[c]}return a===i?null:a},overrideMimeType:function(c){this.state||(this.mimeType=c);return this},abort:function(c){c=c||"abort";this.transport&&this.transport.abort(c);this._ioReady(0,c);return this},getNativeXhr:function(){var c;return(c=this.transport)?c.nativeXhr:null},_ioReady:function(c,a){if(2!=this.state){this.state=2;this.readyState=4;var b;if(200<=c&&300>c||304==c)if(304==c)a="not modified",b=!0;else try{k(this),a="success",b=!0}catch(d){a=
"parser error"}else 0>c&&(c=0);this.status=c;this.statusText=a;this._defer[b?"resolve":"reject"]([this.responseData,a,this])}},_getUrlForSend:function(){var c=this.config,a=c.uri,b=d.Uri.getComponents(c.url).query||"";return a.toString.call(a,c.serializeArray)+(b?(a.query.has()?"&":"?")+b:b)}})},{requires:["./base"]});
KISSY.add("io",function(d,h,i){function k(c,a,b,f,h){d.isFunction(a)&&(f=b,b=a,a=j);return i({type:h||"get",url:c,data:a,success:b,dataType:f})}var j=void 0;d.mix(i,{serialize:h.serialize,get:k,post:function(c,a,b,f){d.isFunction(a)&&(f=b,b=a,a=j);return k(c,a,b,f,"post")},jsonp:function(c,a,b){d.isFunction(a)&&(b=a,a=j);return k(c,a,b,"jsonp")},getScript:d.getScript,getJSON:function(c,a,b){d.isFunction(a)&&(b=a,a=j);return k(c,a,b,"json")},upload:function(c,a,b,f,h){d.isFunction(b)&&(h=f,f=b,b=j);
return i({url:c,type:"post",dataType:h,form:a,data:b,success:f})}});d.mix(d,{Ajax:i,Io:i,IO:i,ajax:i,io:i,jsonp:i.jsonp});return i},{requires:"io/form-serializer,io/base,io/xhr-transport,io/script-transport,io/jsonp,io/form,io/iframe-transport,io/methods".split(",")});
