/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: May 28 17:05
*/
KISSY.add("io/base",function(e,g,h,l){function j(a){var f=a.context;delete a.context;a=e.mix(e.clone(k),a,{deep:!0});a.context=f||a;var b,c=a.type,n=a.dataType,f=a.uri=m.resolve(a.url);a.uri.setQuery("");"crossDomain"in a||(a.crossDomain=!a.uri.isSameOriginAs(m));c=a.type=c.toUpperCase();a.hasContent=!i.test(c);if(a.processData&&(b=a.data)&&"string"!=typeof b)a.data=e.param(b,l,l,a.serializeArray);n=a.dataType=e.trim(n||"*").split(d);!("cache"in a)&&e.inArray(n[0],["script","jsonp"])&&(a.cache=!1);
a.hasContent||(a.data&&f.query.add(e.unparam(a.data)),!1===a.cache&&f.query.set("_ksTS",e.now()+"_"+e.guid()));return a}function c(f,i){a.fire(f,{ajaxConfig:i.config,io:i})}function a(i){function m(a){return function(f){if(g=b.timeoutTimer)clearTimeout(g),b.timeoutTimer=0;var m=i[a];m&&m.apply(r,f);c(a,b)}}var b=this;if(!(b instanceof a))return new a(i);n.call(b);i=j(i);e.mix(b,{responseData:null,config:i||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,
requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null,_defer:new e.Defer(this)});var d;c("start",b);d=new (f[i.dataType[0]]||f["*"])(b);b.transport=d;i.contentType&&b.setRequestHeader("Content-Type",i.contentType);var k=i.dataType[0],g,h,l=i.timeout,r=i.context,q=i.headers,x=i.accepts;b.setRequestHeader("Accept",k&&x[k]?x[k]+("*"===k?"":", */*; q=0.01"):x["*"]);for(h in q)b.setRequestHeader(h,q[h]);if(i.beforeSend&&!1===i.beforeSend.call(r,b,i))return b;b.done(m("success"),
m("error"));b.fin(m("complete"));b.readyState=1;c("send",b);i.async&&0<l&&(b.timeoutTimer=setTimeout(function(){b.abort("timeout")},1E3*l));try{b.state=1,d.send()}catch(y){2>b.state&&b._ioReady(-1,y.message)}return b}var b=/^(?:about|app|app\-storage|.+\-extension|file|widget)$/,d=/\s+/,g=function(a){return a},n=e.Promise,i=/^(?:GET|HEAD)$/,m=new e.Uri((e.Env.host.location||{}).href),b=m&&b.test(m.getScheme()),f={},k={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0,
serializeArray:!0,processData:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:e.parseJSON,html:g,text:g,xml:e.parseXML}},contents:{xml:/xml/,html:/html/,json:/json/}};k.converters.html=k.converters.text;e.mix(a,h.Target);e.mix(a,{isLocal:b,setupConfig:function(a){e.mix(k,a,{deep:!0})},setupTransport:function(a,i){f[a]=i},getTransport:function(a){return f[a]},getConfig:function(){return k}});return a},
{requires:["json","event"]});
KISSY.add("io/form-serializer",function(e,g){function h(a){return a.replace(j,"\r\n")}var l=/^(?:select|textarea)/i,j=/\r?\n/g,c,a=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return c={serialize:function(a,d){return e.param(c.getFormData(a),void 0,void 0,d||!1)},getFormData:function(b){var d=[],c={};e.each(g.query(b),function(a){a=a.elements?e.makeArray(a.elements):[a];d.push.apply(d,a)});d=e.filter(d,function(i){return i.name&&!i.disabled&&
(i.checked||l.test(i.nodeName)||a.test(i.type))});e.each(d,function(a){var b=g.val(a),f;null!==b&&(b=e.isArray(b)?e.map(b,h):h(b),(f=c[a.name])?(f&&!e.isArray(f)&&(f=c[a.name]=[f]),f.push.apply(f,e.makeArray(b))):c[a.name]=b)});return c}}},{requires:["dom"]});
KISSY.add("io/form",function(e,g,h,l){var j=Array.prototype.slice,c=e.Env.host.FormData;g.on("start",function(a){var b,d,a=a.io.config;if(d=a.form){b=h.get(d);d=a.data;for(var n=!1,i={},m=h.query("input",b),f=0,k=m.length;f<k;f++){var g=m[f];if("file"==g.type.toLowerCase()){n=!0;if(!c)break;var w=j.call(g.files,0);i[h.attr(g,"name")]=1<w.length?w:w[0]||null}}n&&c&&(a.files=a.files||{},e.mix(a.files,i),delete a.contentType);!n||c?(b=l.getFormData(b),a.hasContent?(b=e.param(b,void 0,void 0,a.serializeArray),
a.data=d?a.data+("&"+b):b):a.uri.query.add(b)):(d=a.dataType,a=d[0],"*"==a&&(a="text"),d.length=2,d[0]="iframe",d[1]=a)}});return g},{requires:["./base","dom","./form-serializer"]});
KISSY.add("io/iframe-transport",function(e,g,h,l){function j(a){var i=e.guid("io-iframe"),m=g.getEmptyIframeSrc(),a=a.iframe=g.create("<iframe "+(m?' src="'+m+'" ':"")+' id="'+i+'" name="'+i+'" style="position:absolute;left:-9999px;top:-9999px;"/>');g.prepend(a,b.body||b.documentElement);return a}function c(a,i,m){var f=[],d,c,h,l;e.each(a,function(a,n){d=e.isArray(a);c=e.makeArray(a);for(h=0;h<c.length;h++)l=b.createElement("input"),l.type="hidden",l.name=n+(d&&m?"[]":""),l.value=c[h],g.append(l,
i),f.push(l)});return f}function a(a){this.io=a}var b=e.Env.host.document,d=e.clone(l.getConfig().converters.text);d.json=function(a){return e.parseJSON(e.unEscapeHTML(a))};l.setupConfig({converters:{iframe:d,text:{iframe:function(a){return a}},xml:{iframe:function(a){return a}}}});e.augment(a,{send:function(){function a(){h.on(l,"load error",b._callback,b);o.submit()}var b=this,d=b.io,f=d.config,k,l,w,t=f.data,o=g.get(f.form);b.attrs={target:g.attr(o,"target")||"",action:g.attr(o,"action")||"",encoding:g.attr(o,
"encoding"),enctype:g.attr(o,"enctype"),method:g.attr(o,"method")};b.form=o;l=j(d);g.attr(o,{target:l.id,action:d._getUrlForSend(),method:"post",enctype:"multipart/form-data",encoding:"multipart/form-data"});t&&(w=e.unparam(t));w&&(k=c(w,o,f.serializeArray));b.fields=k;6==e.UA.ie?setTimeout(a,0):a()},_callback:function(a){var b=this,d=b.form,f=b.io,a=a.type,c,l=f.iframe;if(l)if("abort"==a&&6==e.UA.ie?setTimeout(function(){g.attr(d,b.attrs)},0):g.attr(d,b.attrs),g.remove(this.fields),h.detach(l),setTimeout(function(){g.remove(l)},
30),f.iframe=null,"load"==a)try{if((c=l.contentWindow.document)&&c.body)f.responseText=g.html(c.body),e.startsWith(f.responseText,"<?xml")&&(f.responseText=void 0);f.responseXML=c&&c.XMLDocument?c.XMLDocument:c;c?f._ioReady(200,"success"):f._ioReady(500,"parser error")}catch(j){f._ioReady(500,"parser error")}else"error"==a&&f._ioReady(500,"error")},abort:function(){this._callback({type:"abort"})}});l.setupTransport("iframe",a);return l},{requires:["dom","event","./base"]});
KISSY.add("io",function(e,g,h){function l(c,a,b,d,g){e.isFunction(a)&&(d=b,b=a,a=j);return h({type:g||"get",url:c,data:a,success:b,dataType:d})}var j=void 0;e.mix(h,{serialize:g.serialize,get:l,post:function(c,a,b,d){e.isFunction(a)&&(d=b,b=a,a=j);return l(c,a,b,d,"post")},jsonp:function(c,a,b){e.isFunction(a)&&(b=a,a=j);return l(c,a,b,"jsonp")},getScript:e.getScript,getJSON:function(c,a,b){e.isFunction(a)&&(b=a,a=j);return l(c,a,b,"json")},upload:function(c,a,b,d,g){e.isFunction(b)&&(g=d,d=b,b=j);
return h({url:c,type:"post",dataType:g,form:a,data:b,success:d})}});e.mix(e,{Ajax:h,IO:h,ajax:h,io:h,jsonp:h.jsonp});return h},{requires:"io/form-serializer,io/base,io/xhr-transport,io/script-transport,io/jsonp,io/form,io/iframe-transport,io/methods".split(",")});
KISSY.add("io/jsonp",function(e,g){var h=e.Env.host;g.setupConfig({jsonp:"callback",jsonpCallback:function(){return e.guid("jsonp")}});g.on("start",function(g){var j=g.io,c=j.config,g=c.dataType;if("jsonp"==g[0]){var a,b=c.jsonpCallback,d=e.isFunction(b)?b():b,n=h[d];c.uri.query.set(c.jsonp,d);h[d]=function(b){1<arguments.length&&(b=e.makeArray(arguments));a=[b]};j.fin(function(){h[d]=n;if(void 0===n)try{delete h[d]}catch(b){}else a&&n(a[0])});j=c.converters;j.script=j.script||{};j.script.json=function(){return a[0]};
g.length=2;g[0]="script";g[1]="json"}});return g},{requires:["./base"]});
KISSY.add("io/methods",function(e,g,h){function l(c){var a=c.responseText,b=c.responseXML,d=c.config,g=d.converters,i,m,f=d.contents,k=d.dataType;if(a||b){for(d=c.mimeType||c.getResponseHeader("Content-Type");"*"==k[0];)k.shift();if(!k.length)for(i in f)if(f[i].test(d)){k[0]!=i&&k.unshift(i);break}k[0]=k[0]||"text";for(i=0;i<k.length;i++)if("text"==k[i]&&a!==h){m=a;break}else if("xml"==k[i]&&b!==h){m=b;break}if(!m){var l={text:a,xml:b};e.each(["text","xml"],function(f){var d=k[0];return g[f]&&g[f][d]&&
l[f]?(k.unshift(f),m="text"==f?a:b,!1):h})}}f=k[0];for(d=1;d<k.length;d++){i=k[d];var j=g[f]&&g[f][i];if(!j)throw"no covert for "+f+" => "+i;m=j(m);f=i}c.responseData=m}var j=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg;e.extend(g,e.Promise,{setRequestHeader:function(c,a){this.requestHeaders[c]=a;return this},getAllResponseHeaders:function(){return 2===this.state?this.responseHeadersString:null},getResponseHeader:function(c){var a,b;if(2===this.state){if(!(b=this.responseHeaders))for(b=this.responseHeaders={};a=
j.exec(this.responseHeadersString);)b[a[1]]=a[2];a=b[c]}return a===h?null:a},overrideMimeType:function(c){this.state||(this.mimeType=c);return this},abort:function(c){c=c||"abort";this.transport&&this.transport.abort(c);this._ioReady(0,c);return this},getNativeXhr:function(){var c;return(c=this.transport)?c.nativeXhr:null},_ioReady:function(c,a){if(2!=this.state){this.state=2;this.readyState=4;var b;if(200<=c&&300>c||304==c)if(304==c)a="not modified",b=!0;else try{l(this),a="success",b=!0}catch(d){a=
"parser error"}else 0>c&&(c=0);this.status=c;this.statusText=a;this._defer[b?"resolve":"reject"]([this.responseData,a,this])}},_getUrlForSend:function(){var c=this.config,a=c.uri,b=e.Uri.getComponents(c.url).query||"";return a.toString.call(a,c.serializeArray)+(b?(a.query.has()?"&":"?")+b:b)}})},{requires:["./base"]});
KISSY.add("io/script-transport",function(e,g,h,l){function j(a){if(!a.config.crossDomain)return new (g.getTransport("*"))(a);this.io=a;return this}var c=e.Env.host,a=c.document;g.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(a){e.globalEval(a);return a}}}});e.augment(j,{send:function(){var b=this,d,e=b.io,i=e.config,m=a.head||a.getElementsByTagName("head")[0]||
a.documentElement;b.head=m;d=a.createElement("script");b.script=d;d.async=!0;i.scriptCharset&&(d.charset=i.scriptCharset);d.src=e._getUrlForSend();d.onerror=d.onload=d.onreadystatechange=function(a){a=a||c.event;b._callback((a.type||"error").toLowerCase())};m.insertBefore(d,m.firstChild)},_callback:function(a,d){var c=this.script,i=this.io,e=this.head;if(c&&(d||!c.readyState||/loaded|complete/.test(c.readyState)||"error"==a))c.onerror=c.onload=c.onreadystatechange=null,e&&c.parentNode&&e.removeChild(c),
this.head=this.script=l,!d&&"error"!=a?i._ioReady(200,"success"):"error"==a&&i._ioReady(500,"script error")},abort:function(){this._callback(0,1)}});g.setupTransport("script",j);return g},{requires:["./base","./xhr-transport"]});
KISSY.add("io/sub-domain-transport",function(e,g,h,l){function j(a){var b=a.config;this.io=a;b.crossDomain=!1}function c(){var a=this.io.config.uri.getHostname(),a=b[a];a.ready=1;h.detach(a.iframe,"load",c,this);this.send()}var a=e.Env.host.document,b={};e.augment(j,g.proto,{send:function(){var d=this.io.config,j=d.uri,i=j.getHostname(),m;m=b[i];var f="/sub_domain_proxy.html";d.xdr&&d.xdr.subDomain&&d.xdr.subDomain.proxy&&(f=d.xdr.subDomain.proxy);m&&m.ready?(this.nativeXhr=g.nativeXhr(0,m.iframe.contentWindow))&&
this.sendInternal():(m?d=m.iframe:(m=b[i]={},d=m.iframe=a.createElement("iframe"),l.css(d,{position:"absolute",left:"-9999px",top:"-9999px"}),l.prepend(d,a.body||a.documentElement),m=new e.Uri,m.setScheme(j.getScheme()),m.setPort(j.getPort()),m.setHostname(i),m.setPath(f),d.src=m.toString()),h.on(d,"load",c,this))}});return j},{requires:["./xhr-transport-base","event","dom"]});
KISSY.add("io/xdr-flash-transport",function(e,g,h){function l(b,c,f){n||(n=!0,b='<object id="'+a+'" type="application/x-shockwave-flash" data="'+b+'" width="0" height="0"><param name="movie" value="'+b+'" /><param name="FlashVars" value="yid='+c+"&uid="+f+'&host=KISSY.IO" /><param name="allowScriptAccess" value="always" /></object>',c=d.createElement("div"),h.prepend(c,d.body||d.documentElement),c.innerHTML=b)}function j(a){this.io=a}var c={},a="io_swf",b,d=e.Env.host.document,n=!1;e.augment(j,{send:function(){var a=
this,d=a.io,f=d.config;l((f.xdr||{}).src||e.Config.base+"io/assets/io.swf",1,1);b?(a._uid=e.guid(),c[a._uid]=a,b.send(d._getUrlForSend(),{id:a._uid,uid:a._uid,method:f.type,data:f.hasContent&&f.data||{}})):setTimeout(function(){a.send()},200)},abort:function(){b.abort(this._uid)},_xdrResponse:function(a,b){var f,d=b.id,e,g=b.c,h=this.io;if(g&&(e=g.responseText))h.responseText=decodeURI(e);switch(a){case "success":f={status:200,statusText:"success"};delete c[d];break;case "abort":delete c[d];break;
case "timeout":case "transport error":case "failure":delete c[d],f={status:"status"in g?g.status:500,statusText:g.statusText||a}}f&&h._ioReady(f.status,f.statusText)}});g.applyTo=function(a,b,c){var a=b.split(".").slice(1),d=g;e.each(a,function(a){d=d[a]});d.apply(null,c)};g.xdrReady=function(){b=d.getElementById(a)};g.xdrResponse=function(a,b){var d=c[b.uid];d&&d._xdrResponse(a,b)};return j},{requires:["./base","dom"]});
KISSY.add("io/xhr-transport-base",function(e,g){function h(a,b){try{return new (b||j).XMLHttpRequest}catch(c){}}function l(a){var b;a.ifModified&&(b=a.uri,!1===a.cache&&(b=b.clone(),b.query.remove("_ksTS")),b=b.toString());return b}var j=e.Env.host,c=7<e.UA.ie&&j.XDomainRequest,a={proto:{}},b={},d={};g.__lastModifiedCached=b;g.__eTagCached=d;a.nativeXhr=j.ActiveXObject?function(a,b){var d;if(!n&&a&&c)d=new c;else if(!(d=!g.isLocal&&h(a,b)))a:{try{d=new (b||j).ActiveXObject("Microsoft.XMLHTTP");break a}catch(e){}d=
void 0}return d}:h;a._XDomainRequest=c;var n=a.supportCORS="withCredentials"in a.nativeXhr();e.mix(a.proto,{sendInternal:function(){var a=this,g=a.io,f=g.config,k=a.nativeXhr,h=f.files,j=h?"post":f.type,t=f.async,o,u=g.mimeType,p=g.requestHeaders||{},g=g._getUrlForSend(),v=l(f),s,r;if(v){if(s=b[v])p["If-Modified-Since"]=s;if(s=d[v])p["If-None-Match"]=s}(o=f.username)?k.open(j,g,t,o,f.password):k.open(j,g,t);j=f.xhrFields||{};"withCredentials"in j?n||delete j.withCredentials:n&&(j.withCredentials=
!0);for(r in j)k[r]=j[r];u&&k.overrideMimeType&&k.overrideMimeType(u);p["X-Requested-With"]||(p["X-Requested-With"]="XMLHttpRequest");if("undefined"!==typeof k.setRequestHeader)for(r in p)k.setRequestHeader(r,p[r]);var q=f.hasContent&&f.data||null;h&&(u=q,p={},u&&(p=e.unparam(u)),p=e.mix(p,h),q=new FormData,e.each(p,function(a,b){e.isArray(a)?e.each(a,function(a){q.append(b+(f.serializeArray?"[]":""),a)}):q.append(b,a)}));k.send(q);!t||4==k.readyState?a._callback():c&&k instanceof c?(k.onload=function(){k.readyState=
4;k.status=200;a._callback()},k.onerror=function(){k.readyState=4;k.status=500;a._callback()}):k.onreadystatechange=function(){a._callback()}},abort:function(){this._callback(0,1)},_callback:function(a,h){var f=this.nativeXhr,k=this.io,j,n,t,o,u,p=k.config;try{if(h||4==f.readyState)if(c&&f instanceof c?(f.onerror=e.noop,f.onload=e.noop):f.onreadystatechange=e.noop,h)4!==f.readyState&&f.abort();else{j=l(p);var v=f.status;c&&f instanceof c||(k.responseHeadersString=f.getAllResponseHeaders());j&&(n=
f.getResponseHeader("Last-Modified"),t=f.getResponseHeader("ETag"),n&&(b[j]=n),t&&(d[t]=t));if((u=f.responseXML)&&u.documentElement)k.responseXML=u;var s=k.responseText=f.responseText;if(p.files&&s){var r,q;if(-1!=(r=s.indexOf("<body>")))q=s.lastIndexOf("</body>"),-1==q&&(q=s.length),s=s.slice(r+6,q);k.responseText=e.unEscapeHTML(s)}try{o=f.statusText}catch(x){o=""}!v&&g.isLocal&&!p.crossDomain?v=k.responseText?200:404:1223===v&&(v=204);k._ioReady(v,o)}}catch(y){f.onreadystatechange=e.noop,h||k._ioReady(-1,
y)}}});return a},{requires:["./base"]});
KISSY.add("io/xhr-transport",function(e,g,h,l,j){function c(c){var g=c.config,i=g.crossDomain,m=g.xdr||{},f=m.subDomain=m.subDomain||{};this.io=c;if(i&&!h.supportCORS){g=g.uri.getHostname();if(a.domain&&e.endsWith(g,a.domain)&&!1!==f.proxy)return new l(c);if("flash"===""+m.use||!b)return new j(c)}this.nativeXhr=h.nativeXhr(i);return this}var a=e.Env.host.document,b=h._XDomainRequest;e.augment(c,h.proto,{send:function(){this.sendInternal()}});g.setupTransport("*",c);return g},{requires:["./base","./xhr-transport-base",
"./sub-domain-transport","./xdr-flash-transport"]});
