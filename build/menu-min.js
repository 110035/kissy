/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Jun 19 18:04
*/
KISSY.add("menu/menu-render",function(g,d){return d.Render.extend({beforeCreateDom:function(c){c.elAttrs.role="menu"},setAriaActiveDescendant:function(c){var b=this.el;c?(c=c.get("el").attr("id"),b.attr("aria-activedescendant",c)):b.attr("aria-activedescendant","")},containsElement:function(c){var b=this.el;return b[0]===c||b.contains(c)}})},{requires:["component/controller"]});
KISSY.add("menu/base",function(g,d,c,b,a,f){function e(a){this.view.setAriaActiveDescendant(a.newVal)}var j=d.KeyCode,h=c.extend([b],{isMenu:1,_onSetHighlightedItem:function(a,f){var b;a&&f&&(b=f.prevVal)&&b.set("highlighted",!1,{data:{byPassSetHighlightedItem:1}})},_onSetVisible:function(a,f){h.superclass._onSetVisible.apply(this,arguments);var b;!a&&(b=this.get("highlightedItem"))&&b.set("highlighted",!1)},bindUI:function(){this.on("afterHighlightedItemChange",e,this)},getRootMenu:function(){return this},
handleMouseEnter:function(){h.superclass.handleMouseEnter.apply(this,arguments);var a=this.getRootMenu();a&&a._popupAutoHideTimer&&(clearTimeout(a._popupAutoHideTimer),a._popupAutoHideTimer=null);this.get("focusable")&&this.set("focused",!0)},handleBlur:function(a){h.superclass.handleBlur.call(this,a);var b;(b=this.get("highlightedItem"))&&b.set("highlighted",!1)},_getNextEnabledHighlighted:function(a,b){var c=this.get("children"),e=c.length,d=a;do{var j=c[a];if(!j.get("disabled")&&!1!==j.get("visible"))return c[a];
a=(a+b+e)%e}while(a!=d);return f},handleKeyEventInternal:function(a){var b=this.get("highlightedItem");if(b&&b.handleKeydown(a))return!0;var c=this.get("children"),e=c.length;if(0===e)return f;var d;switch(a.keyCode){case j.ESC:(b=this.get("highlightedItem"))&&b.set("highlighted",!1);break;case j.HOME:d=this._getNextEnabledHighlighted(0,1);break;case j.END:d=this._getNextEnabledHighlighted(e-1,-1);break;case j.UP:b?(a=g.indexOf(b,c),e=(a-1+e)%e):e-=1;d=this._getNextEnabledHighlighted(e,-1);break;
case j.DOWN:b?(a=g.indexOf(b,c),e=(a+1+e)%e):e=0,d=this._getNextEnabledHighlighted(e,1)}return d?(d.set("highlighted",!0,{data:{fromKeyboard:1}}),!0):f},containsElement:function(a){if(!1===this.get("visible")||!this.view)return!1;if(this.view.containsElement(a))return!0;for(var b=this.get("children"),f=0,e=b.length;f<e;f++){var c=b[f];if(c.containsElement&&c.containsElement(a))return!0}return!1}},{ATTRS:{highlightedItem:{value:null},xrender:{value:a},defaultChildCfg:{value:{xclass:"menuitem"}}},xclass:"menu"});
return h},{requires:["node","component/controller","component/extension/delegate-children","./menu-render"]});
KISSY.add("menu/menuitem-render",function(g,d,c){return c.Render.extend({beforeCreateDom:function(b){b.elAttrs.role=b.selectable?"menuitemradio":"menuitem";b.selected&&b.elCls.push(this.getBaseCssClasses("selected"))},_onSetSelected:function(b){var a=this.el,f=this.getBaseCssClasses("selected");a[b?"addClass":"removeClass"](f)},containsElement:function(b){var a=this.el;return a&&(a[0]==b||a.contains(b))}},{HTML_PARSER:{selectable:function(b){return b.hasClass(this.getBaseCssClass("selectable"))}}})},
{requires:["node","component/controller"]});
KISSY.add("menu/menuitem",function(g,d,c){var b=g.all,a=d.extend({isMenuItem:1,handleMouseDown:function(b){a.superclass.handleMouseDown.call(this,b);this.set("highlighted",!0)},performActionInternal:function(){this.get("selectable")&&this.set("selected",!0);this.fire("click");return!0},_onSetHighlighted:function(a,e){if(!e||!e.byPassSetHighlightedItem)this.get("rendered")?this.get("parent").set("highlightedItem",a?this:null):a&&this.get("parent").set("highlightedItem",this);if(a){var c=this.get("el"),
d=c.parent(function(a){return"visible"!=b(a).css("overflow")},this.get("parent").get("el").parent());d&&c.scrollIntoView(d,{alignWithTop:!0,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0})}},containsElement:function(a){return this.view&&this.view.containsElement(a)}},{ATTRS:{focusable:{value:!1},handleMouseEvents:{value:!1},selectable:{view:1},value:{},selected:{view:1},xrender:{value:c}},xclass:"menuitem"});return a},{requires:["component/controller","./menuitem-render"]});
KISSY.add("menu/check-menuitem-render",function(g,d,c){return d.extend([c],{beforeCreateDom:function(b){b.checked&&b.elCls.push(self.getBaseCssClasses("checked"))},_onSetChecked:function(b){var a=this.get("el"),f=this.getBaseCssClasses("checked");a[b?"addClass":"removeClass"](f)}},{ATTRS:{contentTpl:{value:'<div class="{{getBaseCssClasses "checkbox"}}"></div>'+Extension.ContentRender.ContentTpl}}})},{requires:["./menuitem-render","component/extension/content-render"]});
KISSY.add("menu/check-menuitem",function(g,d,c){return d.extend({performActionInternal:function(){this.set("checked",!this.get("checked"));this.fire("click");return!0}},{ATTRS:{checked:{view:1},xrender:{value:c}},xclass:"check-menuitem"})},{requires:["./menuitem","./check-menuitem-render"]});
KISSY.add("menu/submenu-render",function(g,d,c){return d.extend([c],{decorateDom:function(b){var a=this.controller,f=a.prefixCls,b=b.one("."+f+"popupmenu"),e=b[0].ownerDocument.body;e.insertBefore(b[0],e.firstChild);e=this.getComponentConstructorByNode(f,b);a.setInternal("menu",new e({srcNode:b,prefixCls:f}))}},{ATTRS:{contentTpl:{value:c.ContentTpl+'<span class="{{prefixCls}}submenu-arrow">\u25ba</span>'}}})},{requires:["./menuitem-render","component/extension/content-render"]});
KISSY.add("menu/popupmenu-render",function(g,d,c,b){return b.extend([d,c])},{requires:["component/extension/content-render","component/extension/shim-render","./menu-render"]});
KISSY.add("menu/popupmenu",function(g,d,c,b){var a=c.extend([d],{getRootMenu:function(){var a=this,b;do b=a,a=a.get("parent");while(a&&(a.isMenuItem||a.isMenu));return b===this?null:b},handleMouseLeave:function(b){a.superclass.handleMouseLeave.apply(this,arguments);var c=this.get("parent");c&&c.isSubMenu&&c.clearSubMenuTimers();if(this.get("autoHideOnMouseLeave")){var d=this.getRootMenu();d&&(clearTimeout(d._popupAutoHideTimer),d._popupAutoHideTimer=setTimeout(function(){var a;(a=d.get("highlightedItem"))&&
a.set("highlighted",!1)},1E3*this.get("parent").get("menuDelay")))}},isPopupMenu:1,handleBlur:function(){a.superclass.handleBlur.apply(this,arguments);this.hide()}},{ATTRS:{focusable:{value:!1},autoHideOnMouseLeave:{},contentEl:{view:1},xrender:{value:b}},xclass:"popupmenu"});return a},{requires:["component/extension/align","./base","./popupmenu-render"]});KISSY.add("menu/filtermenu-tpl",function(){return'<div id="ks-filter-menu-input-wrap-{{id}}" class="{{getBaseCssClasses "input-wrap"}}"> <div id="ks-filter-menu-placeholder-{{id}}" class="{{getBaseCssClasses "placeholder"}}"> {{placeholder}} </div> <input id="ks-filter-menu-input-{{id}}" class="{{getBaseCssClasses "input"}}" autocomplete="off"/> </div> <div id="ks-content-{{id}}" class="{{getBaseCssClasses "content"}}"> </div>'});
KISSY.add("menu/filtermenu-render",function(g,d,c,b,a){return c.extend([a],{beforeCreateDom:function(a,b){g.mix(b,{placeholderEl:"#ks-filter-menu-placeholder-{id}",filterInputWrap:"#ks-filter-menu-input-wrap-{id}",filterInput:"#ks-filter-menu-input-{id}"})},getKeyEventTarget:function(){return this.controller.get("filterInput")},_onSetPlaceholder:function(a){this.controller.get("placeholderEl").html(a)}},{ATTRS:{contentTpl:{value:b}},HTML_PARSER:{placeholderEl:function(a){return a.one("."+this.getBaseCssClass("placeholder"))},
filterInputWrap:function(a){return a.one("."+this.getBaseCssClass("input-wrap"))},filterInput:function(a){return a.one("."+this.getBaseCssClass("input"))}}})},{requires:["node","./menu-render","./filtermenu-tpl","component/extension/content-render"]});
KISSY.add("menu/filtermenu",function(g,d,c){var b=d.extend({bindUI:function(){this.view.get("filterInput").on("valuechange",this.handleFilterEvent,this)},handleMouseEnter:function(){b.superclass.handleMouseEnter.apply(this,arguments);this.view.getKeyEventTarget()[0].select()},handleFilterEvent:function(){var a;a=this.view.get("filterInput");var b=this.get("highlightedItem");this.set("filterStr",a.val());a=a.val();this.get("allowMultiple")&&(a=a.replace(/^.+,/,""));if(!a&&b)b.set("highlighted",!1);
else if(a&&(!b||!b.get("visible")))(b=this._getNextEnabledHighlighted(0,1))&&b.set("highlighted",!0)},_onSetFilterStr:function(a){this.filterItems(a)},filterItems:function(a){var b=this.prefixCls,c=this.view,d=c.get("placeholderEl"),c=c.get("filterInput");d[a?"hide":"show"]();if(this.get("allowMultiple")){var d=[],h;h=a.match(/(.+)[,\uff0c]\s*([^\uff0c,]*)/);var i=[];h&&(i=h[1].split(/[,\uff0c]/));/[,\uff0c]$/.test(a)?(d=[],h&&(d=i,h=i[i.length-1],(i=(i=this.get("highlightedItem"))&&i.get("content"))&&
-1<i.indexOf(h)&&h&&(d[d.length-1]=i),c.val(d.join(",")+",")),a=""):(h&&(a=h[2]||""),d=i);this.get("enteredItems").length!=d.length&&this.set("enteredItems",d)}var c=this.get("children"),k=a&&RegExp(g.escapeRegExp(a),"ig");g.each(c,function(c){var d=c.get("content");a?-1<d.indexOf(a)?(c.set("visible",!0),c.get("el").html(d.replace(k,function(a){return"<span class='"+b+"menuitem-hit'>"+a+"</span>"}))):c.set("visible",!1):(c.get("el").html(d),c.set("visible",!0))})},reset:function(){var a=this.view;
this.set("filterStr","");this.set("enteredItems",[]);(a=a&&a.get("filterInput"))&&a.val("")},destructor:function(){var a=this.view;(a=a&&a.get("filterInput"))&&a.detach()}},{ATTRS:{allowTextSelection:{value:!0},placeholder:{view:1},filterStr:{},enteredItems:{value:[]},allowMultiple:{value:!1},xrender:{value:c}},xclass:"filter-menu"});return b},{requires:["./base","./filtermenu-render"]});
KISSY.add("menu",function(g,d,c,b,a,f,e,j,h,i,k,l){d.Render=c;d.Item=b;d.CheckItem=a;a.Render=f;b.Render=e;d.SubMenu=j;j.Render=h;d.PopupMenu=i;i.Render=k;d.FilterMenu=l;return d},{requires:"menu/base,menu/menu-render,menu/menuitem,menu/check-menuitem,menu/check-menuitem-render,menu/menuitem-render,menu/submenu,menu/submenu-render,menu/popupmenu,menu/popupmenu-render,menu/filtermenu".split(",")});
