/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Jun 21 01:27
*/
KISSY.add("menu/menu-render",function(f,b){return b.ATTRS.xrender.value.extend({beforeCreateDom:function(c){c.elAttrs.role="menu"},setAriaActiveDescendant:function(c){var a=this.el;c?(c=c.el.attr("id"),a.attr("aria-activedescendant",c)):a.attr("aria-activedescendant","")},containsElement:function(c){var a=this.el;return a&&(a[0]===c||a.contains(c))}})},{requires:["component/container"]});
KISSY.add("menu/base",function(f,b,c,a,e,g){function h(d){this.view.setAriaActiveDescendant(d.newVal)}var i=b.KeyCode,j=c.extend([a],{isMenu:1,_onSetHighlightedItem:function(d,a){var g;d&&a&&(g=a.prevVal)&&g.set("highlighted",!1,{data:{byPassSetHighlightedItem:1}})},_onSetVisible:function(d,a){j.superclass._onSetVisible.apply(this,arguments);var g;!d&&(g=this.get("highlightedItem"))&&g.set("highlighted",!1)},bindUI:function(){this.on("afterHighlightedItemChange",h,this)},getRootMenu:function(){return this},
handleMouseEnterInternal:function(){j.superclass.handleMouseEnterInternal.apply(this,arguments);var d=this.getRootMenu();d&&d._popupAutoHideTimer&&(clearTimeout(d._popupAutoHideTimer),d._popupAutoHideTimer=null);this.focus()},handleBlurInternal:function(d){j.superclass.handleBlurInternal.call(this,d);var a;(a=this.get("highlightedItem"))&&a.set("highlighted",!1)},_getNextEnabledHighlighted:function(d,a){var c=this.get("children"),b=c.length,e=d;do{var h=c[d];if(!h.get("disabled")&&!1!==h.get("visible"))return c[d];
d=(d+a+b)%b}while(d!=e);return g},handleKeyDownInternal:function(d){var a=this.get("highlightedItem");if(a&&a.handleKeyDownInternal(d))return!0;var c=this.get("children"),b=c.length;if(0===b)return g;var e;switch(d.keyCode){case i.ESC:(a=this.get("highlightedItem"))&&a.set("highlighted",!1);break;case i.HOME:e=this._getNextEnabledHighlighted(0,1);break;case i.END:e=this._getNextEnabledHighlighted(b-1,-1);break;case i.UP:a?(d=f.indexOf(a,c),b=(d-1+b)%b):b-=1;e=this._getNextEnabledHighlighted(b,-1);
break;case i.DOWN:a?(d=f.indexOf(a,c),b=(d+1+b)%b):b=0,e=this._getNextEnabledHighlighted(b,1)}return e?(e.set("highlighted",!0,{data:{fromKeyboard:1}}),!0):g},containsElement:function(d){if(!this.get("visible")||!this.el)return!1;if(this.view.containsElement(d))return!0;for(var a=this.get("children"),b=0,g=a.length;b<g;b++){var c=a[b];if(c.containsElement&&c.containsElement(d))return!0}return!1}},{ATTRS:{highlightedItem:{value:null},xrender:{value:e},defaultChildCfg:{value:{xclass:"menuitem"}}},xclass:"menu"});
return j},{requires:["node","component/container","component/extension/delegate-children","./menu-render"]});
KISSY.add("menu/menuitem-render",function(f,b,c){return c.ATTRS.xrender.value.extend({beforeCreateDom:function(a){a.elAttrs.role=a.selectable?"menuitemradio":"menuitem";a.selected&&a.elCls.push(this.getBaseCssClasses("selected"))},_onSetSelected:function(a){var b=this.el,c=this.getBaseCssClasses("selected");b[a?"addClass":"removeClass"](c)},containsElement:function(a){var b=this.el;return b&&(b[0]==a||b.contains(a))}},{HTML_PARSER:{selectable:function(a){return a.hasClass(this.getBaseCssClass("selectable"))}}})},
{requires:["node","component/controller"]});
KISSY.add("menu/menuitem",function(f,b,c){var a=f.all,e=b.extend({isMenuItem:1,handleMouseDownInternal:function(a){e.superclass.handleMouseDownInternal.call(this,a);this.set("highlighted",!0)},handleClickInternal:function(){this.get("selectable")&&this.set("selected",!0);this.fire("click");return!0},_onSetHighlighted:function(b,c){if(!c||!c.byPassSetHighlightedItem)this.get("rendered")?this.get("parent").set("highlightedItem",b?this:null):b&&this.get("parent").set("highlightedItem",this);if(b){var e=
this.el,f=e.parent(function(d){return"visible"!=a(d).css("overflow")},this.get("parent").el.parent());f&&e.scrollIntoView(f,{alignWithTop:!0,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0})}},containsElement:function(a){return this.view.containsElement(a)}},{ATTRS:{focusable:{value:!1},handleMouseEvents:{value:!1},selectable:{view:1},value:{},selected:{view:1},xrender:{value:c}},xclass:"menuitem"});return e},{requires:["component/controller","./menuitem-render"]});
KISSY.add("menu/check-menuitem-render",function(f,b,c){return b.extend([c],{beforeCreateDom:function(a){a.checked&&a.elCls.push(self.getBaseCssClasses("checked"))},_onSetChecked:function(a){var b=this.el,c=this.getBaseCssClasses("checked");b[a?"addClass":"removeClass"](c)}},{ATTRS:{contentTpl:{value:'<div class="{{getBaseCssClasses "checkbox"}}"></div>'+c.ContentTpl}}})},{requires:["./menuitem-render","component/extension/content-render"]});
KISSY.add("menu/check-menuitem",function(f,b,c){return b.extend({handleClickInternal:function(){this.set("checked",!this.get("checked"));this.fire("click");return!0}},{ATTRS:{checked:{view:1},xrender:{value:c}},xclass:"check-menuitem"})},{requires:["./menuitem","./check-menuitem-render"]});
KISSY.add("menu/submenu-render",function(f,b,c){return b.extend([c],{decorateDom:function(a){var b=this.controller,c=b.prefixCls,a=a.one("."+c+"popupmenu"),h=a[0].ownerDocument.body;h.insertBefore(a[0],h.firstChild);h=this.getComponentConstructorByNode(c,a);b.setInternal("menu",new h({srcNode:a,prefixCls:c}))}},{ATTRS:{contentTpl:{value:c.ContentTpl+'<span class="{{prefixCls}}submenu-arrow">\u25ba</span>'}}})},{requires:["./menuitem-render","component/extension/content-render"]});
KISSY.add("menu/submenu",function(f,b,c,a){function e(d){var a=d.target;a!==this&&a.isMenuItem&&d.newVal&&(this.clearHidePopupMenuTimers(),this.get("highlighted")||(this.set("highlighted",!0),a.set("highlighted",!1),a.set("highlighted",!0)))}function g(){var a=this.get("menu"),b={node:this.el,points:["tr","tl"],overflow:{adjustX:1,adjustY:1}};f.mix(a.get("align"),b,!1);a.show();this.el.attr("aria-haspopup",a.el.attr("id"))}function h(){this.get("menu").hide()}var i=b.KeyCode,j=c.extend({isSubMenu:1,
clearShowPopupMenuTimers:function(){var a;if(a=this._showTimer)a.cancel(),this._showTimer=null},clearHidePopupMenuTimers:function(){var a;if(a=this._dismissTimer)a.cancel(),this._dismissTimer=null},clearSubMenuTimers:function(){this.clearHidePopupMenuTimers();this.clearShowPopupMenuTimers()},bindUI:function(){this.on("afterHighlightedChange",e,this)},handleMouseLeaveInternal:function(){this.set("highlighted",!1,{data:{fromMouse:1}});this.clearSubMenuTimers();this.get("menu").get("visible")&&(this._dismissTimer=
f.later(h,1E3*this.get("menuDelay"),!1,this))},handleMouseEnterInternal:function(){this.set("highlighted",!0,{data:{fromMouse:1}});this.clearSubMenuTimers();this.get("menu").get("visible")||(this._showTimer=f.later(g,1E3*this.get("menuDelay"),!1,this))},_onSetHighlighted:function(a,b){b&&(j.superclass._onSetHighlighted.apply(this,arguments),b.fromMouse||(a&&!b.fromKeyboard?g.call(this):a||h.call(this)))},handleClickInternal:function(){g.call(this);j.superclass.handleClickInternal.apply(this,arguments)},
handleKeyDownInternal:function(a){var b=this.get("menu"),c,e=b.get("visible"),h=a.keyCode;if(e){if(!b.handleKeyDownInternal(a))if(h==i.LEFT)this.set("highlighted",!1),this.set("highlighted",!0,{data:{fromKeyboard:1}});else return}else if(h==i.RIGHT)g.call(this),a=b.get("children"),(c=a[0])&&c.set("highlighted",!0,{data:{fromKeyboard:1}});else{if(h==i.ENTER)return this.handleClickInternal(a);return}return!0},containsElement:function(a){return this.get("menu").containsElement(a)},destructor:function(){var a=
this.get("menu");this.clearSubMenuTimers();a.destroy()}},{ATTRS:{menuDelay:{value:0.15},menu:{value:{},getter:function(a){a.isController||(a.xclass=a.xclass||"popupmenu",a=this.createComponent(a),this.setInternal("menu",a));return a},setter:function(a){a.isController&&a.setInternal("parent",this)}},xrender:{value:a}},xclass:"submenu"});return j},{requires:["node","./menuitem","./submenu-render"]});
KISSY.add("menu/popupmenu-render",function(f,b,c,a){return a.extend([b,c])},{requires:["component/extension/content-render","component/extension/shim-render","./menu-render"]});
KISSY.add("menu/popupmenu",function(f,b,c,a){var e=c.extend([b],{getRootMenu:function(){var a=this,b;do b=a,a=a.get("parent");while(a&&(a.isMenuItem||a.isMenu));return b===this?null:b},handleMouseLeaveInternal:function(a){e.superclass.handleMouseLeaveInternal.apply(this,arguments);if(this.get("autoHideOnMouseLeave")){var b=this.getRootMenu();b&&(clearTimeout(b._popupAutoHideTimer),b._popupAutoHideTimer=setTimeout(function(){var a;(a=b.get("highlightedItem"))&&a.set("highlighted",!1)},1E3*this.get("parent").get("menuDelay")))}},
isPopupMenu:1,handleBlurInternal:function(){e.superclass.handleBlurInternal.apply(this,arguments);this.hide()}},{ATTRS:{focusable:{value:!1},autoHideOnMouseLeave:{},contentEl:{view:1},visible:{value:!1},xrender:{value:a}},xclass:"popupmenu"});return e},{requires:["component/extension/align","./base","./popupmenu-render"]});KISSY.add("menu",function(f,b,c,a,e,g){b.Item=c;b.CheckItem=a;b.SubMenu=e;b.PopupMenu=g;return b},{requires:["menu/base","menu/menuitem","menu/check-menuitem","menu/submenu","menu/popupmenu"]});
