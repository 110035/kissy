/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: May 14 20:35
*/
KISSY.add("menu/base",function(f,c,b,a,d,e){function l(e){this.get("view").setAriaActiveDescendant(e.newVal)}var g=c.KeyCodes,k=b.Controller.extend([a.DelegateChildren,a.DecorateChildren],{isMenu:1,_onSetHighlightedItem:function(e,a){var d;e&&a&&(d=a.prevVal)&&d.set("highlighted",!1,{data:{byPassSetHighlightedItem:1}})},_onSetVisible:function(e,a){k.superclass._onSetVisible.apply(this,arguments);var d;!e&&(d=this.get("highlightedItem"))&&d.set("highlighted",!1)},bindUI:function(){this.on("afterHighlightedItemChange",
l,this)},getRootMenu:function(){return this},handleMouseEnter:function(){k.superclass.handleMouseEnter.apply(this,arguments);var e=this.getRootMenu();e&&e._popupAutoHideTimer&&(clearTimeout(e._popupAutoHideTimer),e._popupAutoHideTimer=null);this.get("focusable")&&this.set("focused",!0)},handleBlur:function(e){k.superclass.handleBlur.call(this,e);var a;(a=this.get("highlightedItem"))&&a.set("highlighted",!1)},_getNextEnabledHighlighted:function(a,d){var c=this.get("children"),g=c.length,j=a;do{var o=
c[a];if(!o.get("disabled")&&!1!==o.get("visible"))return c[a];a=(a+d+g)%g}while(a!=j);return e},handleKeyEventInternal:function(a){var d=this.get("highlightedItem");if(d&&d.handleKeydown(a))return!0;var c=this.get("children"),b=c.length;if(0===b)return e;var j;switch(a.keyCode){case g.ESC:(d=this.get("highlightedItem"))&&d.set("highlighted",!1);break;case g.HOME:j=this._getNextEnabledHighlighted(0,1);break;case g.END:j=this._getNextEnabledHighlighted(b-1,-1);break;case g.UP:d?(a=f.indexOf(d,c),b=
(a-1+b)%b):b-=1;j=this._getNextEnabledHighlighted(b,-1);break;case g.DOWN:d?(a=f.indexOf(d,c),b=(a+1+b)%b):b=0,j=this._getNextEnabledHighlighted(b,1)}return j?(j.set("highlighted",!0,{data:{fromKeyboard:1}}),!0):e},containsElement:function(e){if(!1===this.get("visible")||!this.get("view"))return!1;if(this.get("view").containsElement(e))return!0;for(var a=this.get("children"),d=0,b=a.length;d<b;d++){var j=a[d];if(j.containsElement&&j.containsElement(e))return!0}return!1}},{ATTRS:{highlightedItem:{value:null},
xrender:{value:d},defaultChildCfg:{value:{xclass:"menuitem"}}}},{xclass:"menu",priority:10});return k},{requires:["event","component/base","component/extension","./menu-render"]});
KISSY.add("menu/check-menuitem-render",function(f,c,b){return c.extend({initializer:function(){this.get("checked")&&this.get("elCls").push(self.getCssClassWithState("checked"));this.get("childrenElSelectors").contentEl="#ks-menuitem-content{id}"},_onSetContent:function(a){this.get("contentEl").html(a).unselectable()},_onSetChecked:function(a){var d=this.get("el"),e=this.getCssClassWithState("checked");d[a?"addClass":"removeClass"](e)}},{ATTRS:{contentTpl:{value:b},checked:{sync:0}}})},{requires:["./menuitem-render",
"./check-menuitem-tpl"]});KISSY.add("menu/check-menuitem-tpl",function(){return'<div class="{{prefixCls}}menuitem-checkbox"></div> <div id="ks-menuitem-content{{id}}"      class="{{prefixCls}}menuitem-content">{{{content}}} </div>'});
KISSY.add("menu/check-menuitem",function(f,c,b){return c.extend({performActionInternal:function(){this.set("checked",!this.get("checked"));this.fire("click");return!0}},{ATTRS:{checked:{view:1},xrender:{value:b}}},{xclass:"check-menuitem",priority:30})},{requires:["./menuitem","./check-menuitem-render"]});
KISSY.add("menu/filtermenu-render",function(f,c,b,a){return b.extend({initializer:function(){var a=this.get("childrenElSelectors");f.mix(a,{labelEl:"#ks-menu-filter-label{id}",filterWrap:"#ks-menu-filter{id}",menuContent:"#ks-menu-content{id}",filterInput:"#ks-menu-filter-input{id}"})},getChildrenContainerEl:function(){return this.get("menuContent")},getKeyEventTarget:function(){return this.get("filterInput")},_onSetLabel:function(a){this.get("labelEl").html(a)}},{ATTRS:{label:{sync:0},contentTpl:{value:a}},
HTML_PARSER:{labelEl:function(a){return a.one("."+this.get("prefixCls")+"menu-filter-label")},filterWrap:function(a){return a.one("."+this.get("prefixCls")+"menu-filter")},menuContent:function(a){return a.one("."+this.get("prefixCls")+"menu-content")},filterInput:function(a){return a.one("."+this.get("prefixCls")+"menu-filter-input")}}})},{requires:["node","./menu-render","./filtermenu-tpl"]});KISSY.add("menu/filtermenu-tpl",function(){return'<div id="ks-menu-filter{{id}}"      class="{{prefixCls}}menu-filter">     <div id="ks-menu-filter-label{{id}}"          class="{{prefixCls}}menu-filter-label">         {{label}}     </div>     <input id="ks-menu-filter-input{{id}}"            class="{{prefixCls}}menu-filter-label"            autocomplete="off"/> </div> <div id="ks-menu-content{{id}}"      class="{{prefixCls}}menu-content"> </div>'});
KISSY.add("menu/filtermenu",function(f,c,b,a){var d=c.extend([a.DecorateChild],{bindUI:function(){this.get("view").get("filterInput").on("valuechange",this.handleFilterEvent,this)},handleMouseEnter:function(){d.superclass.handleMouseEnter.apply(this,arguments);this.getKeyEventTarget()[0].select()},handleFilterEvent:function(){var a;a=this.get("view").get("filterInput");var d=this.get("highlightedItem");this.set("filterStr",a.val());a=a.val();this.get("allowMultiple")&&(a=a.replace(/^.+,/,""));if(!a&&
d)d.set("highlighted",!1);else if(a&&(!d||!d.get("visible")))(d=this._getNextEnabledHighlighted(0,1))&&d.set("highlighted",!0)},_onSetFilterStr:function(a){this.filterItems(a)},filterItems:function(a){var d=this.get("prefixCls"),b=this.get("view"),c=b.get("labelEl"),b=b.get("filterInput");c[a?"hide":"show"]();if(this.get("allowMultiple")){var c=[],h;h=a.match(/(.+)[,\uff0c]\s*([^\uff0c,]*)/);var i=[];h&&(i=h[1].split(/[,\uff0c]/));/[,\uff0c]$/.test(a)?(c=[],h&&(c=i,h=i[i.length-1],(i=(i=this.get("highlightedItem"))&&
i.get("content"))&&-1<i.indexOf(h)&&h&&(c[c.length-1]=i),b.val(c.join(",")+",")),a=""):(h&&(a=h[2]||""),c=i);this.get("enteredItems").length!=c.length&&this.set("enteredItems",c)}var b=this.get("children"),m=a&&RegExp(f.escapeRegExp(a),"ig");f.each(b,function(b){var j=b.get("content");a?-1<j.indexOf(a)?(b.set("visible",!0),b.get("el").html(j.replace(m,function(a){return"<span class='"+d+"menuitem-hit'>"+a+"</span>"}))):b.set("visible",!1):(b.get("el").html(j),b.set("visible",!0))})},reset:function(){var a=
this.get("view");this.set("filterStr","");this.set("enteredItems",[]);(a=a&&a.get("filterInput"))&&a.val("")},destructor:function(){var a=this.get("view");(a=a&&a.get("filterInput"))&&a.detach()}},{ATTRS:{decorateChildCls:{value:"menu-content"},allowTextSelection:{value:!0},label:{view:1},filterStr:{},enteredItems:{value:[]},allowMultiple:{value:!1},xrender:{value:b}}},{xclass:"filter-menu",priority:20});return d},{requires:["./base","./filtermenu-render","component/extension"]});
KISSY.add("menu/menu-render",function(f,c){return c.Render.extend({initializer:function(){this.get("elAttrs").role="menu"},setAriaActiveDescendant:function(b){var a=this.get("el");b?(b=b.get("el").attr("id"),a.attr("aria-activedescendant",b)):a.attr("aria-activedescendant","")},containsElement:function(b){var a=this.get("el");return a[0]===b||a.contains(b)}})},{requires:["component/base"]});
KISSY.add("menu",function(f,c,b,a,d,e,l,g,k,h,i,m){c.Render=b;c.Item=a;c.CheckItem=d;d.Render=e;a.Render=l;c.SubMenu=g;g.Render=k;c.PopupMenu=h;h.Render=i;c.FilterMenu=m;return c},{requires:"menu/base,menu/menu-render,menu/menuitem,menu/check-menuitem,menu/check-menuitem-render,menu/menuitem-render,menu/submenu,menu/submenu-render,menu/popupmenu,menu/popupmenu-render,menu/filtermenu".split(",")});
KISSY.add("menu/menuitem-render",function(f,c,b){return b.Render.extend({initializer:function(){var a=this.get("renderData");this.get("elAttrs").role=a.selectable?"menuitemradio":"menuitem";a.selected&&this.get("elCls").push(this.getCssClassWithState("selected"))},_onSetSelected:function(a){var b=this.get("el"),c=this.getCssClassWithState("selected");b[a?"addClass":"removeClass"](c)},containsElement:function(a){var b=this.get("el");return b&&(b[0]==a||b.contains(a))}},{ATTRS:{selected:{sync:0}},HTML_PARSER:{selectable:function(a){var b=
this.getCssClassWithPrefix("menuitem-selectable");return a.hasClass(b)}}})},{requires:["node","component/base"]});
KISSY.add("menu/menuitem",function(f,c,b){var a=f.all,d=c.Controller.extend({isMenuItem:1,handleMouseDown:function(a){d.superclass.handleMouseDown.call(this,a);this.set("highlighted",!0)},performActionInternal:function(){this.get("selectable")&&this.set("selected",!0);this.fire("click");return!0},_onSetHighlighted:function(b,c){if(!c||!c.byPassSetHighlightedItem)this.get("parent").set("highlightedItem",b?this:null);if(b){var d=this.get("el"),f=d.parent(function(b){return"visible"!=a(b).css("overflow")},
this.get("parent").get("el").parent());f&&d.scrollIntoView(f,{alignWithTop:!0,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0})}},containsElement:function(a){return this.get("view")&&this.get("view").containsElement(a)},syncUI:function(){this.get("highlighted")&&this.get("parent").set("highlightedItem",this)}},{ATTRS:{focusable:{value:!1},handleMouseEvents:{value:!1},selectable:{view:1},value:{},selected:{view:1},xrender:{value:b}}},{xclass:"menuitem",priority:10});return d},{requires:["component/base",
"./menuitem-render"]});
KISSY.add("menu/popupmenu-render",function(f,c,b){return b.extend([c.Position.Render,6===f.UA.ie?c.Shim.Render:null],{initializer:function(){this.get("childrenElSelectors").contentEl="#ks-contentbox{id}"},getChildrenContainerEl:function(){return this.get("contentEl")}},{HTML_PARSER:{contentEl:function(a){return a.one("."+this.get("prefixCls")+"contentbox")}},ATTRS:{contentEl:{},contentTpl:{value:'<div id="ks-contentbox{{id}}" class="{{prefixCls}}contentbox {{prefixCls}}popupmenu-contentbox"></div>'}}})},{requires:["component/extension",
"./menu-render"]});
KISSY.add("menu/popupmenu",function(f,c,b,a){var d=b.extend([c.DecorateChild,c.Position,c.Align],{getRootMenu:function(){var a=this,b;do b=a,a=a.get("parent");while(a&&(a.isMenuItem||a.isMenu));return b===this?null:b},handleMouseLeave:function(a){d.superclass.handleMouseLeave.apply(this,arguments);var b=this.get("parent");b&&b.isSubMenu&&b.clearSubMenuTimers();if(this.get("autoHideOnMouseLeave")){var c=this.getRootMenu();c&&(clearTimeout(c._popupAutoHideTimer),c._popupAutoHideTimer=setTimeout(function(){var a;
(a=c.get("highlightedItem"))&&a.set("highlighted",!1)},1E3*this.get("parent").get("menuDelay")))}},isPopupMenu:1,handleBlur:function(){d.superclass.handleBlur.apply(this,arguments);this.hide()}},{ATTRS:{decorateChildCls:{value:"contentbox"},focusable:{value:!1},autoHideOnMouseLeave:{},contentEl:{view:1},xrender:{value:a}}},{xclass:"popupmenu",priority:20});return d},{requires:["component/extension","./base","./popupmenu-render"]});
KISSY.add("menu/submenu-render",function(f,c,b){return c.extend({initializer:function(){this.get("childrenElSelectors").contentEl="#ks-menuitem-content{id}"},_onSetContent:function(a){this.get("contentEl").html(a).unselectable()}},{ATTRS:{contentTpl:{value:b}},HTML_PARSER:{content:function(a){return a.children("."+this.get("prefixCls")+"menuitem-content").html()},contentEl:function(a){return a.children("."+this.get("prefixCls")+"menuitem-content")}}})},{requires:["./menuitem-render","./submenu-tpl"]});
KISSY.add("menu/submenu-tpl",function(){return'<span id="ks-menuitem-content{{id}}" class="{{prefixCls}}menuitem-content">     {{{content}}} </span> <span class="{{prefixCls}}submenu-arrow">\u25ba</span>'});
KISSY.add("menu/submenu",function(f,c,b,a,d){function e(a){var b=a.target;b!==this&&b.isMenuItem&&a.newVal&&(l(this),this.get("highlighted")||(this.set("highlighted",!0),b.set("highlighted",!1),b.set("highlighted",!0)))}function l(a){var b;if(b=a.dismissTimer_)b.cancel(),a.dismissTimer_=null;if(b=a.showTimer_)b.cancel(),a.showTimer_=null}function g(a,b){var c=a.get("menu");if(c&&!c.isController)if(b)a.setInternal("menu",c=a.createChild(c));else return null;return c}function k(){var a,b,c=g(this,1);
c&&(a=this.get("el"),b=c.get("align"),delete b.node,b=f.clone(b),b.node=a,b.points=b.points||["tr","tl"],c.set("align",b),c.show(),a.attr("aria-haspopup",c.get("el").attr("id")))}function h(){var a=g(this);a&&a.hide()}var i=c.KeyCodes,m=d.DecorateChild,n=b.extend([d.DecorateChild],{isSubMenu:1,clearSubMenuTimers:function(){l(this)},bindUI:function(){this.on("afterHighlightedChange",e,this)},handleMouseLeave:function(){this.set("highlighted",!1,{data:{fromMouse:1}});l(this);var a=g(this);a&&a.get("visible")&&
(this.dismissTimer_=f.later(h,1E3*this.get("menuDelay"),!1,this))},handleMouseEnter:function(){this.set("highlighted",!0,{data:{fromMouse:1}});l(this);var a=g(this);if(!a||!a.get("visible"))this.showTimer_=f.later(k,1E3*this.get("menuDelay"),!1,this)},_onSetHighlighted:function(a,b){b&&(n.superclass._onSetHighlighted.apply(this,arguments),b.fromMouse||(a&&!b.fromKeyboard?k.call(this):a||h.call(this)))},performActionInternal:function(){k.call(this);n.superclass.performActionInternal.apply(this,arguments)},
handleKeydown:function(a){var b=g(this),d,f=b&&b.get("visible"),e=a.keyCode;if(f){if(!b.handleKeydown(a))if(e==i.LEFT)this.set("highlighted",!1),this.set("highlighted",!0,{data:{fromKeyboard:1}});else return}else if(e==i.RIGHT){if(k.call(this),b=g(this))a=b.get("children"),(d=a[0])&&d.set("highlighted",!0,{data:{fromKeyboard:1}})}else{if(a.keyCode==c.KeyCodes.ENTER)return this.performActionInternal(a);return}return!0},containsElement:function(a){var b=g(this);return b&&b.containsElement(a)},decorateChildrenInternal:function(a,
b){b.prependTo(b[0].ownerDocument.body);this.setInternal("menu",m.prototype.decorateChildrenInternal.call(this,a,b,this.get("menu")))},destructor:function(){var a=g(this);l(this);a&&a.destroy&&a.destroy()}},{ATTRS:{decorateChildCls:{value:"popupmenu"},menuDelay:{value:0.15},menu:{setter:function(a){a&&a.isController&&a.setInternal("parent",this)}},defaultChildCfg:{value:{xclass:"popupmenu"}},xrender:{value:a}}},{xclass:"submenu",priority:20});return n},{requires:["event","./menuitem","./submenu-render",
"component/extension"]});
