/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: May 30 01:42
*/
KISSY.add("menu/menu-render",function(h,a){return a.Render.extend({initializer:function(){this.get("elAttrs").role="menu"},setAriaActiveDescendant:function(a){var d=this.get("el");a?(a=a.get("el").attr("id"),d.attr("aria-activedescendant",a)):d.attr("aria-activedescendant","")},containsElement:function(a){var d=this.get("el");return d[0]===a||d.contains(a)}})},{requires:["component/base"]});
KISSY.add("menu/base",function(h,a,e,d,f,b){function i(b){this.get("view").setAriaActiveDescendant(b.newVal)}var g=a.KeyCodes,c=e.Controller.extend([d.DelegateChildren,d.DecorateChildren],{isMenu:1,_onSetHighlightedItem:function(b,a){var d;b&&a&&(d=a.prevVal)&&d.set("highlighted",!1,{data:{byPassSetHighlightedItem:1}})},_onSetVisible:function(b,a){c.superclass._onSetVisible.apply(this,arguments);var d;!b&&(d=this.get("highlightedItem"))&&d.set("highlighted",!1)},bindUI:function(){this.on("afterHighlightedItemChange",
i,this)},getRootMenu:function(){return this},handleMouseEnter:function(){c.superclass.handleMouseEnter.apply(this,arguments);var b=this.getRootMenu();b&&b._popupAutoHideTimer&&(clearTimeout(b._popupAutoHideTimer),b._popupAutoHideTimer=null);this.get("focusable")&&this.set("focused",!0)},handleBlur:function(b){c.superclass.handleBlur.call(this,b);var a;(a=this.get("highlightedItem"))&&a.set("highlighted",!1)},_getNextEnabledHighlighted:function(a,d){var g=this.get("children"),i=g.length,j=a;do{var o=
g[a];if(!o.get("disabled")&&!1!==o.get("visible"))return g[a];a=(a+d+i)%i}while(a!=j);return b},handleKeyEventInternal:function(a){var d=this.get("highlightedItem");if(d&&d.handleKeydown(a))return!0;var i=this.get("children"),c=i.length;if(0===c)return b;var j;switch(a.keyCode){case g.ESC:(d=this.get("highlightedItem"))&&d.set("highlighted",!1);break;case g.HOME:j=this._getNextEnabledHighlighted(0,1);break;case g.END:j=this._getNextEnabledHighlighted(c-1,-1);break;case g.UP:d?(a=h.indexOf(d,i),c=
(a-1+c)%c):c-=1;j=this._getNextEnabledHighlighted(c,-1);break;case g.DOWN:d?(a=h.indexOf(d,i),c=(a+1+c)%c):c=0,j=this._getNextEnabledHighlighted(c,1)}return j?(j.set("highlighted",!0,{data:{fromKeyboard:1}}),!0):b},containsElement:function(b){if(!1===this.get("visible")||!this.get("view"))return!1;if(this.get("view").containsElement(b))return!0;for(var a=this.get("children"),d=0,c=a.length;d<c;d++){var j=a[d];if(j.containsElement&&j.containsElement(b))return!0}return!1}},{ATTRS:{highlightedItem:{value:null},
xrender:{value:f},defaultChildCfg:{value:{xclass:"menuitem"}}}},{xclass:"menu"});return c},{requires:["event","component/base","component/extension","./menu-render"]});
KISSY.add("menu/menuitem-render",function(h,a,e){return e.Render.extend({initializer:function(){var a=this.get("renderData");this.get("elAttrs").role=a.selectable?"menuitemradio":"menuitem";a.selected&&this.get("elCls").push(this.getBaseCssClasses("selected"))},_onSetSelected:function(a){var f=this.get("el"),b=this.getBaseCssClasses("selected");f[a?"addClass":"removeClass"](b)},containsElement:function(a){var f=this.get("el");return f&&(f[0]==a||f.contains(a))}},{ATTRS:{selected:{sync:0}},HTML_PARSER:{selectable:function(a){return a.hasClass(this.getBaseCssClass("selectable"))}}})},
{requires:["node","component/base"]});
KISSY.add("menu/menuitem",function(h,a,e){var d=h.all,f=a.Controller.extend({isMenuItem:1,handleMouseDown:function(b){f.superclass.handleMouseDown.call(this,b);this.set("highlighted",!0)},performActionInternal:function(){this.get("selectable")&&this.set("selected",!0);this.fire("click");return!0},_onSetHighlighted:function(b,a){if(!a||!a.byPassSetHighlightedItem)this.get("parent").set("highlightedItem",b?this:null);if(b){var g=this.get("el"),c=g.parent(function(b){return"visible"!=d(b).css("overflow")},
this.get("parent").get("el").parent());c&&g.scrollIntoView(c,{alignWithTop:!0,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0})}},containsElement:function(b){return this.get("view")&&this.get("view").containsElement(b)},syncUI:function(){this.get("highlighted")&&this.get("parent").set("highlightedItem",this)}},{ATTRS:{focusable:{value:!1},handleMouseEvents:{value:!1},selectable:{view:1},value:{},selected:{view:1},xrender:{value:e}}},{xclass:"menuitem"});return f},{requires:["component/base","./menuitem-render"]});
KISSY.add("menu/check-menuitem-render",function(h,a,e){return a.extend([e.ContentRender],{initializer:function(){this.get("checked")&&this.get("elCls").push(self.getBaseCssClasses("checked"))},_onSetChecked:function(a){var f=this.get("el"),b=this.getBaseCssClasses("checked");f[a?"addClass":"removeClass"](b)}},{ATTRS:{contentTpl:{value:'<div class="{{getBaseCssClasses "checkbox"}}"></div>'+e.ContentRender.ContentTpl},checked:{sync:0}}})},{requires:["./menuitem-render","component/extension"]});
KISSY.add("menu/check-menuitem",function(h,a,e){return a.extend({performActionInternal:function(){this.set("checked",!this.get("checked"));this.fire("click");return!0}},{ATTRS:{checked:{view:1},xrender:{value:e}}},{xclass:"check-menuitem"})},{requires:["./menuitem","./check-menuitem-render"]});
KISSY.add("menu/submenu-render",function(h,a,e){return a.extend([e.ContentRender],{},{ATTRS:{contentTpl:{value:e.ContentRender.ContentTpl+'<span class="{{prefixCls}}submenu-arrow">\u25ba</span>'}}})},{requires:["./menuitem-render","component/extension"]});
KISSY.add("menu/submenu",function(h,a,e,d,f){function b(b){var a=b.target;a!==this&&a.isMenuItem&&b.newVal&&(i(this),this.get("highlighted")||(this.set("highlighted",!0),a.set("highlighted",!1),a.set("highlighted",!0)))}function i(b){var a;if(a=b.dismissTimer_)a.cancel(),b.dismissTimer_=null;if(a=b.showTimer_)a.cancel(),b.showTimer_=null}function g(b,a){var c=b.get("menu");if(c&&!c.isController)if(a)b.setInternal("menu",c=b.createChild(c));else return null;return c}function c(){var b,a,c=g(this,1);
c&&(b=this.get("el"),a=c.get("align"),delete a.node,a=h.clone(a),a.node=b,a.points=a.points||["tr","tl"],c.set("align",a),c.show(),b.attr("aria-haspopup",c.get("el").attr("id")))}function k(){var a=g(this);a&&a.hide()}var m=a.KeyCodes,l=f.DecorateChild,n=e.extend([f.DecorateChild],{isSubMenu:1,clearSubMenuTimers:function(){i(this)},bindUI:function(){this.on("afterHighlightedChange",b,this)},handleMouseLeave:function(){this.set("highlighted",!1,{data:{fromMouse:1}});i(this);var a=g(this);a&&a.get("visible")&&
(this.dismissTimer_=h.later(k,1E3*this.get("menuDelay"),!1,this))},handleMouseEnter:function(){this.set("highlighted",!0,{data:{fromMouse:1}});i(this);var a=g(this);if(!a||!a.get("visible"))this.showTimer_=h.later(c,1E3*this.get("menuDelay"),!1,this)},_onSetHighlighted:function(a,b){b&&(n.superclass._onSetHighlighted.apply(this,arguments),b.fromMouse||(a&&!b.fromKeyboard?c.call(this):a||k.call(this)))},performActionInternal:function(){c.call(this);n.superclass.performActionInternal.apply(this,arguments)},
handleKeydown:function(b){var d=g(this),i,f=d&&d.get("visible"),e=b.keyCode;if(f){if(!d.handleKeydown(b))if(e==m.LEFT)this.set("highlighted",!1),this.set("highlighted",!0,{data:{fromKeyboard:1}});else return}else if(e==m.RIGHT){if(c.call(this),d=g(this))b=d.get("children"),(i=b[0])&&i.set("highlighted",!0,{data:{fromKeyboard:1}})}else{if(b.keyCode==a.KeyCodes.ENTER)return this.performActionInternal(b);return}return!0},containsElement:function(a){var b=g(this);return b&&b.containsElement(a)},decorateChildrenInternal:function(a,
b){b.prependTo(b[0].ownerDocument.body);this.setInternal("menu",l.prototype.decorateChildrenInternal.call(this,a,b,this.get("menu")))},destructor:function(){var b=g(this);i(this);b&&b.destroy&&b.destroy()}},{ATTRS:{decorateChildCls:{valueFn:function(){return this.prefixCls+"popupmenu"}},menuDelay:{value:0.15},menu:{setter:function(b){b&&b.isController&&b.setInternal("parent",this)}},defaultChildCfg:{value:{xclass:"popupmenu"}},xrender:{value:d}}},{xclass:"submenu"});return n},{requires:["event","./menuitem",
"./submenu-render","component/extension"]});KISSY.add("menu/popupmenu-render",function(h,a,e){return e.extend([a.ContentRender,a.PositionRender,a.ShimRender])},{requires:["component/extension","./menu-render"]});
KISSY.add("menu/popupmenu",function(h,a,e,d){var f=e.extend([a.DecorateChild,a.Position,a.Align],{getRootMenu:function(){var b=this,a;do a=b,b=b.get("parent");while(b&&(b.isMenuItem||b.isMenu));return a===this?null:a},handleMouseLeave:function(b){f.superclass.handleMouseLeave.apply(this,arguments);var a=this.get("parent");a&&a.isSubMenu&&a.clearSubMenuTimers();if(this.get("autoHideOnMouseLeave")){var d=this.getRootMenu();d&&(clearTimeout(d._popupAutoHideTimer),d._popupAutoHideTimer=setTimeout(function(){var b;
(b=d.get("highlightedItem"))&&b.set("highlighted",!1)},1E3*this.get("parent").get("menuDelay")))}},isPopupMenu:1,handleBlur:function(){f.superclass.handleBlur.apply(this,arguments);this.hide()}},{ATTRS:{focusable:{value:!1},autoHideOnMouseLeave:{},contentEl:{view:1},xrender:{value:d}}},{xclass:"popupmenu"});return f},{requires:["component/extension","./base","./popupmenu-render"]});KISSY.add("menu/filtermenu-tpl",function(){return'<div id="ks-filter-menu-input-wrap{{id}}" class="{{getBaseCssClasses "input-wrap"}}"> <div id="ks-filter-menu-placeholder{{id}}" class="{{getBaseCssClasses "placeholder"}}"> {{placeholder}} </div> <input id="ks-filter-menu-input{{id}}" class="{{getBaseCssClasses "input"}}" autocomplete="off"/> </div> <div id="ks-content{{id}}" class="{{getBaseCssClasses "content"}}"> </div>'});
KISSY.add("menu/filtermenu-render",function(h,a,e,d,f){return e.extend([f.ContentRender],{initializer:function(){var b=this.get("childrenElSelectors");h.mix(b,{placeholderEl:"#ks-filter-menu-placeholder{id}",filterInputWrap:"#ks-filter-menu-input-wrap{id}",filterInput:"#ks-filter-menu-input{id}"})},getKeyEventTarget:function(){return this.get("filterInput")},_onSetPlaceholder:function(b){this.get("placeholderEl").html(b)}},{ATTRS:{placeholder:{sync:0},contentTpl:{value:d}},HTML_PARSER:{placeholderEl:function(b){return b.one("."+
this.getBaseCssClass("placeholder"))},filterInputWrap:function(b){return b.one("."+this.getBaseCssClass("input-wrap"))},filterInput:function(b){return b.one("."+this.getBaseCssClass("input"))}}})},{requires:["node","./menu-render","./filtermenu-tpl","component/extension"]});
KISSY.add("menu/filtermenu",function(h,a,e,d){var f=a.extend([d.DecorateChild],{bindUI:function(){this.get("view").get("filterInput").on("valuechange",this.handleFilterEvent,this)},handleMouseEnter:function(){f.superclass.handleMouseEnter.apply(this,arguments);this.getKeyEventTarget()[0].select()},handleFilterEvent:function(){var b;b=this.get("view").get("filterInput");var a=this.get("highlightedItem");this.set("filterStr",b.val());b=b.val();this.get("allowMultiple")&&(b=b.replace(/^.+,/,""));if(!b&&
a)a.set("highlighted",!1);else if(b&&(!a||!a.get("visible")))(a=this._getNextEnabledHighlighted(0,1))&&a.set("highlighted",!0)},_onSetFilterStr:function(a){this.filterItems(a)},filterItems:function(a){var d=this.prefixCls,g=this.get("view"),c=g.get("placeholderEl"),g=g.get("filterInput");c[a?"hide":"show"]();if(this.get("allowMultiple")){var c=[],f;f=a.match(/(.+)[,\uff0c]\s*([^\uff0c,]*)/);var e=[];f&&(e=f[1].split(/[,\uff0c]/));/[,\uff0c]$/.test(a)?(c=[],f&&(c=e,f=e[e.length-1],(e=(e=this.get("highlightedItem"))&&
e.get("content"))&&-1<e.indexOf(f)&&f&&(c[c.length-1]=e),g.val(c.join(",")+",")),a=""):(f&&(a=f[2]||""),c=e);this.get("enteredItems").length!=c.length&&this.set("enteredItems",c)}var g=this.get("children"),l=a&&RegExp(h.escapeRegExp(a),"ig");h.each(g,function(c){var e=c.get("content");a?-1<e.indexOf(a)?(c.set("visible",!0),c.get("el").html(e.replace(l,function(a){return"<span class='"+d+"menuitem-hit'>"+a+"</span>"}))):c.set("visible",!1):(c.get("el").html(e),c.set("visible",!0))})},reset:function(){var a=
this.get("view");this.set("filterStr","");this.set("enteredItems",[]);(a=a&&a.get("filterInput"))&&a.val("")},destructor:function(){var a=this.get("view");(a=a&&a.get("filterInput"))&&a.detach()}},{ATTRS:{contentEl:{view:!0},allowTextSelection:{value:!0},placeholder:{view:1},filterStr:{},enteredItems:{value:[]},allowMultiple:{value:!1},xrender:{value:e}}},{xclass:"filter-menu"});return f},{requires:["./base","./filtermenu-render","component/extension"]});
KISSY.add("menu",function(h,a,e,d,f,b,i,g,c,k,m,l){a.Render=e;a.Item=d;a.CheckItem=f;f.Render=b;d.Render=i;a.SubMenu=g;g.Render=c;a.PopupMenu=k;k.Render=m;a.FilterMenu=l;return a},{requires:"menu/base,menu/menu-render,menu/menuitem,menu/check-menuitem,menu/check-menuitem-render,menu/menuitem-render,menu/submenu,menu/submenu-render,menu/popupmenu,menu/popupmenu-render,menu/filtermenu".split(",")});
