/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: May 13 21:11
*/
KISSY.add("menu/base",function(f,c,d,a,e){function b(b){this.get("view").setAriaActiveDescendant(b.newVal)}var h=c.KeyCodes,i=d.Container.extend({isMenu:1,_onSetHighlightedItem:function(b,a){var e;b&&a&&(e=a.prevVal)&&e.set("highlighted",!1,{data:{byPassSetHighlightedItem:1}})},_onSetVisible:function(b,a){i.superclass._onSetVisible.apply(this,arguments);var e;!b&&(e=this.get("highlightedItem"))&&e.set("highlighted",!1)},bindUI:function(){this.on("afterHighlightedItemChange",b,this)},getRootMenu:function(){return this},
handleMouseEnter:function(){i.superclass.handleMouseEnter.apply(this,arguments);var b=this.getRootMenu();b&&b._popupAutoHideTimer&&(clearTimeout(b._popupAutoHideTimer),b._popupAutoHideTimer=null);this.get("focusable")&&this.set("focused",!0)},handleBlur:function(b){i.superclass.handleBlur.call(this,b);var a;(a=this.get("highlightedItem"))&&a.set("highlighted",!1)},_getNextEnabledHighlighted:function(b,a){var d=this.get("children"),h=d.length,g=b;do{var n=d[b];if(!n.get("disabled")&&!1!==n.get("visible"))return d[b];
b=(b+a+h)%h}while(b!=g);return e},handleKeyEventInternal:function(b){var a=this.get("highlightedItem");if(a&&a.handleKeydown(b))return!0;var d=this.get("children"),c=d.length;if(0===c)return e;var g;switch(b.keyCode){case h.ESC:(a=this.get("highlightedItem"))&&a.set("highlighted",!1);break;case h.HOME:g=this._getNextEnabledHighlighted(0,1);break;case h.END:g=this._getNextEnabledHighlighted(c-1,-1);break;case h.UP:a?(b=f.indexOf(a,d),c=(b-1+c)%c):c-=1;g=this._getNextEnabledHighlighted(c,-1);break;
case h.DOWN:a?(b=f.indexOf(a,d),c=(b+1+c)%c):c=0,g=this._getNextEnabledHighlighted(c,1)}return g?(g.set("highlighted",!0,{data:{fromKeyboard:1}}),!0):e},containsElement:function(b){if(!1===this.get("visible")||!this.get("view"))return!1;if(this.get("view").containsElement(b))return!0;for(var a=this.get("children"),c=0,e=a.length;c<e;c++){var g=a[c];if(g.containsElement&&g.containsElement(b))return!0}return!1}},{ATTRS:{highlightedItem:{value:null},xrender:{value:a},defaultChildCfg:{value:{xclass:"menuitem"}}}},
{xclass:"menu",priority:10});return i},{requires:["event","component/base","./menu-render"]});
KISSY.add("menu/check-menuitem-render",function(f,c,d){return c.extend({initializer:function(){this.get("checked")&&this.get("elCls").push(self.getCssClassWithState("checked"));this.get("childrenElSelectors").contentEl="#{prefixCls}menuitem-content{id}"},_onSetContent:function(a){this.get("contentEl").html(a).unselectable()},_onSetChecked:function(a){var c=this.get("el"),b=this.getCssClassWithState("checked");c[a?"addClass":"removeClass"](b)}},{ATTRS:{contentTpl:{value:d},checked:{sync:0}}})},{requires:["./menuitem-render",
"./check-menuitem-tpl"]});KISSY.add("menu/check-menuitem-tpl",function(){return'<div class="{{prefixCls}}menuitem-checkbox"></div>\n<div id="{{prefixCls}}menuitem-content{{id}}"\n     class="{{prefixCls}}menuitem-content">{{{content}}}\n</div>'});
KISSY.add("menu/check-menuitem",function(f,c,d){return c.extend({performActionInternal:function(){this.set("checked",!this.get("checked"));this.fire("click");return!0}},{ATTRS:{checked:{view:1},xrender:{value:d}}},{xclass:"check-menuitem",priority:30})},{requires:["./menuitem","./check-menuitem-render"]});
KISSY.add("menu/filtermenu-render",function(f,c,d,a){return d.extend({initializer:function(){var a=this.get("childrenElSelectors");f.mix(a,{labelEl:"#menu-filter-label{id}",filterWrap:"#menu-filter{id}",menuContent:"#menu-content{id}",filterInput:"#menu-filter-input{id}"})},getChildrenContainerEl:function(){return this.get("menuContent")},getKeyEventTarget:function(){return this.get("filterInput")},_onSetLabel:function(a){this.get("labelEl").html(a)}},{ATTRS:{label:{sync:0},contentTpl:{value:a}},
HTML_PARSER:{labelEl:function(a){return a.one("."+this.get("prefixCls")+"menu-filter-label")},filterWrap:function(a){return a.one("."+this.get("prefixCls")+"menu-filter")},menuContent:function(a){return a.one("."+this.get("prefixCls")+"menu-content")},filterInput:function(a){return a.one("."+this.get("prefixCls")+"menu-filter-input")}}})},{requires:["node","./menu-render","./filtermenu-tpl"]});KISSY.add("menu/filtermenu-tpl",function(){return'<div id="ks-menu-filter{{id}}"\n     class="{{prefixCls}}menu-filter">\n    <div id="ks-menu-filter-label{{id}}"\n         class="{{prefixCls}}menu-filter-label">\n        {{label}}\n    </div>\n    <input id="ks-menu-filter-input{{id}}"\n           class="{{prefixCls}}menu-filter-label"\n           autocomplete="off"/>\n</div>\n<div id="ks-menu-content{{id}}"\n     class="{{prefixCls}}menu-content">\n</div>'});
KISSY.add("menu/filtermenu",function(f,c,d,a){var e=d.extend([c.DecorateChild],{bindUI:function(){this.get("view").get("filterInput").on("valuechange",this.handleFilterEvent,this)},handleMouseEnter:function(){e.superclass.handleMouseEnter.apply(this,arguments);this.getKeyEventTarget()[0].select()},handleFilterEvent:function(){var b;b=this.get("view").get("filterInput");var a=this.get("highlightedItem");this.set("filterStr",b.val());b=b.val();this.get("allowMultiple")&&(b=b.replace(/^.+,/,""));if(!b&&
a)a.set("highlighted",!1);else if(b&&(!a||!a.get("visible")))(a=this._getNextEnabledHighlighted(0,1))&&a.set("highlighted",!0)},_onSetFilterStr:function(b){this.filterItems(b)},filterItems:function(b){var a=this.get("prefixCls"),c=this.get("view"),d=c.get("labelEl"),c=c.get("filterInput");d[b?"hide":"show"]();if(this.get("allowMultiple")){var d=[],e;e=b.match(/(.+)[,\uff0c]\s*([^\uff0c,]*)/);var j=[];e&&(j=e[1].split(/[,\uff0c]/));/[,\uff0c]$/.test(b)?(d=[],e&&(d=j,e=j[j.length-1],(j=(j=this.get("highlightedItem"))&&
j.get("content"))&&-1<j.indexOf(e)&&e&&(d[d.length-1]=j),c.val(d.join(",")+",")),b=""):(e&&(b=e[2]||""),d=j);this.get("enteredItems").length!=d.length&&this.set("enteredItems",d)}var c=this.get("children"),k=b&&RegExp(f.escapeRegExp(b),"ig");f.each(c,function(g){var c=g.get("content");b?-1<c.indexOf(b)?(g.set("visible",!0),g.get("el").html(c.replace(k,function(b){return"<span class='"+a+"menuitem-hit'>"+b+"</span>"}))):g.set("visible",!1):(g.get("el").html(c),g.set("visible",!0))})},reset:function(){var b=
this.get("view");this.set("filterStr","");this.set("enteredItems",[]);(b=b&&b.get("filterInput"))&&b.val("")},destructor:function(){var b=this.get("view");(b=b&&b.get("filterInput"))&&b.detach()}},{ATTRS:{allowTextSelection:{value:!0},label:{view:1},filterStr:{},enteredItems:{value:[]},allowMultiple:{value:!1},decorateChildCls:{value:"menu-content"},xrender:{value:a}}},{xclass:"filter-menu",priority:20});return e},{requires:["component/base","./base","./filtermenu-render"]});
KISSY.add("menu/menu-render",function(f,c){return c.Render.extend({initializer:function(){this.get("elAttrs").role="menu"},setAriaActiveDescendant:function(c){var a=this.get("el");c?(c=c.get("el").attr("id"),a.attr("aria-activedescendant",c)):a.attr("aria-activedescendant","")},containsElement:function(c){var a=this.get("el");return a[0]===c||a.contains(c)}})},{requires:["component/base"]});
KISSY.add("menu",function(f,c,d,a,e,b,h,i,l,m,j,k){c.Render=d;c.Item=a;c.CheckItem=e;e.Render=b;a.Render=h;c.SubMenu=i;i.Render=l;c.PopupMenu=m;m.Render=j;c.FilterMenu=k;return c},{requires:"menu/base,menu/menu-render,menu/menuitem,menu/check-menuitem,menu/check-menuitem-render,menu/menuitem-render,menu/submenu,menu/submenu-render,menu/popupmenu,menu/popupmenu-render,menu/filtermenu".split(",")});
KISSY.add("menu/menuitem-render",function(f,c,d){return d.Render.extend({initializer:function(){var a=this.get("renderData");this.get("elAttrs").role=a.selectable?"menuitemradio":"menuitem";a.selected&&this.get("elCls").push(this.getCssClassWithState("selected"))},_onSetSelected:function(a){var c=this.get("el"),b=this.getCssClassWithState("selected");c[a?"addClass":"removeClass"](b)},containsElement:function(a){var c=this.get("el");return c&&(c[0]==a||c.contains(a))}},{ATTRS:{selected:{sync:0}},HTML_PARSER:{selectable:function(a){var c=
this.getCssClassWithPrefix("menuitem-selectable");return a.hasClass(c)}}})},{requires:["node","component/base"]});
KISSY.add("menu/menuitem",function(f,c,d){var a=f.all,e=c.Controller.extend({isMenuItem:1,handleMouseDown:function(b){e.superclass.handleMouseDown.call(this,b);this.set("highlighted",!0)},performActionInternal:function(){this.get("selectable")&&this.set("selected",!0);this.fire("click");return!0},_onSetHighlighted:function(b,c){if(!c||!c.byPassSetHighlightedItem)this.get("parent").set("highlightedItem",b?this:null);if(b){var d=this.get("el"),e=d.parent(function(b){return"visible"!=a(b).css("overflow")},
this.get("parent").get("el").parent());e&&d.scrollIntoView(e,{alignWithTop:!0,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0})}},containsElement:function(b){return this.get("view")&&this.get("view").containsElement(b)},syncUI:function(){this.get("highlighted")&&this.get("parent").set("highlightedItem",this)}},{ATTRS:{focusable:{value:!1},handleMouseEvents:{value:!1},selectable:{view:1},value:{},selected:{view:1},xrender:{value:d}}},{xclass:"menuitem",priority:10});return e},{requires:["component/base",
"./menuitem-render"]});
KISSY.add("menu/popupmenu-render",function(f,c,d){return d.extend([c.Position.Render,6===f.UA.ie?c.Shim.Render:null],{initializer:function(){this.get("childrenElSelectors").contentEl="#{prefixCls}contentbox{id}"},createDom:function(){if(!this.get("contentEl")){var a=f.all((new XTemplate(this.get("contentTpl"))).render({prefixCls:this.get("prefixCls"),content:""}));a.append(this.get("el").contents());this.setInternal("contentEl",a);this.get("el").append(a)}},getChildrenContainerEl:function(){return this.get("contentEl")}},{ATTRS:{contentTpl:{value:'<div id="{{prefixCls}}contentbox{{id}}" class="{{prefixCls}}contentbox {{prefixCls}}popupmenu-contentbox"></div>'}}})},
{requires:["component/extension","./menu-render"]});
KISSY.add("menu/popupmenu",function(f,c,d,a){var e=d.extend([c.Position,c.Align],{getRootMenu:function(){var b=this,a;do a=b,b=b.get("parent");while(b&&(b.isMenuItem||b.isMenu));return a===this?null:a},handleMouseLeave:function(b){e.superclass.handleMouseLeave.apply(this,arguments);var a=this.get("parent");a&&a.isSubMenu&&a.clearSubMenuTimers();if(this.get("autoHideOnMouseLeave")){var c=this.getRootMenu();c&&(clearTimeout(c._popupAutoHideTimer),c._popupAutoHideTimer=setTimeout(function(){var a;(a=
c.get("highlightedItem"))&&a.set("highlighted",!1)},1E3*this.get("parent").get("menuDelay")))}},isPopupMenu:1,handleBlur:function(){e.superclass.handleBlur.apply(this,arguments);this.hide()}},{ATTRS:{focusable:{value:!1},autoHideOnMouseLeave:{},xrender:{value:a}}},{xclass:"popupmenu",priority:20});return e},{requires:["component/extension","./base","./popupmenu-render"]});
KISSY.add("menu/submenu-render",function(f,c,d){return c.extend({initializer:function(){this.get("childrenElSelectors").contentEl="#{prefixCls}menuitem-content{id}"},_onSetContent:function(a){this.get("contentEl").html(a).unselectable()}},{ATTRS:{contentTpl:{value:d}},HTML_PARSER:{content:function(){return el.children("."+this.get("prefixCls")+"menuitem-content").html()},contentEl:function(a){return a.children("."+this.get("prefixCls")+"menuitem-content")}}})},{requires:["./menuitem-render","./submenu-tpl"]});
KISSY.add("menu/submenu-tpl",function(){return'<span id="{{prefixCls}}menuitem-content{{id}}"\nclass="{{prefixCls}}menuitem-content">\n    {{{content}}}\n</span>\n<span class="{{prefixCls}}submenu-arrow">\u25ba</span>'});
KISSY.add("menu/submenu",function(f,c,d,a,e){function b(a){var b=a.target;b!==this&&b.isMenuItem&&a.newVal&&(h(this),this.get("highlighted")||(this.set("highlighted",!0),b.set("highlighted",!1),b.set("highlighted",!0)))}function h(a){var b;if(b=a.dismissTimer_)b.cancel(),a.dismissTimer_=null;if(b=a.showTimer_)b.cancel(),a.showTimer_=null}function i(a,b){var c=a.get("menu");if(c&&!c.isController)if(b)c=d.create(c,a),a.setInternal("menu",c);else return null;return c}function l(){var a,b,c=i(this,1);
c&&(a=this.get("el"),b=c.get("align"),delete b.node,b=f.clone(b),b.node=a,b.points=b.points||["tr","tl"],c.set("align",b),c.show(),a.attr("aria-haspopup",c.get("el").attr("id")))}function m(){var a=i(this);a&&a.hide()}var j=c.KeyCodes,k=a.extend([d.DecorateChild],{isSubMenu:1,clearSubMenuTimers:function(){h(this)},bindUI:function(){this.on("afterHighlightedChange",b,this)},handleMouseLeave:function(){this.set("highlighted",!1,{data:{fromMouse:1}});h(this);var a=i(this);a&&a.get("visible")&&(this.dismissTimer_=
f.later(m,1E3*this.get("menuDelay"),!1,this))},handleMouseEnter:function(){this.set("highlighted",!0,{data:{fromMouse:1}});h(this);var a=i(this);if(!a||!a.get("visible"))this.showTimer_=f.later(l,1E3*this.get("menuDelay"),!1,this)},_onSetHighlighted:function(a,b){b&&(k.superclass._onSetHighlighted.apply(this,arguments),b.fromMouse||(a&&!b.fromKeyboard?l.call(this):a||m.call(this)))},performActionInternal:function(){l.call(this);k.superclass.performActionInternal.apply(this,arguments)},handleKeydown:function(a){var b=
i(this),d,e=b&&b.get("visible"),f=a.keyCode;if(e){if(!b.handleKeydown(a))if(f==j.LEFT)this.set("highlighted",!1),this.set("highlighted",!0,{data:{fromKeyboard:1}});else return}else if(f==j.RIGHT){if(l.call(this),b=i(this))a=b.get("children"),(d=a[0])&&d.set("highlighted",!0,{data:{fromKeyboard:1}})}else{if(a.keyCode==c.KeyCodes.ENTER)return this.performActionInternal(a);return}return!0},containsElement:function(a){var b=i(this);return b&&b.containsElement(a)},decorateChildrenInternal:function(a,b){b.css("top",
"-9999").prependTo(b[0].ownerDocument.body);this.setInternal("menu",d.DecorateChild.prototype.decorateChildrenInternal.call(this,a,b,this.get("menu")))},destructor:function(){var a=i(this);h(this);a&&a.destroy&&a.destroy()}},{ATTRS:{menuDelay:{value:0.15},menu:{setter:function(a){a&&a.isController&&a.setInternal("parent",this)}},defaultChildCfg:{value:{xclass:"popupmenu"}},decorateChildCls:{value:"popupmenu"},xrender:{value:e}}},{xclass:"submenu",priority:20});return k},{requires:["event","component/base",
"./menuitem","./submenu-render"]});
