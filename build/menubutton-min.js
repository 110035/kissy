/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Jun 21 01:27
*/
KISSY.add("menubutton/render",function(f,d,g){return d.ATTRS.xrender.value.extend([g],{decorateDom:function(c){var f=this.controller,h=f.prefixCls,c=c.one("."+h+"popupmenu"),d=c[0].ownerDocument.body;d.insertBefore(c[0],d.firstChild);d=this.getComponentConstructorByNode(h,c);f.setInternal("menu",new d({srcNode:c,prefixCls:h}))},beforeCreateDom:function(c){f.mix(c.elAttrs,{"aria-expanded":!1,"aria-haspopup":!0})},_onSetCollapsed:function(c){var d=this.el,f=this.getBaseCssClass("open");d[c?"removeClass":
"addClass"](f).attr("aria-expanded",!c)},setAriaActiveDescendant:function(c){this.el.attr("aria-activedescendant",c&&c.el[0].id||"")}},{ATTRS:{contentTpl:{value:g.ContentTpl+'<div class="{{getBaseCssClasses "dropdown"}}"><div class="{{getBaseCssClasses "dropdown-inner"}}"></div>'}}})},{requires:["button","component/extension/content-render"]});
KISSY.add("menubutton/base",function(f,d,g,c,o,h){function l(a){a.target.isMenuItem&&this.get("collapseOnClick")&&this.set("collapsed",!0)}function k(a){a.target.isMenu&&this.view.setAriaActiveDescendant(a.newVal)}var i=d.KeyCode,m=g.extend({isMenuButton:1,_onSetCollapsed:function(a){var b=this.get("menu");if(a)b.hide();else if(a=this.el,!b.get("visible")){var c={node:a,points:["bl","tl"],overflow:{adjustX:1,adjustY:1}};f.mix(b.get("align"),c,!1);this.get("matchElWidth")&&(b.render(),c=b.el,c=(parseInt(c.css("borderLeftWidth"))||
0)+(parseInt(c.css("borderRightWidth"))||0),b.set("width",b.get("align").node[0].offsetWidth-c));b.show();a.attr("aria-haspopup",b.el.attr("id"))}},bindUI:function(){this.on("afterHighlightedItemChange",k,this);this.on("click",l,this)},handleKeyDownInternal:function(a){var b=a.keyCode,c=""+a.type,e=this.get("menu");if(b==i.SPACE){if(a.preventDefault(),"keyup"!=c)return h}else if("keydown"!=c)return h;return e.get("rendered")&&e.get("visible")?(a=e.handleKeyDownInternal(a),b==i.ESC?(this.set("collapsed",
!0),!0):a):b==i.SPACE||b==i.DOWN||b==i.UP?(this.set("collapsed",!1),!0):h},handleClickInternal:function(){this.set("collapsed",!this.get("collapsed"))},handleBlurInternal:function(a){m.superclass.handleBlurInternal.call(this,a);this.set("collapsed",!0)},addItem:function(a,b){this.get("menu").addChild(a,b)},removeItem:function(a,b){this.get("menu").removeChild(a,b)},removeItems:function(a){var b=this.get("menu");b&&(b.removeChildren?b.removeChildren(a):b.children&&(b.children=[]))},getItemAt:function(a){var b=
self.get("menu");return b.get("rendered")&&b.getChildAt(a)},_onSetDisabled:function(a){!a&&this.set("collapsed",!0)},destructor:function(){this.get("menu").destroy()}},{ATTRS:{matchElWidth:{value:!0},collapseOnClick:{value:!1},menu:{value:{},getter:function(a){a.isController||(a.xclass=a.xclass||"popupmenu",a=this.createComponent(a),this.setInternal("menu",a));return a},setter:function(a){a.isController&&a.setInternal("parent",this)}},collapsed:{value:!1,view:1},xrender:{value:c}},xclass:"menu-button"});
return m},{requires:["node","button","./render","menu"]});KISSY.add("menubutton/option",function(f,d){return d.Item.extend({},{ATTRS:{selectable:{value:!0},textContent:{}},xclass:"option"})},{requires:["menu"]});
KISSY.add("menubutton/select",function(f,d,g,c,o,h){function l(e){var j=e.get("menu"),j=j.children||j.get&&j.get("children")||[],e=e.get("value"),a,b;for(b=0;b<j.length;b++)if(a=j[b],k(a)==e)return a;return null}function k(e){var a;if(e)if(e.get){if((a=e.get("value"))===h)a=e.get("textContent")||e.get("content")}else if((a=e.value)===h)a=e.textContent||e.content;return a}function i(a){var j=a.get("menu"),b=a.get("value"),a=j&&j.get&&j.get("children");f.each(a,function(a){a&&a.set&&a.set("selected",
k(a)==b)})}function m(a){var b=l(this),c=this.get("menu");a.target===c&&((a=b||c.getChildAt(0))&&a.set("highlighted",!0),b&&b.set("selected",!0))}function a(a){var b=l(a),c=b&&(b.textContent||b.get&&b.get("textContent")),b=b&&(b.content||b.get&&b.get("content"));a.set("content",c||b||a.get("defaultCaption"))}function b(a){a=a.target;if(a.isMenuItem){var a=k(a),b=this.get("value");this.set("value",a);a!=b&&this.fire("change",{prevVal:b,newVal:a})}}var n=g.extend({bindUI:function(){this.on("click",
b,this);this.on("show",m,this)},removeItems:function(){n.superclass.removeItems.apply(this,arguments);this.set("value",null)},removeItem:function(a,b){n.superclass.removeItem.apply(this,arguments);a.get("value")==this.get("value")&&this.set("value",null)},_onSetValue:function(){i(this);a(this)},_onSetDefaultCaption:function(){a(this)}},{ATTRS:{value:{},defaultCaption:{value:""},collapseOnClick:{value:!0}},decorate:function(a,b){a=f.one(a);b=b||{};b.elBefore=a;var c,g=[],i,k=null,l=a.val();a.all("option").each(function(a){var b=
{xclass:"option",content:a.text(),elCls:a.attr("class"),value:a.val()};l==a.val()&&(k={content:b.content,value:b.value});g.push(b)});f.mix(b,{menu:f.mix({children:g},b.menuCfg)});delete b.menuCfg;i=(new n(f.mix(b,k))).render();if(c=a.attr("name")){var m=(new d("<input type='hidden' name='"+c+"' value='"+l+"'>")).insertBefore(a,h);i.on("afterValueChange",function(a){m.val(a.newVal||"")})}a.remove();return i},xclass:"select"});return n},{requires:["node","./base","menu","./option"]});
KISSY.add("menubutton",function(f,d,g,c){d.Select=g;d.Option=c;return d},{requires:["menubutton/base","menubutton/select","menubutton/option"]});
