/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: May 13 21:02
*/
KISSY.add("menubutton/base-render",function(d,f,h){return f.Render.extend({initializer:function(){d.mix(this.get("elAttrs"),{"aria-expanded":!1,"aria-haspopup":!0});this.get("childrenElSelectors").contentEl="#ks-menu-button-caption{id}"},_onSetContent:function(d){this.get("contentEl").html(d).unselectable()},_onSetCollapsed:function(d){var f=this.get("el"),i=this.getCssClassWithPrefix("menu-button-open");f[d?"removeClass":"addClass"](i).attr("aria-expanded",!d)},setAriaActiveDescendant:function(d){this.get("el").attr("aria-activedescendant",
d&&d.get("el").attr("id")||"")}},{ATTRS:{contentTpl:{value:h},collapsed:{value:!0,sync:!1}},HTML_PARSER:{contentEl:function(d){return d.children("."+this.get("prefixCls")+"menu-button-caption")}}})},{requires:["button","./menubutton-tpl"]});
KISSY.add("menubutton/base",function(d,f,h,o,p,i,j){function k(c){c.target.isMenuItem&&this.get("collapseOnClick")&&this.set("collapsed",!0)}function q(c){c.target.isMenu&&this.get("view").setAriaActiveDescendant(c.newVal)}function g(c,a){var b=c.get("menu");if(b&&!b.isController)if(a)b=i.create(b,c),c.setInternal("menu",b);else return null;return b}function m(){var c,a,e=g(this);e&&e.get("visible")&&(c=e.get("align"),a=c.node,delete c.node,c=d.clone(c),c.node=a||this.get("el"),d.mix(c,b,!1),e.set("align",
c))}var n=f.all,l=n(d.Env.host),a=f.KeyCodes,b={points:["bl","tl"],overflow:{adjustX:1,adjustY:1}},e=h.extend([i.DecorateChild],{isMenuButton:1,_onSetCollapsed:function(c){if(c)(c=g(this))&&c.hide();else{var c=this.get("el"),a=g(this,1);a&&!a.get("visible")&&(this.get("matchElWidth")&&a.set("width",n(a.get("align").node||c).innerWidth()),a.show(),m.call(this),c.attr("aria-haspopup",a.get("el").attr("id")))}},bindUI:function(){this.on("afterHighlightedItemChange",q,this);l.on("resize",this.__repositionBuffer=
d.buffer(m,50),this);this.on("click",k,this)},handleKeyEventInternal:function(c){var b=c.keyCode,d=""+c.type,e=g(this);if(b==a.SPACE){if(c.preventDefault(),"keyup"!=d)return j}else if("keydown"!=d)return j;return e&&e.get("visible")?(c=e.handleKeydown(c),b==a.ESC?(this.set("collapsed",!0),!0):c):b==a.SPACE||b==a.DOWN||b==a.UP?(this.set("collapsed",!1),!0):j},performActionInternal:function(){this.set("collapsed",!this.get("collapsed"))},handleBlur:function(c){e.superclass.handleBlur.call(this,c);this.set("collapsed",
!0)},addItem:function(c,a){g(this,1).addChild(c,a)},removeItem:function(c,a){var b=g(this);b&&b.removeChild(c,a)},removeItems:function(c){var a=this.get("menu");a&&(a.removeChildren?a.removeChildren(c):a.children&&(a.children=[]))},getItemAt:function(a){var b=g(this);return b&&b.getChildAt(a)},_onSetDisabled:function(a){!a&&this.set("collapsed",!0)},decorateChildrenInternal:function(a,b){b.css("top","-9999").prependTo(b[0].ownerDocument.body);this.setInternal("menu",i.DecorateChild.prototype.decorateChildrenInternal.call(this,
a,b,this.get("menu")))},destructor:function(){var a;if(a=this.__repositionBuffer)n(l).detach("resize",a,this),a.stop();a=this.get("menu");a.destroy&&a.destroy()}},{ATTRS:{matchElWidth:{value:!0},collapseOnClick:{value:!1},decorateChildCls:{value:"popupmenu"},menu:{value:{},setter:function(a){a&&a.isController&&a.setInternal("parent",this)}},defaultChildCfg:{value:{xclass:"popupmenu"}},collapsed:{view:1},xrender:{value:o}}},{xclass:"menu-button",priority:20});return e},{requires:["node","button","./base-render",
"menu","component/base"]});KISSY.add("menubutton/menubutton-tpl",function(){return'<div id="ks-menu-button-caption{{id}}"\n        class="{{prefixCls}}menu-button-caption">{{{content}}}</div>\n<div class="{{prefixCls}}menu-button-dropdown">\n    <div class="{{prefixCls}}menu-button-dropdown-inner">\n    </div>\n</div>'});KISSY.add("menubutton",function(d,f,h,o,p){f.Render=h;f.Select=o;f.Option=p;return f},{requires:["menubutton/base","menubutton/base-render","menubutton/select","menubutton/option"]});
KISSY.add("menubutton/option",function(d,f){return f.Item.extend({},{ATTRS:{selectable:{value:!0},textContent:{}}},{xclass:"option",priority:10})},{requires:["menu"]});
KISSY.add("menubutton/select",function(d,f,h,o,p,i){function j(a){var b=a.get("menu"),b=b.children||b.get&&b.get("children")||[],a=a.get("value"),d,c;for(c=0;c<b.length;c++)if(d=b[c],k(d)==a)return d;return null}function k(a){var b;if(a)if(a.get){if((b=a.get("value"))===i)b=a.get("textContent")||a.get("content")}else if((b=a.value)===i)b=a.textContent||a.content;return b}function q(a){var b=a.get("menu"),e=a.get("value"),a=b&&b.get&&b.get("children");d.each(a,function(a){a&&a.set&&a.set("selected",
k(a)==e)})}function g(a){var b=j(this),d=this.get("menu");a.target===d&&((a=b||d.getChildAt(0))&&a.set("highlighted",!0),b&&b.set("selected",!0))}function m(a){var b=j(a),d=b&&(b.textContent||b.get&&b.get("textContent")),b=b&&(b.content||b.get&&b.get("content"));a.set("content",d||b||a.get("defaultCaption"))}function n(a){a=a.target;if(a.isMenuItem){var a=k(a),b=this.get("value");this.set("value",a);a!=b&&this.fire("change",{prevVal:b,newVal:a})}}var l=h.extend({bindUI:function(){this.on("click",
n,this);this.on("show",g,this)},removeItems:function(){l.superclass.removeItems.apply(this,arguments);this.set("value",null)},removeItem:function(a,b){l.superclass.removeItem.apply(this,arguments);a.get("value")==this.get("value")&&this.set("value",null)},_onSetValue:function(){q(this);m(this)},_onSetDefaultCaption:function(){m(this)}},{ATTRS:{value:{},defaultCaption:{value:""},collapseOnClick:{value:!0}},decorate:function(a,b){a=d.one(a);b=b||{};b.elBefore=a;var e,c=[],g,h=null,j=a.val();a.all("option").each(function(a){var b=
{xclass:"option",content:a.text(),elCls:a.attr("class"),value:a.val()};j==a.val()&&(h={content:b.content,value:b.value});c.push(b)});d.mix(b,{menu:d.mix({children:c},b.menuCfg)});delete b.menuCfg;g=(new l(d.mix(b,h))).render();if(e=a.attr("name")){var k=(new f("<input type='hidden' name='"+e+"' value='"+j+"'>")).insertBefore(a,i);g.on("afterValueChange",function(a){k.val(a.newVal||"")})}a.remove();return g}},{xclass:"select",priority:30});return l},{requires:["node","./base","menu","./option"]});
