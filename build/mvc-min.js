/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: May 30 01:42
*/
KISSY.add("mvc/model",function(c,j){function g(){g.superclass.constructor.apply(this,arguments);this.collections={}}var h="idAttribute,clientId,urlRoot,url,parse,sync".split(",");c.extend(g,j,{addToCollection:function(b){this.collections[c.stamp(b)]=b;this.addTarget(b)},removeFromCollection:function(b){delete this.collections[c.stamp(b)];this.removeTarget(b)},getId:function(){return this.get(this.get("idAttribute"))},setId:function(b){return this.set(this.get("idAttribute"),b)},setInternal:function(){this.__isModified=
1;return g.superclass.setInternal.apply(this,arguments)},isNew:function(){return!this.getId()},isModified:function(){return!(!this.isNew()&&!this.__isModified)},destroy:function(b){var a=this,b=b||{},f=b.success;b.success=function(d){var e=a.collections;if(d){var c=a.get("parse").call(a,d);c&&a.set(c,b)}for(var g in e)e[g].remove(a,b);a.fire("destroy");f&&f.apply(this,arguments)};!a.isNew()&&b["delete"]?a.get("sync").call(a,a,"delete",b):(b.success(),b.complete&&b.complete());return a},load:function(b){var a=
this,b=b||{},f=b.success;b.success=function(d){if(d){var e=a.get("parse").call(a,d);e&&a.set(e,b)}a.__isModified=0;f&&f.apply(this,arguments)};a.get("sync").call(a,a,"read",b);return a},save:function(b){var a=this,b=b||{},f=b.success;b.success=function(d){if(d){var e=a.get("parse").call(a,d);e&&a.set(e,b)}a.__isModified=0;f&&f.apply(this,arguments)};a.get("sync").call(a,a,a.isNew()?"create":"update",b);return a},toJSON:function(){var b=this.getAttrVals();c.each(h,function(a){delete b[a]});return b}},
{ATTRS:{idAttribute:{value:"id"},clientId:{valueFn:function(){return c.guid("mvc-client")}},url:{value:function(){var b,a,f=this.collections;for(b in f)if(f.hasOwnProperty(b)){a=f[b];break}b=a;var d;b=(b&&(d=b.get("url"))?"string"==typeof d?d:d.call(b):d)||this.get("urlRoot");if(this.isNew())return b;b+="/"==b.charAt(b.length-1)?"":"/";return b+encodeURIComponent(this.getId())+"/"}},urlRoot:{value:""},sync:{value:function(){c.require("mvc").sync.apply(this,arguments)}},parse:{value:function(b){return b}}}});
return g},{requires:["base"]});
KISSY.add("mvc/collection",function(c,j,g,h){function b(){b.superclass.constructor.apply(this,arguments)}b.ATTRS={model:{value:g},models:{setter:function(a){this.remove(this.get("models"),{silent:1});this.add(a,{silent:1});return this.get("models")},value:[]},url:{value:""},comparator:{},sync:{value:function(){c.require("mvc").sync.apply(this,arguments)}},parse:{value:function(a){return a}}};c.extend(b,h,{sort:function(){var a=this.get("comparator");a&&this.get("models").sort(function(f,b){return a(f)-
a(b)})},toJSON:function(){return c.map(this.get("models"),function(a){return a.toJSON()})},add:function(a,b){var d=this,e=!0;if(c.isArray(a)){var k=[].concat(a);c.each(k,function(a){a=d._add(a,b);e=e&&a})}else e=d._add(a,b);return e},remove:function(a,b){var d=this;if(c.isArray(a)){var e=[].concat(a);c.each(e,function(a){d._remove(a,b)})}else a&&d._remove(a,b)},at:function(a){return this.get("models")[a]},_normModel:function(a){var b=!0;a instanceof g||(b=a,a=new (this.get("model")),b=a.set(b,{silent:1}));
return b&&a},load:function(a){var b=this,a=a||{},d=a.success;a.success=function(e){if(e){var k=b.get("parse").call(b,e);k&&b.set("models",k,a)}c.each(b.get("models"),function(a){a.__isModified=0});d&&d.apply(this,arguments)};b.get("sync").call(b,b,"read",a);return b},create:function(a,b){var d=this,b=b||{};if(a=this._normModel(a)){a.addToCollection(d);var e=b.success;b.success=function(){d.add(a,b);e&&e()};a.save(b)}return a},_add:function(a,b){if(a=this._normModel(a)){var b=b||{},d=this.get("models"),
e=this.get("comparator"),c=d.length;if(e)for(var g=e(a),c=0;c<d.length;c++){var i=e(d[c]);if(g<i)break}this.get("models").splice(c,0,a);a.addToCollection(this);b.silent||this.fire("add",{model:a})}return a},_remove:function(a,b){var b=b||{},d=c.indexOf(a,this.get("models"));-1!=d&&(this.get("models").splice(d,1),a.removeFromCollection(this));b.silent||this.fire("remove",{model:a})},getById:function(a){for(var b=this.get("models"),d=0;d<b.length;d++){var e=b[d];if(e.getId()===a)return e}return null},
getByCid:function(a){for(var b=this.get("models"),d=0;d<b.length;d++){var e=b[d];if(e.get("clientId")===a)return e}return null}});return b},{requires:["event","./model","base"]});
KISSY.add("mvc/view",function(c,j,g){function h(){h.superclass.constructor.apply(this,arguments);var a;(a=this.get("events"))&&this._afterEventsChange({newVal:a})}var b=j.all;h.ATTRS={el:{value:"<div />",getter:function(a){"string"==typeof a&&(a=b(a),this.setInternal("el",a));return a}},events:{}};c.extend(h,g,{_afterEventsChange:function(a){var b=a.prevVal;b&&this._removeEvents(b);this._addEvents(a.newVal)},_removeEvents:function(a){var b=this.get("el"),d;for(d in a){var e=a[d],c;for(c in e)b.undelegate(c,
d,"string"==typeof e[c]?this[e[c]]:e[c],this)}},_addEvents:function(a){var b=this.get("el"),d;for(d in a){var e=a[d],c;for(c in e)b.delegate(c,d,"string"==typeof e[c]?this[e[c]]:e[c],this)}},render:function(){return this},destroy:function(){this.get("el").remove()}});return h},{requires:["node","base"]});
KISSY.add("mvc/router",function(c,j,g){function h(a){var b,c;for(c=0;c<a.length;c++)if(b=a.charAt(c),"\\"==b)c++;else if("("==b)return c;throw Error("impossible to not to get capture group in kissy mvc route");}function b(a){a=a||location.href;if(i.nativeHistory&&o){var a=new c.Uri(a),b=a.getQuery().toString();return a.getPath().substr(i.urlRoot.length)+(b?"?"+b:"")}return(new c.Uri(a)).getFragment().replace(/^!/,"")}function a(a){c.endsWith(a,"/")&&(a=a.substring(0,a.length-1));return a}function f(a){a&&
(c.startsWith(a,"/")&&(a=a.substring(1)),a="/"+a);return a}function d(b,c){b=a(b);c=a(c);return b==c}function e(){var a,d,e=0,f=-1,g="",i=-1,j=0,k="";a=new c.Uri(b());var t=0;d=a.clone();d.query.reset();d=d.toString();m(r,function(a){var b=0;m(a[l],function(c){var s=c.regStr,o=c.paramNames,l=-1,n,p=c.name,q=c.callback;if(n=d.match(c.reg)){n.shift();var r=function(){if(o){var a={};m(n,function(b,c){a[o[c]]=b});return a}return[].concat(n)},c=function(){g=s;i=l;j=q;t=r();e=a;k=p;f=n.length};if(n.length)if(s)l=
h(s),l>i?c():l==i&&f>=n.length?n.length<f?c():s.length>g.length&&c():e||c();else return c(),b=1,!1;else return c(),b=1,!1}});if(b)return!1});t&&(a=a.query.get(),j.apply(e,[t,a,{path:d,url:location.href}]),a={name:k,paths:t,path:d,url:location.href,query:a},e.fire("route:"+k,a),e.fire("route",a))}function k(a,b,d){var e=b,f=[];return c.isFunction(d)?(b=c.escapeRegExp(b),b=b.replace(w,function(a,b,c,d,e){f.push(c||e);if(c)return"([^/]+)";if(e)return"(.*)"}),{name:e,paramNames:f,reg:RegExp("^"+b+"$"),
regStr:b,callback:d}):{name:e,reg:d.reg,callback:!c.isFunction(d.callback)&&"string"==typeof d.callback?a[d.callback]:d.callback}}function u(a){this[l]={};this.addRoutes(a.newVal)}function i(){i.superclass.constructor.apply(this,arguments);this.on("afterRoutesChange",u,this);u.call(this,{newVal:this.get("routes")});r.push(this)}var m=c.each,w=/(:([\w\d]+))|(\\\*([\w\d]+))/g,r=[],p=c.Env.host,v=p.document.documentMode||c.UA.ie,q=p.history,o=!(!q||!q.pushState),l="__routerMap";i.ATTRS={routes:{}};c.extend(i,
g,{addRoutes:function(a){var b=this;m(a,function(a,d){b[l][d]=k(b,d,!c.isFunction(a)&&"string"==typeof a?b[a]:a)})}},{hasRoute:function(a){var b=0;m(r,function(c){m(c[l],function(c){if(a.match(c.reg))return b=1,!1});if(b)return!1});return!!b},removeRoot:function(a){return(new c.Uri(a)).getPath().substr(i.urlRoot.length)},navigate:function(c,d){var d=d||{},g=d.replaceHistory,h;b()!==c?i.nativeHistory&&o?(q[g?"replaceState":"pushState"]({},"",location.protocol+"//"+location.host+a(i.urlRoot)+f(c)),
e()):(h="#!"+c,g?location.replace(h+(v&&8>v?j.REPLACE_HISTORY:"")):location.hash=h):d&&d.triggerRoute&&e()},start:function(c){c=c||{};if(i.__started)return c.success&&c.success();c.urlRoot=(c.urlRoot||"").replace(/\/$/,"");var g,h=c.nativeHistory,k=location.pathname,l=b(),m=location.hash.match(/#!.+/);g=i.urlRoot=c.urlRoot;if(i.nativeHistory=h)if(o)m&&d(k,g)&&(q.replaceState({},"",location.protocol+"//"+location.host+a(i.urlRoot)+f(l)),c.triggerRoute=1);else if(!d(k,g)){location.replace(a(g)+"/#!"+
l);return}setTimeout(function(){if(h&&o)j.on(p,"popstate",e);else j.on(p,"hashchange",e),c.triggerRoute=1;c.triggerRoute&&e();c.success&&c.success()},100);i.__started=1}});return i},{requires:["event","base"]});
KISSY.add("mvc/sync",function(c,j,g){var h={create:"POST",update:"POST","delete":"POST",read:"GET"};return function(b,a,f){var f=c.merge({type:h[a],dataType:"json"},f),d,e;d=f.data=f.data||{};d._method=a;f.url||(e=b.get("url"),f.url="string"==typeof e?e:e.call(b));if("create"==a||"update"==a)d.model=g.stringify(b.toJSON());return j(f)}},{requires:["io","json"]});
KISSY.add("mvc",function(c,j,g,h,b,a){return{sync:a,Model:j,View:h,Collection:g,Router:b}},{requires:["mvc/model","mvc/collection","mvc/view","mvc/router","mvc/sync"]});
