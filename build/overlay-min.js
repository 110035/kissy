/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: May 13 23:14
*/
KISSY.add("overlay/base",function(c,e,d,a,b,g,f){var h={hide:"hide",destroy:"destroy"};return e.Controller.extend([d.Position,a,d.Align,b,f],{bindUI:function(){var a=this,f=a.get("closeBtn");if(f)f.on("click",function(f){a.close();f.preventDefault()})},close:function(){this[h[this.get("closeAction")]||"hide"]();return this}},{ATTRS:{closable:{value:!1,view:1},closeBtn:{view:1},closeAction:{value:"hide"},focusable:{value:!1},allowTextSelection:{value:!0},handleMouseEvents:{value:!1},xrender:{value:g}}},
{xclass:"overlay",priority:10})},{requires:"component/base,component/extension,./extension/loading,./extension/mask,./overlay-render,./extension/overlay-effect".split(",")});KISSY.add("overlay/close-tpl",function(){return'{{#if closable}}\n<a href="javascript:void(\'close\')"\n   id="ks-ext-close{{id}}"\n   class="{{prefixCls}}ext-close"\n   role=\'button\'>\n    <span class="{{prefixCls}}ext-close-x">close</span>\n</a>\n{{/if}}'});
KISSY.add("overlay/dialog-render",function(c,e,d){function a(a,c,f){c=a.get(c);"string"==typeof f?c.html(f):c.html("").append(f)}return e.extend({initializer:function(){c.mix(this.get("elAttrs"),{role:"dialog","aria-labelledby":"ks-stdmod-header"+this.get("id")});c.mix(this.get("childrenElSelectors"),{header:"#ks-stdmod-header{id}",body:"#ks-stdmod-body{id}",footer:"#ks-stdmod-footer{id}"})},_onSetBodyStyle:function(a){this.get("body").css(a)},_onSetHeaderStyle:function(a){this.get("header").css(a)},
_onSetFooterStyle:function(a){this.get("footer").css(a)},_onSetBodyContent:function(b){a(this,"body",b)},_onSetHeaderContent:function(b){a(this,"header",b)},_onSetFooterContent:function(b){a(this,"footer",b)}},{ATTRS:{closable:{value:!1},contentTpl:{valueFn:function(){return d+this.get("closeTpl")}},headerContent:{sync:0},bodyContent:{sync:0},footerContent:{sync:0},headerStyle:{sync:0},bodyStyle:{sync:0},footerStyle:{sync:0},body:{},header:{},footer:{}},HTML_PARSER:{header:function(a){return a.one("."+
this.get("prefixCls")+"stdmod-header")},body:function(a){return a.one("."+this.get("prefixCls")+"stdmod-body")},footer:function(a){return a.one("."+this.get("prefixCls")+"stdmod-footer")}}})},{requires:["./overlay-render","./dialog-tpl"]});KISSY.add("overlay/dialog-tpl",function(){return'<div id="ks-contentbox{{id}}"\n        class="{{prefixCls}}contentbox {{prefixCls}}overlay-contentbox {{prefixCls}}dialog-contentbox">\n\n    <div class="{{prefixCls}}stdmod-header"\n         style="\n{{#if headerStyle}}\n{{#each headerStyle}} \n {{xkey}}:{{.}};  \n{{/each}} \n{{/if}}\n"\n         id="ks-stdmod-header{{id}}">\n        {{{headerContent}}}\n    </div>\n\n    <div class="{{prefixCls}}stdmod-body"\n         style="\n{{#if bodyStyle}}\n{{#each bodyStyle}} \n {{xkey}}:{{.}};  \n{{/each}} \n{{/if}}\n"\n         id="ks-stdmod-body{{id}}">\n        {{{bodyContent}}}\n    </div>\n\n    <div class="{{prefixCls}}stdmod-footer"\n         style="\n{{#if footerStyle}}\n{{#each footerStyle}} \n {{xkey}}:{{.}};  \n{{/each}} \n{{/if}}\n"\n         id="ks-stdmod-footer{{id}}">\n        {{{footerContent}}}\n    </div>\n\n</div>\n\n<div tabindex="0"\n     style="position: absolute"></div>'});
KISSY.add("overlay/dialog",function(c,e,d,a){var b=e.extend({__afterCreateEffectGhost:function(a){var b=this.get("body");a.all("."+this.get("prefixCls")+"stdmod-body").css({height:b.height(),width:b.width()}).html("");return a},handleKeyEventInternal:function(f){if(this.get("escapeToClose")&&f.keyCode===a.KeyCodes.ESC){if("select"!=f.target.nodeName.toLowerCase()||f.target.disabled)this.close(),f.halt()}else a:if(f.keyCode==g){var b=this.get("el"),c=a.all(f.target),d=b.last();if(c.equals(b)&&f.shiftKey)d[0].focus(),
f.halt();else if(c.equals(d)&&!f.shiftKey)this.focus(),f.halt();else if(c.equals(b)||b.contains(c))break a;f.halt()}},_onSetVisible:function(a){var c=this.get("el");if(a)this.__lastActive=c[0].ownerDocument.activeElement,this.set("focused",!0),c.attr("aria-hidden","false");else{c.attr("aria-hidden","true");try{this.__lastActive&&this.__lastActive.focus()}catch(d){}}b.superclass._onSetVisible.apply(this,arguments)}},{ATTRS:{header:{view:1},body:{view:1},footer:{view:1},bodyStyle:{value:{},view:1},
footerStyle:{value:{},view:1},headerStyle:{value:{},view:1},headerContent:{value:"",view:1},bodyContent:{value:"",view:1},footerContent:{value:"",view:1},closable:{value:!0},xrender:{value:d},focusable:{value:!0},escapeToClose:{value:!0}}},{xclass:"dialog",priority:20}),g=a.KeyCodes.TAB;return b},{requires:["./base","./dialog-render","node"]});
KISSY.add("overlay/extension/loading-render",function(c,e){function d(){}d.prototype={loading:function(){this._loadingExtEl||(this._loadingExtEl=(new e("<div class='"+this.get("prefixCls")+"ext-loading' style='position: absolute;border: none;width: 100%;top: 0;left: 0;z-index: 99999;height:100%;*height: expression(this.parentNode.offsetHeight);'/>")).appendTo(this.get("el")));this._loadingExtEl.show()},unloading:function(){var a=this._loadingExtEl;a&&a.hide()}};return d},{requires:["node"]});
KISSY.add("overlay/extension/loading",function(){function c(){}c.prototype={loading:function(){this.get("view").loading();return this},unloading:function(){this.get("view").unloading();return this}};return c});
KISSY.add("overlay/extension/mask-render",function(c,e){function d(a){a=a.getCssClassWithPrefix("ext-mask")+" "+a.getCssClassWithState("mask");a=g("<div  style='width:"+(b?"expression(KISSY.DOM.docWidth())":"100%")+";left:0;top:0;height:"+(b?"expression(KISSY.DOM.docHeight())":"100%")+";position:"+(b?"absolute":"fixed")+";' class='"+a+"'>"+(b?"<iframe style='position:absolute;left:0;top:0;background:red;width: expression(this.parentNode.offsetWidth);height: expression(this.parentNode.offsetHeight);filter:alpha(opacity=0);z-index:-1;'></iframe>":
"")+"</div>").prependTo("body");a.unselectable();a.on("mousedown",function(a){a.preventDefault()});return a}function a(){}var b=6===c.UA.ie,g=e.all;a.ATTRS={mask:{},maskNode:{}};a.prototype={__renderUI:function(){this.get("mask")&&this.set("maskNode",d(this))},__syncUI:function(){this.get("mask")&&this.ksSetMaskVisible(this.get("visible"))},ksSetMaskVisible:function(a){var b=this.getCssClassWithState("mask-shown"),c=this.get("maskNode"),d=this.getCssClassWithState("mask-hidden");a?c.removeClass(d).addClass(b):
c.removeClass(b).addClass(d)},__destructor:function(){var a;(a=this.get("maskNode"))&&a.remove()}};return a},{requires:["node"]});
KISSY.add("overlay/extension/mask",function(c,e){function d(){}function a(a,c,d,e){var k=a.effect||b;if(k==b)e.ksSetMaskVisible(d);else{e.ksSetMaskVisible(d);var e=a.duration,a=a.easing,o=d?1:0;c.stop(1,1);c.css("display",d?b:"block");c[k+g[k][o]](e,function(){c.css("display","")},a)}}d.ATTRS={mask:{view:1,value:!1},maskNode:{view:1}};var b="none",g={fade:["Out","In"],slide:["Up","Down"]};d.prototype={__bindUI:function(){var c,b,d=this.get("el"),g=this.get("view");if(b=this.get("mask")){c=this.get("maskNode");
if(b.closeOnClick)c.on(e.Gesture.tap,this.close,this);this.on("afterVisibleChange",function(k){if(k=k.newVal){var e=parseInt(d.css("z-index"))||1;c.css("z-index",e-1)}a(b,c,k,g)})}}};return d},{requires:["event"]});
KISSY.add("overlay/extension/overlay-effect",function(c){function e(a){var c=a.get("el").clone(!0);c.css({visibility:"visible",overflow:h}).addClass(a.get("prefixCls")+"overlay-ghost");return a.__afterCreateEffectGhost(c)}function d(a,b,d){a.__effectGhost&&a.__effectGhost.stop(1,1);var f=a.get("el"),g=c.all,j=a.get("effect"),i=g(j.target),g=j.duration,i=c.mix(i.offset(),{width:i.width(),height:i.height()}),m=c.mix(f.offset(),{width:f.width(),height:f.height()}),l=e(a),j=j.easing;l.insertAfter(f);
f.css("visibility",h);b?(b=i,i=m):b=m;l.css(b);a.__effectGhost=l;l.animate(i,{duration:g,easing:j,complete:function(){a.__effectGhost=null;l.remove();f.css("visibility","");d()}})}function a(a,b,c){var e=a.get("el"),h=a.get("effect"),j=h.effect||g,i=h.target;j==g&&!i?c():i?d(a,b,c):(a=h.duration,h=h.easing,i=b?1:0,e.stop(1,1),e.css({visibility:m,display:b?g:f}),e[j+n[j][i]](a,function(){e.css({display:f,visibility:""});c()},h))}function b(){}var g="none",f="block",h="hidden",m="visible",n={fade:["Out",
"In"],slide:["Up","Down"]};b.ATTRS={effect:{value:{effect:"",target:null,duration:0.5,easing:"easeOut"},setter:function(a){var b=a.effect;"string"==typeof b&&!n[b]&&(a.effect="")}}};b.prototype={__afterCreateEffectGhost:function(a){return a},_onSetVisible:function(b){var c=this;a(c,b,function(){c.fire(b?"show":"hide")})}};return b});
KISSY.add("overlay/overlay-render",function(c,e,d,a,b,g,f,h){return d.Render.extend([6===c.UA.ie?a.Shim.Render:null,a.Position.Render,b,h],{initializer:function(){c.mix(this.get("childrenElSelectors"),{contentEl:"#ks-contentbox{id}",closeBtn:"#ks-ext-close{id}"})},createDom:function(){if(!this.get("contentEl")){var a=c.all(c.substitute('<div class="{prefixCls}contentbox cls"></div>',{cls:this.getCssClassWithState("contentbox")}));a.append(this.get("el").contents());this.setInternal("contentEl",a);
this.get("el").append(a)}},getChildrenContainerEl:function(){return this.get("contentEl")}},{HTML_PARSER:{closeBtn:function(a){return a.one("."+this.get("prefixCls")+"ext-close")}},ATTRS:{closable:{},contentTpl:{value:g+f},closeTpl:{value:f}}})},{requires:"xtemplate,component/base,component/extension,./extension/loading-render,./overlay-tpl,./close-tpl,./extension/mask-render".split(",")});KISSY.add("overlay/overlay-tpl",function(){return'<div id="ks-contentbox{{id}}"\n     class="{{prefixCls}}contentbox {{prefixCls}}overlay-contentbox">\n    {{{content}}}\n</div>'});
KISSY.add("overlay",function(c,e,d,a,b,g){e.Render=d;a.Render=b;e.Dialog=a;c.Dialog=a;e.Popup=g;return c.Overlay=e},{requires:["overlay/base","overlay/overlay-render","overlay/dialog","overlay/dialog-render","overlay/popup"]});
KISSY.add("overlay/popup",function(c,e,d){return e.extend({initializer:function(){var a=this;a.get("trigger")&&("mouse"===a.get("triggerType")?(a._bindTriggerMouse(),a.on("afterRenderUI",function(){a._bindContainerMouse()})):a._bindTriggerClick())},_bindTriggerMouse:function(){var a=this,b=a.get("trigger"),e;a.__mouseEnterPopup=function(b){a._clearHiddenTimer();e=c.later(function(){a._showing(b);e=d},1E3*a.get("mouseDelay"))};b.on("mouseenter",a.__mouseEnterPopup);a._mouseLeavePopup=function(){e&&
(e.cancel(),e=d);a._setHiddenTimer()};b.on("mouseleave",a._mouseLeavePopup)},_bindContainerMouse:function(){this.get("el").on("mouseleave",this._setHiddenTimer,this).on("mouseenter",this._clearHiddenTimer,this)},_setHiddenTimer:function(){var a=this;a._hiddenTimer=c.later(function(){a._hiding()},1E3*a.get("mouseDelay"))},_clearHiddenTimer:function(){this._hiddenTimer&&(this._hiddenTimer.cancel(),this._hiddenTimer=d)},_bindTriggerClick:function(){var a=this;a.__clickPopup=function(b){b.halt();if(a.get("toggle"))a[a.get("visible")?
"_hiding":"_showing"](b);else a._showing(b)};a.get("trigger").on("click",a.__clickPopup)},_showing:function(a){this.set("currentTrigger",c.one(a.target));this.show()},_hiding:function(){this.set("currentTrigger",d);this.hide()},destructor:function(){var a,b=this.get("trigger");b&&(this.__clickPopup&&b.detach("click",this.__clickPopup),this.__mouseEnterPopup&&b.detach("mouseenter",this.__mouseEnterPopup),this._mouseLeavePopup&&b.detach("mouseleave",this._mouseLeavePopup));(a=this.get("el"))&&a.detach("mouseleave",
this._setHiddenTimer,this).detach("mouseenter",this._clearHiddenTimer,this)}},{ATTRS:{trigger:{setter:function(a){return c.all(a)}},triggerType:{value:"click"},currentTrigger:{},mouseDelay:{value:0.1},toggle:{value:!1}}},{xclass:"popup",priority:20})},{requires:["./base"]});
