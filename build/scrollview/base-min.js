/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: May 30 01:43
*/
KISSY.add("scrollview/base/render",function(c,n,o){var m,h={_onSetScrollLeft:function(c){this.get("contentEl")[0].style.left=-c+"px"},_onSetScrollTop:function(c){this.get("contentEl")[0].style.top=-c+"px"}};c.Features.isTransformSupported()&&(m=(c=c.Features.getTransformPrefix())?c+"Transform":"transform",h._onSetScrollLeft=function(c){var e=this.get("scrollTop");this.get("contentEl")[0].style[m]="translate3d("+-c+"px,"+-e+"px,0)"},h._onSetScrollTop=function(c){var e=this.get("scrollLeft");this.get("contentEl")[0].style[m]=
"translate3d("+-e+"px,"+-c+"px,0)"});return n.Render.extend([o.ContentRender],h,{ATTRS:{scrollLeft:{value:0},scrollTop:{value:0}}})},{requires:["component/base","component/extension"]});
KISSY.add("scrollview/base",function(c,n,o,m,h,p){var e=e,q=c.all,c=c.Features.isTouchSupported(),j=p.KeyCodes;return o.Controller.extend({bindUI:function(){var a=this.get("el");a.on("mousewheel",this._onMouseWheel,this);a.on("scroll",this._onElScroll,this)},syncUI:function(){var a=this.get("el")[0],d=this.get("contentEl"),b=d[0],i=Math.max(a.scrollHeight,b.scrollHeight),f=Math.max(a.scrollWidth,b.scrollWidth),b=a.clientHeight,e,c=a.clientWidth;this.scrollHeight=i;this.scrollWidth=f;this.clientHeight=
b;this.clientWidth=c;var g=d.offset();e=this._allowScroll={};i>b&&(e.top=1);f>c&&(e.left=1);this.minScroll={left:0,top:0};var j,h;this.maxScroll={left:j=f-c,top:h=i-b};a=q(a.ownerDocument);this.scrollStep={top:Math.max(0.7*b*b/a.height(),20),left:Math.max(0.7*c*c/a.width(),20)};b=this.get("snap");a=this.get("scrollLeft");i=this.get("scrollTop");if(b){var d=this._pages="string"==typeof b?d.all(b):d.children(),b=this.get("pageIndex"),l=this._pagesXY=[];d.each(function(a,b){var d=a.offset(),e=d.left-
g.left,d=d.top-g.top;e<=j&&d<=h&&(l[b]={x:e,y:d,index:b})});if(b){this.scrollToPage(b);return}}this.scrollTo(a,i)},_onElScroll:function(){var a=this.get("el")[0],d=a.scrollTop,b=a.scrollLeft;d&&this.set("scrollTop",d+this.get("scrollTop"));b&&this.set("scrollLeft",b+this.get("scrollLeft"));a.scrollTop=a.scrollLeft=0},handleKeyEventInternal:function(a){var d=a.target,b=n.nodeName(d);if("input"==b||"textarea"==b||"select"==b||n.hasAttr(d,"contenteditable"))return e;var a=a.keyCode,i=this.isAxisEnabled("x"),
f=this.isAxisEnabled("y"),d=this.minScroll,b=this.maxScroll,c=this.scrollStep,k,g=e;if(f){var h=c.top,m=this.clientHeight,l=this.get("scrollTop"),f=l==b.top;k=l==d.top;if(a==j.DOWN){if(f)return e;this.scrollTo(e,l+h);g=!0}else if(a==j.UP){if(k)return e;this.scrollTo(e,l-h);g=!0}else if(a==j.PAGE_DOWN){if(f)return e;this.scrollTo(e,l+m);g=!0}else if(a==j.PAGE_UP){if(k)return e;this.scrollTo(e,l-m);g=!0}}if(i)if(i=c.left,c=this.get("scrollLeft"),f=c==b.left,k=c==d.left,a==j.RIGHT){if(f)return e;this.scrollTo(c+
i);g=!0}else if(a==j.LEFT){if(k)return e;this.scrollTo(c-i);g=!0}return g},_onMouseWheel:function(a){if(!this.get("disabled")){var d,b,c=this.scrollStep,f,h=this.maxScroll,k=this.minScroll;if((f=a.deltaY)&&this.isAxisEnabled("y")){var g=this.get("scrollTop");d=h.top;b=k.top;g<=b&&0<f||g>=d&&0>f||(this.scrollTo(e,g-a.deltaY*c.top),a.preventDefault())}if((f=a.deltaX)&&this.isAxisEnabled("x"))g=this.get("scrollLeft"),d=h.left,b=k.left,g<=b&&0<f||g>=d&&0>f||(this.scrollTo(g-a.deltaX*c.left),a.preventDefault())}},
isAxisEnabled:function(a){return this._allowScroll["x"==a?"left":"top"]},stopAnimation:function(){this.get("contentEl").stop();var a=this.maxScroll,d=this.minScroll;this.set("scrollTop",Math.min(Math.max(this.get("scrollTop"),d.top),a.top));this.set("scrollLeft",Math.min(Math.max(this.get("scrollLeft"),d.left),a.left))},_uiSetPageIndex:function(a){this.scrollToPage(a)},_getPageIndexFromXY:function(a,d,b){var c=this._pagesXY.concat([]),f=d?"x":"y";c.sort(function(a,b){return a[f]-b[f]});if(0<b)for(d=
0;d<c.length;d++){if(b=c[d],b[f]>=a)return b.index}else for(d=c.length-1;0<=d;d--)if(b=c[d],b[f]<=a)return b.index;return e},scrollToPage:function(a,d){var b;if((b=this._pagesXY)&&b[a])this.setInternal("pageIndex",a),this.scrollTo(b[a].x,b[a].y,d)},scrollTo:function(a,d,b){var c=this;if(b){var f=c.get("scrollLeft"),h=c.get("scrollTop");c.get("contentEl").animate({xx:{fx:{frame:function(b,g){a!==e&&c.set("scrollLeft",f+g.pos*(a-f));d!==e&&c.set("scrollTop",h+g.pos*(d-h))}}}},b)}else a!==e&&c.set("scrollLeft",
a),d!==e&&c.set("scrollTop",d)}},{ATTRS:{contentEl:{view:1},scrollLeft:{view:1},scrollTop:{view:1},focusable:{value:!c},allowTextSelection:{value:!0},handleMouseEvents:{value:!1},snap:{value:!1},snapDuration:{value:0.3},snapEasing:{value:"easeOut"},pageIndex:{value:0},xrender:{value:h}}},{xclass:"scrollview"})},{requires:["dom","component/base","component/extension","./base/render","event"]});
